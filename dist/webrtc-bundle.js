function getLastValue(a,b,c,d){return getLastValueAt(a,b,c,d,1)}function getLastValueAt(a,b,c,d,e){var f=getDataSeries(a.id,b,c,d);return f?f.dataPoints_[f.dataPoints_.length-e].value:null}function getAvgValue(a,b,c,d){var e=getDataSeries(a.id,b,c,d);return e?e.getAvg():null}function getDataSeries(a,b,c,d){var e=this.dataSeriesId(a,b,c,d);return dataSeries[e]}function getDataSeriesByLabel(a,b,c){var d=Object.keys(dataSeries),e=[],f=new RegExp(a+".*"+b+".*"+c);for(i=0;i<d.length;i++){var g=d[i];if(f.test(g)){e.push(dataSeries[g])}}return e}function getValueBefore(a,b,c,d,e){var f=this.dataSeriesId(a.id,b,c,d),g=dataSeries[f];if(g){for(i=g.dataPoints_.length-1;i>=0;i--)if(g.dataPoints_[i].time<e)return g.dataPoints_[i].value;return g.dataPoints_[0].value}return null}function dataSeriesId(a,b,c,d){return a+"-"+b+"-"+c+"-"+d}function graphViewId(a,b,c,d){return a.id+"-"+b+"-"+c+"-"+d}function matchesType(a,b,c){return"video"==b&&isVideoStats(c)?!0:"audio"==b&&isAudioStats(c)&&("googJitterReceived"!=a||containsLabel(c,"audioOutputLevel"))?!0:!1}function isVideoStats(a){return containsLabel(a,"googFrameHeightSent")||containsLabel(a,"googFrameHeightReceived")}function isAudioStats(a){return containsLabel(a,"audioInputLevel")||containsLabel(a,"audioOutputLevel")}function getStatsDataType(a,b){return isVideoStats(b)?"video":isAudioStats(b)&&("googJitterReceived"!=a||containsLabel(b,"audioOutputLevel"))?"audio":null}function containsLabel(a,b){for(var c=0;c<a.length-1;c+=2)if(a[c]==b)return!0;return!1}function updateGraph(a,b,c,d,e){var f=bweCompoundGraphConfig[e]?"bweCompound":e,g=this.graphViewId(a,b,c,f);if(!graphViews[g]){var h=getStatsDataType(e,d.values);graphViews[g]=createStatsGraphView(a,b,c,f,h);var i=new Date(d.timestamp);graphViews[g].setDateRange(i,i)}var j=this.dataSeriesId(a.id,b,c,e);graphViews[g].hasDataSeries(dataSeries[j])||graphViews[g].addDataSeries(dataSeries[j]),graphViews[g].updateEndDate()}function drawSingleReport(a,b,c,d){if(d&&d.values)for(var e=0;e<d.values.length-1;e+=2){var f=d.values[e],g=parseInt(d.values[e+1]);if(!isNaN(g)){var h=dataSeriesId(a.id,b,c,f),i=h,j=f,k=g;dataConversionConfig[f]&&(addDataSeriesPoint(h,d.timestamp,f,g),k=dataConversionConfig[f].convertFunction(dataSeries[h],a,b,c),j=dataConversionConfig[f].convertedName,i=dataSeriesId(a.id,b,c,j)),addDataSeriesPoint(i,d.timestamp,j,k),updateGraph(a,b,c,d,f),j!=f&&updateGraph(a,b,c,d,j)}}}function addDataSeriesPoint(a,b,c,d){dataSeries[a]||(dataSeries[a]=new TimelineDataSeries,bweCompoundGraphConfig[c]&&dataSeries[a].setColor(bweCompoundGraphConfig[c].color)),"packetsLost"==c&&0>d&&(d=0),dataSeries[a].addPoint(b,d)}function ensureStatsGraphTopContainer(a,b,c){var d=a.id+"-"+b+"-"+c+"-graph-container",e=$('[id="'+d+'"]')[0];return e||(e=document.createElement("div"),e.id=d,e.className="stats-graph-container",a.appendChild(e)),e}function createStatsGraphView(a,b,c,d,e){var f=ensureStatsGraphTopContainer(a,b,c),g=a.id+"-"+b+"-"+c+"-"+d,h=g+"-div",i=g+"-canvas",j=document.createElement("div");return j.className="stats-graph-sub-container "+d+"-"+e,f.appendChild(j),j.innerHTML="<div>"+d+"</div><div id="+h+"><canvas id="+i+"></canvas></div>","bweCompound"==d&&j.insertBefore(createBweCompoundLegend(a,b+"-"+c),$('[id="'+h+'"]')[0]),new TimelineGraphView(h,i)}function createBweCompoundLegend(a,b){var c=document.createElement("div");for(var d in bweCompoundGraphConfig){var e=document.createElement("div");c.appendChild(e),e.innerHTML="<input type=checkbox checked></input>"+d,e.style.color=bweCompoundGraphConfig[d].color,e.dataSeriesId=a.id+"-"+b+"-"+d,e.graphViewId=a.id+"-"+b+"-bweCompound",e.firstChild.addEventListener("click",function(a){var b=dataSeries[a.target.parentNode.dataSeriesId];b.show(a.target.checked),graphViews[a.target.parentNode.graphViewId].repaint()})}return c}function initialize(){ssrcInfoManager=new SsrcInfoManager,peerConnectionUpdateTable=new PeerConnectionUpdateTable,statsTable=new StatsTable(ssrcInfoManager)}function getPeerConnectionId(a){return a.pid+"-"+a.lid}function extractSsrcInfo(a){("setLocalDescription"==a.type||"setRemoteDescription"==a.type)&&ssrcInfoManager.addSsrcStreamInfo(a.value)}function removePeerConnection(a){var b=$('[id="'+getPeerConnectionId(a)+'"]')[0];b&&peerConnectionsListElem.removeChild(b)}function addPeerConnection(a){var b=$('[id="'+getPeerConnectionId(a)+'"]')[0];return b||(b=document.createElement("li"),peerConnectionsListElem.appendChild(b),b.id=getPeerConnectionId(a)),b.innerHTML="<h3>PeerConnection "+b.id+"</h3><div>"+a.url+" "+a.servers+" "+a.constraints+"</div>",b.firstChild.title="Click to collapse or expand",b.firstChild.addEventListener("click",function(a){a.target.parentElement.className=""==a.target.parentElement.className?"peer-connection-hidden":""}),b}function updatePeerConnection(a){var b=$('[id="'+getPeerConnectionId(a)+'"]')[0];peerConnectionUpdateTable.addPeerConnectionUpdate(b,a),extractSsrcInfo(a)}function updateAllPeerConnections(a){for(var b=0;b<a.length;++b)for(var c=addPeerConnection(a[b]),d=a[b].log,e=0;e<d.length;++e)peerConnectionUpdateTable.addPeerConnectionUpdate(c,d[e]),extractSsrcInfo(d[e])}function addStats(a){var b=getPeerConnectionElement(a);if(b)for(var c=0;c<a.reports.length;++c){var d=a.reports[c];if(drawSingleReport(b,d.type,d.id,d.stats),statsTable.addStatsReport(b,d.type,d.id,d),isVideoStats(d.stats.values)){var e=new Date((new Date).getTime()-6e4),f=getLastValue(b,d.type,d.id,"packetsLost"),g=getLastValue(b,d.type,d.id,"packetsReceived");if(null!=f&&null!=g){var h=getValueBefore(b,d.type,d.id,"packetsLost",e),i=getValueBefore(b,d.type,d.id,"packetsReceived",e),j=(f-h)/(g-i)*100;10>j?($("#quality1").fadeIn(10),$("#quality2, #quality3, #quality4").fadeOut(10)):j>10&&20>j?($("#quality2").fadeIn(10),$("#quality1, #quality3, #quality4").fadeOut(10)):j>20&&100>j?($("#quality3").fadeIn(10),$("#quality1, #quality2, #quality4").fadeOut(10)):j>100&&1e3>j&&($("#quality4").fadeIn(10),$("#quality1, #quality2, #quality3").fadeOut(10))}}}}function getPeerConnectionElement(a){return $('[id="'+getPeerConnectionId(a)+'"]')[0]}function updateDumpStatus(a){dumpCreator.onUpdate(a)}function hex_sha1(a){return binb2hex(core_sha1(str2binb(a),a.length*chrsz))}function b64_sha1(a){return binb2b64(core_sha1(str2binb(a),a.length*chrsz))}function str_sha1(a){return binb2str(core_sha1(str2binb(a),a.length*chrsz))}function hex_hmac_sha1(a,b){return binb2hex(core_hmac_sha1(a,b))}function b64_hmac_sha1(a,b){return binb2b64(core_hmac_sha1(a,b))}function str_hmac_sha1(a,b){return binb2str(core_hmac_sha1(a,b))}function sha1_vm_test(){return"a9993e364706816aba3e25717850c26c9cd0d89d"==hex_sha1("abc")}function core_sha1(a,b){a[b>>5]|=128<<24-b%32,a[(b+64>>9<<4)+15]=b;var c,d,e,f,g,h,i,j,k=new Array(80),l=1732584193,m=-271733879,n=-1732584194,o=271733878,p=-1009589776;for(c=0;c<a.length;c+=16){for(f=l,g=m,h=n,i=o,j=p,d=0;80>d;d++)k[d]=16>d?a[c+d]:rol(k[d-3]^k[d-8]^k[d-14]^k[d-16],1),e=safe_add(safe_add(rol(l,5),sha1_ft(d,m,n,o)),safe_add(safe_add(p,k[d]),sha1_kt(d))),p=o,o=n,n=rol(m,30),m=l,l=e;l=safe_add(l,f),m=safe_add(m,g),n=safe_add(n,h),o=safe_add(o,i),p=safe_add(p,j)}return[l,m,n,o,p]}function sha1_ft(a,b,c,d){return 20>a?b&c|~b&d:40>a?b^c^d:60>a?b&c|b&d|c&d:b^c^d}function sha1_kt(a){return 20>a?1518500249:40>a?1859775393:60>a?-1894007588:-899497514}function core_hmac_sha1(a,b){var c=str2binb(a);c.length>16&&(c=core_sha1(c,a.length*chrsz));for(var d=new Array(16),e=new Array(16),f=0;16>f;f++)d[f]=909522486^c[f],e[f]=1549556828^c[f];var g=core_sha1(d.concat(str2binb(b)),512+b.length*chrsz);return core_sha1(e.concat(g),672)}function safe_add(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function rol(a,b){return a<<b|a>>>32-b}function str2binb(a){for(var b=[],c=(1<<chrsz)-1,d=0;d<a.length*chrsz;d+=chrsz)b[d>>5]|=(a.charCodeAt(d/chrsz)&c)<<32-chrsz-d%32;return b}function binb2str(a){for(var b="",c=(1<<chrsz)-1,d=0;d<32*a.length;d+=chrsz)b+=String.fromCharCode(a[d>>5]>>>32-chrsz-d%32&c);return b}function binb2hex(a){for(var b=hexcase?"0123456789ABCDEF":"0123456789abcdef",c="",d=0;d<4*a.length;d++)c+=b.charAt(a[d>>2]>>8*(3-d%4)+4&15)+b.charAt(a[d>>2]>>8*(3-d%4)&15);return c}function binb2b64(a){for(var b,c,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e="",f=0;f<4*a.length;f+=3)for(b=(a[f>>2]>>8*(3-f%4)&255)<<16|(a[f+1>>2]>>8*(3-(f+1)%4)&255)<<8|a[f+2>>2]>>8*(3-(f+2)%4)&255,c=0;4>c;c++)e+=8*f+6*c>32*a.length?b64pad:d.charAt(b>>6*(3-c)&63);return e}!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){function c(a){var b=a.length,c=fb.type(a);return"function"===c||fb.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}function d(a,b,c){if(fb.isFunction(b))return fb.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return fb.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(nb.test(b))return fb.filter(b,a,c);b=fb.filter(b,a)}return fb.grep(a,function(a){return fb.inArray(a,b)>=0!==c})}function e(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}function f(a){var b=vb[a]={};return fb.each(a.match(ub)||[],function(a,c){b[c]=!0}),b}function g(){pb.addEventListener?(pb.removeEventListener("DOMContentLoaded",h,!1),a.removeEventListener("load",h,!1)):(pb.detachEvent("onreadystatechange",h),a.detachEvent("onload",h))}function h(){(pb.addEventListener||"load"===event.type||"complete"===pb.readyState)&&(g(),fb.ready())}function i(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(Ab,"-$1").toLowerCase();if(c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:zb.test(c)?fb.parseJSON(c):c}catch(e){}fb.data(a,b,c)}else c=void 0}return c}function j(a){var b;for(b in a)if(("data"!==b||!fb.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function k(a,b,c,d){if(fb.acceptData(a)){var e,f,g=fb.expando,h=a.nodeType,i=h?fb.cache:a,j=h?a[g]:a[g]&&g;if(j&&i[j]&&(d||i[j].data)||void 0!==c||"string"!=typeof b)return j||(j=h?a[g]=W.pop()||fb.guid++:g),i[j]||(i[j]=h?{}:{toJSON:fb.noop}),("object"==typeof b||"function"==typeof b)&&(d?i[j]=fb.extend(i[j],b):i[j].data=fb.extend(i[j].data,b)),f=i[j],d||(f.data||(f.data={}),f=f.data),void 0!==c&&(f[fb.camelCase(b)]=c),"string"==typeof b?(e=f[b],null==e&&(e=f[fb.camelCase(b)])):e=f,e}}function l(a,b,c){if(fb.acceptData(a)){var d,e,f=a.nodeType,g=f?fb.cache:a,h=f?a[fb.expando]:fb.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){fb.isArray(b)?b=b.concat(fb.map(b,fb.camelCase)):b in d?b=[b]:(b=fb.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;for(;e--;)delete d[b[e]];if(c?!j(d):!fb.isEmptyObject(d))return}(c||(delete g[h].data,j(g[h])))&&(f?fb.cleanData([a],!0):db.deleteExpando||g!=g.window?delete g[h]:g[h]=null)}}}function m(){return!0}function n(){return!1}function o(){try{return pb.activeElement}catch(a){}}function p(a){var b=Lb.split("|"),c=a.createDocumentFragment();if(c.createElement)for(;b.length;)c.createElement(b.pop());return c}function q(a,b){var c,d,e=0,f=typeof a.getElementsByTagName!==yb?a.getElementsByTagName(b||"*"):typeof a.querySelectorAll!==yb?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||fb.nodeName(d,b)?f.push(d):fb.merge(f,q(d,b));return void 0===b||b&&fb.nodeName(a,b)?fb.merge([a],f):f}function r(a){Fb.test(a.type)&&(a.defaultChecked=a.checked)}function s(a,b){return fb.nodeName(a,"table")&&fb.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function t(a){return a.type=(null!==fb.find.attr(a,"type"))+"/"+a.type,a}function u(a){var b=Wb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function v(a,b){for(var c,d=0;null!=(c=a[d]);d++)fb._data(c,"globalEval",!b||fb._data(b[d],"globalEval"))}function w(a,b){if(1===b.nodeType&&fb.hasData(a)){var c,d,e,f=fb._data(a),g=fb._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)fb.event.add(b,c,h[c][d])}g.data&&(g.data=fb.extend({},g.data))}}function x(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!db.noCloneEvent&&b[fb.expando]){e=fb._data(b);for(d in e.events)fb.removeEvent(b,d,e.handle);b.removeAttribute(fb.expando)}"script"===c&&b.text!==a.text?(t(b).text=a.text,u(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),db.html5Clone&&a.innerHTML&&!fb.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&Fb.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}}function y(b,c){var d=fb(c.createElement(b)).appendTo(c.body),e=a.getDefaultComputedStyle?a.getDefaultComputedStyle(d[0]).display:fb.css(d[0],"display");return d.detach(),e}function z(a){var b=pb,c=ac[a];return c||(c=y(a,b),"none"!==c&&c||(_b=(_b||fb("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=(_b[0].contentWindow||_b[0].contentDocument).document,b.write(),b.close(),c=y(a,b),_b.detach()),ac[a]=c),c}function A(a,b){return{get:function(){var c=a();return null!=c?c?void delete this.get:(this.get=b).apply(this,arguments):void 0}}}function B(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=nc.length;e--;)if(b=nc[e]+c,b in a)return b;return d}function C(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=fb._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&Db(d)&&(f[g]=fb._data(d,"olddisplay",z(d.nodeName)))):f[g]||(e=Db(d),(c&&"none"!==c||!e)&&fb._data(d,"olddisplay",e?c:fb.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function D(a,b,c){var d=jc.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function E(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=fb.css(a,c+Cb[f],!0,e)),d?("content"===c&&(g-=fb.css(a,"padding"+Cb[f],!0,e)),"margin"!==c&&(g-=fb.css(a,"border"+Cb[f]+"Width",!0,e))):(g+=fb.css(a,"padding"+Cb[f],!0,e),"padding"!==c&&(g+=fb.css(a,"border"+Cb[f]+"Width",!0,e)));return g}function F(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=bc(a),g=db.boxSizing()&&"border-box"===fb.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=cc(a,b,f),(0>e||null==e)&&(e=a.style[b]),ec.test(e))return e;d=g&&(db.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+E(a,b,c||(g?"border":"content"),d,f)+"px"}function G(a,b,c,d,e){return new G.prototype.init(a,b,c,d,e)}function H(){return setTimeout(function(){oc=void 0}),oc=fb.now()}function I(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=Cb[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function J(a,b,c){for(var d,e=(uc[b]||[]).concat(uc["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function K(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},n=a.style,o=a.nodeType&&Db(a),p=fb._data(a,"fxshow");c.queue||(h=fb._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,fb.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[n.overflow,n.overflowX,n.overflowY],j=fb.css(a,"display"),k=z(a.nodeName),"none"===j&&(j=k),"inline"===j&&"none"===fb.css(a,"float")&&(db.inlineBlockNeedsLayout&&"inline"!==k?n.zoom=1:n.display="inline-block")),c.overflow&&(n.overflow="hidden",db.shrinkWrapBlocks()||l.always(function(){n.overflow=c.overflow[0],n.overflowX=c.overflow[1],n.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],qc.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(o?"hide":"show")){if("show"!==e||!p||void 0===p[d])continue;o=!0}m[d]=p&&p[d]||fb.style(a,d)}if(!fb.isEmptyObject(m)){p?"hidden"in p&&(o=p.hidden):p=fb._data(a,"fxshow",{}),f&&(p.hidden=!o),o?fb(a).show():l.done(function(){fb(a).hide()}),l.done(function(){var b;fb._removeData(a,"fxshow");for(b in m)fb.style(a,b,m[b])});for(d in m)g=J(o?p[d]:0,d,l),d in p||(p[d]=g.start,o&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function L(a,b){var c,d,e,f,g;for(c in a)if(d=fb.camelCase(c),e=b[d],f=a[c],fb.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=fb.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function M(a,b,c){var d,e,f=0,g=tc.length,h=fb.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=oc||H(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:fb.extend({},b),opts:fb.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:oc||H(),duration:c.duration,tweens:[],createTween:function(b,c){var d=fb.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(L(k,j.opts.specialEasing);g>f;f++)if(d=tc[f].call(j,a,k,j.opts))return d;return fb.map(k,J,j),fb.isFunction(j.opts.start)&&j.opts.start.call(a,j),fb.fx.timer(fb.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function N(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(ub)||[];if(fb.isFunction(c))for(;d=f[e++];)"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function O(a,b,c,d){function e(h){var i;return f[h]=!0,fb.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||g||f[j]?g?!(i=j):void 0:(b.dataTypes.unshift(j),e(j),!1)}),i}var f={},g=a===Sc;return e(b.dataTypes[0])||!f["*"]&&e("*")}function P(a,b){var c,d,e=fb.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&fb.extend(!0,a,c),a}function Q(a,b,c){for(var d,e,f,g,h=a.contents,i=a.dataTypes;"*"===i[0];)i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function R(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function S(a,b,c,d){var e;if(fb.isArray(b))fb.each(b,function(b,e){c||Wc.test(a)?d(a,e):S(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==fb.type(b))d(a,b);else for(e in b)S(a+"["+e+"]",b[e],c,d)}function T(){try{return new a.XMLHttpRequest}catch(b){}}function U(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function V(a){return fb.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}var W=[],X=W.slice,Y=W.concat,Z=W.push,$=W.indexOf,_={},ab=_.toString,bb=_.hasOwnProperty,cb="".trim,db={},eb="1.11.0",fb=function(a,b){return new fb.fn.init(a,b)},gb=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,hb=/^-ms-/,ib=/-([\da-z])/gi,jb=function(a,b){return b.toUpperCase()};fb.fn=fb.prototype={jquery:eb,constructor:fb,selector:"",length:0,toArray:function(){return X.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:X.call(this)},pushStack:function(a){var b=fb.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return fb.each(this,a,b)},map:function(a){return this.pushStack(fb.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(X.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:Z,sort:W.sort,splice:W.splice},fb.extend=fb.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||fb.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(fb.isPlainObject(c)||(b=fb.isArray(c)))?(b?(b=!1,f=a&&fb.isArray(a)?a:[]):f=a&&fb.isPlainObject(a)?a:{},g[d]=fb.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},fb.extend({expando:"jQuery"+(eb+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===fb.type(a)},isArray:Array.isArray||function(a){return"array"===fb.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return a-parseFloat(a)>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==fb.type(a)||a.nodeType||fb.isWindow(a))return!1;try{if(a.constructor&&!bb.call(a,"constructor")&&!bb.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(db.ownLast)for(b in a)return bb.call(a,b);for(b in a);return void 0===b||bb.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?_[ab.call(a)]||"object":typeof a},globalEval:function(b){b&&fb.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(hb,"ms-").replace(ib,jb)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,d){var e,f=0,g=a.length,h=c(a);if(d){if(h)for(;g>f&&(e=b.apply(a[f],d),e!==!1);f++);else for(f in a)if(e=b.apply(a[f],d),e===!1)break}else if(h)for(;g>f&&(e=b.call(a[f],f,a[f]),e!==!1);f++);else for(f in a)if(e=b.call(a[f],f,a[f]),e===!1)break;return a},trim:cb&&!cb.call("Â ")?function(a){return null==a?"":cb.call(a)}:function(a){return null==a?"":(a+"").replace(gb,"")},makeArray:function(a,b){var d=b||[];return null!=a&&(c(Object(a))?fb.merge(d,"string"==typeof a?[a]:a):Z.call(d,a)),d},inArray:function(a,b,c){var d;if(b){if($)return $.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;)a[e++]=b[d++];if(c!==c)for(;void 0!==b[d];)a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,d){var e,f=0,g=a.length,h=c(a),i=[];if(h)for(;g>f;f++)e=b(a[f],f,d),null!=e&&i.push(e);else for(f in a)e=b(a[f],f,d),null!=e&&i.push(e);return Y.apply([],i)},guid:1,proxy:function(a,b){var c,d,e;return"string"==typeof b&&(e=a[b],b=a,a=e),fb.isFunction(a)?(c=X.call(arguments,2),d=function(){return a.apply(b||this,c.concat(X.call(arguments)))},d.guid=a.guid=a.guid||fb.guid++,d):void 0},now:function(){return+new Date},support:db}),fb.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){_["[object "+b+"]"]=b.toLowerCase()});var kb=function(a){function b(a,b,c,d){var e,f,g,h,i,j,l,o,p,q;if((b?b.ownerDocument||b:O)!==G&&F(b),b=b||G,c=c||[],!a||"string"!=typeof a)return c;if(1!==(h=b.nodeType)&&9!==h)return[];if(I&&!d){if(e=sb.exec(a))if(g=e[1]){if(9===h){if(f=b.getElementById(g),!f||!f.parentNode)return c;if(f.id===g)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(g))&&M(b,f)&&f.id===g)return c.push(f),c}else{if(e[2])return _.apply(c,b.getElementsByTagName(a)),c;if((g=e[3])&&x.getElementsByClassName&&b.getElementsByClassName)return _.apply(c,b.getElementsByClassName(g)),c}if(x.qsa&&(!J||!J.test(a))){if(o=l=N,p=b,q=9===h&&a,1===h&&"object"!==b.nodeName.toLowerCase()){for(j=m(a),(l=b.getAttribute("id"))?o=l.replace(ub,"\\$&"):b.setAttribute("id",o),o="[id='"+o+"'] ",i=j.length;i--;)j[i]=o+n(j[i]);p=tb.test(a)&&k(b.parentNode)||b,q=j.join(",")}if(q)try{return _.apply(c,p.querySelectorAll(q)),c}catch(r){}finally{l||b.removeAttribute("id")}}}return v(a.replace(ib,"$1"),b,c,d)}function c(){function a(c,d){return b.push(c+" ")>y.cacheLength&&delete a[b.shift()],a[c+" "]=d}var b=[];return a}function d(a){return a[N]=!0,a}function e(a){var b=G.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function f(a,b){for(var c=a.split("|"),d=a.length;d--;)y.attrHandle[c[d]]=b}function g(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||W)-(~a.sourceIndex||W);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function h(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function i(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function j(a){return d(function(b){return b=+b,d(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function k(a){return a&&typeof a.getElementsByTagName!==V&&a}function l(){}function m(a,c){var d,e,f,g,h,i,j,k=S[a+" "];if(k)return c?0:k.slice(0);for(h=a,i=[],j=y.preFilter;h;){(!d||(e=jb.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),d=!1,(e=kb.exec(h))&&(d=e.shift(),f.push({value:d,type:e[0].replace(ib," ")}),h=h.slice(d.length));for(g in y.filter)!(e=ob[g].exec(h))||j[g]&&!(e=j[g](e))||(d=e.shift(),f.push({value:d,type:g,matches:e}),h=h.slice(d.length));if(!d)break}return c?h.length:h?b.error(a):S(a,i).slice(0)}function n(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function o(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=Q++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[P,f];if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e){if(i=b[N]||(b[N]={}),(h=i[d])&&h[0]===P&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function p(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function q(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function r(a,b,c,e,f,g){return e&&!e[N]&&(e=r(e)),f&&!f[N]&&(f=r(f,g)),d(function(d,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=d||u(b||"*",h.nodeType?[h]:h,[]),r=!a||!d&&b?p:q(p,m,a,h,i),s=c?f||(d?a:o||e)?[]:g:r;if(c&&c(r,s,h,i),e)for(j=q(s,n),e(j,[],h,i),k=j.length;k--;)(l=j[k])&&(s[n[k]]=!(r[n[k]]=l));if(d){if(f||a){if(f){for(j=[],k=s.length;k--;)(l=s[k])&&j.push(r[k]=l);f(null,s=[],j,i)}for(k=s.length;k--;)(l=s[k])&&(j=f?bb.call(d,l):m[k])>-1&&(d[j]=!(g[j]=l))}}else s=q(s===g?s.splice(o,s.length):s),f?f(null,g,s,i):_.apply(g,s)})}function s(a){for(var b,c,d,e=a.length,f=y.relative[a[0].type],g=f||y.relative[" "],h=f?1:0,i=o(function(a){return a===b},g,!0),j=o(function(a){return bb.call(b,a)>-1},g,!0),k=[function(a,c,d){return!f&&(d||c!==C)||((b=c).nodeType?i(a,c,d):j(a,c,d))}];e>h;h++)if(c=y.relative[a[h].type])k=[o(p(k),c)];else{if(c=y.filter[a[h].type].apply(null,a[h].matches),c[N]){for(d=++h;e>d&&!y.relative[a[d].type];d++);return r(h>1&&p(k),h>1&&n(a.slice(0,h-1).concat({value:" "===a[h-2].type?"*":""})).replace(ib,"$1"),c,d>h&&s(a.slice(h,d)),e>d&&s(a=a.slice(d)),e>d&&n(a))}k.push(c)}return p(k)}function t(a,c){var e=c.length>0,f=a.length>0,g=function(d,g,h,i,j){var k,l,m,n=0,o="0",p=d&&[],r=[],s=C,t=d||f&&y.find.TAG("*",j),u=P+=null==s?1:Math.random()||.1,v=t.length;for(j&&(C=g!==G&&g);o!==v&&null!=(k=t[o]);o++){if(f&&k){for(l=0;m=a[l++];)if(m(k,g,h)){i.push(k);break}j&&(P=u)}e&&((k=!m&&k)&&n--,d&&p.push(k))}if(n+=o,e&&o!==n){for(l=0;m=c[l++];)m(p,r,g,h);if(d){if(n>0)for(;o--;)p[o]||r[o]||(r[o]=Z.call(i));r=q(r)}_.apply(i,r),j&&!d&&r.length>0&&n+c.length>1&&b.uniqueSort(i)}return j&&(P=u,C=s),p};return e?d(g):g}function u(a,c,d){for(var e=0,f=c.length;f>e;e++)b(a,c[e],d);return d}function v(a,b,c,d){var e,f,g,h,i,j=m(a);if(!d&&1===j.length){if(f=j[0]=j[0].slice(0),f.length>2&&"ID"===(g=f[0]).type&&x.getById&&9===b.nodeType&&I&&y.relative[f[1].type]){if(b=(y.find.ID(g.matches[0].replace(vb,wb),b)||[])[0],!b)return c;a=a.slice(f.shift().value.length)}for(e=ob.needsContext.test(a)?0:f.length;e--&&(g=f[e],!y.relative[h=g.type]);)if((i=y.find[h])&&(d=i(g.matches[0].replace(vb,wb),tb.test(f[0].type)&&k(b.parentNode)||b))){if(f.splice(e,1),a=d.length&&n(f),!a)return _.apply(c,d),c;break}}return B(a,j)(d,b,!I,c,tb.test(a)&&k(b.parentNode)||b),c}var w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N="sizzle"+-new Date,O=a.document,P=0,Q=0,R=c(),S=c(),T=c(),U=function(a,b){return a===b&&(E=!0),0},V="undefined",W=1<<31,X={}.hasOwnProperty,Y=[],Z=Y.pop,$=Y.push,_=Y.push,ab=Y.slice,bb=Y.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},cb="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",db="[\\x20\\t\\r\\n\\f]",eb="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",fb=eb.replace("w","w#"),gb="\\["+db+"*("+eb+")"+db+"*(?:([*^$|!~]?=)"+db+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+fb+")|)|)"+db+"*\\]",hb=":("+eb+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+gb.replace(3,8)+")*)|.*)\\)|)",ib=new RegExp("^"+db+"+|((?:^|[^\\\\])(?:\\\\.)*)"+db+"+$","g"),jb=new RegExp("^"+db+"*,"+db+"*"),kb=new RegExp("^"+db+"*([>+~]|"+db+")"+db+"*"),lb=new RegExp("="+db+"*([^\\]'\"]*?)"+db+"*\\]","g"),mb=new RegExp(hb),nb=new RegExp("^"+fb+"$"),ob={ID:new RegExp("^#("+eb+")"),CLASS:new RegExp("^\\.("+eb+")"),TAG:new RegExp("^("+eb.replace("w","w*")+")"),ATTR:new RegExp("^"+gb),PSEUDO:new RegExp("^"+hb),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+db+"*(even|odd|(([+-]|)(\\d*)n|)"+db+"*(?:([+-]|)"+db+"*(\\d+)|))"+db+"*\\)|)","i"),bool:new RegExp("^(?:"+cb+")$","i"),needsContext:new RegExp("^"+db+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+db+"*((?:-\\d)?\\d*)"+db+"*\\)|)(?=[^-]|$)","i")},pb=/^(?:input|select|textarea|button)$/i,qb=/^h\d$/i,rb=/^[^{]+\{\s*\[native \w/,sb=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tb=/[+~]/,ub=/'|\\/g,vb=new RegExp("\\\\([\\da-f]{1,6}"+db+"?|("+db+")|.)","ig"),wb=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)};try{_.apply(Y=ab.call(O.childNodes),O.childNodes),Y[O.childNodes.length].nodeType}catch(xb){_={apply:Y.length?function(a,b){$.apply(a,ab.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}x=b.support={},A=b.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},F=b.setDocument=function(a){var b,c=a?a.ownerDocument||a:O,d=c.defaultView;return c!==G&&9===c.nodeType&&c.documentElement?(G=c,H=c.documentElement,I=!A(c),d&&d!==d.top&&(d.addEventListener?d.addEventListener("unload",function(){F()},!1):d.attachEvent&&d.attachEvent("onunload",function(){F()})),x.attributes=e(function(a){return a.className="i",!a.getAttribute("className")}),x.getElementsByTagName=e(function(a){return a.appendChild(c.createComment("")),!a.getElementsByTagName("*").length}),x.getElementsByClassName=rb.test(c.getElementsByClassName)&&e(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length
}),x.getById=e(function(a){return H.appendChild(a).id=N,!c.getElementsByName||!c.getElementsByName(N).length}),x.getById?(y.find.ID=function(a,b){if(typeof b.getElementById!==V&&I){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},y.filter.ID=function(a){var b=a.replace(vb,wb);return function(a){return a.getAttribute("id")===b}}):(delete y.find.ID,y.filter.ID=function(a){var b=a.replace(vb,wb);return function(a){var c=typeof a.getAttributeNode!==V&&a.getAttributeNode("id");return c&&c.value===b}}),y.find.TAG=x.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==V?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},y.find.CLASS=x.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==V&&I?b.getElementsByClassName(a):void 0},K=[],J=[],(x.qsa=rb.test(c.querySelectorAll))&&(e(function(a){a.innerHTML="<select t=''><option selected=''></option></select>",a.querySelectorAll("[t^='']").length&&J.push("[*^$]="+db+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||J.push("\\["+db+"*(?:value|"+cb+")"),a.querySelectorAll(":checked").length||J.push(":checked")}),e(function(a){var b=c.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&J.push("name"+db+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||J.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),J.push(",.*:")})),(x.matchesSelector=rb.test(L=H.webkitMatchesSelector||H.mozMatchesSelector||H.oMatchesSelector||H.msMatchesSelector))&&e(function(a){x.disconnectedMatch=L.call(a,"div"),L.call(a,"[s!='']:x"),K.push("!=",hb)}),J=J.length&&new RegExp(J.join("|")),K=K.length&&new RegExp(K.join("|")),b=rb.test(H.compareDocumentPosition),M=b||rb.test(H.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},U=b?function(a,b){if(a===b)return E=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!x.sortDetached&&b.compareDocumentPosition(a)===d?a===c||a.ownerDocument===O&&M(O,a)?-1:b===c||b.ownerDocument===O&&M(O,b)?1:D?bb.call(D,a)-bb.call(D,b):0:4&d?-1:1)}:function(a,b){if(a===b)return E=!0,0;var d,e=0,f=a.parentNode,h=b.parentNode,i=[a],j=[b];if(!f||!h)return a===c?-1:b===c?1:f?-1:h?1:D?bb.call(D,a)-bb.call(D,b):0;if(f===h)return g(a,b);for(d=a;d=d.parentNode;)i.unshift(d);for(d=b;d=d.parentNode;)j.unshift(d);for(;i[e]===j[e];)e++;return e?g(i[e],j[e]):i[e]===O?-1:j[e]===O?1:0},c):G},b.matches=function(a,c){return b(a,null,null,c)},b.matchesSelector=function(a,c){if((a.ownerDocument||a)!==G&&F(a),c=c.replace(lb,"='$1']"),!(!x.matchesSelector||!I||K&&K.test(c)||J&&J.test(c)))try{var d=L.call(a,c);if(d||x.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return b(c,G,null,[a]).length>0},b.contains=function(a,b){return(a.ownerDocument||a)!==G&&F(a),M(a,b)},b.attr=function(a,b){(a.ownerDocument||a)!==G&&F(a);var c=y.attrHandle[b.toLowerCase()],d=c&&X.call(y.attrHandle,b.toLowerCase())?c(a,b,!I):void 0;return void 0!==d?d:x.attributes||!I?a.getAttribute(b):(d=a.getAttributeNode(b))&&d.specified?d.value:null},b.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},b.uniqueSort=function(a){var b,c=[],d=0,e=0;if(E=!x.detectDuplicates,D=!x.sortStable&&a.slice(0),a.sort(U),E){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return D=null,a},z=b.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=z(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d++];)c+=z(b);return c},y=b.selectors={cacheLength:50,createPseudo:d,match:ob,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(vb,wb),a[3]=(a[4]||a[5]||"").replace(vb,wb),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||b.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&b.error(a[0]),a},PSEUDO:function(a){var b,c=!a[5]&&a[2];return ob.CHILD.test(a[0])?null:(a[3]&&void 0!==a[4]?a[2]=a[4]:c&&mb.test(c)&&(b=m(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(vb,wb).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=R[a+" "];return b||(b=new RegExp("(^|"+db+")"+a+"("+db+"|$)"))&&R(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==V&&a.getAttribute("class")||"")})},ATTR:function(a,c,d){return function(e){var f=b.attr(e,a);return null==f?"!="===c:c?(f+="","="===c?f===d:"!="===c?f!==d:"^="===c?d&&0===f.indexOf(d):"*="===c?d&&f.indexOf(d)>-1:"$="===c?d&&f.slice(-d.length)===d:"~="===c?(" "+f+" ").indexOf(d)>-1:"|="===c?f===d||f.slice(0,d.length+1)===d+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){for(;p;){for(l=b;l=l[p];)if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(k=q[N]||(q[N]={}),j=k[a]||[],n=j[0]===P&&j[1],m=j[0]===P&&j[2],l=n&&q.childNodes[n];l=++n&&l&&l[p]||(m=n=0)||o.pop();)if(1===l.nodeType&&++m&&l===b){k[a]=[P,n,m];break}}else if(s&&(j=(b[N]||(b[N]={}))[a])&&j[0]===P)m=j[1];else for(;(l=++n&&l&&l[p]||(m=n=0)||o.pop())&&((h?l.nodeName.toLowerCase()!==r:1!==l.nodeType)||!++m||(s&&((l[N]||(l[N]={}))[a]=[P,m]),l!==b)););return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,c){var e,f=y.pseudos[a]||y.setFilters[a.toLowerCase()]||b.error("unsupported pseudo: "+a);return f[N]?f(c):f.length>1?(e=[a,a,"",c],y.setFilters.hasOwnProperty(a.toLowerCase())?d(function(a,b){for(var d,e=f(a,c),g=e.length;g--;)d=bb.call(a,e[g]),a[d]=!(b[d]=e[g])}):function(a){return f(a,0,e)}):f}},pseudos:{not:d(function(a){var b=[],c=[],e=B(a.replace(ib,"$1"));return e[N]?d(function(a,b,c,d){for(var f,g=e(a,null,d,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,d,f){return b[0]=a,e(b,null,f,c),!c.pop()}}),has:d(function(a){return function(c){return b(a,c).length>0}}),contains:d(function(a){return function(b){return(b.textContent||b.innerText||z(b)).indexOf(a)>-1}}),lang:d(function(a){return nb.test(a||"")||b.error("unsupported lang: "+a),a=a.replace(vb,wb).toLowerCase(),function(b){var c;do if(c=I?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===H},focus:function(a){return a===G.activeElement&&(!G.hasFocus||G.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!y.pseudos.empty(a)},header:function(a){return qb.test(a.nodeName)},input:function(a){return pb.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:j(function(){return[0]}),last:j(function(a,b){return[b-1]}),eq:j(function(a,b,c){return[0>c?c+b:c]}),even:j(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:j(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:j(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:j(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},y.pseudos.nth=y.pseudos.eq;for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})y.pseudos[w]=h(w);for(w in{submit:!0,reset:!0})y.pseudos[w]=i(w);return l.prototype=y.filters=y.pseudos,y.setFilters=new l,B=b.compile=function(a,b){var c,d=[],e=[],f=T[a+" "];if(!f){for(b||(b=m(a)),c=b.length;c--;)f=s(b[c]),f[N]?d.push(f):e.push(f);f=T(a,t(e,d))}return f},x.sortStable=N.split("").sort(U).join("")===N,x.detectDuplicates=!!E,F(),x.sortDetached=e(function(a){return 1&a.compareDocumentPosition(G.createElement("div"))}),e(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||f("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),x.attributes&&e(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||f("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),e(function(a){return null==a.getAttribute("disabled")})||f(cb,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),b}(a);fb.find=kb,fb.expr=kb.selectors,fb.expr[":"]=fb.expr.pseudos,fb.unique=kb.uniqueSort,fb.text=kb.getText,fb.isXMLDoc=kb.isXML,fb.contains=kb.contains;var lb=fb.expr.match.needsContext,mb=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,nb=/^.[^:#\[\.,]*$/;fb.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?fb.find.matchesSelector(d,a)?[d]:[]:fb.find.matches(a,fb.grep(b,function(a){return 1===a.nodeType}))},fb.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(fb(a).filter(function(){for(b=0;e>b;b++)if(fb.contains(d[b],this))return!0}));for(b=0;e>b;b++)fb.find(a,d[b],c);return c=this.pushStack(e>1?fb.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(d(this,a||[],!1))},not:function(a){return this.pushStack(d(this,a||[],!0))},is:function(a){return!!d(this,"string"==typeof a&&lb.test(a)?fb(a):a||[],!1).length}});var ob,pb=a.document,qb=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,rb=fb.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:qb.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||ob).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof fb?b[0]:b,fb.merge(this,fb.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:pb,!0)),mb.test(c[1])&&fb.isPlainObject(b))for(c in b)fb.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}if(d=pb.getElementById(c[2]),d&&d.parentNode){if(d.id!==c[2])return ob.find(a);this.length=1,this[0]=d}return this.context=pb,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):fb.isFunction(a)?"undefined"!=typeof ob.ready?ob.ready(a):a(fb):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),fb.makeArray(a,this))};rb.prototype=fb.fn,ob=fb(pb);var sb=/^(?:parents|prev(?:Until|All))/,tb={children:!0,contents:!0,next:!0,prev:!0};fb.extend({dir:function(a,b,c){for(var d=[],e=a[b];e&&9!==e.nodeType&&(void 0===c||1!==e.nodeType||!fb(e).is(c));)1===e.nodeType&&d.push(e),e=e[b];return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),fb.fn.extend({has:function(a){var b,c=fb(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(fb.contains(this,c[b]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=lb.test(a)||"string"!=typeof a?fb(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&fb.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?fb.unique(f):f)},index:function(a){return a?"string"==typeof a?fb.inArray(this[0],fb(a)):fb.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(fb.unique(fb.merge(this.get(),fb(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),fb.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return fb.dir(a,"parentNode")},parentsUntil:function(a,b,c){return fb.dir(a,"parentNode",c)},next:function(a){return e(a,"nextSibling")},prev:function(a){return e(a,"previousSibling")},nextAll:function(a){return fb.dir(a,"nextSibling")},prevAll:function(a){return fb.dir(a,"previousSibling")},nextUntil:function(a,b,c){return fb.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return fb.dir(a,"previousSibling",c)},siblings:function(a){return fb.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return fb.sibling(a.firstChild)},contents:function(a){return fb.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:fb.merge([],a.childNodes)}},function(a,b){fb.fn[a]=function(c,d){var e=fb.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=fb.filter(d,e)),this.length>1&&(tb[a]||(e=fb.unique(e)),sb.test(a)&&(e=e.reverse())),this.pushStack(e)}});var ub=/\S+/g,vb={};fb.Callbacks=function(a){a="string"==typeof a?vb[a]||f(a):fb.extend({},a);var b,c,d,e,g,h,i=[],j=!a.once&&[],k=function(f){for(c=a.memory&&f,d=!0,g=h||0,h=0,e=i.length,b=!0;i&&e>g;g++)if(i[g].apply(f[0],f[1])===!1&&a.stopOnFalse){c=!1;break}b=!1,i&&(j?j.length&&k(j.shift()):c?i=[]:l.disable())},l={add:function(){if(i){var d=i.length;!function f(b){fb.each(b,function(b,c){var d=fb.type(c);"function"===d?a.unique&&l.has(c)||i.push(c):c&&c.length&&"string"!==d&&f(c)})}(arguments),b?e=i.length:c&&(h=d,k(c))}return this},remove:function(){return i&&fb.each(arguments,function(a,c){for(var d;(d=fb.inArray(c,i,d))>-1;)i.splice(d,1),b&&(e>=d&&e--,g>=d&&g--)}),this},has:function(a){return a?fb.inArray(a,i)>-1:!(!i||!i.length)},empty:function(){return i=[],e=0,this},disable:function(){return i=j=c=void 0,this},disabled:function(){return!i},lock:function(){return j=void 0,c||l.disable(),this},locked:function(){return!j},fireWith:function(a,c){return!i||d&&!j||(c=c||[],c=[a,c.slice?c.slice():c],b?j.push(c):k(c)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!d}};return l},fb.extend({Deferred:function(a){var b=[["resolve","done",fb.Callbacks("once memory"),"resolved"],["reject","fail",fb.Callbacks("once memory"),"rejected"],["notify","progress",fb.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return fb.Deferred(function(c){fb.each(b,function(b,f){var g=fb.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&fb.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?fb.extend(a,d):d}},e={};return d.pipe=d.then,fb.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b,c,d,e=0,f=X.call(arguments),g=f.length,h=1!==g||a&&fb.isFunction(a.promise)?g:0,i=1===h?a:fb.Deferred(),j=function(a,c,d){return function(e){c[a]=this,d[a]=arguments.length>1?X.call(arguments):e,d===b?i.notifyWith(c,d):--h||i.resolveWith(c,d)}};if(g>1)for(b=new Array(g),c=new Array(g),d=new Array(g);g>e;e++)f[e]&&fb.isFunction(f[e].promise)?f[e].promise().done(j(e,d,f)).fail(i.reject).progress(j(e,c,b)):--h;return h||i.resolveWith(d,f),i.promise()}});var wb;fb.fn.ready=function(a){return fb.ready.promise().done(a),this},fb.extend({isReady:!1,readyWait:1,holdReady:function(a){a?fb.readyWait++:fb.ready(!0)},ready:function(a){if(a===!0?!--fb.readyWait:!fb.isReady){if(!pb.body)return setTimeout(fb.ready);fb.isReady=!0,a!==!0&&--fb.readyWait>0||(wb.resolveWith(pb,[fb]),fb.fn.trigger&&fb(pb).trigger("ready").off("ready"))}}}),fb.ready.promise=function(b){if(!wb)if(wb=fb.Deferred(),"complete"===pb.readyState)setTimeout(fb.ready);else if(pb.addEventListener)pb.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1);else{pb.attachEvent("onreadystatechange",h),a.attachEvent("onload",h);var c=!1;try{c=null==a.frameElement&&pb.documentElement}catch(d){}c&&c.doScroll&&!function e(){if(!fb.isReady){try{c.doScroll("left")}catch(a){return setTimeout(e,50)}g(),fb.ready()}}()}return wb.promise(b)};var xb,yb="undefined";for(xb in fb(db))break;db.ownLast="0"!==xb,db.inlineBlockNeedsLayout=!1,fb(function(){var a,b,c=pb.getElementsByTagName("body")[0];c&&(a=pb.createElement("div"),a.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",b=pb.createElement("div"),c.appendChild(a).appendChild(b),typeof b.style.zoom!==yb&&(b.style.cssText="border:0;margin:0;width:1px;padding:1px;display:inline;zoom:1",(db.inlineBlockNeedsLayout=3===b.offsetWidth)&&(c.style.zoom=1)),c.removeChild(a),a=b=null)}),function(){var a=pb.createElement("div");if(null==db.deleteExpando){db.deleteExpando=!0;try{delete a.test}catch(b){db.deleteExpando=!1}}a=null}(),fb.acceptData=function(a){var b=fb.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return 1!==c&&9!==c?!1:!b||b!==!0&&a.getAttribute("classid")===b};var zb=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Ab=/([A-Z])/g;fb.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?fb.cache[a[fb.expando]]:a[fb.expando],!!a&&!j(a)},data:function(a,b,c){return k(a,b,c)},removeData:function(a,b){return l(a,b)},_data:function(a,b,c){return k(a,b,c,!0)},_removeData:function(a,b){return l(a,b,!0)}}),fb.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=fb.data(f),1===f.nodeType&&!fb._data(f,"parsedAttrs"))){for(c=g.length;c--;)d=g[c].name,0===d.indexOf("data-")&&(d=fb.camelCase(d.slice(5)),i(f,d,e[d]));fb._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){fb.data(this,a)}):arguments.length>1?this.each(function(){fb.data(this,a,b)}):f?i(f,a,fb.data(f,a)):void 0},removeData:function(a){return this.each(function(){fb.removeData(this,a)})}}),fb.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=fb._data(a,b),c&&(!d||fb.isArray(c)?d=fb._data(a,b,fb.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=fb.queue(a,b),d=c.length,e=c.shift(),f=fb._queueHooks(a,b),g=function(){fb.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return fb._data(a,c)||fb._data(a,c,{empty:fb.Callbacks("once memory").add(function(){fb._removeData(a,b+"queue"),fb._removeData(a,c)})})}}),fb.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?fb.queue(this[0],a):void 0===b?this:this.each(function(){var c=fb.queue(this,a,b);fb._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&fb.dequeue(this,a)})},dequeue:function(a){return this.each(function(){fb.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=fb.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};for("string"!=typeof a&&(b=a,a=void 0),a=a||"fx";g--;)c=fb._data(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var Bb=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Cb=["Top","Right","Bottom","Left"],Db=function(a,b){return a=b||a,"none"===fb.css(a,"display")||!fb.contains(a.ownerDocument,a)},Eb=fb.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===fb.type(c)){e=!0;for(h in c)fb.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,fb.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(fb(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},Fb=/^(?:checkbox|radio)$/i;!function(){var a=pb.createDocumentFragment(),b=pb.createElement("div"),c=pb.createElement("input");if(b.setAttribute("className","t"),b.innerHTML="  <link/><table></table><a href='/a'>a</a>",db.leadingWhitespace=3===b.firstChild.nodeType,db.tbody=!b.getElementsByTagName("tbody").length,db.htmlSerialize=!!b.getElementsByTagName("link").length,db.html5Clone="<:nav></:nav>"!==pb.createElement("nav").cloneNode(!0).outerHTML,c.type="checkbox",c.checked=!0,a.appendChild(c),db.appendChecked=c.checked,b.innerHTML="<textarea>x</textarea>",db.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue,a.appendChild(b),b.innerHTML="<input type='radio' checked='checked' name='t'/>",db.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,db.noCloneEvent=!0,b.attachEvent&&(b.attachEvent("onclick",function(){db.noCloneEvent=!1}),b.cloneNode(!0).click()),null==db.deleteExpando){db.deleteExpando=!0;try{delete b.test}catch(d){db.deleteExpando=!1}}a=b=c=null}(),function(){var b,c,d=pb.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(db[b+"Bubbles"]=c in a)||(d.setAttribute(c,"t"),db[b+"Bubbles"]=d.attributes[c].expando===!1);d=null}();var Gb=/^(?:input|select|textarea)$/i,Hb=/^key/,Ib=/^(?:mouse|contextmenu)|click/,Jb=/^(?:focusinfocus|focusoutblur)$/,Kb=/^([^.]*)(?:\.(.+)|)$/;fb.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=fb._data(a);if(q){for(c.handler&&(i=c,c=i.handler,e=i.selector),c.guid||(c.guid=fb.guid++),(g=q.events)||(g=q.events={}),(k=q.handle)||(k=q.handle=function(a){return typeof fb===yb||a&&fb.event.triggered===a.type?void 0:fb.event.dispatch.apply(k.elem,arguments)},k.elem=a),b=(b||"").match(ub)||[""],h=b.length;h--;)f=Kb.exec(b[h])||[],n=p=f[1],o=(f[2]||"").split(".").sort(),n&&(j=fb.event.special[n]||{},n=(e?j.delegateType:j.bindType)||n,j=fb.event.special[n]||{},l=fb.extend({type:n,origType:p,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&fb.expr.match.needsContext.test(e),namespace:o.join(".")},i),(m=g[n])||(m=g[n]=[],m.delegateCount=0,j.setup&&j.setup.call(a,d,o,k)!==!1||(a.addEventListener?a.addEventListener(n,k,!1):a.attachEvent&&a.attachEvent("on"+n,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,l):m.push(l),fb.event.global[n]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=fb.hasData(a)&&fb._data(a);if(q&&(k=q.events)){for(b=(b||"").match(ub)||[""],j=b.length;j--;)if(h=Kb.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=fb.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=k[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=m.length;f--;)g=m[f],!e&&p!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(m.splice(f,1),g.selector&&m.delegateCount--,l.remove&&l.remove.call(a,g));i&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||fb.removeEvent(a,n,q.handle),delete k[n])}else for(n in k)fb.event.remove(a,n+b[j],c,d,!0);fb.isEmptyObject(k)&&(delete q.handle,fb._removeData(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,j,k,l,m=[d||pb],n=bb.call(b,"type")?b.type:b,o=bb.call(b,"namespace")?b.namespace.split("."):[];if(h=k=d=d||pb,3!==d.nodeType&&8!==d.nodeType&&!Jb.test(n+fb.event.triggered)&&(n.indexOf(".")>=0&&(o=n.split("."),n=o.shift(),o.sort()),g=n.indexOf(":")<0&&"on"+n,b=b[fb.expando]?b:new fb.Event(n,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=o.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:fb.makeArray(c,[b]),j=fb.event.special[n]||{},e||!j.trigger||j.trigger.apply(d,c)!==!1)){if(!e&&!j.noBubble&&!fb.isWindow(d)){for(i=j.delegateType||n,Jb.test(i+n)||(h=h.parentNode);h;h=h.parentNode)m.push(h),k=h;k===(d.ownerDocument||pb)&&m.push(k.defaultView||k.parentWindow||a)}for(l=0;(h=m[l++])&&!b.isPropagationStopped();)b.type=l>1?i:j.bindType||n,f=(fb._data(h,"events")||{})[b.type]&&fb._data(h,"handle"),f&&f.apply(h,c),f=g&&h[g],f&&f.apply&&fb.acceptData(h)&&(b.result=f.apply(h,c),b.result===!1&&b.preventDefault());if(b.type=n,!e&&!b.isDefaultPrevented()&&(!j._default||j._default.apply(m.pop(),c)===!1)&&fb.acceptData(d)&&g&&d[n]&&!fb.isWindow(d)){k=d[g],k&&(d[g]=null),fb.event.triggered=n;try{d[n]()}catch(p){}fb.event.triggered=void 0,k&&(d[g]=k)}return b.result}},dispatch:function(a){a=fb.event.fix(a);var b,c,d,e,f,g=[],h=X.call(arguments),i=(fb._data(this,"events")||{})[a.type]||[],j=fb.event.special[a.type]||{};if(h[0]=a,a.delegateTarget=this,!j.preDispatch||j.preDispatch.call(this,a)!==!1){for(g=fb.event.handlers.call(this,a,i),b=0;(e=g[b++])&&!a.isPropagationStopped();)for(a.currentTarget=e.elem,f=0;(d=e.handlers[f++])&&!a.isImmediatePropagationStopped();)(!a.namespace_re||a.namespace_re.test(d.namespace))&&(a.handleObj=d,a.data=d.data,c=((fb.event.special[d.origType]||{}).handle||d.handler).apply(e.elem,h),void 0!==c&&(a.result=c)===!1&&(a.preventDefault(),a.stopPropagation()));return j.postDispatch&&j.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(e=[],f=0;h>f;f++)d=b[f],c=d.selector+" ",void 0===e[c]&&(e[c]=d.needsContext?fb(c,this).index(i)>=0:fb.find(c,this,null,[i]).length),e[c]&&e.push(d);e.length&&g.push({elem:i,handlers:e})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[fb.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];for(g||(this.fixHooks[e]=g=Ib.test(e)?this.mouseHooks:Hb.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new fb.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return a.target||(a.target=f.srcElement||pb),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,g.filter?g.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button,g=b.fromElement;return null==a.pageX&&null!=b.clientX&&(d=a.target.ownerDocument||pb,e=d.documentElement,c=d.body,a.pageX=b.clientX+(e&&e.scrollLeft||c&&c.scrollLeft||0)-(e&&e.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||c&&c.scrollTop||0)-(e&&e.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&g&&(a.relatedTarget=g===a.target?b.toElement:g),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==o()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===o()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return fb.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return fb.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=fb.extend(new fb.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?fb.event.trigger(e,null,b):fb.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},fb.removeEvent=pb.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]===yb&&(a[d]=null),a.detachEvent(d,c))},fb.Event=function(a,b){return this instanceof fb.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&(a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault())?m:n):this.type=a,b&&fb.extend(this,b),this.timeStamp=a&&a.timeStamp||fb.now(),void(this[fb.expando]=!0)):new fb.Event(a,b)},fb.Event.prototype={isDefaultPrevented:n,isPropagationStopped:n,isImmediatePropagationStopped:n,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=m,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=m,a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=m,this.stopPropagation()}},fb.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){fb.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!fb.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),db.submitBubbles||(fb.event.special.submit={setup:function(){return fb.nodeName(this,"form")?!1:void fb.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=fb.nodeName(b,"input")||fb.nodeName(b,"button")?b.form:void 0;c&&!fb._data(c,"submitBubbles")&&(fb.event.add(c,"submit._submit",function(a){a._submit_bubble=!0}),fb._data(c,"submitBubbles",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&fb.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return fb.nodeName(this,"form")?!1:void fb.event.remove(this,"._submit")}}),db.changeBubbles||(fb.event.special.change={setup:function(){return Gb.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(fb.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),fb.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),fb.event.simulate("change",this,a,!0)})),!1):void fb.event.add(this,"beforeactivate._change",function(a){var b=a.target;Gb.test(b.nodeName)&&!fb._data(b,"changeBubbles")&&(fb.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||fb.event.simulate("change",this.parentNode,a,!0)}),fb._data(b,"changeBubbles",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return fb.event.remove(this,"._change"),!Gb.test(this.nodeName)}}),db.focusinBubbles||fb.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){fb.event.simulate(b,a.target,fb.event.fix(a),!0)};fb.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=fb._data(d,b);e||d.addEventListener(a,c,!0),fb._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=fb._data(d,b)-1;e?fb._data(d,b,e):(d.removeEventListener(a,c,!0),fb._removeData(d,b))}}}),fb.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(f in a)this.on(f,b,c,a[f],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=n;
else if(!d)return this;return 1===e&&(g=d,d=function(a){return fb().off(a),g.apply(this,arguments)},d.guid=g.guid||(g.guid=fb.guid++)),this.each(function(){fb.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,fb(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=n),this.each(function(){fb.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){fb.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?fb.event.trigger(a,b,c,!0):void 0}});var Lb="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Mb=/ jQuery\d+="(?:null|\d+)"/g,Nb=new RegExp("<(?:"+Lb+")[\\s/>]","i"),Ob=/^\s+/,Pb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Qb=/<([\w:]+)/,Rb=/<tbody/i,Sb=/<|&#?\w+;/,Tb=/<(?:script|style|link)/i,Ub=/checked\s*(?:[^=]|=\s*.checked.)/i,Vb=/^$|\/(?:java|ecma)script/i,Wb=/^true\/(.*)/,Xb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Yb={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:db.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Zb=p(pb),$b=Zb.appendChild(pb.createElement("div"));Yb.optgroup=Yb.option,Yb.tbody=Yb.tfoot=Yb.colgroup=Yb.caption=Yb.thead,Yb.th=Yb.td,fb.extend({clone:function(a,b,c){var d,e,f,g,h,i=fb.contains(a.ownerDocument,a);if(db.html5Clone||fb.isXMLDoc(a)||!Nb.test("<"+a.nodeName+">")?f=a.cloneNode(!0):($b.innerHTML=a.outerHTML,$b.removeChild(f=$b.firstChild)),!(db.noCloneEvent&&db.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||fb.isXMLDoc(a)))for(d=q(f),h=q(a),g=0;null!=(e=h[g]);++g)d[g]&&x(e,d[g]);if(b)if(c)for(h=h||q(a),d=d||q(f),g=0;null!=(e=h[g]);g++)w(e,d[g]);else w(a,f);return d=q(f,"script"),d.length>0&&v(d,!i&&q(a,"script")),d=h=e=null,f},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k,l=a.length,m=p(b),n=[],o=0;l>o;o++)if(f=a[o],f||0===f)if("object"===fb.type(f))fb.merge(n,f.nodeType?[f]:f);else if(Sb.test(f)){for(h=h||m.appendChild(b.createElement("div")),i=(Qb.exec(f)||["",""])[1].toLowerCase(),k=Yb[i]||Yb._default,h.innerHTML=k[1]+f.replace(Pb,"<$1></$2>")+k[2],e=k[0];e--;)h=h.lastChild;if(!db.leadingWhitespace&&Ob.test(f)&&n.push(b.createTextNode(Ob.exec(f)[0])),!db.tbody)for(f="table"!==i||Rb.test(f)?"<table>"!==k[1]||Rb.test(f)?0:h:h.firstChild,e=f&&f.childNodes.length;e--;)fb.nodeName(j=f.childNodes[e],"tbody")&&!j.childNodes.length&&f.removeChild(j);for(fb.merge(n,h.childNodes),h.textContent="";h.firstChild;)h.removeChild(h.firstChild);h=m.lastChild}else n.push(b.createTextNode(f));for(h&&m.removeChild(h),db.appendChecked||fb.grep(q(n,"input"),r),o=0;f=n[o++];)if((!d||-1===fb.inArray(f,d))&&(g=fb.contains(f.ownerDocument,f),h=q(m.appendChild(f),"script"),g&&v(h),c))for(e=0;f=h[e++];)Vb.test(f.type||"")&&c.push(f);return h=null,m},cleanData:function(a,b){for(var c,d,e,f,g=0,h=fb.expando,i=fb.cache,j=db.deleteExpando,k=fb.event.special;null!=(c=a[g]);g++)if((b||fb.acceptData(c))&&(e=c[h],f=e&&i[e])){if(f.events)for(d in f.events)k[d]?fb.event.remove(c,d):fb.removeEvent(c,d,f.handle);i[e]&&(delete i[e],j?delete c[h]:typeof c.removeAttribute!==yb?c.removeAttribute(h):c[h]=null,W.push(e))}}}),fb.fn.extend({text:function(a){return Eb(this,function(a){return void 0===a?fb.text(this):this.empty().append((this[0]&&this[0].ownerDocument||pb).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=s(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=s(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?fb.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||fb.cleanData(q(c)),c.parentNode&&(b&&fb.contains(c.ownerDocument,c)&&v(q(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){for(1===a.nodeType&&fb.cleanData(q(a,!1));a.firstChild;)a.removeChild(a.firstChild);a.options&&fb.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return fb.clone(this,a,b)})},html:function(a){return Eb(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(Mb,""):void 0;if(!("string"!=typeof a||Tb.test(a)||!db.htmlSerialize&&Nb.test(a)||!db.leadingWhitespace&&Ob.test(a)||Yb[(Qb.exec(a)||["",""])[1].toLowerCase()])){a=a.replace(Pb,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(fb.cleanData(q(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,fb.cleanData(q(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=Y.apply([],a);var c,d,e,f,g,h,i=0,j=this.length,k=this,l=j-1,m=a[0],n=fb.isFunction(m);if(n||j>1&&"string"==typeof m&&!db.checkClone&&Ub.test(m))return this.each(function(c){var d=k.eq(c);n&&(a[0]=m.call(this,c,d.html())),d.domManip(a,b)});if(j&&(h=fb.buildFragment(a,this[0].ownerDocument,!1,this),c=h.firstChild,1===h.childNodes.length&&(h=c),c)){for(f=fb.map(q(h,"script"),t),e=f.length;j>i;i++)d=h,i!==l&&(d=fb.clone(d,!0,!0),e&&fb.merge(f,q(d,"script"))),b.call(this[i],d,i);if(e)for(g=f[f.length-1].ownerDocument,fb.map(f,u),i=0;e>i;i++)d=f[i],Vb.test(d.type||"")&&!fb._data(d,"globalEval")&&fb.contains(g,d)&&(d.src?fb._evalUrl&&fb._evalUrl(d.src):fb.globalEval((d.text||d.textContent||d.innerHTML||"").replace(Xb,"")));h=c=null}return this}}),fb.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){fb.fn[a]=function(a){for(var c,d=0,e=[],f=fb(a),g=f.length-1;g>=d;d++)c=d===g?this:this.clone(!0),fb(f[d])[b](c),Z.apply(e,c.get());return this.pushStack(e)}});var _b,ac={};!function(){var a,b,c=pb.createElement("div"),d="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";c.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=c.getElementsByTagName("a")[0],a.style.cssText="float:left;opacity:.5",db.opacity=/^0.5/.test(a.style.opacity),db.cssFloat=!!a.style.cssFloat,c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",db.clearCloneStyle="content-box"===c.style.backgroundClip,a=c=null,db.shrinkWrapBlocks=function(){var a,c,e,f;if(null==b){if(a=pb.getElementsByTagName("body")[0],!a)return;f="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",c=pb.createElement("div"),e=pb.createElement("div"),a.appendChild(c).appendChild(e),b=!1,typeof e.style.zoom!==yb&&(e.style.cssText=d+";width:1px;padding:1px;zoom:1",e.innerHTML="<div></div>",e.firstChild.style.width="5px",b=3!==e.offsetWidth),a.removeChild(c),a=c=e=null}return b}}();var bc,cc,dc=/^margin/,ec=new RegExp("^("+Bb+")(?!px)[a-z%]+$","i"),fc=/^(top|right|bottom|left)$/;a.getComputedStyle?(bc=function(a){return a.ownerDocument.defaultView.getComputedStyle(a,null)},cc=function(a,b,c){var d,e,f,g,h=a.style;return c=c||bc(a),g=c?c.getPropertyValue(b)||c[b]:void 0,c&&(""!==g||fb.contains(a.ownerDocument,a)||(g=fb.style(a,b)),ec.test(g)&&dc.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0===g?g:g+""}):pb.documentElement.currentStyle&&(bc=function(a){return a.currentStyle},cc=function(a,b,c){var d,e,f,g,h=a.style;return c=c||bc(a),g=c?c[b]:void 0,null==g&&h&&h[b]&&(g=h[b]),ec.test(g)&&!fc.test(b)&&(d=h.left,e=a.runtimeStyle,f=e&&e.left,f&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"}),!function(){function b(){var b,c,d=pb.getElementsByTagName("body")[0];d&&(b=pb.createElement("div"),c=pb.createElement("div"),b.style.cssText=j,d.appendChild(b).appendChild(c),c.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;display:block;padding:1px;border:1px;width:4px;margin-top:1%;top:1%",fb.swap(d,null!=d.style.zoom?{zoom:1}:{},function(){e=4===c.offsetWidth}),f=!0,g=!1,h=!0,a.getComputedStyle&&(g="1%"!==(a.getComputedStyle(c,null)||{}).top,f="4px"===(a.getComputedStyle(c,null)||{width:"4px"}).width),d.removeChild(b),c=d=null)}var c,d,e,f,g,h,i=pb.createElement("div"),j="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",k="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";i.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",c=i.getElementsByTagName("a")[0],c.style.cssText="float:left;opacity:.5",db.opacity=/^0.5/.test(c.style.opacity),db.cssFloat=!!c.style.cssFloat,i.style.backgroundClip="content-box",i.cloneNode(!0).style.backgroundClip="",db.clearCloneStyle="content-box"===i.style.backgroundClip,c=i=null,fb.extend(db,{reliableHiddenOffsets:function(){if(null!=d)return d;var a,b,c,e=pb.createElement("div"),f=pb.getElementsByTagName("body")[0];return f?(e.setAttribute("className","t"),e.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=pb.createElement("div"),a.style.cssText=j,f.appendChild(a).appendChild(e),e.innerHTML="<table><tr><td></td><td>t</td></tr></table>",b=e.getElementsByTagName("td"),b[0].style.cssText="padding:0;margin:0;border:0;display:none",c=0===b[0].offsetHeight,b[0].style.display="",b[1].style.display="none",d=c&&0===b[0].offsetHeight,f.removeChild(a),e=f=null,d):void 0},boxSizing:function(){return null==e&&b(),e},boxSizingReliable:function(){return null==f&&b(),f},pixelPosition:function(){return null==g&&b(),g},reliableMarginRight:function(){var b,c,d,e;if(null==h&&a.getComputedStyle){if(b=pb.getElementsByTagName("body")[0],!b)return;c=pb.createElement("div"),d=pb.createElement("div"),c.style.cssText=j,b.appendChild(c).appendChild(d),e=d.appendChild(pb.createElement("div")),e.style.cssText=d.style.cssText=k,e.style.marginRight=e.style.width="0",d.style.width="1px",h=!parseFloat((a.getComputedStyle(e,null)||{}).marginRight),b.removeChild(c)}return h}})}(),fb.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var gc=/alpha\([^)]*\)/i,hc=/opacity\s*=\s*([^)]*)/,ic=/^(none|table(?!-c[ea]).+)/,jc=new RegExp("^("+Bb+")(.*)$","i"),kc=new RegExp("^([+-])=("+Bb+")","i"),lc={position:"absolute",visibility:"hidden",display:"block"},mc={letterSpacing:0,fontWeight:400},nc=["Webkit","O","Moz","ms"];fb.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=cc(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":db.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=fb.camelCase(b),i=a.style;if(b=fb.cssProps[h]||(fb.cssProps[h]=B(i,h)),g=fb.cssHooks[b]||fb.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if(f=typeof c,"string"===f&&(e=kc.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(fb.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||fb.cssNumber[h]||(c+="px"),db.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!(g&&"set"in g&&void 0===(c=g.set(a,c,d)))))try{i[b]="",i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=fb.camelCase(b);return b=fb.cssProps[h]||(fb.cssProps[h]=B(a.style,h)),g=fb.cssHooks[b]||fb.cssHooks[h],g&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=cc(a,b,d)),"normal"===f&&b in mc&&(f=mc[b]),""===c||c?(e=parseFloat(f),c===!0||fb.isNumeric(e)?e||0:f):f}}),fb.each(["height","width"],function(a,b){fb.cssHooks[b]={get:function(a,c,d){return c?0===a.offsetWidth&&ic.test(fb.css(a,"display"))?fb.swap(a,lc,function(){return F(a,b,d)}):F(a,b,d):void 0},set:function(a,c,d){var e=d&&bc(a);return D(a,c,d?E(a,b,d,db.boxSizing()&&"border-box"===fb.css(a,"boxSizing",!1,e),e):0)}}}),db.opacity||(fb.cssHooks.opacity={get:function(a,b){return hc.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=fb.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===fb.trim(f.replace(gc,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=gc.test(f)?f.replace(gc,e):f+" "+e)}}),fb.cssHooks.marginRight=A(db.reliableMarginRight,function(a,b){return b?fb.swap(a,{display:"inline-block"},cc,[a,"marginRight"]):void 0}),fb.each({margin:"",padding:"",border:"Width"},function(a,b){fb.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+Cb[d]+b]=f[d]||f[d-2]||f[0];return e}},dc.test(a)||(fb.cssHooks[a+b].set=D)}),fb.fn.extend({css:function(a,b){return Eb(this,function(a,b,c){var d,e,f={},g=0;if(fb.isArray(b)){for(d=bc(a),e=b.length;e>g;g++)f[b[g]]=fb.css(a,b[g],!1,d);return f}return void 0!==c?fb.style(a,b,c):fb.css(a,b)},a,b,arguments.length>1)},show:function(){return C(this,!0)},hide:function(){return C(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){Db(this)?fb(this).show():fb(this).hide()})}}),fb.Tween=G,G.prototype={constructor:G,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(fb.cssNumber[c]?"":"px")},cur:function(){var a=G.propHooks[this.prop];return a&&a.get?a.get(this):G.propHooks._default.get(this)},run:function(a){var b,c=G.propHooks[this.prop];return this.pos=b=this.options.duration?fb.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):G.propHooks._default.set(this),this}},G.prototype.init.prototype=G.prototype,G.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=fb.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){fb.fx.step[a.prop]?fb.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[fb.cssProps[a.prop]]||fb.cssHooks[a.prop])?fb.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},G.propHooks.scrollTop=G.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},fb.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},fb.fx=G.prototype.init,fb.fx.step={};var oc,pc,qc=/^(?:toggle|show|hide)$/,rc=new RegExp("^(?:([+-])=|)("+Bb+")([a-z%]*)$","i"),sc=/queueHooks$/,tc=[K],uc={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=rc.exec(b),f=e&&e[3]||(fb.cssNumber[a]?"":"px"),g=(fb.cssNumber[a]||"px"!==f&&+d)&&rc.exec(fb.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,fb.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};fb.Animation=fb.extend(M,{tweener:function(a,b){fb.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],uc[c]=uc[c]||[],uc[c].unshift(b)},prefilter:function(a,b){b?tc.unshift(a):tc.push(a)}}),fb.speed=function(a,b,c){var d=a&&"object"==typeof a?fb.extend({},a):{complete:c||!c&&b||fb.isFunction(a)&&a,duration:a,easing:c&&b||b&&!fb.isFunction(b)&&b};return d.duration=fb.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in fb.fx.speeds?fb.fx.speeds[d.duration]:fb.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){fb.isFunction(d.old)&&d.old.call(this),d.queue&&fb.dequeue(this,d.queue)},d},fb.fn.extend({fadeTo:function(a,b,c,d){return this.filter(Db).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=fb.isEmptyObject(a),f=fb.speed(b,c,d),g=function(){var b=M(this,fb.extend({},a),f);(e||fb._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=fb.timers,g=fb._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&sc.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&fb.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=fb._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=fb.timers,g=d?d.length:0;for(c.finish=!0,fb.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),fb.each(["toggle","show","hide"],function(a,b){var c=fb.fn[b];fb.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(I(b,!0),a,d,e)}}),fb.each({slideDown:I("show"),slideUp:I("hide"),slideToggle:I("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){fb.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),fb.timers=[],fb.fx.tick=function(){var a,b=fb.timers,c=0;for(oc=fb.now();c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||fb.fx.stop(),oc=void 0},fb.fx.timer=function(a){fb.timers.push(a),a()?fb.fx.start():fb.timers.pop()},fb.fx.interval=13,fb.fx.start=function(){pc||(pc=setInterval(fb.fx.tick,fb.fx.interval))},fb.fx.stop=function(){clearInterval(pc),pc=null},fb.fx.speeds={slow:600,fast:200,_default:400},fb.fn.delay=function(a,b){return a=fb.fx?fb.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a,b,c,d,e=pb.createElement("div");e.setAttribute("className","t"),e.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=e.getElementsByTagName("a")[0],c=pb.createElement("select"),d=c.appendChild(pb.createElement("option")),b=e.getElementsByTagName("input")[0],a.style.cssText="top:1px",db.getSetAttribute="t"!==e.className,db.style=/top/.test(a.getAttribute("style")),db.hrefNormalized="/a"===a.getAttribute("href"),db.checkOn=!!b.value,db.optSelected=d.selected,db.enctype=!!pb.createElement("form").enctype,c.disabled=!0,db.optDisabled=!d.disabled,b=pb.createElement("input"),b.setAttribute("value",""),db.input=""===b.getAttribute("value"),b.value="t",b.setAttribute("type","radio"),db.radioValue="t"===b.value,a=b=c=d=e=null}();var vc=/\r/g;fb.fn.extend({val:function(a){var b,c,d,e=this[0];return arguments.length?(d=fb.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,fb(this).val()):a,null==e?e="":"number"==typeof e?e+="":fb.isArray(e)&&(e=fb.map(e,function(a){return null==a?"":a+""})),b=fb.valHooks[this.type]||fb.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))})):e?(b=fb.valHooks[e.type]||fb.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(vc,""):null==c?"":c)):void 0}}),fb.extend({valHooks:{option:{get:function(a){var b=fb.find.attr(a,"value");return null!=b?b:fb.text(a)}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(db.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&fb.nodeName(c.parentNode,"optgroup"))){if(b=fb(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=fb.makeArray(b),g=e.length;g--;)if(d=e[g],fb.inArray(fb.valHooks.option.get(d),f)>=0)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),fb.each(["radio","checkbox"],function(){fb.valHooks[this]={set:function(a,b){return fb.isArray(b)?a.checked=fb.inArray(fb(a).val(),b)>=0:void 0}},db.checkOn||(fb.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var wc,xc,yc=fb.expr.attrHandle,zc=/^(?:checked|selected)$/i,Ac=db.getSetAttribute,Bc=db.input;fb.fn.extend({attr:function(a,b){return Eb(this,fb.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){fb.removeAttr(this,a)})}}),fb.extend({attr:function(a,b,c){var d,e,f=a.nodeType;return a&&3!==f&&8!==f&&2!==f?typeof a.getAttribute===yb?fb.prop(a,b,c):(1===f&&fb.isXMLDoc(a)||(b=b.toLowerCase(),d=fb.attrHooks[b]||(fb.expr.match.bool.test(b)?xc:wc)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=fb.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void fb.removeAttr(a,b)):void 0},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(ub);if(f&&1===a.nodeType)for(;c=f[e++];)d=fb.propFix[c]||c,fb.expr.match.bool.test(c)?Bc&&Ac||!zc.test(c)?a[d]=!1:a[fb.camelCase("default-"+c)]=a[d]=!1:fb.attr(a,c,""),a.removeAttribute(Ac?c:d)},attrHooks:{type:{set:function(a,b){if(!db.radioValue&&"radio"===b&&fb.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),xc={set:function(a,b,c){return b===!1?fb.removeAttr(a,c):Bc&&Ac||!zc.test(c)?a.setAttribute(!Ac&&fb.propFix[c]||c,c):a[fb.camelCase("default-"+c)]=a[c]=!0,c}},fb.each(fb.expr.match.bool.source.match(/\w+/g),function(a,b){var c=yc[b]||fb.find.attr;yc[b]=Bc&&Ac||!zc.test(b)?function(a,b,d){var e,f;return d||(f=yc[b],yc[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,yc[b]=f),e}:function(a,b,c){return c?void 0:a[fb.camelCase("default-"+b)]?b.toLowerCase():null}}),Bc&&Ac||(fb.attrHooks.value={set:function(a,b,c){return fb.nodeName(a,"input")?void(a.defaultValue=b):wc&&wc.set(a,b,c)}}),Ac||(wc={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},yc.id=yc.name=yc.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},fb.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:wc.set},fb.attrHooks.contenteditable={set:function(a,b,c){wc.set(a,""===b?!1:b,c)}},fb.each(["width","height"],function(a,b){fb.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),db.style||(fb.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var Cc=/^(?:input|select|textarea|button|object)$/i,Dc=/^(?:a|area)$/i;fb.fn.extend({prop:function(a,b){return Eb(this,fb.prop,a,b,arguments.length>1)},removeProp:function(a){return a=fb.propFix[a]||a,this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})}}),fb.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;return a&&3!==g&&8!==g&&2!==g?(f=1!==g||!fb.isXMLDoc(a),f&&(b=fb.propFix[b]||b,e=fb.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]):void 0},propHooks:{tabIndex:{get:function(a){var b=fb.find.attr(a,"tabindex");return b?parseInt(b,10):Cc.test(a.nodeName)||Dc.test(a.nodeName)&&a.href?0:-1}}}}),db.hrefNormalized||fb.each(["href","src"],function(a,b){fb.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),db.optSelected||(fb.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}}),fb.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){fb.propFix[this.toLowerCase()]=this}),db.enctype||(fb.propFix.enctype="encoding");var Ec=/[\t\r\n\f]/g;fb.fn.extend({addClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j="string"==typeof a&&a;if(fb.isFunction(a))return this.each(function(b){fb(this).addClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(ub)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(Ec," "):" ")){for(f=0;e=b[f++];)d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=fb.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j=0===arguments.length||"string"==typeof a&&a;if(fb.isFunction(a))return this.each(function(b){fb(this).removeClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(ub)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(Ec," "):"")){for(f=0;e=b[f++];)for(;d.indexOf(" "+e+" ")>=0;)d=d.replace(" "+e+" "," ");g=a?fb.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(fb.isFunction(a)?function(c){fb(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c)for(var b,d=0,e=fb(this),f=a.match(ub)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else(c===yb||"boolean"===c)&&(this.className&&fb._data(this,"__className__",this.className),this.className=this.className||a===!1?"":fb._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(Ec," ").indexOf(b)>=0)return!0;return!1}}),fb.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){fb.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),fb.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var Fc=fb.now(),Gc=/\?/,Hc=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;fb.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=fb.trim(b+"");return e&&!fb.trim(e.replace(Hc,function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")}))?Function("return "+e)():fb.error("Invalid JSON: "+b)},fb.parseXML=function(b){var c,d;if(!b||"string"!=typeof b)return null;try{a.DOMParser?(d=new DOMParser,c=d.parseFromString(b,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||fb.error("Invalid XML: "+b),c};var Ic,Jc,Kc=/#.*$/,Lc=/([?&])_=[^&]*/,Mc=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Nc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Oc=/^(?:GET|HEAD)$/,Pc=/^\/\//,Qc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Rc={},Sc={},Tc="*/".concat("*");try{Jc=location.href}catch(Uc){Jc=pb.createElement("a"),Jc.href="",Jc=Jc.href}Ic=Qc.exec(Jc.toLowerCase())||[],fb.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Jc,type:"GET",isLocal:Nc.test(Ic[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Tc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":fb.parseJSON,"text xml":fb.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?P(P(a,fb.ajaxSettings),b):P(fb.ajaxSettings,a)},ajaxPrefilter:N(Rc),ajaxTransport:N(Sc),ajax:function(a,b){function c(a,b,c,d){var e,k,r,s,u,w=b;2!==t&&(t=2,h&&clearTimeout(h),j=void 0,g=d||"",v.readyState=a>0?4:0,e=a>=200&&300>a||304===a,c&&(s=Q(l,v,c)),s=R(l,s,v,e),e?(l.ifModified&&(u=v.getResponseHeader("Last-Modified"),u&&(fb.lastModified[f]=u),u=v.getResponseHeader("etag"),u&&(fb.etag[f]=u)),204===a||"HEAD"===l.type?w="nocontent":304===a?w="notmodified":(w=s.state,k=s.data,r=s.error,e=!r)):(r=w,(a||!w)&&(w="error",0>a&&(a=0))),v.status=a,v.statusText=(b||w)+"",e?o.resolveWith(m,[k,w,v]):o.rejectWith(m,[v,w,r]),v.statusCode(q),q=void 0,i&&n.trigger(e?"ajaxSuccess":"ajaxError",[v,l,e?k:r]),p.fireWith(m,[v,w]),i&&(n.trigger("ajaxComplete",[v,l]),--fb.active||fb.event.trigger("ajaxStop")))}"object"==typeof a&&(b=a,a=void 0),b=b||{};var d,e,f,g,h,i,j,k,l=fb.ajaxSetup({},b),m=l.context||l,n=l.context&&(m.nodeType||m.jquery)?fb(m):fb.event,o=fb.Deferred(),p=fb.Callbacks("once memory"),q=l.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!k)for(k={};b=Mc.exec(g);)k[b[1].toLowerCase()]=b[2];b=k[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?g:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(l.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return j&&j.abort(b),c(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,l.url=((a||l.url||Jc)+"").replace(Kc,"").replace(Pc,Ic[1]+"//"),l.type=b.method||b.type||l.method||l.type,l.dataTypes=fb.trim(l.dataType||"*").toLowerCase().match(ub)||[""],null==l.crossDomain&&(d=Qc.exec(l.url.toLowerCase()),l.crossDomain=!(!d||d[1]===Ic[1]&&d[2]===Ic[2]&&(d[3]||("http:"===d[1]?"80":"443"))===(Ic[3]||("http:"===Ic[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=fb.param(l.data,l.traditional)),O(Rc,l,b,v),2===t)return v;i=l.global,i&&0===fb.active++&&fb.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!Oc.test(l.type),f=l.url,l.hasContent||(l.data&&(f=l.url+=(Gc.test(f)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=Lc.test(f)?f.replace(Lc,"$1_="+Fc++):f+(Gc.test(f)?"&":"?")+"_="+Fc++)),l.ifModified&&(fb.lastModified[f]&&v.setRequestHeader("If-Modified-Since",fb.lastModified[f]),fb.etag[f]&&v.setRequestHeader("If-None-Match",fb.etag[f])),(l.data&&l.hasContent&&l.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",l.contentType),v.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+Tc+"; q=0.01":""):l.accepts["*"]);for(e in l.headers)v.setRequestHeader(e,l.headers[e]);if(l.beforeSend&&(l.beforeSend.call(m,v,l)===!1||2===t))return v.abort();u="abort";for(e in{success:1,error:1,complete:1})v[e](l[e]);if(j=O(Sc,l,b,v)){v.readyState=1,i&&n.trigger("ajaxSend",[v,l]),l.async&&l.timeout>0&&(h=setTimeout(function(){v.abort("timeout")
},l.timeout));try{t=1,j.send(r,c)}catch(w){if(!(2>t))throw w;c(-1,w)}}else c(-1,"No Transport");return v},getJSON:function(a,b,c){return fb.get(a,b,c,"json")},getScript:function(a,b){return fb.get(a,void 0,b,"script")}}),fb.each(["get","post"],function(a,b){fb[b]=function(a,c,d,e){return fb.isFunction(c)&&(e=e||d,d=c,c=void 0),fb.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),fb.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){fb.fn[b]=function(a){return this.on(b,a)}}),fb._evalUrl=function(a){return fb.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},fb.fn.extend({wrapAll:function(a){if(fb.isFunction(a))return this.each(function(b){fb(this).wrapAll(a.call(this,b))});if(this[0]){var b=fb(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return this.each(fb.isFunction(a)?function(b){fb(this).wrapInner(a.call(this,b))}:function(){var b=fb(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=fb.isFunction(a);return this.each(function(c){fb(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){fb.nodeName(this,"body")||fb(this).replaceWith(this.childNodes)}).end()}}),fb.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0||!db.reliableHiddenOffsets()&&"none"===(a.style&&a.style.display||fb.css(a,"display"))},fb.expr.filters.visible=function(a){return!fb.expr.filters.hidden(a)};var Vc=/%20/g,Wc=/\[\]$/,Xc=/\r?\n/g,Yc=/^(?:submit|button|image|reset|file)$/i,Zc=/^(?:input|select|textarea|keygen)/i;fb.param=function(a,b){var c,d=[],e=function(a,b){b=fb.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=fb.ajaxSettings&&fb.ajaxSettings.traditional),fb.isArray(a)||a.jquery&&!fb.isPlainObject(a))fb.each(a,function(){e(this.name,this.value)});else for(c in a)S(c,a[c],b,e);return d.join("&").replace(Vc,"+")},fb.fn.extend({serialize:function(){return fb.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=fb.prop(this,"elements");return a?fb.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!fb(this).is(":disabled")&&Zc.test(this.nodeName)&&!Yc.test(a)&&(this.checked||!Fb.test(a))}).map(function(a,b){var c=fb(this).val();return null==c?null:fb.isArray(c)?fb.map(c,function(a){return{name:b.name,value:a.replace(Xc,"\r\n")}}):{name:b.name,value:c.replace(Xc,"\r\n")}}).get()}}),fb.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&T()||U()}:T;var $c=0,_c={},ad=fb.ajaxSettings.xhr();a.ActiveXObject&&fb(a).on("unload",function(){for(var a in _c)_c[a](void 0,!0)}),db.cors=!!ad&&"withCredentials"in ad,ad=db.ajax=!!ad,ad&&fb.ajaxTransport(function(a){if(!a.crossDomain||db.cors){var b;return{send:function(c,d){var e,f=a.xhr(),g=++$c;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)void 0!==c[e]&&f.setRequestHeader(e,c[e]+"");f.send(a.hasContent&&a.data||null),b=function(c,e){var h,i,j;if(b&&(e||4===f.readyState))if(delete _c[g],b=void 0,f.onreadystatechange=fb.noop,e)4!==f.readyState&&f.abort();else{j={},h=f.status,"string"==typeof f.responseText&&(j.text=f.responseText);try{i=f.statusText}catch(k){i=""}h||!a.isLocal||a.crossDomain?1223===h&&(h=204):h=j.text?200:404}j&&d(h,i,j,f.getAllResponseHeaders())},a.async?4===f.readyState?setTimeout(b):f.onreadystatechange=_c[g]=b:b()},abort:function(){b&&b(void 0,!0)}}}}),fb.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return fb.globalEval(a),a}}}),fb.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),fb.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=pb.head||fb("head")[0]||pb.documentElement;return{send:function(d,e){b=pb.createElement("script"),b.async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||e(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}});var bd=[],cd=/(=)\?(?=&|$)|\?\?/;fb.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=bd.pop()||fb.expando+"_"+Fc++;return this[a]=!0,a}}),fb.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(cd.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&cd.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=fb.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(cd,"$1"+e):b.jsonp!==!1&&(b.url+=(Gc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||fb.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,bd.push(e)),g&&fb.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),fb.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||pb;var d=mb.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=fb.buildFragment([a],b,e),e&&e.length&&fb(e).remove(),fb.merge([],d.childNodes))};var dd=fb.fn.load;fb.fn.load=function(a,b,c){if("string"!=typeof a&&dd)return dd.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=a.slice(h,a.length),a=a.slice(0,h)),fb.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(f="POST"),g.length>0&&fb.ajax({url:a,type:f,dataType:"html",data:b}).done(function(a){e=arguments,g.html(d?fb("<div>").append(fb.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,e||[a.responseText,b,a])}),this},fb.expr.filters.animated=function(a){return fb.grep(fb.timers,function(b){return a===b.elem}).length};var ed=a.document.documentElement;fb.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=fb.css(a,"position"),l=fb(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=fb.css(a,"top"),i=fb.css(a,"left"),j=("absolute"===k||"fixed"===k)&&fb.inArray("auto",[f,i])>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),fb.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},fb.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){fb.offset.setOffset(this,a,b)});var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;return f?(b=f.documentElement,fb.contains(b,e)?(typeof e.getBoundingClientRect!==yb&&(d=e.getBoundingClientRect()),c=V(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d):void 0},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===fb.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),fb.nodeName(a[0],"html")||(c=a.offset()),c.top+=fb.css(a[0],"borderTopWidth",!0),c.left+=fb.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-fb.css(d,"marginTop",!0),left:b.left-c.left-fb.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||ed;a&&!fb.nodeName(a,"html")&&"static"===fb.css(a,"position");)a=a.offsetParent;return a||ed})}}),fb.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);fb.fn[a]=function(d){return Eb(this,function(a,d,e){var f=V(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?fb(f).scrollLeft():e,c?e:fb(f).scrollTop()):a[d]=e)},a,d,arguments.length,null)}}),fb.each(["top","left"],function(a,b){fb.cssHooks[b]=A(db.pixelPosition,function(a,c){return c?(c=cc(a,b),ec.test(c)?fb(a).position()[b]+"px":c):void 0})}),fb.each({Height:"height",Width:"width"},function(a,b){fb.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){fb.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return Eb(this,function(b,c,d){var e;return fb.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?fb.css(b,c,g):fb.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),fb.fn.size=function(){return this.length},fb.fn.andSelf=fb.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return fb});var fd=a.jQuery,gd=a.$;return fb.noConflict=function(b){return a.$===fb&&(a.$=gd),b&&a.jQuery===fb&&(a.jQuery=fd),fb},typeof b===yb&&(a.jQuery=a.$=fb),fb}),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function b(a){return a}function c(a){return decodeURIComponent(a.replace(e," "))}function d(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return f.json?JSON.parse(a):a}catch(b){}}var e=/\+/g,f=a.cookie=function(e,g,h){if(void 0!==g){if(h=a.extend({},f.defaults,h),"number"==typeof h.expires){var i=h.expires,j=h.expires=new Date;j.setDate(j.getDate()+i)}return g=f.json?JSON.stringify(g):String(g),document.cookie=[f.raw?e:encodeURIComponent(e),"=",f.raw?g:encodeURIComponent(g),h.expires?"; expires="+h.expires.toUTCString():"",h.path?"; path="+h.path:"",h.domain?"; domain="+h.domain:"",h.secure?"; secure":""].join("")}for(var k=f.raw?b:c,l=document.cookie.split("; "),m=e?void 0:{},n=0,o=l.length;o>n;n++){var p=l[n].split("="),q=k(p.shift()),r=k(p.join("="));if(e&&e===q){m=d(r);break}e||(m[q]=d(r))}return m};f.defaults={},a.removeCookie=function(b,c){return void 0!==a.cookie(b)?(a.cookie(b,"",a.extend({},c,{expires:-1})),!0):!1}}),function(a,b){function c(b,c){var e,f,g,h=b.nodeName.toLowerCase();return"area"===h?(e=b.parentNode,f=e.name,b.href&&f&&"map"===e.nodeName.toLowerCase()?(g=a("img[usemap=#"+f+"]")[0],!!g&&d(g)):!1):(/input|select|textarea|button|object/.test(h)?!b.disabled:"a"===h?b.href||c:c)&&d(b)}function d(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}var e=0,f=/^ui-id-\d+$/;a.ui=a.ui||{},a.extend(a.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({focus:function(b){return function(c,d){return"number"==typeof c?this.each(function(){var b=this;setTimeout(function(){a(b).focus(),d&&d.call(b)},c)}):b.apply(this,arguments)}}(a.fn.focus),scrollParent:function(){var b;return b=a.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length)for(var d,e,f=a(this[0]);f.length&&f[0]!==document;){if(d=f.css("position"),("absolute"===d||"relative"===d||"fixed"===d)&&(e=parseInt(f.css("zIndex"),10),!isNaN(e)&&0!==e))return e;f=f.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})},removeUniqueId:function(){return this.each(function(){f.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(c,d){function e(b,c,d,e){return a.each(f,function(){c-=parseFloat(a.css(b,"padding"+this))||0,d&&(c-=parseFloat(a.css(b,"border"+this+"Width"))||0),e&&(c-=parseFloat(a.css(b,"margin"+this))||0)}),c}var f="Width"===d?["Left","Right"]:["Top","Bottom"],g=d.toLowerCase(),h={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?h["inner"+d].call(this):this.each(function(){a(this).css(g,e(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return"number"!=typeof b?h["outer"+d].call(this,b):this.each(function(){a(this).css(g,e(this,b,!0,c)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(b){return function(c){return arguments.length?b.call(this,a.camelCase(c)):b.call(this)}}(a.fn.removeData)),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.support.selectstart="onselectstart"in document.createElement("div"),a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.extend(a.ui,{plugin:{add:function(b,c,d){var e,f=a.ui[b].prototype;for(e in d)f.plugins[e]=f.plugins[e]||[],f.plugins[e].push([c,d[e]])},call:function(a,b,c){var d,e=a.plugins[b];if(e&&a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType)for(d=0;e.length>d;d++)a.options[e[d][0]]&&e[d][1].apply(a.element,c)}},hasScroll:function(b,c){if("hidden"===a(b).css("overflow"))return!1;var d=c&&"left"===c?"scrollLeft":"scrollTop",e=!1;return b[d]>0?!0:(b[d]=1,e=b[d]>0,b[d]=0,e)}})}(jQuery),function(a,b){var c=0,d=Array.prototype.slice,e=a.cleanData;a.cleanData=function(b){for(var c,d=0;null!=(c=b[d]);d++)try{a(c).triggerHandler("remove")}catch(f){}e(b)},a.widget=function(c,d,e){var f,g,h,i,j={},k=c.split(".")[0];c=c.split(".")[1],f=k+"-"+c,e||(e=d,d=a.Widget),a.expr[":"][f.toLowerCase()]=function(b){return!!a.data(b,f)},a[k]=a[k]||{},g=a[k][c],h=a[k][c]=function(a,c){return this._createWidget?(arguments.length&&this._createWidget(a,c),b):new h(a,c)},a.extend(h,g,{version:e.version,_proto:a.extend({},e),_childConstructors:[]}),i=new d,i.options=a.widget.extend({},i.options),a.each(e,function(c,e){return a.isFunction(e)?(j[c]=function(){var a=function(){return d.prototype[c].apply(this,arguments)},b=function(a){return d.prototype[c].apply(this,a)};return function(){var c,d=this._super,f=this._superApply;return this._super=a,this._superApply=b,c=e.apply(this,arguments),this._super=d,this._superApply=f,c}}(),b):(j[c]=e,b)}),h.prototype=a.widget.extend(i,{widgetEventPrefix:g?i.widgetEventPrefix:c},j,{constructor:h,namespace:k,widgetName:c,widgetFullName:f}),g?(a.each(g._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,h,c._proto)}),delete g._childConstructors):d._childConstructors.push(h),a.widget.bridge(c,h)},a.widget.extend=function(c){for(var e,f,g=d.call(arguments,1),h=0,i=g.length;i>h;h++)for(e in g[h])f=g[h][e],g[h].hasOwnProperty(e)&&f!==b&&(c[e]=a.isPlainObject(f)?a.isPlainObject(c[e])?a.widget.extend({},c[e],f):a.widget.extend({},f):f);return c},a.widget.bridge=function(c,e){var f=e.prototype.widgetFullName||c;a.fn[c]=function(g){var h="string"==typeof g,i=d.call(arguments,1),j=this;return g=!h&&i.length?a.widget.extend.apply(null,[g].concat(i)):g,this.each(h?function(){var d,e=a.data(this,f);return e?a.isFunction(e[g])&&"_"!==g.charAt(0)?(d=e[g].apply(e,i),d!==e&&d!==b?(j=d&&d.jquery?j.pushStack(d.get()):d,!1):b):a.error("no such method '"+g+"' for "+c+" widget instance"):a.error("cannot call methods on "+c+" prior to initialization; attempted to call method '"+g+"'")}:function(){var b=a.data(this,f);b?b.option(g||{})._init():a.data(this,f,new e(g,this))}),j}},a.Widget=function(){},a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,d){d=a(d||this.defaultElement||this)[0],this.element=a(d),this.uuid=c++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=a.widget.extend({},this.options,this._getCreateOptions(),b),this.bindings=a(),this.hoverable=a(),this.focusable=a(),d!==this&&(a.data(d,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===d&&this.destroy()}}),this.document=a(d.style?d.ownerDocument:d.document||d),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(c,d){var e,f,g,h=c;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof c)if(h={},e=c.split("."),c=e.shift(),e.length){for(f=h[c]=a.widget.extend({},this.options[c]),g=0;e.length-1>g;g++)f[e[g]]=f[e[g]]||{},f=f[e[g]];if(c=e.pop(),d===b)return f[c]===b?null:f[c];f[c]=d}else{if(d===b)return this.options[c]===b?null:this.options[c];h[c]=d}return this._setOptions(h),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!b).attr("aria-disabled",b),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(c,d,e){var f,g=this;"boolean"!=typeof c&&(e=d,d=c,c=!1),e?(d=f=a(d),this.bindings=this.bindings.add(d)):(e=d,d=this.element,f=this.widget()),a.each(e,function(e,h){function i(){return c||g.options.disabled!==!0&&!a(this).hasClass("ui-state-disabled")?("string"==typeof h?g[h]:h).apply(g,arguments):b}"string"!=typeof h&&(i.guid=h.guid=h.guid||i.guid||a.guid++);var j=e.match(/^(\w+)\s*(.*)$/),k=j[1]+g.eventNamespace,l=j[2];l?f.delegate(l,k,i):d.bind(k,i)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,a.unbind(b).undelegate(b)},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.apply(this.element[0],[c].concat(d))===!1||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?e===!0||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}})}(jQuery),function(a){var b=!1;a(document).mouseup(function(){b=!1}),a.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){return!0===a.data(c.target,b.widgetName+".preventClickEvent")?(a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(c){if(!b){this._mouseStarted&&this._mouseUp(c),this._mouseDownEvent=c;var d=this,e=1===c.which,f="string"==typeof this.options.cancel&&c.target.nodeName?a(c.target).closest(this.options.cancel).length:!1;return e&&!f&&this._mouseCapture(c)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(c)&&this._mouseDelayMet(c)&&(this._mouseStarted=this._mouseStart(c)!==!1,!this._mouseStarted)?(c.preventDefault(),!0):(!0===a.data(c.target,this.widgetName+".preventClickEvent")&&a.removeData(c.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),c.preventDefault(),b=!0,!0)):!0}},_mouseMove:function(b){return a.ui.ie&&(!document.documentMode||9>document.documentMode)&&!b.button?this._mouseUp(b):this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted)},_mouseUp:function(b){return a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target===this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(a){a.widget("ui.draggable",a.ui.mouse,{version:"1.10.3",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(b){var c=this.options;return this.helper||c.disabled||a(b.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(b),this.handle?(a(c.iframeFix===!0?"iframe":c.iframeFix).each(function(){a("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(a(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(b){var c=this.options;return this.helper=this._createHelper(b),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),a.ui.ddmanager&&(a.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),this._setContainment(),this._trigger("start",b)===!1?(this._clear(),!1):(this._cacheHelperProportions(),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this._mouseDrag(b,!0),a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,b),!0)},_mouseDrag:function(b,c){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),!c){var d=this._uiHash();if(this._trigger("drag",b,d)===!1)return this._mouseUp({}),!1;this.position=d.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),!1},_mouseStop:function(b){var c=this,d=!1;return a.ui.ddmanager&&!this.options.dropBehaviour&&(d=a.ui.ddmanager.drop(this,b)),this.dropped&&(d=this.dropped,this.dropped=!1),"original"!==this.options.helper||a.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!d||"valid"===this.options.revert&&d||this.options.revert===!0||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,d)?a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){c._trigger("stop",b)!==!1&&c._clear()}):this._trigger("stop",b)!==!1&&this._clear(),!1):!1},_mouseUp:function(b){return a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,b),a.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(b){return this.options.handle?!!a(b.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b])):"clone"===c.helper?this.element.clone().removeAttr("id"):this.element;return d.parents("body").length||d.appendTo("parent"===c.appendTo?this.element[0].parentNode:c.appendTo),d[0]===this.element[0]||/(fixed|absolute)/.test(d.css("position"))||d.css("position","absolute"),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){var b=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.element.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options;return e.containment?"window"===e.containment?void(this.containment=[a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,a(window).scrollLeft()+a(window).width()-this.helperProportions.width-this.margins.left,a(window).scrollTop()+(a(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===e.containment?void(this.containment=[0,0,a(document).width()-this.helperProportions.width-this.margins.left,(a(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):e.containment.constructor===Array?void(this.containment=e.containment):("parent"===e.containment&&(e.containment=this.helper[0].parentNode),c=a(e.containment),d=c[0],void(d&&(b="hidden"!==c.css("overflow"),this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(b?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(b?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c))):void(this.containment=null)},_convertPositionTo:function(b,c){c||(c=this.position);var d="absolute"===b?1:-1,e="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:e.scrollTop(),left:e.scrollLeft()}),{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*d,left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*d}},_generatePosition:function(b){var c,d,e,f,g=this.options,h="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=b.pageX,j=b.pageY;
return this.offset.scroll||(this.offset.scroll={top:h.scrollTop(),left:h.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(d=this.relative_container.offset(),c=[this.containment[0]+d.left,this.containment[1]+d.top,this.containment[2]+d.left,this.containment[3]+d.top]):c=this.containment,b.pageX-this.offset.click.left<c[0]&&(i=c[0]+this.offset.click.left),b.pageY-this.offset.click.top<c[1]&&(j=c[1]+this.offset.click.top),b.pageX-this.offset.click.left>c[2]&&(i=c[2]+this.offset.click.left),b.pageY-this.offset.click.top>c[3]&&(j=c[3]+this.offset.click.top)),g.grid&&(e=g.grid[1]?this.originalPageY+Math.round((j-this.originalPageY)/g.grid[1])*g.grid[1]:this.originalPageY,j=c?e-this.offset.click.top>=c[1]||e-this.offset.click.top>c[3]?e:e-this.offset.click.top>=c[1]?e-g.grid[1]:e+g.grid[1]:e,f=g.grid[0]?this.originalPageX+Math.round((i-this.originalPageX)/g.grid[0])*g.grid[0]:this.originalPageX,i=c?f-this.offset.click.left>=c[0]||f-this.offset.click.left>c[2]?f:f-this.offset.click.left>=c[0]?f-g.grid[0]:f+g.grid[0]:f)),{top:j-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:i-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(b,c,d){return d=d||this._uiHash(),a.ui.plugin.call(this,b,[c,d]),"drag"===b&&(this.positionAbs=this._convertPositionTo("absolute")),a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c){var d=a(this).data("ui-draggable"),e=d.options,f=a.extend({},c,{item:d.element});d.sortables=[],a(e.connectToSortable).each(function(){var c=a.data(this,"ui-sortable");c&&!c.options.disabled&&(d.sortables.push({instance:c,shouldRevert:c.options.revert}),c.refreshPositions(),c._trigger("activate",b,f))})},stop:function(b,c){var d=a(this).data("ui-draggable"),e=a.extend({},c,{item:d.element});a.each(d.sortables,function(){this.instance.isOver?(this.instance.isOver=0,d.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(b),this.instance.options.helper=this.instance.options._helper,"original"===d.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",b,e))})},drag:function(b,c){var d=a(this).data("ui-draggable"),e=this;a.each(d.sortables,function(){var f=!1,g=this;this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(f=!0,a.each(d.sortables,function(){return this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this!==g&&this.instance._intersectsWith(this.instance.containerCache)&&a.contains(g.instance.element[0],this.instance.element[0])&&(f=!1),f})),f?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=a(e).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return c.helper[0]},b.target=this.instance.currentItem[0],this.instance._mouseCapture(b,!0),this.instance._mouseStart(b,!0,!0),this.instance.offset.click.top=d.offset.click.top,this.instance.offset.click.left=d.offset.click.left,this.instance.offset.parent.left-=d.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=d.offset.parent.top-this.instance.offset.parent.top,d._trigger("toSortable",b),d.dropped=this.instance.element,d.currentItem=d.element,this.instance.fromOutside=d),this.instance.currentItem&&this.instance._mouseDrag(b)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",b,this.instance._uiHash(this.instance)),this.instance._mouseStop(b,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),d._trigger("fromSortable",b),d.dropped=!1)})}}),a.ui.plugin.add("draggable","cursor",{start:function(){var b=a("body"),c=a(this).data("ui-draggable").options;b.css("cursor")&&(c._cursor=b.css("cursor")),b.css("cursor",c.cursor)},stop:function(){var b=a(this).data("ui-draggable").options;b._cursor&&a("body").css("cursor",b._cursor)}}),a.ui.plugin.add("draggable","opacity",{start:function(b,c){var d=a(c.helper),e=a(this).data("ui-draggable").options;d.css("opacity")&&(e._opacity=d.css("opacity")),d.css("opacity",e.opacity)},stop:function(b,c){var d=a(this).data("ui-draggable").options;d._opacity&&a(c.helper).css("opacity",d._opacity)}}),a.ui.plugin.add("draggable","scroll",{start:function(){var b=a(this).data("ui-draggable");b.scrollParent[0]!==document&&"HTML"!==b.scrollParent[0].tagName&&(b.overflowOffset=b.scrollParent.offset())},drag:function(b){var c=a(this).data("ui-draggable"),d=c.options,e=!1;c.scrollParent[0]!==document&&"HTML"!==c.scrollParent[0].tagName?(d.axis&&"x"===d.axis||(c.overflowOffset.top+c.scrollParent[0].offsetHeight-b.pageY<d.scrollSensitivity?c.scrollParent[0].scrollTop=e=c.scrollParent[0].scrollTop+d.scrollSpeed:b.pageY-c.overflowOffset.top<d.scrollSensitivity&&(c.scrollParent[0].scrollTop=e=c.scrollParent[0].scrollTop-d.scrollSpeed)),d.axis&&"y"===d.axis||(c.overflowOffset.left+c.scrollParent[0].offsetWidth-b.pageX<d.scrollSensitivity?c.scrollParent[0].scrollLeft=e=c.scrollParent[0].scrollLeft+d.scrollSpeed:b.pageX-c.overflowOffset.left<d.scrollSensitivity&&(c.scrollParent[0].scrollLeft=e=c.scrollParent[0].scrollLeft-d.scrollSpeed))):(d.axis&&"x"===d.axis||(b.pageY-a(document).scrollTop()<d.scrollSensitivity?e=a(document).scrollTop(a(document).scrollTop()-d.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<d.scrollSensitivity&&(e=a(document).scrollTop(a(document).scrollTop()+d.scrollSpeed))),d.axis&&"y"===d.axis||(b.pageX-a(document).scrollLeft()<d.scrollSensitivity?e=a(document).scrollLeft(a(document).scrollLeft()-d.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<d.scrollSensitivity&&(e=a(document).scrollLeft(a(document).scrollLeft()+d.scrollSpeed)))),e!==!1&&a.ui.ddmanager&&!d.dropBehaviour&&a.ui.ddmanager.prepareOffsets(c,b)}}),a.ui.plugin.add("draggable","snap",{start:function(){var b=a(this).data("ui-draggable"),c=b.options;b.snapElements=[],a(c.snap.constructor!==String?c.snap.items||":data(ui-draggable)":c.snap).each(function(){var c=a(this),d=c.offset();this!==b.element[0]&&b.snapElements.push({item:this,width:c.outerWidth(),height:c.outerHeight(),top:d.top,left:d.left})})},drag:function(b,c){var d,e,f,g,h,i,j,k,l,m,n=a(this).data("ui-draggable"),o=n.options,p=o.snapTolerance,q=c.offset.left,r=q+n.helperProportions.width,s=c.offset.top,t=s+n.helperProportions.height;for(l=n.snapElements.length-1;l>=0;l--)h=n.snapElements[l].left,i=h+n.snapElements[l].width,j=n.snapElements[l].top,k=j+n.snapElements[l].height,h-p>r||q>i+p||j-p>t||s>k+p||!a.contains(n.snapElements[l].item.ownerDocument,n.snapElements[l].item)?(n.snapElements[l].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,b,a.extend(n._uiHash(),{snapItem:n.snapElements[l].item})),n.snapElements[l].snapping=!1):("inner"!==o.snapMode&&(d=p>=Math.abs(j-t),e=p>=Math.abs(k-s),f=p>=Math.abs(h-r),g=p>=Math.abs(i-q),d&&(c.position.top=n._convertPositionTo("relative",{top:j-n.helperProportions.height,left:0}).top-n.margins.top),e&&(c.position.top=n._convertPositionTo("relative",{top:k,left:0}).top-n.margins.top),f&&(c.position.left=n._convertPositionTo("relative",{top:0,left:h-n.helperProportions.width}).left-n.margins.left),g&&(c.position.left=n._convertPositionTo("relative",{top:0,left:i}).left-n.margins.left)),m=d||e||f||g,"outer"!==o.snapMode&&(d=p>=Math.abs(j-s),e=p>=Math.abs(k-t),f=p>=Math.abs(h-q),g=p>=Math.abs(i-r),d&&(c.position.top=n._convertPositionTo("relative",{top:j,left:0}).top-n.margins.top),e&&(c.position.top=n._convertPositionTo("relative",{top:k-n.helperProportions.height,left:0}).top-n.margins.top),f&&(c.position.left=n._convertPositionTo("relative",{top:0,left:h}).left-n.margins.left),g&&(c.position.left=n._convertPositionTo("relative",{top:0,left:i-n.helperProportions.width}).left-n.margins.left)),!n.snapElements[l].snapping&&(d||e||f||g||m)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,b,a.extend(n._uiHash(),{snapItem:n.snapElements[l].item})),n.snapElements[l].snapping=d||e||f||g||m)}}),a.ui.plugin.add("draggable","stack",{start:function(){var b,c=this.data("ui-draggable").options,d=a.makeArray(a(c.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});d.length&&(b=parseInt(a(d[0]).css("zIndex"),10)||0,a(d).each(function(c){a(this).css("zIndex",b+c)}),this.css("zIndex",b+d.length))}}),a.ui.plugin.add("draggable","zIndex",{start:function(b,c){var d=a(c.helper),e=a(this).data("ui-draggable").options;d.css("zIndex")&&(e._zIndex=d.css("zIndex")),d.css("zIndex",e.zIndex)},stop:function(b,c){var d=a(this).data("ui-draggable").options;d._zIndex&&a(c.helper).css("zIndex",d._zIndex)}})}(jQuery),function(a){function b(a,b,c){return a>b&&b+c>a}a.widget("ui.droppable",{version:"1.10.3",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var b=this.options,c=b.accept;this.isover=!1,this.isout=!0,this.accept=a.isFunction(c)?c:function(a){return a.is(c)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},a.ui.ddmanager.droppables[b.scope]=a.ui.ddmanager.droppables[b.scope]||[],a.ui.ddmanager.droppables[b.scope].push(this),b.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var b=0,c=a.ui.ddmanager.droppables[this.options.scope];c.length>b;b++)c[b]===this&&c.splice(b,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(b,c){"accept"===b&&(this.accept=a.isFunction(c)?c:function(a){return a.is(c)}),a.Widget.prototype._setOption.apply(this,arguments)},_activate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),c&&this._trigger("activate",b,this.ui(c))},_deactivate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),c&&this._trigger("deactivate",b,this.ui(c))},_over:function(b){var c=a.ui.ddmanager.current;c&&(c.currentItem||c.element)[0]!==this.element[0]&&this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",b,this.ui(c)))},_out:function(b){var c=a.ui.ddmanager.current;c&&(c.currentItem||c.element)[0]!==this.element[0]&&this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",b,this.ui(c)))},_drop:function(b,c){var d=c||a.ui.ddmanager.current,e=!1;return d&&(d.currentItem||d.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var b=a.data(this,"ui-droppable");return b.options.greedy&&!b.options.disabled&&b.options.scope===d.options.scope&&b.accept.call(b.element[0],d.currentItem||d.element)&&a.ui.intersect(d,a.extend(b,{offset:b.element.offset()}),b.options.tolerance)?(e=!0,!1):void 0}),e?!1:this.accept.call(this.element[0],d.currentItem||d.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",b,this.ui(d)),this.element):!1):!1},ui:function(a){return{draggable:a.currentItem||a.element,helper:a.helper,position:a.position,offset:a.positionAbs}}}),a.ui.intersect=function(a,c,d){if(!c.offset)return!1;var e,f,g=(a.positionAbs||a.position.absolute).left,h=g+a.helperProportions.width,i=(a.positionAbs||a.position.absolute).top,j=i+a.helperProportions.height,k=c.offset.left,l=k+c.proportions.width,m=c.offset.top,n=m+c.proportions.height;switch(d){case"fit":return g>=k&&l>=h&&i>=m&&n>=j;case"intersect":return g+a.helperProportions.width/2>k&&l>h-a.helperProportions.width/2&&i+a.helperProportions.height/2>m&&n>j-a.helperProportions.height/2;case"pointer":return e=(a.positionAbs||a.position.absolute).left+(a.clickOffset||a.offset.click).left,f=(a.positionAbs||a.position.absolute).top+(a.clickOffset||a.offset.click).top,b(f,m,c.proportions.height)&&b(e,k,c.proportions.width);case"touch":return(i>=m&&n>=i||j>=m&&n>=j||m>i&&j>n)&&(g>=k&&l>=g||h>=k&&l>=h||k>g&&h>l);default:return!1}},a.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(b,c){var d,e,f=a.ui.ddmanager.droppables[b.options.scope]||[],g=c?c.type:null,h=(b.currentItem||b.element).find(":data(ui-droppable)").addBack();a:for(d=0;f.length>d;d++)if(!(f[d].options.disabled||b&&!f[d].accept.call(f[d].element[0],b.currentItem||b.element))){for(e=0;h.length>e;e++)if(h[e]===f[d].element[0]){f[d].proportions.height=0;continue a}f[d].visible="none"!==f[d].element.css("display"),f[d].visible&&("mousedown"===g&&f[d]._activate.call(f[d],c),f[d].offset=f[d].element.offset(),f[d].proportions={width:f[d].element[0].offsetWidth,height:f[d].element[0].offsetHeight})}},drop:function(b,c){var d=!1;return a.each((a.ui.ddmanager.droppables[b.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&a.ui.intersect(b,this,this.options.tolerance)&&(d=this._drop.call(this,c)||d),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],b.currentItem||b.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,c)))}),d},dragStart:function(b,c){b.element.parentsUntil("body").bind("scroll.droppable",function(){b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)})},drag:function(b,c){b.options.refreshPositions&&a.ui.ddmanager.prepareOffsets(b,c),a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var d,e,f,g=a.ui.intersect(b,this,this.options.tolerance),h=!g&&this.isover?"isout":g&&!this.isover?"isover":null;h&&(this.options.greedy&&(e=this.options.scope,f=this.element.parents(":data(ui-droppable)").filter(function(){return a.data(this,"ui-droppable").options.scope===e}),f.length&&(d=a.data(f[0],"ui-droppable"),d.greedyChild="isover"===h)),d&&"isover"===h&&(d.isover=!1,d.isout=!0,d._out.call(d,c)),this[h]=!0,this["isout"===h?"isover":"isout"]=!1,this["isover"===h?"_over":"_out"].call(this,c),d&&"isout"===h&&(d.isout=!1,d.isover=!0,d._over.call(d,c)))}})},dragStop:function(b,c){b.element.parentsUntil("body").unbind("scroll.droppable"),b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)}}}(jQuery);var peerConnectionsListElem=null,ssrcInfoManager=null,peerConnectionUpdateTable=null,statsTable=null,dumpCreator=null,SsrcInfoManager=function(){"use strict";function a(){this.streamInfoContainer_={},this.ATTRIBUTE_SEPARATOR_=/[\r,\n]/,this.FIELD_SEPARATOR_REGEX_=/ .*:/,this.SSRC_ATTRIBUTE_PREFIX_="a=ssrc:",this.SSRC_INFO_BLOCK_CLASS_="ssrc-info-block"}return a.prototype={addSsrcStreamInfo:function(a){for(var b=a.split(this.ATTRIBUTE_SEPARATOR_),c=0;c<b.length;++c)if(0==b[c].indexOf(this.SSRC_ATTRIBUTE_PREFIX_)){var d=b[c].search(this.FIELD_SEPARATOR_REGEX_);if(-1!=d){var e=b[c].substring(this.SSRC_ATTRIBUTE_PREFIX_.length,d);this.streamInfoContainer_[e]||(this.streamInfoContainer_[e]={});for(var f,g,h=b[c].substring(d+1);h.length>0;)d=h.search(this.FIELD_SEPARATOR_REGEX_),-1==d&&(d=h.length),f=h.substring(0,h.indexOf(":")),g=h.substring(h.indexOf(":")+1,d),this.streamInfoContainer_[e][f]=g,h=h.substring(d+1)}}},getStreamInfo:function(a){return this.streamInfoContainer_[a]},populateSsrcInfo:function(a,b){if(this.streamInfoContainer_[b]){a.className=this.SSRC_INFO_BLOCK_CLASS_;var c;for(var d in this.streamInfoContainer_[b])c=document.createElement("div"),a.appendChild(c),c.textContent=d+":"+this.streamInfoContainer_[b][d]}}},a}(),TimelineDataSeries=function(){"use strict";function a(){this.dataPoints_=[],this.color_="red",this.isVisible_=!0,this.cacheStartTime_=null,this.cacheStepSize_=0,this.cacheValues_=[]}function b(a,b){this.time=a,this.value=b}return a.prototype={addPoint:function(a,c){var d=new Date(a);this.dataPoints_.push(new b(d,c))},isVisible:function(){return this.isVisible_},show:function(a){this.isVisible_=a},getColor:function(){return this.color_},setColor:function(a){this.color_=a},getAvg:function(){for(var a=0,b=0;b<this.dataPoints_.length;b++)a+=this.dataPoints_[b].value;return a/this.dataPoints_.length},getValues:function(a,b,c){return this.cacheStartTime_==a&&this.cacheStepSize_==b&&this.cacheValues_.length==c?this.cacheValues_:(this.cacheValues_=this.getValuesInternal_(a,b,c),this.cacheStartTime_=a,this.cacheStepSize_=b,this.cacheValues_)},getValuesInternal_:function(a,b,c){for(var d=[],e=0,f=0,g=a,h=0;c>h;++h){for(;e<this.dataPoints_.length&&this.dataPoints_[e].time<g;)f=this.dataPoints_[e].value,++e;d[h]=f,g+=b}return d}},a}(),TimelineGraphView=function(){"use strict";function a(a,b){this.scrollbar_={position_:0,range_:0},this.graphDiv_=$('[id="'+a+'"]')[0],this.canvas_=$('[id="'+b+'"]')[0],this.startTime_=0,this.endTime_=1,this.graph_=null,this.updateScrollbarRange_(!0)}var b=2e3,c=6,d=4,e=3,f=25,g=10,h="#CCC",i="#000",j="#FFF";a.prototype={getLength_:function(){var a=this.endTime_-this.startTime_;return Math.floor(a/b)},graphScrolledToRightEdge_:function(){return this.scrollbar_.position_==this.scrollbar_.range_},updateScrollbarRange_:function(a){var b=this.getLength_()-this.canvas_.width;0>b&&(b=0),this.scrollbar_.position_>b&&(a=!0),this.scrollbar_.range_=b,a&&(this.scrollbar_.position_=b,this.repaint())},setDateRange:function(a,b){this.startTime_=a.getTime(),this.endTime_=b.getTime(),this.endTime_<=this.startTime_&&(this.startTime_=this.endTime_-1),this.updateScrollbarRange_(!0)},updateEndDate:function(){this.endTime_=(new Date).getTime(),this.updateScrollbarRange_(this.graphScrolledToRightEdge_())},getStartDate:function(){return new Date(this.startTime_)},setDataSeries:function(a){this.graph_=new k;for(var b=0;b<a.length;++b)this.graph_.addDataSeries(a[b]);this.repaint()},addDataSeries:function(a){this.graph_||(this.graph_=new k),this.graph_.addDataSeries(a),this.repaint()},repaint:function(){this.repaintTimerRunning_=!1;var a=this.canvas_.width,c=this.canvas_.height,e=this.canvas_.getContext("2d");e.fillStyle=j,e.fillRect(0,0,a,c);var f=e.font.match(/([0-9]+)px/)[1],g=parseInt(f);if(!(0==f.length||0>=g||4*g>c||50>a)){e.save(),e.translate(.5,.5);var i=this.scrollbar_.position_;0==this.scrollbar_.range_&&(i=this.getLength_()-this.canvas_.width);var k=this.startTime_+i*b,l=c;c-=g+d,this.drawTimeLabels(e,a,c,l,k),e.strokeStyle=h,e.strokeRect(0,0,a-1,c-1),this.graph_&&(this.graph_.layout(a,c,g,k,b),this.graph_.drawTicks(e),this.graph_.drawLines(e),this.graph_.drawLabels(e)),e.restore()}},drawTimeLabels:function(a,c,d,e,g){for(var j=new Date(g).toLocaleTimeString(),k=a.measureText(j).width+f,l=[1e3,5e3,3e4,6e4,3e5,18e5,36e5,18e6],m=null,n=0;n<l.length;++n)if(l[n]/b>=k){m=l[n];break}if(m){var o=Math.ceil(g/m)*m;for(a.textBaseline="bottom",a.textAlign="center",a.fillStyle=i,a.strokeStyle=h;;){var p=Math.round((o-g)/b);if(p>=c)break;var q=new Date(o).toLocaleTimeString();a.fillText(q,p,e),a.beginPath(),a.lineTo(p,0),a.lineTo(p,d),a.stroke(),o+=m}}},getDataSeriesCount:function(){return this.graph_?this.graph_.dataSeries_.length:0},hasDataSeries:function(a){return this.graph_?this.graph_.hasDataSeries(a):!1}};var k=function(){function a(){this.dataSeries_=[],this.width_=0,this.height_=0,this.fontHeight_=0,this.startTime_=0,this.scale_=0,this.max_=0,this.labels_=[]}return a.prototype={addDataSeries:function(a){this.dataSeries_.push(a)},hasDataSeries:function(a){for(var b=0;b<this.dataSeries_.length;++b)if(this.dataSeries_[b]==a)return!0;return!1},getValues:function(a){return a.isVisible()?a.getValues(this.startTime_,this.scale_,this.width_):null},layout:function(a,b,c,d,e){this.width_=a,this.height_=b,this.fontHeight_=c,this.startTime_=d,this.scale_=e;for(var f=0,g=0;g<this.dataSeries_.length;++g){var h=this.getValues(this.dataSeries_[g]);if(h)for(var i=0;i<h.length;++i)h[i]>f&&(f=h[i])}this.layoutLabels_(f)},layoutLabels_:function(a){if(1024>a)return void this.layoutLabelsBasic_(a,0);var b=["","m","M","G","T","P"],c=1;for(a/=1024;b[c+1]&&a>=1024;)a/=1024,++c;this.layoutLabelsBasic_(a,1);for(var d=0;d<this.labels_.length;++d)this.labels_[d]+=" "+b[c];this.max_*=Math.pow(1024,c)},layoutLabelsBasic_:function(a,b){if(this.labels_=[],0==a)return void(this.max_=a);var e=2*this.fontHeight_+d,f=1+this.height_/e;2>f?f=2:f>c&&(f=c);for(var g=Math.pow(10,-b),h=b;;){if(Math.ceil(a/g)+1<=f)break;if(Math.ceil(a/(2*g))+1<=f){g*=2;break}if(Math.ceil(a/(5*g))+1<=f){g*=5;break}g*=10,h>0&&--h}this.max_=Math.ceil(a/g)*g;for(var i=this.max_;i>=0;i-=g)this.labels_.push(i.toFixed(h))},drawTicks:function(a){var b,c;b=this.width_-1,c=this.width_-1-g,a.fillStyle=h,a.beginPath();for(var d=1;d<this.labels_.length-1;++d){var e=Math.round(this.height_*d/(this.labels_.length-1));a.moveTo(b,e),a.lineTo(c,e)}a.stroke()},drawLines:function(a){var b=0,c=this.height_-1;this.max_&&(b=c/this.max_);for(var d=this.dataSeries_.length-1;d>=0;--d){var e=this.getValues(this.dataSeries_[d]);if(e){a.strokeStyle=this.dataSeries_[d].getColor(),a.beginPath();for(var f=0;f<e.length;++f)a.lineTo(f,c-Math.round(e[f]*b));a.stroke()}}},drawLabels:function(a){if(0!=this.labels_.length){var b=this.width_-e;a.fillStyle=i,a.textAlign="right",a.textBaseline="top",a.fillText(this.labels_[0],b,0),a.textBaseline="bottom";for(var c=(this.height_-1)/(this.labels_.length-1),d=1;d<this.labels_.length;++d)a.fillText(this.labels_[d],b,c*d)}}},a}();return a}(),STATS_GRAPH_CONTAINER_HEADING_CLASS="stats-graph-container-heading",bweCompoundGraphConfig={googAvailableSendBandwidth:{color:"red"},googTargetEncBitrateCorrected:{color:"purple"},googActualEncBitrate:{color:"orange"},googRetransmitBitrate:{color:"blue"},googTransmitBitrate:{color:"green"}},totalToPerSecond=function(a){var b=a.dataPoints_.length;if(b>=2){var c=a.dataPoints_[b-1],d=a.dataPoints_[b-2];return Math.round(1e3*(c.value-d.value)/(c.time-d.time))}return 0},totalBytesToBitsPerSecond=function(a){return 8*totalToPerSecond(a)},totalKiloBytesToBitsPerSecond=function(a){return totalBytesToBitsPerSecond(a)/1e3},packetsLostPercentage=function(a,b,c,d){var e=getLastValue(b,c,d,"packetsLost"),f=getLastValue(b,c,d,"packetsReceived");return null!=e&&null!=f?Math.round(100*e/(f+e)*100)/100:null},dataConversionConfig={packetsSent:{convertedName:"packetsSentPerSecond",convertFunction:totalToPerSecond},bytesSent:{convertedName:"kiloBitsSentPerSecond",convertFunction:totalKiloBytesToBitsPerSecond},packetsReceived:{convertedName:"packetsReceivedPerSecond",convertFunction:totalToPerSecond},bytesReceived:{convertedName:"kiloBitsReceivedPerSecond",convertFunction:totalKiloBytesToBitsPerSecond},packetsLost:{convertedName:"packetsLostPer",convertFunction:packetsLostPercentage},googTargetEncBitrate:{convertedName:"googTargetEncBitrateCorrected",convertFunction:function(a){var b=a.dataPoints_.length,c=a.dataPoints_[b-1];return c.value<5e3?1e3*c.value:c.value}}},graphViews={},dataSeries={},StatsTable=function(){"use strict";function a(a){this.ssrcInfoManager_=a}return a.prototype={addStatsReport:function(a,b,c,d){var e=this.ensureStatsTable_(a,d);d.stats&&this.addStatsToTable_(a,b,c,e,d.stats.timestamp,d.stats.values)},ensureStatsTableContainer_:function(a){var b=a.id+"-table-container",c=$('[id="'+b+'"]')[0];return c||(c=document.createElement("div"),c.id=b,c.className="stats-table-container",a.appendChild(c)),c},ensureStatsTable_:function(a,b){var c=a.id+"-table-"+b.type+"-"+b.id,d=$(document.getElementById(c))[0];if(!d){var e=this.ensureStatsTableContainer_(a);d=document.createElement("table"),e.appendChild(d),d.id=c,d.border=1,d.innerHTML="<tr><th colspan=2></th></tr>",d.rows[0].cells[0].textContent="Statistics "+b.type+"-"+b.id,"ssrc"==b.type&&(d.insertRow(1),d.rows[1].innerHTML="<td colspan=2></td>",this.ssrcInfoManager_.populateSsrcInfo(d.rows[1].cells[0],b.id))}return d},addStatsToTable_:function(a,b,c,d,e,f){Date(e);$(".stats-var").each(function(){var d=$(this).data("var"),e=$(this).data("type");if(matchesType(d,e,f)){var g=getLastValue(a,b,c,d);null!=g&&($(this).html(g),$(this).attr("data-avg",getAvgValue(a,b,c,d)))}})},updateStatsTableRow_:function(a,b,c){var d=a.id+"-"+b,e=$('[id="'+d+'"]')[0];e||(e=document.createElement("tr"),e.id=d,a.firstChild.appendChild(e),e.innerHTML="<td>"+b+"</td><td></td>"),e.cells[1].textContent=c}},a}(),PeerConnectionUpdateEntry=function(a,b,c,d){this.pid=a,this.lid=b,this.type=c,this.value=d},PeerConnectionUpdateTable=function(){"use strict";function a(){this.UPDATE_LOG_ID_SUFFIX_="-update-log",this.UPDATE_LOG_CONTAINER_CLASS_="update-log-container",this.UPDATE_LOG_TABLE_CLASS_="update-log-table"}return a.prototype={addPeerConnectionUpdate:function(a,b){var c=this.ensureUpdateContainer_(a),d=document.createElement("tr");if(c.firstChild.appendChild(d),d.innerHTML="<td>"+(new Date).toLocaleString()+"</td>",0==b.value.length)return void(d.innerHTML+="<td>"+b.type+"</td>");d.innerHTML+="<td><details><summary>"+b.type+"</summary></details></td>";var e=document.createElement("pre"),f=d.cells[1].childNodes[0];f.appendChild(e),e.textContent=b.value},ensureUpdateContainer_:function(a){var b=a.id+this.UPDATE_LOG_ID_SUFFIX_,c=$('[id="'+b+'"]')[0];if(!c){var d=document.createElement("div");d.className=this.UPDATE_LOG_CONTAINER_CLASS_,a.appendChild(d),c=document.createElement("table"),c.className=this.UPDATE_LOG_TABLE_CLASS_,c.id=b,c.border=1,d.appendChild(c),c.innerHTML='<tr><th>Time</th><th class="update-log-header-event">Event</th></tr>'}return c}},a}(),DumpCreator=function(){function a(a){this.recording_=!1,this.StatusStrings_={NOT_STARTED:"not started.",RECORDING:"recording..."},this.status_=this.StatusStrings_.NOT_STARTED,this.root_=document.createElement("details"),this.root_.className="peer-connection-dump-root",a.appendChild(this.root_);var b=document.createElement("summary");this.root_.appendChild(b),b.textContent="Create Dump";var c=document.createElement("pre");this.root_.appendChild(c),c.innerHTML="<button></button> Status: <span></span>",c.getElementsByTagName("button")[0].addEventListener("click",this.onToggled_.bind(this)),this.updateDisplay_()}return a.prototype={onToggled_:function(){this.recording_?(this.recording_=!1,this.status_=this.StatusStrings_.NOT_STARTED,chrome.send("stopRtpRecording")):(this.recording_=!0,this.status_=this.StatusStrings_.RECORDING,chrome.send("startRtpRecording")),this.updateDisplay_()},updateDisplay_:function(){this.root_.getElementsByTagName("button")[0].textContent=this.recording_?"Stop Recording RTP Packets":"Start Recording RTP Packets",this.root_.getElementsByTagName("span")[0].textContent=this.status_},onUpdate:function(a){this.recording_&&(this.status_=JSON.stringify(a),this.updateDisplay_())}},a}();document.addEventListener("DOMContentLoaded",initialize),function(b){var c=b.detect=function(){var b=function(){},c={browser_parsers:[{regex:"^(Opera)/(\\d+)\\.(\\d+) \\(Nintendo Wii",family_replacement:"Wii",manufacturer:"Nintendo"},{regex:"(SeaMonkey|Camino)/(\\d+)\\.(\\d+)\\.?([ab]?\\d+[a-z]*)",family_replacement:"Camino",other:!0},{regex:"(Pale[Mm]oon)/(\\d+)\\.(\\d+)\\.?(\\d+)?",family_replacement:"Pale Moon (Firefox Variant)",other:!0},{regex:"(Fennec)/(\\d+)\\.(\\d+)\\.?([ab]?\\d+[a-z]*)",family_replacement:"Firefox Mobile"},{regex:"(Fennec)/(\\d+)\\.(\\d+)(pre)",family_replacment:"Firefox Mobile"},{regex:"(Fennec)/(\\d+)\\.(\\d+)",family_replacement:"Firefox Mobile"},{regex:"Mobile.*(Firefox)/(\\d+)\\.(\\d+)",family_replacement:"Firefox Mobile"},{regex:"(Namoroka|Shiretoko|Minefield)/(\\d+)\\.(\\d+)\\.(\\d+(?:pre)?)",family_replacement:"Firefox ($1)"},{regex:"(Firefox)/(\\d+)\\.(\\d+)(a\\d+[a-z]*)",family_replacement:"Firefox Alpha"},{regex:"(Firefox)/(\\d+)\\.(\\d+)(b\\d+[a-z]*)",family_replacement:"Firefox Beta"},{regex:"(Firefox)-(?:\\d+\\.\\d+)?/(\\d+)\\.(\\d+)(a\\d+[a-z]*)",family_replacement:"Firefox Alpha"},{regex:"(Firefox)-(?:\\d+\\.\\d+)?/(\\d+)\\.(\\d+)(b\\d+[a-z]*)",family_replacement:"Firefox Beta"},{regex:"(Namoroka|Shiretoko|Minefield)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)?",family_replacement:"Firefox ($1)"},{regex:"(Firefox).*Tablet browser (\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"MicroB",tablet:!0},{regex:"(MozillaDeveloperPreview)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)?"},{regex:"(Flock)/(\\d+)\\.(\\d+)(b\\d+?)",family_replacement:"Flock",other:!0},{regex:"(RockMelt)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Rockmelt",other:!0},{regex:"(Navigator)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Netscape"},{regex:"(Navigator)/(\\d+)\\.(\\d+)([ab]\\d+)",family_replacement:"Netscape"},{regex:"(Netscape6)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Netscape"},{regex:"(MyIBrow)/(\\d+)\\.(\\d+)",family_replacement:"My Internet Browser",other:!0},{regex:"(Opera Tablet).*Version/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",family_replacement:"Opera Tablet",tablet:!0},{regex:"(Opera)/.+Opera Mobi.+Version/(\\d+)\\.(\\d+)",family_replacement:"Opera Mobile"},{regex:"Opera Mobi",family_replacement:"Opera Mobile"},{regex:"(Opera Mini)/(\\d+)\\.(\\d+)",family_replacement:"Opera Mini"},{regex:"(Opera Mini)/att/(\\d+)\\.(\\d+)",family_replacement:"Opera Mini"},{regex:"(Opera)/9.80.*Version/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",family_replacement:"Opera"},{regex:"(webOSBrowser)/(\\d+)\\.(\\d+)",family_replacement:"webOS"},{regex:"(webOS)/(\\d+)\\.(\\d+)",family_replacement:"webOS"},{regex:"(wOSBrowser).+TouchPad/(\\d+)\\.(\\d+)",family_replacement:"webOS TouchPad"},{regex:"(luakit)",family_replacement:"LuaKit",other:!0},{regex:"(Lightning)/(\\d+)\\.(\\d+)([ab]?\\d+[a-z]*)",family_replacement:"Lightning",other:!0},{regex:"(Firefox)/(\\d+)\\.(\\d+)\\.(\\d+(?:pre)?) \\(Swiftfox\\)",family_replacement:"Swiftfox",other:!0},{regex:"(Firefox)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)? \\(Swiftfox\\)",family_replacement:"Swiftfox",other:!0},{regex:"rekonq",family_replacement:"Rekonq",other:!0},{regex:"(conkeror|Conkeror)/(\\d+)\\.(\\d+)\\.?(\\d+)?",family_replacement:"Conkeror",other:!0},{regex:"(konqueror)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Konqueror",other:!0},{regex:"(WeTab)-Browser",family_replacement:"WeTab",other:!0},{regex:"(Comodo_Dragon)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Comodo Dragon",other:!0},{regex:"(YottaaMonitor)",family_replacement:"Yottaa Monitor",other:!0},{regex:"(Kindle)/(\\d+)\\.(\\d+)",family_replacement:"Kindle"},{regex:"(Symphony) (\\d+).(\\d+)",family_replacement:"Symphony",other:!0},{regex:"Minimo",family_replacement:"Minimo",other:!0},{regex:"(CrMo)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Chrome Mobile"},{regex:"(CriOS)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Chrome Mobile iOS"},{regex:"(Chrome)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+) Mobile",family_replacement:"Chrome Mobile"},{regex:"(chromeframe)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Chrome Frame"},{regex:"(UC Browser)(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"UC Browser",other:!0},{regex:"(SLP Browser)/(\\d+)\\.(\\d+)",family_replacement:"Tizen Browser",other:!0},{regex:"(Epiphany)/(\\d+)\\.(\\d+).(\\d+)",family_replacement:"Epiphany",other:!0},{regex:"(SE 2\\.X) MetaSr (\\d+)\\.(\\d+)",family_replacement:"Sogou Explorer",other:!0},{regex:"(Pingdom.com_bot_version_)(\\d+)\\.(\\d+)",family_replacement:"PingdomBot",other:!0},{regex:"(facebookexternalhit)/(\\d+)\\.(\\d+)",family_replacement:"FacebookBot"},{regex:"(Twitterbot)/(\\d+)\\.(\\d+)",family_replacement:"TwitterBot"},{regex:"(AdobeAIR|Chromium|FireWeb|Jasmine|ANTGalio|Midori|Fresco|Lobo|PaleMoon|Maxthon|Lynx|OmniWeb|Dillo|Camino|Demeter|Fluid|Fennec|Shiira|Sunrise|Chrome|Flock|Netscape|Lunascape|WebPilot|NetFront|Netfront|Konqueror|SeaMonkey|Kazehakase|Vienna|Iceape|Iceweasel|IceWeasel|Iron|K-Meleon|Sleipnir|Galeon|GranParadiso|Opera Mini|iCab|NetNewsWire|ThunderBrowse|Iron|Iris|UP\\.Browser|Bunjaloo|Google Earth|Raven for Mac)/(\\d+)\\.(\\d+)\\.(\\d+)"},{regex:"(Bolt|Jasmine|IceCat|Skyfire|Midori|Maxthon|Lynx|Arora|IBrowse|Dillo|Camino|Shiira|Fennec|Phoenix|Chrome|Flock|Netscape|Lunascape|Epiphany|WebPilot|Opera Mini|Opera|NetFront|Netfront|Konqueror|Googlebot|SeaMonkey|Kazehakase|Vienna|Iceape|Iceweasel|IceWeasel|Iron|K-Meleon|Sleipnir|Galeon|GranParadiso|iCab|NetNewsWire|Iron|Space Bison|Stainless|Orca|Dolfin|BOLT|Minimo|Tizen Browser|Polaris)/(\\d+)\\.(\\d+)"},{regex:"(iRider|Crazy Browser|SkipStone|iCab|Lunascape|Sleipnir|Maemo Browser) (\\d+)\\.(\\d+)\\.(\\d+)"},{regex:"(iCab|Lunascape|Opera|Android|Jasmine|Polaris|BREW) (\\d+)\\.(\\d+)\\.?(\\d+)?"},{regex:"(Android) Donut",v2_replacement:"2",v1_replacement:"1"},{regex:"(Android) Eclair",v2_replacement:"1",v1_replacement:"2"},{regex:"(Android) Froyo",v2_replacement:"2",v1_replacement:"2"},{regex:"(Android) Gingerbread",v2_replacement:"3",v1_replacement:"2"},{regex:"(Android) Honeycomb",v1_replacement:"3"},{regex:"(IEMobile)[ /](\\d+)\\.(\\d+)",family_replacement:"IE Mobile"},{regex:"(MSIE) (\\d+)\\.(\\d+).*XBLWP7",family_replacement:"IE Large Screen"},{regex:"(Firefox)/(\\d+)\\.(\\d+)\\.(\\d+)"},{regex:"(Firefox)/(\\d+)\\.(\\d+)(pre|[ab]\\d+[a-z]*)?"},{regex:"(Obigo)InternetBrowser",other:!0},{regex:"(Obigo)\\-Browser",other:!0},{regex:"(Obigo|OBIGO)[^\\d]*(\\d+)(?:.(\\d+))?",other:!0},{regex:"(MAXTHON|Maxthon) (\\d+)\\.(\\d+)",family_replacement:"Maxthon",other:!0},{regex:"(Maxthon|MyIE2|Uzbl|Shiira)",v1_replacement:"0",other:!0},{regex:"(PLAYSTATION) (\\d+)",family_replacement:"PlayStation",manufacturer:"Sony"},{regex:"(PlayStation Portable)[^\\d]+(\\d+).(\\d+)",manufacturer:"Sony"},{regex:"(BrowseX) \\((\\d+)\\.(\\d+)\\.(\\d+)",other:!0},{regex:"(POLARIS)/(\\d+)\\.(\\d+)",family_replacement:"Polaris",other:!0},{regex:"(Embider)/(\\d+)\\.(\\d+)",family_replacement:"Polaris",other:!0},{regex:"(BonEcho)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Bon Echo",other:!0},{regex:"(iPod).+Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPod).*Version/(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPod)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPhone).*Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPhone).*Version/(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPhone)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPad).*Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",tablet:!0,manufacturer:"Apple"},{regex:"(iPad).*Version/(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",tablet:!0,manufacturer:"Apple"},{regex:"(iPad)",family_replacement:"Mobile Safari",tablet:!0,manufacturer:"Apple"},{regex:"(AvantGo) (\\d+).(\\d+)",other:!0},{regex:"(Avant)",v1_replacement:"1",other:!0},{regex:"^(Nokia)",family_replacement:"Nokia Services (WAP) Browser",manufacturer:"Nokia"},{regex:"(NokiaBrowser)/(\\d+)\\.(\\d+).(\\d+)\\.(\\d+)",manufacturer:"Nokia"},{regex:"(NokiaBrowser)/(\\d+)\\.(\\d+).(\\d+)",manufacturer:"Nokia"},{regex:"(NokiaBrowser)/(\\d+)\\.(\\d+)",manufacturer:"Nokia"},{regex:"(BrowserNG)/(\\d+)\\.(\\d+).(\\d+)",family_replacement:"NokiaBrowser",manufacturer:"Nokia"},{regex:"(Series60)/5\\.0",v2_replacement:"0",v1_replacement:"7",family_replacement:"NokiaBrowser",manufacturer:"Nokia"},{regex:"(Series60)/(\\d+)\\.(\\d+)",family_replacement:"Nokia OSS Browser",manufacturer:"Nokia"},{regex:"(S40OviBrowser)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Nokia Series 40 Ovi Browser",manufacturer:"Nokia"},{regex:"(Nokia)[EN]?(\\d+)",manufacturer:"Nokia"},{regex:"(BB10);",family_replacement:"Blackberry WebKit",manufacturer:"RIM"},{regex:"(PlayBook).+RIM Tablet OS (\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Blackberry WebKit",tablet:!0,manufacturer:"Nokia"},{regex:"(Black[bB]erry).+Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Blackberry WebKit",manufacturer:"RIM"},{regex:"(Black[bB]erry)\\s?(\\d+)",family_replacement:"Blackberry",manufacturer:"RIM"},{regex:"(OmniWeb)/v(\\d+)\\.(\\d+)",other:!0},{regex:"(Blazer)/(\\d+)\\.(\\d+)",family_replacement:"Palm Blazer",manufacturer:"Palm"},{regex:"(Pre)/(\\d+)\\.(\\d+)",family_replacement:"Palm Pre",manufacturer:"Palm"},{regex:"(Links) \\((\\d+)\\.(\\d+)",other:!0},{regex:"(QtWeb) Internet Browser/(\\d+)\\.(\\d+)",other:!0},{regex:"(Silk)/(\\d+)\\.(\\d+)(?:\\.([0-9\\-]+))?",other:!0,tablet:!0},{regex:"(AppleWebKit)/(\\d+)\\.?(\\d+)?\\+ .* Version/\\d+\\.\\d+.\\d+ Safari/",family_replacement:"WebKit Nightly"},{regex:"(Version)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?.*Safari/",family_replacement:"Safari"},{regex:"(Safari)/\\d+"},{regex:"(OLPC)/Update(\\d+)\\.(\\d+)",other:!0},{regex:"(OLPC)/Update()\\.(\\d+)",v1_replacement:"0",other:!0},{regex:"(SEMC\\-Browser)/(\\d+)\\.(\\d+)",other:!0},{regex:"(Teleca)",family_replacement:"Teleca Browser",other:!0},{regex:"(MSIE) (\\d+)\\.(\\d+)",family_replacement:"IE"}],os_parsers:[{regex:"(Android) (\\d+)\\.(\\d+)(?:[.\\-]([a-z0-9]+))?"},{regex:"(Android)\\-(\\d+)\\.(\\d+)(?:[.\\-]([a-z0-9]+))?"},{regex:"(Android) Donut",os_v2_replacement:"2",os_v1_replacement:"1"},{regex:"(Android) Eclair",os_v2_replacement:"1",os_v1_replacement:"2"},{regex:"(Android) Froyo",os_v2_replacement:"2",os_v1_replacement:"2"},{regex:"(Android) Gingerbread",os_v2_replacement:"3",os_v1_replacement:"2"},{regex:"(Android) Honeycomb",os_v1_replacement:"3"},{regex:"(Windows Phone 6\\.5)"},{regex:"(Windows (?:NT 5\\.2|NT 5\\.1))",os_replacement:"Windows XP"},{regex:"(XBLWP7)",os_replacement:"Windows Phone OS"},{regex:"(Windows NT 6\\.1)",os_replacement:"Windows 7"},{regex:"(Windows NT 6\\.0)",os_replacement:"Windows Vista"},{regex:"(Windows 98|Windows XP|Windows ME|Windows 95|Windows CE|Windows 7|Windows NT 4\\.0|Windows Vista|Windows 2000)"},{regex:"(Windows NT 6\\.2)",os_replacement:"Windows 8"},{regex:"(Windows Phone 8)",os_replacement:"Windows Phone 8"},{regex:"(Windows NT 5\\.0)",os_replacement:"Windows 2000"},{regex:"(Windows Phone OS) (\\d+)\\.(\\d+)"},{regex:"(Windows ?Mobile)",os_replacement:"Windows Mobile"},{regex:"(WinNT4.0)",os_replacement:"Windows NT 4.0"},{regex:"(Win98)",os_replacement:"Windows 98"},{regex:"(Tizen)/(\\d+)\\.(\\d+)",other:!0},{regex:"(Mac OS X) (\\d+)[_.](\\d+)(?:[_.](\\d+))?",manufacturer:"Apple"},{regex:"(?:PPC|Intel) (Mac OS X)",manufacturer:"Apple"},{regex:"(CPU OS|iPhone OS) (\\d+)_(\\d+)(?:_(\\d+))?",os_replacement:"iOS",manufacturer:"Apple"},{regex:"(iPhone|iPad|iPod); Opera",os_replacement:"iOS",manufacturer:"Apple"},{regex:"(iPad); Opera",tablet:!0,manufacturer:"Apple"},{regex:"(iPhone|iPad|iPod).*Mac OS X.*Version/(\\d+)\\.(\\d+)",os_replacement:"iOS",manufacturer:"Apple"},{regex:"(CrOS) [a-z0-9_]+ (\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"Chrome OS"},{regex:"(Debian)-(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",other:!0},{regex:"(Linux Mint)(?:/(\\d+))?",other:!0},{regex:"(Mandriva)(?: Linux)?/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",other:!0},{regex:"(Symbian[Oo][Ss])/(\\d+)\\.(\\d+)",os_replacement:"Symbian OS"},{regex:"(Symbian/3).+NokiaBrowser/7\\.3",os_replacement:"Symbian^3 Anna"},{regex:"(Symbian/3).+NokiaBrowser/7\\.4",os_replacement:"Symbian^3 Belle"},{regex:"(Symbian/3)",os_replacement:"Symbian^3"},{regex:"(Series 60|SymbOS|S60)",os_replacement:"Symbian OS"},{regex:"(MeeGo)",other:!0},{regex:"Symbian [Oo][Ss]",os_replacement:"Symbian OS"},{regex:"(BB10);.+Version/(\\d+).(\\d+).(\\d+)",os_replacement:"BlackBerry OS",manufacturer:"RIM"},{regex:"(Black[Bb]erry)[0-9a-z]+/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"BlackBerry OS",manufacturer:"RIM"},{regex:"(Black[Bb]erry).+Version/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"BlackBerry OS",manufacturer:"RIM"},{regex:"(RIM Tablet OS) (\\d+)\\.(\\d+)\\.(\\d+)",os_replacement:"BlackBerry Tablet OS",tablet:!0,manufacturer:"RIM"},{regex:"(Play[Bb]ook)",os_replacement:"BlackBerry Tablet OS",tablet:!0,manufacturer:"RIM"},{regex:"(Black[Bb]erry)",os_replacement:"Blackberry OS",manufacturer:"RIM"},{regex:"(webOS|hpwOS)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"webOS"},{regex:"(SUSE|Fedora|Red Hat|PCLinuxOS)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",other:!0},{regex:"(SUSE|Fedora|Red Hat|Puppy|PCLinuxOS|CentOS)/(\\d+)\\.(\\d+)\\.(\\d+)",other:!0},{regex:"(Ubuntu|Kindle|Bada|Lubuntu|BackTrack|Red Hat|Slackware)/(\\d+)\\.(\\d+)"},{regex:"(Windows|OpenBSD|FreeBSD|NetBSD|Ubuntu|Kubuntu|Android|Arch Linux|CentOS|WeTab|Slackware)"},{regex:"(Linux|BSD)",other:!0}],mobile_os_families:["Windows Phone 6.5","Windows CE","Symbian OS"],device_parsers:[{regex:"HTC ([A-Z][a-z0-9]+) Build",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC ([A-Z][a-z0-9 ]+) \\d+\\.\\d+\\.\\d+\\.\\d+",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC_Touch_([A-Za-z0-9]+)",device_replacement:"HTC Touch ($1)",manufacturer:"HTC"},{regex:"USCCHTC(\\d+)",device_replacement:"HTC $1 (US Cellular)",manufacturer:"HTC"},{regex:"Sprint APA(9292)",device_replacement:"HTC $1 (Sprint)",manufacturer:"HTC"},{regex:"HTC ([A-Za-z0-9]+ [A-Z])",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC-([A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC_([A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC ([A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"(ADR[A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"(HTC)",manufacturer:"HTC"},{regex:"SonyEricsson([A-Za-z0-9]+)/",device_replacement:"Ericsson $1",other:!0,manufacturer:"Sony"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; WOWMobile (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\.[\\d]+; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\-update1\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\.[\\d]+; (.+) Build"},{regex:"NokiaN([0-9]+)",device_replacement:"Nokia N$1",manufacturer:"Nokia"},{regex:"Nokia([A-Za-z0-9\\v-]+)",device_replacement:"Nokia $1",manufacturer:"Nokia"},{regex:"NOKIA ([A-Za-z0-9\\-]+)",device_replacement:"Nokia $1",manufacturer:"Nokia"},{regex:"Nokia ([A-Za-z0-9\\-]+)",device_replacement:"Nokia $1",manufacturer:"Nokia"},{regex:"Lumia ([A-Za-z0-9\\-]+)",device_replacement:"Lumia $1",manufacturer:"Nokia"},{regex:"Symbian",device_replacement:"Nokia",manufacturer:"Nokia"},{regex:"BB10; ([A-Za-z0-9- ]+)\\)",device_replacement:"BlackBerry $1",manufacturer:"RIM"},{regex:"(PlayBook).+RIM Tablet OS",device_replacement:"Blackberry Playbook",tablet:!0,manufacturer:"RIM"},{regex:"(Black[Bb]erry [0-9]+);",manufacturer:"RIM"},{regex:"Black[Bb]erry([0-9]+)",device_replacement:"BlackBerry $1",manufacturer:"RIM"},{regex:"(Pre)/(\\d+)\\.(\\d+)",device_replacement:"Palm Pre",manufacturer:"Palm"},{regex:"(Pixi)/(\\d+)\\.(\\d+)",device_replacement:"Palm Pixi",manufacturer:"Palm"},{regex:"(Touchpad)/(\\d+)\\.(\\d+)",device_replacement:"HP Touchpad",manufacturer:"HP"},{regex:"HPiPAQ([A-Za-z0-9]+)/(\\d+).(\\d+)",device_replacement:"HP iPAQ $1",manufacturer:"HP"},{regex:"Palm([A-Za-z0-9]+)",device_replacement:"Palm $1",manufacturer:"Palm"},{regex:"Treo([A-Za-z0-9]+)",device_replacement:"Palm Treo $1",manufacturer:"Palm"},{regex:"webOS.*(P160UNA)/(\\d+).(\\d+)",device_replacement:"HP Veer",manufacturer:"HP"},{regex:"(Kindle Fire)",manufacturer:"Amazon"},{regex:"(Kindle)",manufacturer:"Amazon"},{regex:"(Silk)/(\\d+)\\.(\\d+)(?:\\.([0-9\\-]+))?",device_replacement:"Kindle Fire",tablet:!0,manufacturer:"Amazon"},{regex:"(iPad) Simulator;",manufacturer:"Apple"},{regex:"(iPad);",manufacturer:"Apple"},{regex:"(iPod);",manufacturer:"Apple"},{regex:"(iPhone) Simulator;",manufacturer:"Apple"},{regex:"(iPhone);",manufacturer:"Apple"},{regex:"Nexus\\ ([A-Za-z0-9\\-]+)",device_replacement:"Nexus $1"},{regex:"acer_([A-Za-z0-9]+)_",device_replacement:"Acer $1",manufacturer:"Acer"},{regex:"acer_([A-Za-z0-9]+)_",device_replacement:"Acer $1",manufacturer:"Acer"},{regex:"Amoi\\-([A-Za-z0-9]+)",device_replacement:"Amoi $1",other:!0,manufacturer:"Amoi"},{regex:"AMOI\\-([A-Za-z0-9]+)",device_replacement:"Amoi $1",other:!0,manufacturer:"Amoi"},{regex:"Asus\\-([A-Za-z0-9]+)",device_replacement:"Asus $1",manufacturer:"Asus"},{regex:"ASUS\\-([A-Za-z0-9]+)",device_replacement:"Asus $1",manufacturer:"Asus"},{regex:"BIRD\\-([A-Za-z0-9]+)",device_replacement:"Bird $1",other:!0},{regex:"BIRD\\.([A-Za-z0-9]+)",device_replacement:"Bird $1",other:!0},{regex:"BIRD ([A-Za-z0-9]+)",device_replacement:"Bird $1",other:!0},{regex:"Dell ([A-Za-z0-9]+)",device_replacement:"Dell $1",manufacturer:"Dell"},{regex:"DoCoMo/2\\.0 ([A-Za-z0-9]+)",device_replacement:"DoCoMo $1",other:!0},{regex:"([A-Za-z0-9]+)\\_W\\;FOMA",device_replacement:"DoCoMo $1",other:!0},{regex:"([A-Za-z0-9]+)\\;FOMA",device_replacement:"DoCoMo $1",other:!0},{regex:"vodafone([A-Za-z0-9]+)",device_replacement:"Huawei Vodafone $1",other:!0},{regex:"i\\-mate ([A-Za-z0-9]+)",device_replacement:"i-mate $1",other:!0},{regex:"Kyocera\\-([A-Za-z0-9]+)",device_replacement:"Kyocera $1",other:!0},{regex:"KWC\\-([A-Za-z0-9]+)",device_replacement:"Kyocera $1",other:!0},{regex:"Lenovo\\-([A-Za-z0-9]+)",device_replacement:"Lenovo $1",manufacturer:"Lenovo"},{regex:"Lenovo\\_([A-Za-z0-9]+)",device_replacement:"Lenovo $1",manufacturer:"Levovo"},{regex:"LG/([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG-LG([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE-LG([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE VX([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG ([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE LG\\-AX([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG\\-([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE\\-([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"(KIN)\\.One (\\d+)\\.(\\d+)",device_replacement:"Microsoft $1"},{regex:"(KIN)\\.Two (\\d+)\\.(\\d+)",device_replacement:"Microsoft $1"},{regex:"(Motorola)\\-([A-Za-z0-9]+)",manufacturer:"Motorola"},{regex:"MOTO\\-([A-Za-z0-9]+)",device_replacement:"Motorola $1",manufacturer:"Motorola"},{regex:"MOT\\-([A-Za-z0-9]+)",device_replacement:"Motorola $1",manufacturer:"Motorola"},{regex:"Philips([A-Za-z0-9]+)",device_replacement:"Philips $1",manufacturer:"Philips"},{regex:"Philips ([A-Za-z0-9]+)",device_replacement:"Philips $1",manufacturer:"Philips"},{regex:"SAMSUNG-([A-Za-z0-9\\-]+)",device_replacement:"Samsung $1",manufacturer:"Samsung"},{regex:"SAMSUNG\\; ([A-Za-z0-9\\-]+)",device_replacement:"Samsung $1",manufacturer:"Samsung"},{regex:"Softbank/1\\.0/([A-Za-z0-9]+)",device_replacement:"Softbank $1",other:!0},{regex:"Softbank/2\\.0/([A-Za-z0-9]+)",device_replacement:"Softbank $1",other:!0},{regex:"(hiptop|avantgo|plucker|xiino|blazer|elaine|up.browser|up.link|mmp|smartphone|midp|wap|vodafone|o2|pocket|mobile|pda)",device_replacement:"Generic Smartphone"},{regex:"^(1207|3gso|4thp|501i|502i|503i|504i|505i|506i|6310|6590|770s|802s|a wa|acer|acs\\-|airn|alav|asus|attw|au\\-m|aur |aus |abac|acoo|aiko|alco|alca|amoi|anex|anny|anyw|aptu|arch|argo|bell|bird|bw\\-n|bw\\-u|beck|benq|bilb|blac|c55/|cdm\\-|chtm|capi|comp|cond|craw|dall|dbte|dc\\-s|dica|ds\\-d|ds12|dait|devi|dmob|doco|dopo|el49|erk0|esl8|ez40|ez60|ez70|ezos|ezze|elai|emul|eric|ezwa|fake|fly\\-|fly\\_|g\\-mo|g1 u|g560|gf\\-5|grun|gene|go.w|good|grad|hcit|hd\\-m|hd\\-p|hd\\-t|hei\\-|hp i|hpip|hs\\-c|htc |htc\\-|htca|htcg)",device_replacement:"Generic Feature Phone"},{regex:"^(htcp|htcs|htct|htc\\_|haie|hita|huaw|hutc|i\\-20|i\\-go|i\\-ma|i230|iac|iac\\-|iac/|ig01|im1k|inno|iris|jata|java|kddi|kgt|kgt/|kpt |kwc\\-|klon|lexi|lg g|lg\\-a|lg\\-b|lg\\-c|lg\\-d|lg\\-f|lg\\-g|lg\\-k|lg\\-l|lg\\-m|lg\\-o|lg\\-p|lg\\-s|lg\\-t|lg\\-u|lg\\-w|lg/k|lg/l|lg/u|lg50|lg54|lge\\-|lge/|lynx|leno|m1\\-w|m3ga|m50/|maui|mc01|mc21|mcca|medi|meri|mio8|mioa|mo01|mo02|mode|modo|mot |mot\\-|mt50|mtp1|mtv |mate|maxo|merc|mits|mobi|motv|mozz|n100|n101|n102|n202|n203|n300|n302|n500|n502|n505|n700|n701|n710|nec\\-|nem\\-|newg|neon)",device_replacement:"Generic Feature Phone"},{regex:"^(netf|noki|nzph|o2 x|o2\\-x|opwv|owg1|opti|oran|ot\\-s|p800|pand|pg\\-1|pg\\-2|pg\\-3|pg\\-6|pg\\-8|pg\\-c|pg13|phil|pn\\-2|pt\\-g|palm|pana|pire|pock|pose|psio|qa\\-a|qc\\-2|qc\\-3|qc\\-5|qc\\-7|qc07|qc12|qc21|qc32|qc60|qci\\-|qwap|qtek|r380|r600|raks|rim9|rove|s55/|sage|sams|sc01|sch\\-|scp\\-|sdk/|se47|sec\\-|sec0|sec1|semc|sgh\\-|shar|sie\\-|sk\\-0|sl45|slid|smb3|smt5|sp01|sph\\-|spv |spv\\-|sy01|samm|sany|sava|scoo|send|siem|smar|smit|soft|sony|t\\-mo|t218|t250|t600|t610|t618|tcl\\-|tdg\\-|telm|tim\\-|ts70|tsm\\-|tsm3|tsm5|tx\\-9|tagt)",device_replacement:"Generic Feature Phone"},{regex:"^(talk|teli|topl|tosh|up.b|upg1|utst|v400|v750|veri|vk\\-v|vk40|vk50|vk52|vk53|vm40|vx98|virg|vite|voda|vulc|w3c |w3c\\-|wapj|wapp|wapu|wapm|wig |wapi|wapr|wapv|wapy|wapa|waps|wapt|winc|winw|wonu|x700|xda2|xdag|yas\\-|your|zte\\-|zeto|aste|audi|avan|blaz|brew|brvw|bumb|ccwa|cell|cldc|cmd\\-|dang|eml2|fetc|hipt|http|ibro|idea|ikom|ipaq|jbro|jemu|jigs|keji|kyoc|kyok|libw|m\\-cr|midp|mmef|moto|mwbp|mywa|newt|nok6|o2im|pant|pdxg|play|pluc|port|prox|rozo|sama|seri|smal|symb|treo|upsi|vx52|vx53|vx60|vx61|vx70|vx80|vx81|vx83|vx85|wap\\-|webc|whit|wmlb|xda\\-|xda\\_)",device_replacement:"Generic Feature Phone"},{regex:"(bot|borg|google(^tv)|yahoo|slurp|msnbot|msrbot|openbot|archiver|netresearch|lycos|scooter|altavista|teoma|gigabot|baiduspider|blitzbot|oegp|charlotte|furlbot|http%20client|polybot|htdig|ichiro|mogimogi|larbin|pompos|scrubby|searchsight|seekbot|semanticdiscovery|silk|snappy|speedy|spider|voila|vortex|voyager|zao|zeal|fast\\-webcrawler|converacrawler|dataparksearch|findlinks)",device_replacement:"Spider"}],mobile_browser_families:["Firefox Mobile","Opera Mobile","Opera Mini","Mobile Safari","webOS","IE Mobile","Playstation Portable","Nokia","Blackberry","Palm","Silk","Android","Maemo","Obigo","Netfront","AvantGo","Teleca","SEMC-Browser","Bolt","Iris","UP.Browser","Symphony","Minimo","Bunjaloo","Jasmine","Dolfin","Polaris","BREW","Chrome Mobile","Chrome Mobile iOS","UC Browser","Tizen Browser"]};
b.parsers=["device_parsers","browser_parsers","os_parsers","mobile_os_families","mobile_browser_families"],b.types=["browser","os","device"],b.regexes=c||function(){var a={};return b.parsers.map(function(b){a[b]=[]}),a}(),b.families=function(){var a={};return b.types.map(function(b){a[b]=[]}),a}();var d=Array.prototype,e=(Object.prototype,Function.prototype,d.forEach),f=(d.indexOf,function(a,b){for(var c={},d=0;d<b.length&&!(c=b[d](a));d++);return c}),g=function(a,b){h(a,function(a){h(b,function(b){delete a[b]})})},h=forEach=function(a,b,c){if(null!=a)if(e&&a.forEach===e)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,f=a.length;f>d;d++)if(b.call(c,a[d],d,a)==={})return}else for(var g in a)if(_.has(a,g)&&b.call(c,a[g],g,a)==={})return},i=function(a){return!(!a||"undefined"==typeof a||null==a)},j=function(a){var b="";return a=a||{},i(a)&&i(a.major)&&(b+=a.major,i(a.minor)&&(b+="."+a.minor,i(a.patch)&&(b+="."+a.patch))),b},k=function(a){a=a||{};var b=j(a);return b&&(b=" "+b),a&&i(a.family)?a.family+b:""};return b.parse=function(c){{var d=function(a){return b.regexes[a+"_parsers"].map(function(b){function c(a){var c=a.match(d);if(!c)return null;var g={};return g.family=(e?e.replace("$1",c[1]):c[1])||"other",g.major=parseInt(f?f:c[2])||null,g.minor=c[3]?parseInt(c[3]):null,g.patch=c[4]?parseInt(c[4]):null,g.tablet=b.tablet,g.man=b.manufacturer||null,g}var d=new RegExp(b.regex),e=b[("browser"===a?"family":a)+"_replacement"],f=b.major_version_replacement;return c})},e=function(){},h=d("browser"),l=d("os"),m=d("device");a=new e}a.browser=f(c,h),i(a.browser)?(a.browser.name=k(a.browser),a.browser.version=j(a.browser)):a.browser={},a.os=f(c,l),i(a.os)?(a.os.name=k(a.os),a.os.version=j(a.os)):a.os={},a.device=f(c,m),i(a.device)?(a.device.name=k(a.device),a.device.version=j(a.device)):a.device={tablet:!1};{var n={};b.regexes.mobile_browser_families.map(function(a){n[a]=!0}),b.regexes.mobile_os_families.map(function(a){n[a]=!0})}return a.device.type="Spider"===a.browser.family?"Spider":a.browser.tablet||a.os.tablet||a.device.tablet?"Tablet":n.hasOwnProperty(a.browser.family)?"Mobile":"Desktop",a.device.manufacturer=a.browser.man||a.os.man||a.device.man||null,g([a.browser,a.os,a.device],["tablet","man"]),a},b}();"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=c),exports.detect=c):b.detect=c,"function"==typeof define&&define.amd&&define(function(){return c})}(window),function(a,b){"function"==typeof define&&define.amd?define(b):"undefined"!=typeof module&&module.exports?module.exports=b():a.Salsa20=b()}(this,function(){function a(a,b){this.rounds=20,this.sigmaWords=[1634760805,857760878,2036477234,1797285236],this.keyWords=[],this.nonceWords=[0,0],this.counterWords=[0,0],this.block=[],this.blockUsed=64,this.setKey(a),this.setNonce(b)}return a.prototype.setKey=function(a){for(var b=0,c=0;8>b;b++,c+=4)this.keyWords[b]=255&a[c]|(255&a[c+1])<<8|(255&a[c+2])<<16|(255&a[c+3])<<24;this._reset()},a.prototype.setNonce=function(a){this.nonceWords[0]=255&a[0]|(255&a[1])<<8|(255&a[2])<<16|(255&a[3])<<24,this.nonceWords[1]=255&a[4]|(255&a[5])<<8|(255&a[6])<<16|(255&a[7])<<24,this._reset()},a.prototype.getBytes=function(a){for(var b=new Array(a),c=0;a>c;c++)64==this.blockUsed&&(this._generateBlock(),this._incrementCounter(),this.blockUsed=0),b[c]=this.block[this.blockUsed],this.blockUsed++;return b},a.prototype.getHexString=function(a){for(var b=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],c=[],d=this.getBytes(a),e=0;e<d.length;e++)c.push(b[d[e]>>4&15]),c.push(b[15&d[e]]);return c.join("")},a.prototype._reset=function(){this.counterWords[0]=0,this.counterWords[1]=0,this.blockUsed=64},a.prototype._incrementCounter=function(){this.counterWords[0]=this.counterWords[0]+1&4294967295,0==this.counterWords[0]&&(this.counterWords[1]=this.counterWords[1]+1&4294967295)},a.prototype._generateBlock=function(){for(var a,b=this.sigmaWords[0],c=this.keyWords[0],d=this.keyWords[1],e=this.keyWords[2],f=this.keyWords[3],g=this.sigmaWords[1],h=this.nonceWords[0],i=this.nonceWords[1],j=this.counterWords[0],k=this.counterWords[1],l=this.sigmaWords[2],m=this.keyWords[4],n=this.keyWords[5],o=this.keyWords[6],p=this.keyWords[7],q=this.sigmaWords[3],r=b,s=c,t=d,u=e,v=f,w=g,x=h,y=i,z=j,A=k,B=l,C=m,D=n,E=o,F=p,G=q,H=0;H<this.rounds;H+=2)a=r+D,v^=a<<7|a>>>25,a=v+r,z^=a<<9|a>>>23,a=z+v,D^=a<<13|a>>>19,a=D+z,r^=a<<18|a>>>14,a=w+s,A^=a<<7|a>>>25,a=A+w,E^=a<<9|a>>>23,a=E+A,s^=a<<13|a>>>19,a=s+E,w^=a<<18|a>>>14,a=B+x,F^=a<<7|a>>>25,a=F+B,t^=a<<9|a>>>23,a=t+F,x^=a<<13|a>>>19,a=x+t,B^=a<<18|a>>>14,a=G+C,u^=a<<7|a>>>25,a=u+G,y^=a<<9|a>>>23,a=y+u,C^=a<<13|a>>>19,a=C+y,G^=a<<18|a>>>14,a=r+u,s^=a<<7|a>>>25,a=s+r,t^=a<<9|a>>>23,a=t+s,u^=a<<13|a>>>19,a=u+t,r^=a<<18|a>>>14,a=w+v,x^=a<<7|a>>>25,a=x+w,y^=a<<9|a>>>23,a=y+x,v^=a<<13|a>>>19,a=v+y,w^=a<<18|a>>>14,a=B+A,C^=a<<7|a>>>25,a=C+B,z^=a<<9|a>>>23,a=z+C,A^=a<<13|a>>>19,a=A+z,B^=a<<18|a>>>14,a=G+F,D^=a<<7|a>>>25,a=D+G,E^=a<<9|a>>>23,a=E+D,F^=a<<13|a>>>19,a=F+E,G^=a<<18|a>>>14;r+=b,s+=c,t+=d,u+=e,v+=f,w+=g,x+=h,y+=i,z+=j,A+=k,B+=l,C+=m,D+=n,E+=o,F+=p,G+=q,this.block[0]=r>>>0&255,this.block[1]=r>>>8&255,this.block[2]=r>>>16&255,this.block[3]=r>>>24&255,this.block[4]=s>>>0&255,this.block[5]=s>>>8&255,this.block[6]=s>>>16&255,this.block[7]=s>>>24&255,this.block[8]=t>>>0&255,this.block[9]=t>>>8&255,this.block[10]=t>>>16&255,this.block[11]=t>>>24&255,this.block[12]=u>>>0&255,this.block[13]=u>>>8&255,this.block[14]=u>>>16&255,this.block[15]=u>>>24&255,this.block[16]=v>>>0&255,this.block[17]=v>>>8&255,this.block[18]=v>>>16&255,this.block[19]=v>>>24&255,this.block[20]=w>>>0&255,this.block[21]=w>>>8&255,this.block[22]=w>>>16&255,this.block[23]=w>>>24&255,this.block[24]=x>>>0&255,this.block[25]=x>>>8&255,this.block[26]=x>>>16&255,this.block[27]=x>>>24&255,this.block[28]=y>>>0&255,this.block[29]=y>>>8&255,this.block[30]=y>>>16&255,this.block[31]=y>>>24&255,this.block[32]=z>>>0&255,this.block[33]=z>>>8&255,this.block[34]=z>>>16&255,this.block[35]=z>>>24&255,this.block[36]=A>>>0&255,this.block[37]=A>>>8&255,this.block[38]=A>>>16&255,this.block[39]=A>>>24&255,this.block[40]=B>>>0&255,this.block[41]=B>>>8&255,this.block[42]=B>>>16&255,this.block[43]=B>>>24&255,this.block[44]=C>>>0&255,this.block[45]=C>>>8&255,this.block[46]=C>>>16&255,this.block[47]=C>>>24&255,this.block[48]=D>>>0&255,this.block[49]=D>>>8&255,this.block[50]=D>>>16&255,this.block[51]=D>>>24&255,this.block[52]=E>>>0&255,this.block[53]=E>>>8&255,this.block[54]=E>>>16&255,this.block[55]=E>>>24&255,this.block[56]=F>>>0&255,this.block[57]=F>>>8&255,this.block[58]=F>>>16&255,this.block[59]=F>>>24&255,this.block[60]=G>>>0&255,this.block[61]=G>>>8&255,this.block[62]=G>>>16&255,this.block[63]=G>>>24&255},a}),function(a,b){var c,d;"function"==typeof define&&define.amd?define(["salsa20"],b.bind(a,a.crypto)):"undefined"!=typeof module&&module.exports?(c=require("./salsa20.js"),d=require("crypto"),module.exports=b(d,c)):a.BigInt=b(a.crypto,a.Salsa20)}(this,function(a,b){function c(a){var b,c,d,e;for(c=new Array(a),b=0;a>b;b++)c[b]=0;for(c[0]=2,d=0;c[d]<a;){for(b=c[d]*c[d];a>b;b+=c[d])c[b]=1;for(d++,c[d]=c[d-1]+1;c[d]<a&&c[c[d]];c[d]++);}for(e=new Array(d),b=0;d>b;b++)e[b]=c[b];return e}function d(a,b){return ub.length!=a.length&&(ub=I(a),vb=I(a),wb=I(a)),K(wb,b),e(a,wb)}function e(a,b){var c,d,e,f;if(ub.length!=a.length&&(ub=I(a),vb=I(a),wb=I(a)),J(wb,b),J(vb,a),J(ub,a),L(vb,-1),L(ub,-1),G(vb))return 0;for(e=0;0==vb[e];e++);for(c=1,d=2;vb[e]%d==0;d*=2,c++);if(f=e*eb+c-1,f&&M(vb,f),ab(wb,vb,a),!E(wb,1)&&!F(wb,ub)){for(d=1;f-1>=d&&!F(wb,ub);){if($(wb,a),E(wb,1))return 0;d++}if(!F(wb,ub))return 0}return 1}function f(a){var b,c,d;for(b=a.length-1;0==a[b]&&b>0;b--);for(c=0,d=a[b];d;d>>=1,c++);return c+=eb*b}function g(a,b){var c=C(0,(a.length>b?a.length:b)*eb,0);return J(c,a),c}function h(a){var b=C(0,a,0);return q(b,a),_(b,1)}function i(a,b){var c=I(a);return Y(c,b),_(c,1)}function j(a,b){var c=g(a,a.length+1);return L(c,b),_(c,1)}function k(a,b){var c=g(a,a.length+b.length);return X(c,b),_(c,1)}function l(a,b,c){var d=g(a,c.length);return ab(d,_(b,2),_(c,2),0),_(d,1)}function m(a,b){var c=g(a,a.length>b.length?a.length+1:b.length+1);return V(c,b),_(c,1)}function n(a,b){var c=g(a,a.length>b.length?a.length+1:b.length+1);return W(c,b),_(c,1)}function o(a,b){var c,d=g(a,b.length);return c=u(d,b),c?_(d,1):null}function p(a,b,c){var d=g(a,c.length);return Z(d,b,c),_(d,1)}function q(a,b){var e,g,h,i,j,k,l,m,n,o,p,r,u;if(0==Db.length&&(Db=c(3e4)),0==Eb.length)for(Eb=new Array(512),k=0;512>k;k++)Eb[k]=Math.pow(2,k/511-1);if(e=.1,h=20,u=20,Gb.length!=a.length&&(Gb=I(a),Hb=I(a),Kb=I(a),Mb=I(a),Pb=I(a),Qb=I(a),Rb=I(a),Ob=I(a),Nb=I(a),Fb=I(a),Ib=I(a),Jb=I(a),Lb=I(a),Sb=I(a)),u>=b){for(i=(1<<(b+2>>1))-1,K(a,0),j=1;j;)for(j=0,a[0]=1|1<<b-1|ib(b),k=1;k<Db.length&&(Db[k]&i)==Db[k];k++)if(0==a[0]%Db[k]){j=1;break}return void A(a)}if(m=e*b*b,b>2*h)for(l=1;h>=b-b*l;)l=Eb[ib(9)];else l=.5;for(r=Math.floor(l*b)+1,q(Jb,r),K(Gb,0),Gb[Math.floor((b-2)/eb)]|=1<<(b-2)%eb,z(Gb,Jb,Fb,Ib),o=f(Fb);;){for(;s(Hb,o,0),!y(Fb,Hb););for(L(Hb,1),W(Hb,Fb),J(Nb,Jb),X(Nb,Hb),P(Nb,2),L(Nb,1),J(Mb,Hb),P(Mb,2),n=0,k=0;k<Db.length&&Db[k]<m;k++)if(0==B(Nb,Db[k])&&!E(Nb,Db[k])){n=1;break}if(n||d(Nb,2)||(n=1),!n){for(L(Nb,-3),k=Nb.length-1;0==Nb[k]&&k>0;k--);for(p=0,g=Nb[k];g;g>>=1,p++);for(p+=eb*k;s(Lb,p,0),!y(Nb,Lb););if(L(Nb,3),L(Lb,2),J(Ob,Lb),J(Kb,Nb),L(Kb,-1),ab(Ob,Kb,Nb),L(Ob,-1),G(Ob)&&(J(Ob,Lb),ab(Ob,Mb,Nb),L(Ob,-1),J(Sb,Nb),J(Pb,Ob),t(Pb,Nb),E(Pb,1)))return void J(a,Sb)}}}function r(a,b){var c,d;return c=Math.floor((a-1)/eb)+2,d=C(0,0,c),s(d,a,b),d}function s(a,b,c){var d,e;for(d=0;d<a.length;d++)a[d]=0;for(e=Math.floor((b-1)/eb)+1,d=0;e>d;d++)a[d]=ib(eb);a[e-1]&=(2<<(b-1)%eb)-1,1==c&&(a[e-1]|=1<<(b-1)%eb)}function t(a,b){var c,d,e,f,g,h,i,j,k,l;for(sb.length!=a.length&&(sb=I(a)),k=1;k;){for(k=0,c=1;c<b.length;c++)if(b[c]){k=1;break}if(!k)break;for(c=a.length;!a[c]&&c>=0;c--);for(d=a[c],e=b[c],f=1,g=0,h=0,i=1;e+h&&e+i&&(j=Math.floor((d+f)/(e+h)),l=Math.floor((d+g)/(e+i)),j==l);)kb=f-j*h,f=h,h=kb,kb=g-j*i,g=i,i=kb,kb=d-j*e,d=e,e=kb;g?(J(sb,a),R(a,b,f,g),R(b,sb,i,h)):(Y(a,b),J(sb,a),J(a,b),J(b,sb))}if(0!=b[0])for(kb=B(a,b[0]),K(a,b[0]),b[0]=kb;b[0];)a[0]%=b[0],kb=a[0],a[0]=b[0],b[0]=kb}function u(a,b){var c=1+2*Math.max(a.length,b.length);if(!(1&a[0]||1&b[0]))return K(a,0),0;for(yb.length!=c&&(yb=new Array(c),xb=new Array(c),zb=new Array(c),Ab=new Array(c),Bb=new Array(c),Cb=new Array(c)),J(yb,a),J(xb,b),K(zb,1),K(Ab,0),K(Bb,0),K(Cb,1);;){for(;!(1&yb[0]);)N(yb),1&zb[0]||1&Ab[0]?(W(zb,b),N(zb),V(Ab,a),N(Ab)):(N(zb),N(Ab));for(;!(1&xb[0]);)N(xb),1&Bb[0]||1&Cb[0]?(W(Bb,b),N(Bb),V(Cb,a),N(Cb)):(N(Bb),N(Cb));if(y(xb,yb)?(V(xb,yb),V(Bb,zb),V(Cb,Ab)):(V(yb,xb),V(zb,Bb),V(Ab,Cb)),E(yb,0)){for(;w(Bb);)W(Bb,b);return J(a,Bb),E(xb,1)?1:(K(a,0),0)}}}function v(a,b){for(var c=1,d=0;;){if(1==a)return c;if(0==a)return 0;if(d-=c*Math.floor(b/a),b%=a,1==b)return d;if(0==b)return 0;c-=d*Math.floor(a/b),a%=b}}function w(a){return a[a.length-1]>>eb-1&1}function x(a,b,c){var d,e=a.length,f=b.length,g=f>e+c?e+c:f;for(d=f-1-c;e>d&&d>=0;d++)if(a[d]>0)return 1;for(d=e-1+c;f>d;d++)if(b[d]>0)return 0;for(d=g-1;d>=c;d--){if(a[d-c]>b[d])return 1;if(a[d-c]<b[d])return 0}return 0}function y(a,b){var c,d=a.length<b.length?a.length:b.length;for(c=a.length;c<b.length;c++)if(b[c])return 0;for(c=b.length;c<a.length;c++)if(a[c])return 1;for(c=d-1;c>=0;c--){if(a[c]>b[c])return 1;if(a[c]<b[c])return 0}return 0}function z(a,b,c,d){var e,f,g,h,i,j,k,l;for(J(d,a),f=b.length;0==b[f-1];f--);for(l=b[f-1],k=0;l;k++)l>>=1;for(k=eb-k,O(b,k),O(d,k),e=d.length;0==d[e-1]&&e>f;e--);for(K(c,0);!x(b,d,e-f);)U(d,b,e-f),c[e-f]++;for(g=e-1;g>=f;g--){for(c[g-f]=d[g]==b[f-1]?fb:Math.floor((d[g]*gb+d[g-1])/b[f-1]);i=(f>1?b[f-2]:0)*c[g-f],j=i>>eb,i&=fb,h=j+c[g-f]*b[f-1],j=h>>eb,h&=fb,j==d[g]?h==d[g-1]?i>(g>1?d[g-2]:0):h>d[g-1]:j>d[g];)c[g-f]--;S(d,b,-c[g-f],g-f),w(d)&&(T(d,b,g-f),c[g-f]--)}M(b,k),M(d,k)}function A(a){var b,c,d,e;for(c=a.length,d=0,b=0;c>b;b++)d+=a[b],e=0,0>d&&(e=-(d>>eb),d+=e*gb),a[b]=d&fb,d=(d>>eb)-e}function B(a,b){var c,d=0;for(c=a.length-1;c>=0;c--)d=(d*gb+a[c])%b;return d}function C(a,b,c){var d,e;return d=Math.ceil(b/eb)+1,d=c>d?c:d,e=new Array(d),K(e,a),e}function D(a,b,c){var d,e,f,g,h,i=a.length;if(-1==b){for(f=new Array(0);;){for(g=new Array(f.length+1),e=0;e<f.length;e++)g[e+1]=f[e];if(g[0]=parseInt(a,10),f=g,d=a.indexOf(",",0),1>d)break;if(a=a.substring(d+1),0==a.length)break}return f.length<c?(g=new Array(c),J(g,f),g):f}for(var j=b,k=0,l=1==b?i:0;j>1;)1&j&&(k=1),l+=i,j>>=1;for(l+=k*i,f=C(0,l,0),e=0;i>e&&(d=hb.indexOf(a.substring(e,e+1),0),36>=b&&d>=36&&(d-=26),!(d>=b||0>d));e++)P(f,b),L(f,d);for(i=f.length;i>0&&!f[i-1];i--);for(i=c>i+1?c:i+1,g=new Array(i),h=i<f.length?i:f.length,e=0;h>e;e++)g[e]=f[e];for(;i>e;e++)g[e]=0;return g}function E(a,b){var c;if(a[0]!=b)return 0;for(c=1;c<a.length;c++)if(a[c])return 0;return 1}function F(a,b){var c,d=a.length<b.length?a.length:b.length;for(c=0;d>c;c++)if(a[c]!=b[c])return 0;if(a.length>b.length){for(;c<a.length;c++)if(a[c])return 0}else for(;c<b.length;c++)if(b[c])return 0;return 1}function G(a){var b;for(b=0;b<a.length;b++)if(a[b])return 0;return 1}function H(a,b){var c,d,e="";if(qb.length!=a.length?qb=I(a):J(qb,a),-1==b){for(c=a.length-1;c>0;c--)e+=a[c]+",";e+=a[0]}else for(;!G(qb);)d=Q(qb,b),e=hb.substring(d,d+1)+e;return 0==e.length&&(e="0"),e}function I(a){var b;return b=new Array(a.length),J(b,a),b}function J(a,b){var c,d=a.length<b.length?a.length:b.length;for(c=0;d>c;c++)a[c]=b[c];for(c=d;c<a.length;c++)a[c]=0}function K(a,b){var c,d;for(d=b,c=0;c<a.length;c++)a[c]=d&fb,d>>=eb}function L(a,b){var c,d,e,f;for(a[0]+=b,d=a.length,e=0,c=0;d>c;c++)if(e+=a[c],f=0,0>e&&(f=-(e>>eb),e+=f*gb),a[c]=e&fb,e=(e>>eb)-f,!e)return}function M(a,b){var c,d=Math.floor(b/eb);if(d){for(c=0;c<a.length-d;c++)a[c]=a[c+d];for(;c<a.length;c++)a[c]=0;b%=eb}for(c=0;c<a.length-1;c++)a[c]=fb&(a[c+1]<<eb-b|a[c]>>b);a[c]>>=b}function N(a){var b;for(b=0;b<a.length-1;b++)a[b]=fb&(a[b+1]<<eb-1|a[b]>>1);a[b]=a[b]>>1|a[b]&gb>>1}function O(a,b){var c,d=Math.floor(b/eb);if(d){for(c=a.length;c>=d;c--)a[c]=a[c-d];for(;c>=0;c--)a[c]=0;b%=eb}if(b){for(c=a.length-1;c>0;c--)a[c]=fb&(a[c]<<b|a[c-1]>>eb-b);a[c]=fb&a[c]<<b}}function P(a,b){var c,d,e,f;if(b)for(d=a.length,e=0,c=0;d>c;c++)e+=a[c]*b,f=0,0>e&&(f=-(e>>eb),e+=f*gb),a[c]=e&fb,e=(e>>eb)-f}function Q(a,b){var c,d,e=0;for(c=a.length-1;c>=0;c--)d=e*gb+a[c],a[c]=Math.floor(d/b),e=d%b;return e}function R(a,b,c,d){var e,f,g,h;for(g=a.length<b.length?a.length:b.length,h=a.length,f=0,e=0;g>e;e++)f+=c*a[e]+d*b[e],a[e]=f&fb,f>>=eb;for(e=g;h>e;e++)f+=c*a[e],a[e]=f&fb,f>>=eb}function S(a,b,c,d){var e,f,g,h;for(g=a.length<d+b.length?a.length:d+b.length,h=a.length,f=0,e=d;g>e;e++)f+=a[e]+c*b[e-d],a[e]=f&fb,f>>=eb;for(e=g;f&&h>e;e++)f+=a[e],a[e]=f&fb,f>>=eb}function T(a,b,c){var d,e,f,g;for(f=a.length<c+b.length?a.length:c+b.length,g=a.length,e=0,d=c;f>d;d++)e+=a[d]+b[d-c],a[d]=e&fb,e>>=eb;for(d=f;e&&g>d;d++)e+=a[d],a[d]=e&fb,e>>=eb}function U(a,b,c){var d,e,f,g;for(f=a.length<c+b.length?a.length:c+b.length,g=a.length,e=0,d=c;f>d;d++)e+=a[d]-b[d-c],a[d]=e&fb,e>>=eb;for(d=f;e&&g>d;d++)e+=a[d],a[d]=e&fb,e>>=eb}function V(a,b){var c,d,e;for(e=a.length<b.length?a.length:b.length,d=0,c=0;e>c;c++)d+=a[c]-b[c],a[c]=d&fb,d>>=eb;for(c=e;d&&c<a.length;c++)d+=a[c],a[c]=d&fb,d>>=eb}function W(a,b){var c,d,e;for(e=a.length<b.length?a.length:b.length,d=0,c=0;e>c;c++)d+=a[c]+b[c],a[c]=d&fb,d>>=eb;for(c=e;d&&c<a.length;c++)d+=a[c],a[c]=d&fb,d>>=eb}function X(a,b){var c;for(lb.length!=2*a.length&&(lb=new Array(2*a.length)),K(lb,0),c=0;c<b.length;c++)b[c]&&S(lb,a,b[c],c);J(a,lb)}function Y(a,b){ob.length!=a.length?ob=I(a):J(ob,a),pb.length!=a.length&&(pb=I(a)),z(ob,b,pb,a)}function Z(a,b,c){var d;for(mb.length!=2*a.length&&(mb=new Array(2*a.length)),K(mb,0),d=0;d<b.length;d++)b[d]&&S(mb,a,b[d],d);Y(mb,c),J(a,mb)}function $(a,b){var c,d,e,f,g;for(f=a.length;f>0&&!a[f-1];f--);for(g=f>b.length?2*f:2*b.length,mb.length!=g&&(mb=new Array(g)),K(mb,0),c=0;f>c;c++){for(e=mb[2*c]+a[c]*a[c],mb[2*c]=e&fb,e>>=eb,d=c+1;f>d;d++)e=mb[c+d]+2*a[c]*a[d]+e,mb[c+d]=e&fb,e>>=eb;mb[c+f]=e}Y(mb,b),J(a,mb)}function _(a,b){var c,d;for(c=a.length;c>0&&!a[c-1];c--);return d=new Array(c+b),J(d,a),d}function ab(a,b,c){var d,e,f,g;if(rb.length!=c.length&&(rb=I(c)),0!=(1&c[0])){for(K(rb,0),f=c.length;f>0&&!c[f-1];f--);for(g=gb-v(B(c,gb),gb),rb[f]=1,Z(a,rb,c),nb.length!=a.length?nb=I(a):J(nb,a),d=b.length-1;d>0&!b[d];d--);if(0==b[d])return void K(a,1);for(e=1<<eb-1;e&&!(b[d]&e);e>>=1);for(;;){if(!(e>>=1)){if(d--,0>d)return void bb(a,jb,c,g);e=1<<eb-1}bb(a,a,c,g),e&b[d]&&bb(a,nb,c,g)}}else for(J(rb,a),K(a,1);!E(b,0);)1&b[0]&&Z(a,rb,c),Q(b,2),$(rb,c)}function bb(a,b,c,d){var e,f,g,h,i,j,k=c.length,l=b.length;for(tb.length!=k&&(tb=new Array(k)),K(tb,0);k>0&&0==c[k-1];k--);for(;l>0&&0==b[l-1];l--);for(j=tb.length-1,e=0;k>e;e++){for(i=tb[0]+a[e]*b[0],h=(i&fb)*d&fb,g=i+h*c[0]>>eb,i=a[e],f=1;l-4>f;)g+=tb[f]+h*c[f]+i*b[f],tb[f-1]=g&fb,g>>=eb,f++,g+=tb[f]+h*c[f]+i*b[f],tb[f-1]=g&fb,g>>=eb,f++,g+=tb[f]+h*c[f]+i*b[f],tb[f-1]=g&fb,g>>=eb,f++,g+=tb[f]+h*c[f]+i*b[f],tb[f-1]=g&fb,g>>=eb,f++,g+=tb[f]+h*c[f]+i*b[f],tb[f-1]=g&fb,g>>=eb,f++;for(;l>f;)g+=tb[f]+h*c[f]+i*b[f],tb[f-1]=g&fb,g>>=eb,f++;for(;k-4>f;)g+=tb[f]+h*c[f],tb[f-1]=g&fb,g>>=eb,f++,g+=tb[f]+h*c[f],tb[f-1]=g&fb,g>>=eb,f++,g+=tb[f]+h*c[f],tb[f-1]=g&fb,g>>=eb,f++,g+=tb[f]+h*c[f],tb[f-1]=g&fb,g>>=eb,f++,g+=tb[f]+h*c[f],tb[f-1]=g&fb,g>>=eb,f++;for(;k>f;)g+=tb[f]+h*c[f],tb[f-1]=g&fb,g>>=eb,f++;for(;j>f;)g+=tb[f],tb[f-1]=g&fb,g>>=eb,f++;tb[f-1]=g&fb}y(c,tb)||V(tb,c),J(a,tb)}function cb(a){function c(){for(var a=e.getBytes(g),b=0,c=0;g>b;b++)c=c*f+a[b];return c}function d(){return e.getBytes(1)[0]}var e=new b([a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15],a[16],a[17],a[18],a[19],a[20],a[21],a[22],a[23],a[24],a[25],a[26],a[27],a[28],a[29],a[30],a[31]],[a[32],a[33],a[34],a[35],a[36],a[37],a[38],a[39]]),f=256,g=6,h=Math.pow(2,52),i=2*h;return ib=function(a){if(a>31)throw new Error("Too many bits.");var b=0,c=0,e=Math.floor(a/8),f=(1<<a%8)-1;for(f&&(c=d()&f);e>b;b++)c=256*c+d();return c},function(){for(var a=c(),b=Math.pow(f,g),e=0;h>a;)a=(a+e)*f,b*=f,e=d();for(;a>=i;)a/=2,b/=2,e>>>=1;return(a+e)/b}}function db(){var b;if("undefined"!=typeof a&&"function"==typeof a.randomBytes)try{b=a.randomBytes(40)}catch(c){throw c}else{if("undefined"==typeof a||"function"!=typeof a.getRandomValues)throw new Error("Keys should not be generated without CSPRNG.");b=new Uint8Array(40),a.getRandomValues(b)}return Array.prototype.slice.call(b,0)}var eb=0,fb=0,gb=fb+1,hb="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_=!@#$%^&*()[]{}|;:,.<>/?`~ \\'\"+-";for(eb=0;1<<eb+1>1<<eb;eb++);eb>>=1,fb=(1<<eb)-1,gb=fb+1;var ib,jb=C(1,1,1),kb=new Array(0),lb=kb,mb=kb,nb=kb,ob=kb,pb=kb,qb=kb,rb=kb,sb=kb,tb=kb,ub=kb,vb=kb,wb=kb,xb=kb,yb=kb,zb=kb,Ab=kb,Bb=kb,Cb=kb,Db=kb,Eb=kb,Fb=kb,Gb=kb,Hb=kb,Ib=kb,Jb=kb,Kb=kb,Lb=kb,Mb=kb,Nb=kb,Ob=kb,Pb=kb,Qb=kb,Rb=kb,Sb=kb,Tb={str2bigInt:D,bigInt2str:H,int2bigInt:C,multMod:p,powMod:l,inverseMod:o,randBigInt:r,randBigInt_:s,equals:F,equalsInt:E,sub:m,mod:i,mod_:Y,modInt:B,mult:k,divInt_:Q,rightShift_:M,leftShift_:O,dup:I,greater:y,add:n,addInt:j,addInt_:L,isZero:G,bitSize:f,randTruePrime:h,millerRabin:e,divide_:z,trim:_,expand:g,bpe:eb,primes:Db,findPrimes:c,getSeed:db};return function Ub(){Math.random=cb(db()),"function"==typeof setTimeout&&"undefined"!=typeof document&&setTimeout(Ub,3e5)}(),Tb});var CryptoJS=CryptoJS||function(a,b){var c={},d=c.lib={},e=d.Base=function(){function a(){}return{extend:function(b){a.prototype=this;var c=new a;return b&&c.mixIn(b),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),f=d.WordArray=e.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes,e=a.sigBytes;if(this.clamp(),d%4)for(var f=0;e>f;f++){var g=c[f>>>2]>>>24-f%4*8&255;b[d+f>>>2]|=g<<24-(d+f)%4*8}else if(c.length>65535)for(var f=0;e>f;f+=4)b[d+f>>>2]=c[f>>>2];else b.push.apply(b,c);return this.sigBytes+=e,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8,b.length=a.ceil(c/4)},clone:function(){var a=e.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;b>d;d+=4)c.push(4294967296*a.random()|0);return new f.init(c,b)}}),g=c.enc={},h=g.Hex={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;c>e;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push((f>>>4).toString(16)),d.push((15&f).toString(16))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new f.init(c,b/2)}},i=g.Latin1={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;c>e;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push(String.fromCharCode(f))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-d%4*8;return new f.init(c,b)}},j=g.Utf8={stringify:function(a){try{return decodeURIComponent(escape(i.stringify(a)))}catch(b){throw new Error("Malformed UTF-8 data")}},parse:function(a){return i.parse(unescape(encodeURIComponent(a)))}},k=d.BufferedBlockAlgorithm=e.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=j.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,g=this.blockSize,h=4*g,i=e/h;i=b?a.ceil(i):a.max((0|i)-this._minBufferSize,0);var j=i*g,k=a.min(4*j,e);if(j){for(var l=0;j>l;l+=g)this._doProcessBlock(d,l);var m=d.splice(0,j);c.sigBytes-=k}return new f.init(m,k)},clone:function(){var a=e.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0}),l=(d.Hasher=k.extend({cfg:e.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){k.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){a&&this._append(a);var b=this._doFinalize();return b},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new l.HMAC.init(a,c).finalize(b)}}}),c.algo={});return c}(Math);!function(){{var a=CryptoJS,b=a.lib,c=b.WordArray,d=a.enc;d.Base64={stringify:function(a){var b=a.words,c=a.sigBytes,d=this._map;a.clamp();for(var e=[],f=0;c>f;f+=3)for(var g=b[f>>>2]>>>24-f%4*8&255,h=b[f+1>>>2]>>>24-(f+1)%4*8&255,i=b[f+2>>>2]>>>24-(f+2)%4*8&255,j=g<<16|h<<8|i,k=0;4>k&&c>f+.75*k;k++)e.push(d.charAt(j>>>6*(3-k)&63));var l=d.charAt(64);if(l)for(;e.length%4;)e.push(l);return e.join("")},parse:function(a){var b=a.length,d=this._map,e=d.charAt(64);if(e){var f=a.indexOf(e);-1!=f&&(b=f)}for(var g=[],h=0,i=0;b>i;i++)if(i%4){var j=d.indexOf(a.charAt(i-1))<<i%4*2,k=d.indexOf(a.charAt(i))>>>6-i%4*2;g[h>>>2]|=(j|k)<<24-h%4*8,h++}return c.create(g,h)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}}(),function(a){function b(a,b,c,d,e,f,g){var h=a+(b&c|~b&d)+e+g;return(h<<f|h>>>32-f)+b}function c(a,b,c,d,e,f,g){var h=a+(b&d|c&~d)+e+g;return(h<<f|h>>>32-f)+b}function d(a,b,c,d,e,f,g){var h=a+(b^c^d)+e+g;return(h<<f|h>>>32-f)+b}function e(a,b,c,d,e,f,g){var h=a+(c^(b|~d))+e+g;return(h<<f|h>>>32-f)+b}var f=CryptoJS,g=f.lib,h=g.WordArray,i=g.Hasher,j=f.algo,k=[];!function(){for(var b=0;64>b;b++)k[b]=4294967296*a.abs(a.sin(b+1))|0}();var l=j.MD5=i.extend({_doReset:function(){this._hash=new h.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(a,f){for(var g=0;16>g;g++){var h=f+g,i=a[h];a[h]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var j=this._hash.words,l=a[f+0],m=a[f+1],n=a[f+2],o=a[f+3],p=a[f+4],q=a[f+5],r=a[f+6],s=a[f+7],t=a[f+8],u=a[f+9],v=a[f+10],w=a[f+11],x=a[f+12],y=a[f+13],z=a[f+14],A=a[f+15],B=j[0],C=j[1],D=j[2],E=j[3];B=b(B,C,D,E,l,7,k[0]),E=b(E,B,C,D,m,12,k[1]),D=b(D,E,B,C,n,17,k[2]),C=b(C,D,E,B,o,22,k[3]),B=b(B,C,D,E,p,7,k[4]),E=b(E,B,C,D,q,12,k[5]),D=b(D,E,B,C,r,17,k[6]),C=b(C,D,E,B,s,22,k[7]),B=b(B,C,D,E,t,7,k[8]),E=b(E,B,C,D,u,12,k[9]),D=b(D,E,B,C,v,17,k[10]),C=b(C,D,E,B,w,22,k[11]),B=b(B,C,D,E,x,7,k[12]),E=b(E,B,C,D,y,12,k[13]),D=b(D,E,B,C,z,17,k[14]),C=b(C,D,E,B,A,22,k[15]),B=c(B,C,D,E,m,5,k[16]),E=c(E,B,C,D,r,9,k[17]),D=c(D,E,B,C,w,14,k[18]),C=c(C,D,E,B,l,20,k[19]),B=c(B,C,D,E,q,5,k[20]),E=c(E,B,C,D,v,9,k[21]),D=c(D,E,B,C,A,14,k[22]),C=c(C,D,E,B,p,20,k[23]),B=c(B,C,D,E,u,5,k[24]),E=c(E,B,C,D,z,9,k[25]),D=c(D,E,B,C,o,14,k[26]),C=c(C,D,E,B,t,20,k[27]),B=c(B,C,D,E,y,5,k[28]),E=c(E,B,C,D,n,9,k[29]),D=c(D,E,B,C,s,14,k[30]),C=c(C,D,E,B,x,20,k[31]),B=d(B,C,D,E,q,4,k[32]),E=d(E,B,C,D,t,11,k[33]),D=d(D,E,B,C,w,16,k[34]),C=d(C,D,E,B,z,23,k[35]),B=d(B,C,D,E,m,4,k[36]),E=d(E,B,C,D,p,11,k[37]),D=d(D,E,B,C,s,16,k[38]),C=d(C,D,E,B,v,23,k[39]),B=d(B,C,D,E,y,4,k[40]),E=d(E,B,C,D,l,11,k[41]),D=d(D,E,B,C,o,16,k[42]),C=d(C,D,E,B,r,23,k[43]),B=d(B,C,D,E,u,4,k[44]),E=d(E,B,C,D,x,11,k[45]),D=d(D,E,B,C,A,16,k[46]),C=d(C,D,E,B,n,23,k[47]),B=e(B,C,D,E,l,6,k[48]),E=e(E,B,C,D,s,10,k[49]),D=e(D,E,B,C,z,15,k[50]),C=e(C,D,E,B,q,21,k[51]),B=e(B,C,D,E,x,6,k[52]),E=e(E,B,C,D,o,10,k[53]),D=e(D,E,B,C,v,15,k[54]),C=e(C,D,E,B,m,21,k[55]),B=e(B,C,D,E,t,6,k[56]),E=e(E,B,C,D,A,10,k[57]),D=e(D,E,B,C,r,15,k[58]),C=e(C,D,E,B,y,21,k[59]),B=e(B,C,D,E,p,6,k[60]),E=e(E,B,C,D,w,10,k[61]),D=e(D,E,B,C,n,15,k[62]),C=e(C,D,E,B,u,21,k[63]),j[0]=j[0]+B|0,j[1]=j[1]+C|0,j[2]=j[2]+D|0,j[3]=j[3]+E|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;c[e>>>5]|=128<<24-e%32;var f=a.floor(d/4294967296),g=d;c[(e+64>>>9<<4)+15]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),c[(e+64>>>9<<4)+14]=16711935&(g<<8|g>>>24)|4278255360&(g<<24|g>>>8),b.sigBytes=4*(c.length+1),this._process();for(var h=this._hash,i=h.words,j=0;4>j;j++){var k=i[j];i[j]=16711935&(k<<8|k>>>24)|4278255360&(k<<24|k>>>8)}return h},clone:function(){var a=i.clone.call(this);return a._hash=this._hash.clone(),a}});f.MD5=i._createHelper(l),f.HmacMD5=i._createHmacHelper(l)}(Math),function(){var a=CryptoJS,b=a.lib,c=b.Base,d=b.WordArray,e=a.algo,f=e.MD5,g=e.EvpKDF=c.extend({cfg:c.extend({keySize:4,hasher:f,iterations:1}),init:function(a){this.cfg=this.cfg.extend(a)},compute:function(a,b){for(var c=this.cfg,e=c.hasher.create(),f=d.create(),g=f.words,h=c.keySize,i=c.iterations;g.length<h;){j&&e.update(j);var j=e.update(a).finalize(b);e.reset();for(var k=1;i>k;k++)j=e.finalize(j),e.reset();f.concat(j)}return f.sigBytes=4*h,f}});a.EvpKDF=function(a,b,c){return g.create(c).compute(a,b)}}(),CryptoJS.lib.Cipher||function(a){var b=CryptoJS,c=b.lib,d=c.Base,e=c.WordArray,f=c.BufferedBlockAlgorithm,g=b.enc,h=(g.Utf8,g.Base64),i=b.algo,j=i.EvpKDF,k=c.Cipher=f.extend({cfg:d.extend(),createEncryptor:function(a,b){return this.create(this._ENC_XFORM_MODE,a,b)},createDecryptor:function(a,b){return this.create(this._DEC_XFORM_MODE,a,b)},init:function(a,b,c){this.cfg=this.cfg.extend(c),this._xformMode=a,this._key=b,this.reset()},reset:function(){f.reset.call(this),this._doReset()},process:function(a){return this._append(a),this._process()},finalize:function(a){a&&this._append(a);var b=this._doFinalize();return b},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function a(a){return"string"==typeof a?w:t}return function(b){return{encrypt:function(c,d,e){return a(d).encrypt(b,c,d,e)},decrypt:function(c,d,e){return a(d).decrypt(b,c,d,e)}}}}()}),l=(c.StreamCipher=k.extend({_doFinalize:function(){var a=this._process(!0);return a},blockSize:1}),b.mode={}),m=c.BlockCipherMode=d.extend({createEncryptor:function(a,b){return this.Encryptor.create(a,b)},createDecryptor:function(a,b){return this.Decryptor.create(a,b)},init:function(a,b){this._cipher=a,this._iv=b}}),n=l.CBC=function(){function b(b,c,d){var e=this._iv;if(e){var f=e;this._iv=a}else var f=this._prevBlock;for(var g=0;d>g;g++)b[c+g]^=f[g]}var c=m.extend();return c.Encryptor=c.extend({processBlock:function(a,c){var d=this._cipher,e=d.blockSize;b.call(this,a,c,e),d.encryptBlock(a,c),this._prevBlock=a.slice(c,c+e)}}),c.Decryptor=c.extend({processBlock:function(a,c){var d=this._cipher,e=d.blockSize,f=a.slice(c,c+e);d.decryptBlock(a,c),b.call(this,a,c,e),this._prevBlock=f}}),c}(),o=b.pad={},p=o.Pkcs7={pad:function(a,b){for(var c=4*b,d=c-a.sigBytes%c,f=d<<24|d<<16|d<<8|d,g=[],h=0;d>h;h+=4)g.push(f);var i=e.create(g,d);a.concat(i)},unpad:function(a){var b=255&a.words[a.sigBytes-1>>>2];a.sigBytes-=b}},q=(c.BlockCipher=k.extend({cfg:k.cfg.extend({mode:n,padding:p}),reset:function(){k.reset.call(this);var a=this.cfg,b=a.iv,c=a.mode;if(this._xformMode==this._ENC_XFORM_MODE)var d=c.createEncryptor;else{var d=c.createDecryptor;this._minBufferSize=1}this._mode=d.call(c,this,b&&b.words)},_doProcessBlock:function(a,b){this._mode.processBlock(a,b)},_doFinalize:function(){var a=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var b=this._process(!0)}else{var b=this._process(!0);a.unpad(b)}return b},blockSize:4}),c.CipherParams=d.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}})),r=b.format={},s=r.OpenSSL={stringify:function(a){var b=a.ciphertext,c=a.salt;if(c)var d=e.create([1398893684,1701076831]).concat(c).concat(b);else var d=b;return d.toString(h)},parse:function(a){var b=h.parse(a),c=b.words;if(1398893684==c[0]&&1701076831==c[1]){var d=e.create(c.slice(2,4));c.splice(0,4),b.sigBytes-=16}return q.create({ciphertext:b,salt:d})}},t=c.SerializableCipher=d.extend({cfg:d.extend({format:s}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var e=a.createEncryptor(c,d),f=e.finalize(b),g=e.cfg;return q.create({ciphertext:f,key:c,iv:g.iv,algorithm:a,mode:g.mode,padding:g.padding,blockSize:a.blockSize,formatter:d.format})},decrypt:function(a,b,c,d){d=this.cfg.extend(d),b=this._parse(b,d.format);var e=a.createDecryptor(c,d).finalize(b.ciphertext);return e},_parse:function(a,b){return"string"==typeof a?b.parse(a,this):a}}),u=b.kdf={},v=u.OpenSSL={execute:function(a,b,c,d){d||(d=e.random(8));var f=j.create({keySize:b+c}).compute(a,d),g=e.create(f.words.slice(b),4*c);return f.sigBytes=4*b,q.create({key:f,iv:g,salt:d})}},w=c.PasswordBasedCipher=t.extend({cfg:t.cfg.extend({kdf:v}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var e=d.kdf.execute(c,a.keySize,a.ivSize);d.iv=e.iv;var f=t.encrypt.call(this,a,b,e.key,d);return f.mixIn(e),f},decrypt:function(a,b,c,d){d=this.cfg.extend(d),b=this._parse(b,d.format);var e=d.kdf.execute(c,a.keySize,a.ivSize,b.salt);d.iv=e.iv;var f=t.decrypt.call(this,a,b,e.key,d);return f}})}(),function(){var a=CryptoJS,b=a.lib,c=b.BlockCipher,d=a.algo,e=[],f=[],g=[],h=[],i=[],j=[],k=[],l=[],m=[],n=[];!function(){for(var a=[],b=0;256>b;b++)a[b]=128>b?b<<1:b<<1^283;for(var c=0,d=0,b=0;256>b;b++){var o=d^d<<1^d<<2^d<<3^d<<4;o=o>>>8^255&o^99,e[c]=o,f[o]=c;var p=a[c],q=a[p],r=a[q],s=257*a[o]^16843008*o;g[c]=s<<24|s>>>8,h[c]=s<<16|s>>>16,i[c]=s<<8|s>>>24,j[c]=s;var s=16843009*r^65537*q^257*p^16843008*c;k[o]=s<<24|s>>>8,l[o]=s<<16|s>>>16,m[o]=s<<8|s>>>24,n[o]=s,c?(c=p^a[a[a[r^p]]],d^=a[a[d]]):c=d=1}}();var o=[0,1,2,4,8,16,32,64,128,27,54],p=d.AES=c.extend({_doReset:function(){for(var a=this._key,b=a.words,c=a.sigBytes/4,d=this._nRounds=c+6,f=4*(d+1),g=this._keySchedule=[],h=0;f>h;h++)if(c>h)g[h]=b[h];else{var i=g[h-1];h%c?c>6&&h%c==4&&(i=e[i>>>24]<<24|e[i>>>16&255]<<16|e[i>>>8&255]<<8|e[255&i]):(i=i<<8|i>>>24,i=e[i>>>24]<<24|e[i>>>16&255]<<16|e[i>>>8&255]<<8|e[255&i],i^=o[h/c|0]<<24),g[h]=g[h-c]^i}for(var j=this._invKeySchedule=[],p=0;f>p;p++){var h=f-p;if(p%4)var i=g[h];else var i=g[h-4];j[p]=4>p||4>=h?i:k[e[i>>>24]]^l[e[i>>>16&255]]^m[e[i>>>8&255]]^n[e[255&i]]
}},encryptBlock:function(a,b){this._doCryptBlock(a,b,this._keySchedule,g,h,i,j,e)},decryptBlock:function(a,b){var c=a[b+1];a[b+1]=a[b+3],a[b+3]=c,this._doCryptBlock(a,b,this._invKeySchedule,k,l,m,n,f);var c=a[b+1];a[b+1]=a[b+3],a[b+3]=c},_doCryptBlock:function(a,b,c,d,e,f,g,h){for(var i=this._nRounds,j=a[b]^c[0],k=a[b+1]^c[1],l=a[b+2]^c[2],m=a[b+3]^c[3],n=4,o=1;i>o;o++){var p=d[j>>>24]^e[k>>>16&255]^f[l>>>8&255]^g[255&m]^c[n++],q=d[k>>>24]^e[l>>>16&255]^f[m>>>8&255]^g[255&j]^c[n++],r=d[l>>>24]^e[m>>>16&255]^f[j>>>8&255]^g[255&k]^c[n++],s=d[m>>>24]^e[j>>>16&255]^f[k>>>8&255]^g[255&l]^c[n++];j=p,k=q,l=r,m=s}var p=(h[j>>>24]<<24|h[k>>>16&255]<<16|h[l>>>8&255]<<8|h[255&m])^c[n++],q=(h[k>>>24]<<24|h[l>>>16&255]<<16|h[m>>>8&255]<<8|h[255&j])^c[n++],r=(h[l>>>24]<<24|h[m>>>16&255]<<16|h[j>>>8&255]<<8|h[255&k])^c[n++],s=(h[m>>>24]<<24|h[j>>>16&255]<<16|h[k>>>8&255]<<8|h[255&l])^c[n++];a[b]=p,a[b+1]=q,a[b+2]=r,a[b+3]=s},keySize:8});a.AES=c._createHelper(p)}(),function(){var a=CryptoJS,b=a.lib,c=b.WordArray,d=b.Hasher,e=a.algo,f=[],g=e.SHA1=d.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],g=c[2],h=c[3],i=c[4],j=0;80>j;j++){if(16>j)f[j]=0|a[b+j];else{var k=f[j-3]^f[j-8]^f[j-14]^f[j-16];f[j]=k<<1|k>>>31}var l=(d<<5|d>>>27)+i+f[j];l+=20>j?(e&g|~e&h)+1518500249:40>j?(e^g^h)+1859775393:60>j?(e&g|e&h|g&h)-1894007588:(e^g^h)-899497514,i=h,h=g,g=e<<30|e>>>2,e=d,d=l}c[0]=c[0]+d|0,c[1]=c[1]+e|0,c[2]=c[2]+g|0,c[3]=c[3]+h|0,c[4]=c[4]+i|0},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,d=8*a.sigBytes;return b[d>>>5]|=128<<24-d%32,b[(d+64>>>9<<4)+14]=Math.floor(c/4294967296),b[(d+64>>>9<<4)+15]=c,a.sigBytes=4*b.length,this._process(),this._hash},clone:function(){var a=d.clone.call(this);return a._hash=this._hash.clone(),a}});a.SHA1=d._createHelper(g),a.HmacSHA1=d._createHmacHelper(g)}(),function(a){var b=CryptoJS,c=b.lib,d=c.WordArray,e=c.Hasher,f=b.algo,g=[],h=[];!function(){function b(b){for(var c=a.sqrt(b),d=2;c>=d;d++)if(!(b%d))return!1;return!0}function c(a){return 4294967296*(a-(0|a))|0}for(var d=2,e=0;64>e;)b(d)&&(8>e&&(g[e]=c(a.pow(d,.5))),h[e]=c(a.pow(d,1/3)),e++),d++}();var i=[],j=f.SHA256=e.extend({_doReset:function(){this._hash=new d.init(g.slice(0))},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],g=c[3],j=c[4],k=c[5],l=c[6],m=c[7],n=0;64>n;n++){if(16>n)i[n]=0|a[b+n];else{var o=i[n-15],p=(o<<25|o>>>7)^(o<<14|o>>>18)^o>>>3,q=i[n-2],r=(q<<15|q>>>17)^(q<<13|q>>>19)^q>>>10;i[n]=p+i[n-7]+r+i[n-16]}var s=j&k^~j&l,t=d&e^d&f^e&f,u=(d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22),v=(j<<26|j>>>6)^(j<<21|j>>>11)^(j<<7|j>>>25),w=m+v+s+h[n]+i[n],x=u+t;m=l,l=k,k=j,j=g+w|0,g=f,f=e,e=d,d=w+x|0}c[0]=c[0]+d|0,c[1]=c[1]+e|0,c[2]=c[2]+f|0,c[3]=c[3]+g|0,c[4]=c[4]+j|0,c[5]=c[5]+k|0,c[6]=c[6]+l|0,c[7]=c[7]+m|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;return c[e>>>5]|=128<<24-e%32,c[(e+64>>>9<<4)+14]=a.floor(d/4294967296),c[(e+64>>>9<<4)+15]=d,b.sigBytes=4*c.length,this._process(),this._hash},clone:function(){var a=e.clone.call(this);return a._hash=this._hash.clone(),a}});b.SHA256=e._createHelper(j),b.HmacSHA256=e._createHmacHelper(j)}(Math),function(){{var a=CryptoJS,b=a.lib,c=b.Base,d=a.enc,e=d.Utf8,f=a.algo;f.HMAC=c.extend({init:function(a,b){a=this._hasher=new a.init,"string"==typeof b&&(b=e.parse(b));var c=a.blockSize,d=4*c;b.sigBytes>d&&(b=a.finalize(b)),b.clamp();for(var f=this._oKey=b.clone(),g=this._iKey=b.clone(),h=f.words,i=g.words,j=0;c>j;j++)h[j]^=1549556828,i[j]^=909522486;f.sigBytes=g.sigBytes=d,this.reset()},reset:function(){var a=this._hasher;a.reset(),a.update(this._iKey)},update:function(a){return this._hasher.update(a),this},finalize:function(a){var b=this._hasher,c=b.finalize(a);b.reset();var d=b.finalize(this._oKey.clone().concat(c));return d}})}}(),CryptoJS.pad.NoPadding={pad:function(){},unpad:function(){}},CryptoJS.mode.CTR=function(){var a=CryptoJS.lib.BlockCipherMode.extend(),b=a.Encryptor=a.extend({processBlock:function(a,b){var c=this._cipher,d=c.blockSize,e=this._iv,f=this._counter;e&&(f=this._counter=e.slice(0),this._iv=void 0);var g=f.slice(0);c.encryptBlock(g,0),f[d-1]=f[d-1]+1|0;for(var h=0;d>h;h++)a[b+h]^=g[h]}});return a.Decryptor=b,a}(),function(){"use strict";function a(){}function b(a,b){for(var c=a.length;c--;)if(a[c].listener===b)return c;return-1}function c(a){return function(){return this[a].apply(this,arguments)}}var d=a.prototype;d.getListeners=function(a){var b,c,d=this._getEvents();if("object"==typeof a){b={};for(c in d)d.hasOwnProperty(c)&&a.test(c)&&(b[c]=d[c])}else b=d[a]||(d[a]=[]);return b},d.flattenListeners=function(a){var b,c=[];for(b=0;b<a.length;b+=1)c.push(a[b].listener);return c},d.getListenersAsObject=function(a){var b,c=this.getListeners(a);return c instanceof Array&&(b={},b[a]=c),b||c},d.addListener=function(a,c){var d,e=this.getListenersAsObject(a),f="object"==typeof c;for(d in e)e.hasOwnProperty(d)&&-1===b(e[d],c)&&e[d].push(f?c:{listener:c,once:!1});return this},d.on=c("addListener"),d.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},d.once=c("addOnceListener"),d.defineEvent=function(a){return this.getListeners(a),this},d.defineEvents=function(a){for(var b=0;b<a.length;b+=1)this.defineEvent(a[b]);return this},d.removeListener=function(a,c){var d,e,f=this.getListenersAsObject(a);for(e in f)f.hasOwnProperty(e)&&(d=b(f[e],c),-1!==d&&f[e].splice(d,1));return this},d.off=c("removeListener"),d.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},d.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},d.manipulateListeners=function(a,b,c){var d,e,f=a?this.removeListener:this.addListener,g=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(e=b[d])&&("function"==typeof e?f.call(this,d,e):g.call(this,d,e));return this},d.removeEvent=function(a){var b,c=typeof a,d=this._getEvents();if("string"===c)delete d[a];else if("object"===c)for(b in d)d.hasOwnProperty(b)&&a.test(b)&&delete d[b];else delete this._events;return this},d.emitEvent=function(a,b){var c,d,e,f,g=this.getListenersAsObject(a);for(e in g)if(g.hasOwnProperty(e))for(d=g[e].length;d--;)c=g[e][d],c.once===!0&&this.removeListener(a,c.listener),f=c.listener.apply(this,b||[]),f===this._getOnceReturnValue()&&this.removeListener(a,c.listener);return this},d.trigger=c("emitEvent"),d.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},d.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},d._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},d._getEvents=function(){return this._events||(this._events={})},"function"==typeof define&&define.amd?define(function(){return a}):"object"==typeof module&&module.exports?module.exports=a:this.EventEmitter=a}.call(this),function(a,b){"function"==typeof define&&define.amd?define(["bigint","crypto","eventemitter"],function(a,c,d){var e={BigInt:a,CryptoJS:c,EventEmitter:d,OTR:{},DSA:{}};return b.call(e)}):(a.OTR={},a.DSA={},b.call(a))}(this,function(){return function(){"use strict";var a=this,b={N:"FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA237327FFFFFFFFFFFFFFFF",G:"2",MSGSTATE_PLAINTEXT:0,MSGSTATE_ENCRYPTED:1,MSGSTATE_FINISHED:2,AUTHSTATE_NONE:0,AUTHSTATE_AWAITING_DHKEY:1,AUTHSTATE_AWAITING_REVEALSIG:2,AUTHSTATE_AWAITING_SIG:3,WHITESPACE_TAG:" 	  				 	 	 	  ",WHITESPACE_TAG_V2:"  		  	 ",WHITESPACE_TAG_V3:"  		  		",OTR_TAG:"?OTR",OTR_VERSION_1:"\x00",OTR_VERSION_2:"\x00",OTR_VERSION_3:"\x00",SMPSTATE_EXPECT0:0,SMPSTATE_EXPECT1:1,SMPSTATE_EXPECT2:2,SMPSTATE_EXPECT3:3,SMPSTATE_EXPECT4:4,STATUS_SEND_QUERY:0,STATUS_AKE_INIT:1,STATUS_AKE_SUCCESS:2,STATUS_END_OTR:3};"undefined"!=typeof module&&module.exports?module.exports=b:a.OTR.CONST=b}.call(this),function(){"use strict";var a,b,c=this,d={};"undefined"!=typeof module&&module.exports?(module.exports=d={},a=require("../vendor/crypto.js"),b=require("../vendor/bigint.js")):(c.OTR&&(c.OTR.HLP=d),c.DSA&&(c.DSA.HLP=d),a=c.CryptoJS,b=c.BigInt);var e={BYTE:1,SHORT:2,INT:4,CTR:8,MAC:20,SIG:40},f="?OTR",g=".";d.debug=function(a){this.debug&&"function"!=typeof this.debug&&"undefined"!=typeof console&&console.log(a)},d.extend=function(a,b){function c(){this.constructor=a}for(var d in b)Object.hasOwnProperty.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype},d.compare=function(a,b){if(a.length!==b.length)return!1;for(var c=0,d=0;c<a.length;c++)d|=a[c].charCodeAt(0)^b[c].charCodeAt(0);return 0===d},d.divMod=function(a,c,d){return b.multMod(a,b.inverseMod(c,d),d)},d.subMod=function(a,c,d){return a=b.mod(a,d),c=b.mod(c,d),b.greater(c,a)&&(a=b.add(a,d)),b.sub(a,c)},d.randomExponent=function(){return b.randBigInt(1536)},d.smpHash=function(b,c,f){var g=a.algo.SHA256.create();g.update(a.enc.Latin1.parse(d.packBytes(b,e.BYTE))),g.update(a.enc.Latin1.parse(d.packMPI(c))),f&&g.update(a.enc.Latin1.parse(d.packMPI(f)));var h=g.finalize();return d.bits2bigInt(h.toString(a.enc.Latin1))},d.makeMac=function(b,c){var e=a.enc.Latin1.parse(c),f=a.HmacSHA256(a.enc.Latin1.parse(b),e);return d.mask(f.toString(a.enc.Latin1),0,160)},d.make1Mac=function(b,c){var d=a.enc.Latin1.parse(c),e=a.HmacSHA1(a.enc.Latin1.parse(b),d);return e.toString(a.enc.Latin1)},d.encryptAes=function(b,c,d){var e={mode:a.mode.CTR,iv:a.enc.Latin1.parse(d),padding:a.pad.NoPadding},f=a.AES.encrypt(b,a.enc.Latin1.parse(c),e),g=a.enc.Base64.parse(f.toString());return a.enc.Latin1.stringify(g)},d.decryptAes=function(b,c,d){b=a.enc.Latin1.parse(b);var e={mode:a.mode.CTR,iv:a.enc.Latin1.parse(d),padding:a.pad.NoPadding};return a.AES.decrypt(a.enc.Base64.stringify(b),a.enc.Latin1.parse(c),e)},d.multPowMod=function(a,c,d,e,f){return b.multMod(b.powMod(a,c,f),b.powMod(d,e,f),f)},d.ZKP=function(a,c,e,f){return b.equals(c,d.smpHash(a,e,f))},d.GTOE=function(a,c){return b.equals(a,c)||b.greater(a,c)},d.between=function(a,c,d){return b.greater(a,c)&&b.greater(d,a)},d.checkGroup=function(a,c){var e=b.str2bigInt("2",10),f=b.sub(c,e);return d.GTOE(a,e)&&d.GTOE(f,a)};var h={XOR:function(a,b){return a^b},OR:function(a,b){return a|b},AND:function(a,b){return a&b}};d.bigBitWise=function(a,c,d){for(var e=c.length>d.length,f=e?d:c,g=e?c:d,i=g.length,j=b.expand(f,i),k=0;i>k;k++)j[k]=h[a](j[k],g[k]);return j},d.h1=function(b,c){var d=a.algo.SHA1.create();return d.update(a.enc.Latin1.parse(b)),d.update(a.enc.Latin1.parse(c)),d.finalize().toString(a.enc.Latin1)},d.h2=function(b,c){var d=a.algo.SHA256.create();return d.update(a.enc.Latin1.parse(b)),d.update(a.enc.Latin1.parse(c)),d.finalize().toString(a.enc.Latin1)},d.mask=function(a,b,c){return a.substr(b/8,c/8)},d.twotothe=function(a){for(var c=[1<<a%b.bpe,0],d=0,e=Math.floor(a/b.bpe);e>d;d++)c.unshift(0);return c},d.packBytes=function(a,b){a=a.toString(16);for(var c,d="";b>0;b--)c=a.length?a.substr(-2,2):"0",a=a.substr(0,a.length-2),d=l(parseInt(c,16))+d;return d},d.packINT=function(a){return d.packBytes(a,e.INT)},d.packCtr=function(a){return d.padCtr(d.packBytes(a,e.CTR))},d.padCtr=function(a){return a+"\x00\x00\x00\x00\x00\x00\x00\x00"},d.unpackCtr=function(a){return a=d.toByteArray(a.substring(0,8)),d.unpack(a)},d.unpack=function(a){a.reverse();for(var b=0,c=0,d=a.length;d>c;c++)b+=Math.pow(256,c)*a[c];return b},d.packData=function(a){return d.packINT(a.length)+a},d.bigInt2bits=function(a,c){c||(c=0),a=b.dup(a);for(var d="";!b.isZero(a);)d=k[255&a[0]]+d,b.rightShift_(a,8);for(;d.length<c;)d="\x00"+d;return d},d.bits2bigInt=function(a){return a=d.toByteArray(a),d.retMPI(a)},d.packMPI=function(a){return d.packData(d.bigInt2bits(b.trim(a,0)))},d.packSHORT=function(a){return d.packBytes(a,e.SHORT)},d.unpackSHORT=function(a){return a=d.toByteArray(a),d.unpack(a)},d.packTLV=function(a,b){return d.packSHORT(a)+d.packSHORT(b.length)+b},d.readLen=function(a){return a=d.toByteArray(a.substring(0,4)),d.unpack(a)},d.readData=function(a){var b=d.unpack(a.splice(0,4));return[b,a]},d.retMPI=function(a){var c=b.str2bigInt("0",10,a.length);return a.forEach(function(a,d){d&&b.leftShift_(c,8),c[0]|=a}),c},d.readMPI=function(a){return a=d.toByteArray(a),a=d.readData(a),d.retMPI(a[1])},d.packMPIs=function(a){return a.reduce(function(a,b){return a+d.packMPI(b)},"")},d.unpackMPIs=function(a,b){for(var c=0,e=[];a>c;c++)e.push("MPI");return d.splitype(e,b).map(function(a){return d.readMPI(a)})},d.wrapMsg=function(b,c,e,h,i){b=a.enc.Base64.stringify(a.enc.Latin1.parse(b)),b=f+":"+b+g;var j;if(e&&(j="|",j+=d.readLen(h).toString(16),j+="|",j+=d.readLen(i).toString(16)),!c)return[null,b];var k=Math.ceil(b.length/c);if(k>65535)return["Too many fragments"];if(1==k)return[null,b];var l,m,n,o,p,q=[];for(l=1;k>=l;l++)m=(l-1)*c,n=l*c,o=b.slice(m,n),p=f,e&&(p+=j),p+=","+l+",",p+=k+",",p+=o+",",q.push(p);return[null,q]},d.splitype=function n(a,b){var c=[];return a.forEach(function(a){var f;switch(a){case"PUBKEY":f=n(["SHORT","MPI","MPI","MPI","MPI"],b).join("");break;case"DATA":case"MPI":f=b.substring(0,d.readLen(b)+4);break;default:f=b.substring(0,e[a])}c.push(f),b=b.substring(f.length)}),c};for(var i,j={},k={},l=String.fromCharCode,m=0;256>m;++m)i=l(m),j[i]=m,k[m]=i;for(m=128;256>m;++m)j[l(63232+m)]=m;d.toByteArray=function(a){var b,c,d=[],e=j,f=a.split(""),g=-1;for(c=f.length,b=c%8;b--;)++g,d[g]=e[f[g]];for(b=c>>3;b--;)d.push(e[f[++g]],e[f[++g]],e[f[++g]],e[f[++g]],e[f[++g]],e[f[++g]],e[f[++g]],e[f[++g]]);return d}}.call(this),function(){"use strict";function a(){var a=(new Date).getTime();return function(b){if(p&&"undefined"!=typeof console){var c=(new Date).getTime();console.log(b+": "+(c-a)),a=c}}}function b(a,c){var d=i.randBigInt(i.bitSize(c));return j.between(d,a,c)?d:b(a,c)}function c(a,b){var c,d=3e4,e=i.bitSize(a),f=i.primes;for(0===f.length&&(f=i.findPrimes(d)),q.length!=a.length&&(q=i.dup(a)),c=0;c<f.length&&f[c]<=d;c++)if(0===i.modInt(a,f[c])&&!i.equalsInt(a,f[c]))return 0;for(c=0;b>c;c++){for(i.randBigInt_(q,e,0);!i.greater(a,q);)i.randBigInt_(q,e,0);if(!i.millerRabin(a,q))return 0}return 1}function d(b){for(var d,e,f,g,h=a(),k=r[b].repeat,l=r[b].N,o=j.twotothe(b-1),p=4*b,q=!1;;)if(d=i.randBigInt(l,1),d[0]|=1,c(d,k)){for(h("q"),g=0;p>g;g++)if(e=i.randBigInt(b,1),e[0]|=1,f=i.mod(e,d),f=i.sub(f,m),e=i.sub(e,f),!i.greater(o,e)&&c(e,k)){h("p"),s[b]={p:e,q:d},q=!0;break}if(q)break}for(var t,u=i.dup(n),v=i.sub(e,m),w=i.multMod(v,i.inverseMod(d,e),e);;){t=i.powMod(u,w,e);{if(!i.equals(t,m))return s[b].g=t,void h("g");u=i.add(u,m)}}throw new Error("Unreachable!")}function e(a,c){if(!(this instanceof e))return new e(a,c);if(c=c||{},a){var f=this;return["p","q","g","y","x"].forEach(function(b){f[b]=a[b]}),void(this.type=a.type||o)}var g=parseInt(c.bit_length?c.bit_length:1024,10);if(!r[g])throw new Error("Unsupported bit length.");s[g]||d(g),this.p=s[g].p,this.q=s[g].q,this.g=s[g].g,this.type=o,this.x=b(l,this.q),this.y=i.powMod(this.g,this.x,this.p),c.nocache&&(s[g]=null)}function f(a){var b,c;if(b=a.indexOf("("),c=a.lastIndexOf(")"),0>b||0>c)throw new Error("Malformed S-Expression");a=a.substring(b+1,c);var d=a.search(/\s/),e={type:a.substring(0,d),val:[]};if(a=a.substring(d+1,c),b=a.indexOf("("),0>b)e.val.push(a);else for(var g,h,i,j;b>-1;){for(g=b+1,h=a.length,i=1,j=0;h>g&&i>j;g++)"("===a[g]&&i++,")"===a[g]&&j++;e.val.push(f(a.substring(b,++g))),a=a.substring(++g),b=a.indexOf("(")}return e}function g(a){if(!a.type)throw new Error("Parse error.");var b,c;return"privkeys"===a.type?(b=[],a.val.forEach(function(a){b.push(g(a))}),b):(b={},a.val.forEach(function(a){c=a.val[0],"string"==typeof c?0===c.indexOf("#")&&(c=c.substring(1,c.lastIndexOf("#")),c=i.str2bigInt(c,16)):c=g(a),b[a.type]=c}),b)}var h,i,j,k=this;"undefined"!=typeof module&&module.exports?(module.exports=e,h=require("../vendor/crypto.js"),i=require("../vendor/bigint.js"),j=require("./helpers.js")):(Object.keys(k.DSA).forEach(function(a){e[a]=k.DSA[a]}),k.DSA=e,h=k.CryptoJS,i=k.BigInt,j=e.HLP);var l=i.str2bigInt("0",10),m=i.str2bigInt("1",10),n=i.str2bigInt("2",10),o="\x00\x00",p=!1,q=[],r={1024:{N:160,repeat:40},2048:{N:224,repeat:56}},s={};e.prototype={constructor:e,packPublic:function(){var a=this.type;return a+=j.packMPI(this.p),a+=j.packMPI(this.q),a+=j.packMPI(this.g),a+=j.packMPI(this.y)},packPrivate:function(){var a=this.packPublic()+j.packMPI(this.x);return a=h.enc.Latin1.parse(a),a.toString(h.enc.Base64)},generateNonce:function(a){var b=j.bigInt2bits(i.trim(this.x,0)),c=j.bigInt2bits(i.randBigInt(256)),d=h.algo.SHA256.create();d.update(h.enc.Latin1.parse(b)),d.update(a),d.update(h.enc.Latin1.parse(c));var e=d.finalize();return e=j.bits2bigInt(e.toString(h.enc.Latin1)),i.rightShift_(e,256-i.bitSize(this.q)),j.between(e,l,this.q)?e:this.generateNonce(a)},sign:function(a){a=h.enc.Latin1.parse(a);for(var b,c=i.str2bigInt(a.toString(h.enc.Hex),16),d=l,e=l;i.isZero(e)||i.isZero(d);)b=this.generateNonce(a),d=i.mod(i.powMod(this.g,b,this.p),this.q),i.isZero(d)||(e=i.inverseMod(b,this.q),e=i.mult(e,i.add(c,i.mult(this.x,d))),e=i.mod(e,this.q));return[d,e]},fingerprint:function(){var a=this.packPublic();return this.type===o&&(a=a.substring(2)),a=h.enc.Latin1.parse(a),h.SHA1(a).toString(h.enc.Hex)}},e.parsePublic=function(a,b){var c=["SHORT","MPI","MPI","MPI","MPI"];b&&c.push("MPI"),a=j.splitype(c,a);var d={type:a[0],p:j.readMPI(a[1]),q:j.readMPI(a[2]),g:j.readMPI(a[3]),y:j.readMPI(a[4])};return b&&(d.x=j.readMPI(a[5])),new e(d)},e.parsePrivate=function(a,b){return b?g(f(a))[0]["private-key"].dsa:(a=h.enc.Base64.parse(a),a=a.toString(h.enc.Latin1),e.parsePublic(a,!0))},e.verify=function(a,b,c,d){if(!j.between(c,l,a.q)||!j.between(d,l,a.q))return!1;var e=h.enc.Latin1.parse(b);e=i.str2bigInt(e.toString(h.enc.Hex),16);var f=i.inverseMod(d,a.q),g=i.multMod(e,f,a.q),k=i.multMod(c,f,a.q);g=i.powMod(a.g,g,a.p),k=i.powMod(a.y,k,a.p);var m=i.mod(i.multMod(g,k,a.p),a.q);return i.equals(m,c)}}.call(this),function(){"use strict";var a,b,c,d=this,e={};"undefined"!=typeof module&&module.exports?(module.exports=e,a=require("../vendor/crypto.js"),b=require("./const.js"),c=require("./helpers.js")):(d.OTR.Parse=e,a=d.CryptoJS,b=d.OTR.CONST,c=d.OTR.HLP);var f={};f[b.WHITESPACE_TAG_V2]=b.OTR_VERSION_2,f[b.WHITESPACE_TAG_V3]=b.OTR_VERSION_3,e.parseMsg=function(d,e){var g=[],h=e.indexOf(b.OTR_TAG);if(!~h){if(this.initFragment(d),k=e.indexOf(b.WHITESPACE_TAG),~k){e=e.split(""),e.splice(k,16);for(var i,j=e.length;j>k;)i=e.slice(k,k+8).join(""),Object.hasOwnProperty.call(f,i)?(e.splice(k,8),g.push(f[i])):k+=8;e=e.join("")}return{msg:e,ver:g}}var k=h+b.OTR_TAG.length,l=e[k];if(","===l||"|"===l)return this.msgFragment(d,e.substring(k+1),"|"===l);if(this.initFragment(d),~["?","v"].indexOf(l)){"?"===e[k]&&(g.push(b.OTR_VERSION_1),k+=1);var m={2:b.OTR_VERSION_2,3:b.OTR_VERSION_3},n=e.substring(k+1),o=n.indexOf("?");return o>=1&&(n=n.substring(0,o).split(""),"v"===e[k]&&n.forEach(function(a){Object.hasOwnProperty.call(m,a)&&g.push(m[a])})),{cls:"query",ver:g}}if(":"===l){k+=1;var p=e.substring(k,k+4);if(p.length<4)return{msg:e};p=a.enc.Base64.parse(p).toString(a.enc.Latin1);var q=p.substring(0,2),r=p.substring(2);if(!d["ALLOW_V"+c.unpackSHORT(q)])return{msg:e};k+=4;var s=e.substring(k).indexOf(".");if(!~s)return{msg:e};e=a.enc.Base64.parse(e.substring(k,k+s)),e=a.enc.Latin1.stringify(e);var t;q===b.OTR_VERSION_3&&(t=e.substring(0,8),e=e.substring(8));var u;return~["","\n","",""].indexOf(r)?u="ake":""===r&&(u="data"),{version:q,type:r,msg:e,cls:u,instance_tags:t}}return" Error:"===e.substring(k,k+7)?(d.ERROR_START_AKE&&d.sendQueryMsg(),{msg:e.substring(k+7),cls:"error"}):{msg:e}},e.initFragment=function(a){a.fragment={s:"",j:0,k:0}},e.msgFragment=function(a,b,d){if(b=b.split(","),d){var e=b.shift().split("|"),f=c.packINT(parseInt(e[0],16)),g=c.packINT(parseInt(e[1],16));if(a.checkInstanceTags(f+g))return}if(!(b.length<4||isNaN(parseInt(b[0],10))||isNaN(parseInt(b[1],10)))){var h=parseInt(b[0],10),i=parseInt(b[1],10);return b=b[2],h>i||0===i||0===h?void this.initFragment(a):(1===h?(this.initFragment(a),a.fragment={k:1,n:i,s:b}):i===a.fragment.n&&h===a.fragment.k+1?(a.fragment.s+=b,a.fragment.k+=1):this.initFragment(a),i===h?(b=a.fragment.s,this.initFragment(a),this.parseMsg(a,b)):void 0)}}}.call(this),function(){"use strict";function a(a,b,d,e,g){var h=c.enc.Latin1.parse(g),i=c.algo.HMAC.create(c.algo.SHA256,h);return i.update(c.enc.Latin1.parse(f.packMPI(a))),i.update(c.enc.Latin1.parse(f.packMPI(b))),i.update(c.enc.Latin1.parse(d)),i.update(c.enc.Latin1.parse(e)),i.finalize().toString(c.enc.Latin1)}function b(a){if(!(this instanceof b))return new b(a);this.otr=a,this.our_dh=a.our_old_dh,this.our_keyid=a.our_keyid-1,this.their_y=null,this.their_keyid=null,this.their_priv_pk=null,this.ssid=null,this.transmittedRS=!1,this.r=null,this.priv=a.priv;var c=this;["sendMsg"].forEach(function(a){c[a]=c[a].bind(c)})}var c,d,e,f,g,h=this;"undefined"!=typeof module&&module.exports?(module.exports=b,c=require("../vendor/crypto.js"),d=require("../vendor/bigint.js"),e=require("./const.js"),f=require("./helpers.js"),g=require("./dsa.js")):(h.OTR.AKE=b,c=h.CryptoJS,d=h.BigInt,e=h.OTR.CONST,f=h.OTR.HLP,g=h.DSA);var i=d.str2bigInt(e.N,16);b.prototype={constructor:b,createKeys:function(a){var b=d.powMod(a,this.our_dh.privateKey,i),c=f.packMPI(b);this.ssid=f.mask(f.h2("\x00",c),0,64);var e=f.h2("",c);this.c=f.mask(e,0,128),this.c_prime=f.mask(e,128,128),this.m1=f.h2("",c),this.m2=f.h2("",c),this.m1_prime=f.h2("",c),this.m2_prime=f.h2("",c)},verifySignMac:function(b,d,e,h,i,j,k,l){var m=f.makeMac(d,e);if(!f.compare(b,m))return["MACs do not match."];var n=f.decryptAes(d.substring(4),h,l);n=f.splitype(["PUBKEY","INT","SIG"],n.toString(c.enc.Latin1));var o=a(i,j,n[0],n[1],k),p=g.parsePublic(n[0]),q=f.bits2bigInt(n[2].substring(0,20)),r=f.bits2bigInt(n[2].substring(20));return g.verify(p,o,q,r)?[null,f.readLen(n[1]),p]:["Cannot verify signature of m."]},makeM:function(b,d,e,g){var h=this.priv.packPublic(),i=f.packINT(this.our_keyid),j=a(this.our_dh.publicKey,b,h,i,d);j=this.priv.sign(j);var k=h+i;k+=f.bigInt2bits(j[0],20),k+=f.bigInt2bits(j[1],20),k=c.enc.Latin1.parse(k);var l=f.packData(f.encryptAes(k,e,f.packCtr(0))),m=f.makeMac(l,g);return l+m},akeSuccess:function(a){return f.debug.call(this.otr,"success"),d.equals(this.their_y,this.our_dh.publicKey)?this.otr.error("equal keys - we have a problem.",!0):(this.their_keyid!==this.otr.their_keyid&&this.their_keyid!==this.otr.their_keyid-1&&(this.otr.our_old_dh=this.our_dh,this.otr.their_y=this.their_y,this.otr.their_old_y=null,this.otr.their_keyid=this.their_keyid,this.otr.their_priv_pk=this.their_priv_pk,this.otr.sessKeys[0]=[new this.otr.DHSession(this.otr.our_dh,this.otr.their_y),null],this.otr.sessKeys[1]=[new this.otr.DHSession(this.otr.our_old_dh,this.otr.their_y),null]),this.otr.ssid=this.ssid,this.otr.transmittedRS=this.transmittedRS,this.otr_version=a,this.otr.authstate=e.AUTHSTATE_NONE,this.otr.msgstate=e.MSGSTATE_ENCRYPTED,this.r=null,this.myhashed=null,this.dhcommit=null,this.encrypted=null,this.hashed=null,this.otr.trigger("status",[e.STATUS_AKE_SUCCESS]),void this.otr.sendStored())},handleAKE:function(a){var b,g,h,j=a.version;switch(a.type){case"":if(f.debug.call(this.otr,"d-h key message"),a=f.splitype(["DATA","DATA"],a.msg),this.otr.authstate===e.AUTHSTATE_AWAITING_DHKEY){var k=f.readMPI(this.myhashed),l=f.readMPI(a[1]);if(d.greater(k,l)){h="",b=this.dhcommit;break}this.our_dh=this.otr.dh(),this.otr.authstate=e.AUTHSTATE_NONE,this.r=null,this.myhashed=null}else this.otr.authstate===e.AUTHSTATE_AWAITING_SIG&&(this.our_dh=this.otr.dh());this.otr.authstate=e.AUTHSTATE_AWAITING_REVEALSIG,this.encrypted=a[0].substring(4),this.hashed=a[1].substring(4),h="\n",b=f.packMPI(this.our_dh.publicKey);break;case"\n":if(f.debug.call(this.otr,"reveal signature message"),a=f.splitype(["MPI"],a.msg),this.otr.authstate!==e.AUTHSTATE_AWAITING_DHKEY){if(this.otr.authstate!==e.AUTHSTATE_AWAITING_SIG)return;if(!d.equals(this.their_y,f.readMPI(a[0])))return}if(this.otr.authstate=e.AUTHSTATE_AWAITING_SIG,this.their_y=f.readMPI(a[0]),!f.checkGroup(this.their_y,i))return this.otr.error("Illegal g^y.",!0);this.createKeys(this.their_y),h="",b=f.packMPI(this.r),b+=this.makeM(this.their_y,this.m1,this.c,this.m2),this.m1=null,this.m2=null,this.c=null;break;case"":if(f.debug.call(this.otr,"signature message"),this.otr.authstate!==e.AUTHSTATE_AWAITING_REVEALSIG)return;a=f.splitype(["DATA","DATA","MAC"],a.msg),this.r=f.readMPI(a[0]);var m=c.enc.Hex.parse(d.bigInt2str(this.r,16));m=c.enc.Latin1.stringify(m);var n=f.decryptAes(this.encrypted,m,f.packCtr(0));n=n.toString(c.enc.Latin1),this.their_y=f.readMPI(n);var o=c.SHA256(c.enc.Latin1.parse(n));return f.compare(this.hashed,o.toString(c.enc.Latin1))?f.checkGroup(this.their_y,i)?(this.createKeys(this.their_y),g=this.verifySignMac(a[2],a[1],this.m2,this.c,this.their_y,this.our_dh.publicKey,this.m1,f.packCtr(0)),g[0]?this.otr.error(g[0],!0):(this.their_keyid=g[1],this.their_priv_pk=g[2],b=this.makeM(this.their_y,this.m1_prime,this.c_prime,this.m2_prime),this.m1=null,this.m2=null,this.m1_prime=null,this.m2_prime=null,this.c=null,this.c_prime=null,this.sendMsg(j,"",b),void this.akeSuccess(j))):this.otr.error("Illegal g^x.",!0):this.otr.error("Hashed g^x does not match.",!0);case"":if(f.debug.call(this.otr,"data message"),this.otr.authstate!==e.AUTHSTATE_AWAITING_SIG)return;return a=f.splitype(["DATA","MAC"],a.msg),g=this.verifySignMac(a[1],a[0],this.m2_prime,this.c_prime,this.their_y,this.our_dh.publicKey,this.m1_prime,f.packCtr(0)),g[0]?this.otr.error(g[0],!0):(this.their_keyid=g[1],this.their_priv_pk=g[2],this.m1_prime=null,this.m2_prime=null,this.c_prime=null,this.transmittedRS=!0,void this.akeSuccess(j));default:return}this.sendMsg(j,h,b)},sendMsg:function(a,b,c){var d=a+b,g=a===e.OTR_VERSION_3;return g&&(f.debug.call(this.otr,"instance tags"),d+=this.otr.our_instance_tag,d+=this.otr.their_instance_tag),d+=c,d=f.wrapMsg(d,this.otr.fragment_size,g,this.otr.our_instance_tag,this.otr.their_instance_tag),d[0]?this.otr.error(d[0]):void this.otr._sendMsg(d[1],!0)},initiateAKE:function(a){f.debug.call(this.otr,"d-h commit message"),this.otr.trigger("status",[e.STATUS_AKE_INIT]),this.otr.authstate=e.AUTHSTATE_AWAITING_DHKEY;var b=f.packMPI(this.our_dh.publicKey);b=c.enc.Latin1.parse(b),this.r=d.randBigInt(128);var g=c.enc.Hex.parse(d.bigInt2str(this.r,16));g=c.enc.Latin1.stringify(g),this.myhashed=c.SHA256(b),this.myhashed=f.packData(this.myhashed.toString(c.enc.Latin1)),this.dhcommit=f.packData(f.encryptAes(b,g,f.packCtr(0))),this.dhcommit+=this.myhashed,this.sendMsg(a,"",this.dhcommit)}}}.call(this),function(){"use strict";function a(b){return this instanceof a?(this.version=1,this.our_fp=b.our_fp,this.their_fp=b.their_fp,this.ssid=b.ssid,this.debug=!!b.debug,void this.init()):new a(b)}var b,c,d,e,f,g=this;"undefined"!=typeof module&&module.exports?(module.exports=a,b=require("../vendor/crypto.js"),c=require("../vendor/bigint.js"),d=require("../vendor/eventemitter.js"),e=require("./const.js"),f=require("./helpers.js")):(g.OTR.SM=a,b=g.CryptoJS,c=g.BigInt,d=g.EventEmitter,e=g.OTR.CONST,f=g.OTR.HLP);var h=c.str2bigInt(e.G,10),i=c.str2bigInt(e.N,16),j=c.sub(i,c.str2bigInt("1",10));c.divInt_(j,2),f.extend(a,d),a.prototype.init=function(){this.smpstate=e.SMPSTATE_EXPECT1,this.secret=null},a.prototype.makeSecret=function(a,c){var d=b.algo.SHA256.create();d.update(b.enc.Latin1.parse(f.packBytes(this.version,1))),d.update(b.enc.Hex.parse(a?this.our_fp:this.their_fp)),d.update(b.enc.Hex.parse(a?this.their_fp:this.our_fp)),d.update(b.enc.Latin1.parse(this.ssid)),d.update(b.enc.Latin1.parse(c));var e=d.finalize();this.secret=f.bits2bigInt(e.toString(b.enc.Latin1))},a.prototype.makeG2s=function(){this.a2=f.randomExponent(),this.a3=f.randomExponent(),this.g2a=c.powMod(h,this.a2,i),this.g3a=c.powMod(h,this.a3,i),f.checkGroup(this.g2a,i)&&f.checkGroup(this.g3a,i)||this.makeG2s()},a.prototype.computeGs=function(a,b){this.g2=c.powMod(a,this.a2,i),this.g3=c.powMod(b,this.a3,i)},a.prototype.computePQ=function(a){this.p=c.powMod(this.g3,a,i),this.q=f.multPowMod(h,a,this.g2,this.secret,i)},a.prototype.computeR=function(){this.r=c.powMod(this.QoQ,this.a3,i)},a.prototype.computeRab=function(a){return c.powMod(a,this.a3,i)},a.prototype.computeC=function(a,b){return f.smpHash(a,c.powMod(h,b,i))},a.prototype.computeD=function(a,b,d){return f.subMod(a,c.multMod(b,d,j),j)},a.prototype.handleSM=function(a){var b,d,g,j,k,l,m,n,o,p,q,r,s,t,u={2:e.SMPSTATE_EXPECT1,3:e.SMPSTATE_EXPECT2,4:e.SMPSTATE_EXPECT3,5:e.SMPSTATE_EXPECT4,7:e.SMPSTATE_EXPECT1};if(6===a.type)return this.init(),void this.trigger("trust",[!1]);if(this.smpstate!==u[a.type])return this.abort();switch(this.smpstate){case e.SMPSTATE_EXPECT1:f.debug.call(this,"smp tlv 2");var v,w;return 7===a.type&&(v=a.msg.indexOf("\x00"),w=a.msg.substring(0,v),a.msg=a.msg.substring(v+1)),s=f.readLen(a.msg.substr(0,4)),6!==s?this.abort():(a=f.unpackMPIs(6,a.msg.substring(4)),f.checkGroup(a[0],i)&&f.checkGroup(a[3],i)&&f.ZKP(1,a[1],f.multPowMod(h,a[2],a[0],a[1],i))&&f.ZKP(2,a[4],f.multPowMod(h,a[5],a[3],a[4],i))?(this.g3ao=a[3],this.makeG2s(),d=f.randomExponent(),g=f.randomExponent(),this.c2=this.computeC(3,d),this.c3=this.computeC(4,g),this.d2=this.computeD(d,this.a2,this.c2),this.d3=this.computeD(g,this.a3,this.c3),this.computeGs(a[0],a[3]),this.smpstate=e.SMPSTATE_EXPECT0,void this.trigger("question",[w])):this.abort());case e.SMPSTATE_EXPECT2:if(f.debug.call(this,"smp tlv 3"),s=f.readLen(a.msg.substr(0,4)),11!==s)return this.abort();if(a=f.unpackMPIs(11,a.msg.substring(4)),!(f.checkGroup(a[0],i)&&f.checkGroup(a[3],i)&&f.checkGroup(a[6],i)&&f.checkGroup(a[7],i)))return this.abort();if(!f.ZKP(3,a[1],f.multPowMod(h,a[2],a[0],a[1],i)))return this.abort();if(!f.ZKP(4,a[4],f.multPowMod(h,a[5],a[3],a[4],i)))return this.abort();if(this.g3ao=a[3],this.computeGs(a[0],a[3]),k=f.multPowMod(this.g3,a[9],a[6],a[8],i),l=f.multPowMod(h,a[9],this.g2,a[10],i),l=c.multMod(l,c.powMod(a[7],a[8],i),i),!f.ZKP(5,a[8],k,l))return this.abort();var x=f.randomExponent();this.computePQ(x);var y=f.randomExponent(),z=f.randomExponent(),A=f.multPowMod(h,y,this.g2,z,i),B=f.smpHash(6,c.powMod(this.g3,y,i),A),C=this.computeD(y,x,B),D=this.computeD(z,this.secret,B);this.QoQ=f.divMod(this.q,a[7],i),this.PoP=f.divMod(this.p,a[6],i),this.computeR(),j=f.randomExponent(),p=c.powMod(this.QoQ,j,i),q=f.smpHash(7,c.powMod(h,j,i),p),r=this.computeD(j,this.a3,q),this.smpstate=e.SMPSTATE_EXPECT4,b=f.packINT(8)+f.packMPIs([this.p,this.q,B,C,D,this.r,q,r]),b=f.packTLV(4,b);break;case e.SMPSTATE_EXPECT3:if(f.debug.call(this,"smp tlv 4"),s=f.readLen(a.msg.substr(0,4)),8!==s)return this.abort();if(a=f.unpackMPIs(8,a.msg.substring(4)),!f.checkGroup(a[0],i)||!f.checkGroup(a[1],i)||!f.checkGroup(a[5],i))return this.abort();if(k=f.multPowMod(this.g3,a[3],a[0],a[2],i),l=f.multPowMod(h,a[3],this.g2,a[4],i),l=c.multMod(l,c.powMod(a[1],a[2],i),i),!f.ZKP(6,a[2],k,l))return this.abort();if(m=f.multPowMod(h,a[7],this.g3ao,a[6],i),this.QoQ=f.divMod(a[1],this.q,i),n=f.multPowMod(this.QoQ,a[7],a[5],a[6],i),!f.ZKP(7,a[6],m,n))return this.abort();this.computeR(),j=f.randomExponent(),p=c.powMod(this.QoQ,j,i),q=f.smpHash(8,c.powMod(h,j,i),p),r=this.computeD(j,this.a3,q),b=f.packINT(3)+f.packMPIs([this.r,q,r]),b=f.packTLV(5,b),o=this.computeRab(a[5]),t=!!c.equals(o,f.divMod(a[0],this.p,i)),this.trigger("trust",[t,"answered"]),this.init();break;case e.SMPSTATE_EXPECT4:return f.debug.call(this,"smp tlv 5"),s=f.readLen(a.msg.substr(0,4)),3!==s?this.abort():(a=f.unpackMPIs(3,a.msg.substring(4)),f.checkGroup(a[0],i)?(m=f.multPowMod(h,a[2],this.g3ao,a[1],i),n=f.multPowMod(this.QoQ,a[2],a[0],a[1],i),f.ZKP(8,a[1],m,n)?(o=this.computeRab(a[0]),t=!!c.equals(o,this.PoP),this.trigger("trust",[t,"asked"]),void this.init()):this.abort()):this.abort())
}this.sendMsg(b)},a.prototype.sendMsg=function(a){this.trigger("send",[this.ssid,"\x00"+a])},a.prototype.rcvSecret=function(a,b){f.debug.call(this,"receive secret");var c,d=!1;this.smpstate===e.SMPSTATE_EXPECT0?c=this.answer:(c=this.initiate,d=!0),this.makeSecret(d,a),c.call(this,b)},a.prototype.answer=function(){f.debug.call(this,"smp answer");var a=f.randomExponent();this.computePQ(a);var b=f.randomExponent(),d=f.randomExponent(),g=f.multPowMod(h,b,this.g2,d,i),j=f.smpHash(5,c.powMod(this.g3,b,i),g),k=this.computeD(b,a,j),l=this.computeD(d,this.secret,j);this.smpstate=e.SMPSTATE_EXPECT3;var m=f.packINT(11)+f.packMPIs([this.g2a,this.c2,this.d2,this.g3a,this.c3,this.d3,this.p,this.q,j,k,l]);this.sendMsg(f.packTLV(3,m))},a.prototype.initiate=function(a){f.debug.call(this,"smp initiate"),this.smpstate!==e.SMPSTATE_EXPECT1&&this.abort(),this.makeG2s();var b=f.randomExponent(),c=f.randomExponent();this.c2=this.computeC(1,b),this.c3=this.computeC(2,c),this.d2=this.computeD(b,this.a2,this.c2),this.d3=this.computeD(c,this.a3,this.c3),this.smpstate=e.SMPSTATE_EXPECT2;var d="",g=2;a&&(d+=a,d+="\x00",g=7),d+=f.packINT(6)+f.packMPIs([this.g2a,this.c2,this.d2,this.g3a,this.c3,this.d3]),this.sendMsg(f.packTLV(g,d))},a.prototype.abort=function(){this.init(),this.sendMsg(f.packTLV(6,"")),this.trigger("abort")}}.call(this),function(){"use strict";function a(b){if(!(this instanceof a))return new a(b);if(b=b||{},b.priv&&!(b.priv instanceof l))throw new Error("Requires long-lived DSA key.");if(this.priv=b.priv?b.priv:new l,this.fragment_size=b.fragment_size||0,this.fragment_size<0)throw new Error("Fragment size must be a positive integer.");if(this.send_interval=b.send_interval||0,this.send_interval<0)throw new Error("Send interval must be a positive integer.");this.outgoing=[],this.our_instance_tag=b.instance_tag||a.makeInstanceTag(),this.debug=!!b.debug,this.smw=b.smw,this.init();var c=this;["sendMsg","receiveMsg"].forEach(function(a){c[a]=c[a].bind(c)}),d.call(this)}var b,c,d,e,f,g,h,i,j,k,l,m=this;"undefined"!=typeof module&&module.exports?(module.exports=a,b=require("../vendor/crypto.js"),c=require("../vendor/bigint.js"),d=require("../vendor/eventemitter.js"),e=require("webworker-threads").Worker,f=require("path").join(__dirname,"/sm-webworker.js"),g=require("./const.js"),h=require("./helpers.js"),i=require("./parse.js"),j=require("./ake.js"),k=require("./sm.js"),l=require("./dsa.js"),a.CONST=g):(Object.keys(m.OTR).forEach(function(b){a[b]=m.OTR[b]}),m.OTR=a,b=m.CryptoJS,c=m.BigInt,d=m.EventEmitter,e=m.Worker,f="sm-webworker.js",g=a.CONST,h=a.HLP,i=a.Parse,j=a.AKE,k=a.SM,l=m.DSA);var n=c.str2bigInt(g.G,10),o=c.str2bigInt(g.N,16),p=Math.pow(2,53)-1,q=Math.pow(2,31)-1;h.extend(a,d),a.prototype.init=function(){this.msgstate=g.MSGSTATE_PLAINTEXT,this.authstate=g.AUTHSTATE_NONE,this.ALLOW_V2=!0,this.ALLOW_V3=!0,this.REQUIRE_ENCRYPTION=!1,this.SEND_WHITESPACE_TAG=!1,this.WHITESPACE_START_AKE=!1,this.ERROR_START_AKE=!1,i.initFragment(this),this.their_y=null,this.their_old_y=null,this.their_keyid=0,this.their_priv_pk=null,this.their_instance_tag="\x00\x00\x00\x00",this.our_dh=this.dh(),this.our_old_dh=this.dh(),this.our_keyid=2,this.sessKeys=[new Array(2),new Array(2)],this.storedMgs=[],this.oldMacKeys=[],this.sm=null,this._akeInit(),this.receivedPlaintext=!1},a.prototype._akeInit=function(){this.ake=new j(this),this.transmittedRS=!1,this.ssid=null},a.prototype._SMW=function(a,b){this.otr=a;var d={path:f,seed:c.getSeed};"object"==typeof a.smw&&Object.keys(a.smw).forEach(function(b){d[b]=a.smw[b]}),this.worker=new e(d.path);var g=this;this.worker.onmessage=function(a){var b=a.data;b&&g.trigger(b.method,b.args)},this.worker.postMessage({type:"seed",seed:d.seed(),imports:d.imports}),this.worker.postMessage({type:"init",reqs:b})},h.extend(a.prototype._SMW,d),["handleSM","rcvSecret","abort"].forEach(function(b){a.prototype._SMW.prototype[b]=function(){this.worker.postMessage({type:"method",method:b,args:Array.prototype.slice.call(arguments,0)})}}),a.prototype._smInit=function(){var a={ssid:this.ssid,our_fp:this.priv.fingerprint(),their_fp:this.their_priv_pk.fingerprint(),debug:this.debug};this.smw?(this.sm&&this.sm.worker.terminate(),this.sm=new this._SMW(this,a)):this.sm=new k(a);var b=this;["trust","abort","question"].forEach(function(a){b.sm.on(a,function(){b.trigger("smp",[a].concat(Array.prototype.slice.call(arguments)))})}),this.sm.on("send",function(a,c){b.ssid===a&&b._sendMsg(c)})},a.prototype.io=function(a){this.outgoing=this.outgoing.concat(a);var b=this;!function c(a){if(!a){if(!b.outgoing.length)return;var d=b.outgoing.shift();b.trigger("io",[d])}setTimeout(c,a?0:b.send_interval)}(!0)},a.prototype.dh=function(){var a={privateKey:c.randBigInt(320)};return a.publicKey=c.powMod(n,a.privateKey,o),a},a.prototype.DHSession=function r(a,d){if(!(this instanceof r))return new r(a,d);var e=c.powMod(d,a.privateKey,o),f=h.packMPI(e);this.id=h.mask(h.h2("\x00",f),0,64);var g=c.greater(a.publicKey,d),i=g?"":"",j=g?"":"";this.sendenc=h.mask(h.h1(i,f),0,128),this.sendmac=b.SHA1(b.enc.Latin1.parse(this.sendenc)),this.sendmac=this.sendmac.toString(b.enc.Latin1),this.sendmacused=!1,this.rcvenc=h.mask(h.h1(j,f),0,128),this.rcvmac=b.SHA1(b.enc.Latin1.parse(this.rcvenc)),this.rcvmac=this.rcvmac.toString(b.enc.Latin1),this.rcvmacused=!1,this.extra_symkey=h.h2("Ã¿",f),this.send_counter=0,this.rcv_counter=0},a.prototype.rotateOurKeys=function(){var a=this;this.sessKeys[1].forEach(function(b){b&&b.sendmacused&&a.oldMacKeys.push(b.sendmac),b&&b.rcvmacused&&a.oldMacKeys.push(b.rcvmac)}),this.our_old_dh=this.our_dh,this.our_dh=this.dh(),this.our_keyid+=1,this.sessKeys[1][0]=this.sessKeys[0][0],this.sessKeys[1][1]=this.sessKeys[0][1],this.sessKeys[0]=[this.their_y?new this.DHSession(this.our_dh,this.their_y):null,this.their_old_y?new this.DHSession(this.our_dh,this.their_old_y):null]},a.prototype.rotateTheirKeys=function(a){this.their_keyid+=1;var b=this;this.sessKeys.forEach(function(a){a[1]&&a[1].sendmacused&&b.oldMacKeys.push(a[1].sendmac),a[1]&&a[1].rcvmacused&&b.oldMacKeys.push(a[1].rcvmac)}),this.their_old_y=this.their_y,this.sessKeys[0][1]=this.sessKeys[0][0],this.sessKeys[1][1]=this.sessKeys[1][0],this.their_y=a,this.sessKeys[0][0]=new this.DHSession(this.our_dh,this.their_y),this.sessKeys[1][0]=new this.DHSession(this.our_old_dh,this.their_y)},a.prototype.prepareMsg=function(a,c){if(this.msgstate!==g.MSGSTATE_ENCRYPTED||0===this.their_keyid)return this.error("Not ready to encrypt.");var d=this.sessKeys[1][0];if(d.send_counter>=p)return this.error("Should have rekeyed by now.");d.send_counter+=1;var e=h.packCtr(d.send_counter),f=this.ake.otr_version+"",i=this.ake.otr_version===g.OTR_VERSION_3;if(i&&(f+=this.our_instance_tag,f+=this.their_instance_tag),f+="\x00",f+=h.packINT(this.our_keyid-1),f+=h.packINT(this.their_keyid),f+=h.packMPI(this.our_dh.publicKey),f+=e.substring(0,8),Math.ceil(a.length/8)>=q)return this.error("Message is too long.");var j=h.encryptAes(b.enc.Latin1.parse(a),d.sendenc,e);return f+=h.packData(j),f+=h.make1Mac(f,d.sendmac),f+=h.packData(this.oldMacKeys.splice(0).join("")),d.sendmacused=!0,f=h.wrapMsg(f,this.fragment_size,i,this.our_instance_tag,this.their_instance_tag),f[0]?this.error(f[0]):(c&&this.trigger("file",["send",d.extra_symkey,c]),f[1])},a.prototype.handleDataMsg=function(a){var c=a.version+a.type;this.ake.otr_version===g.OTR_VERSION_3&&(c+=a.instance_tags);var d=["BYTE","INT","INT","MPI","CTR","DATA","MAC","DATA"];a=h.splitype(d,a.msg);var e=""===a[0];if(this.msgstate!==g.MSGSTATE_ENCRYPTED||8!==a.length)return void(e||this.error("Received an unreadable encrypted message.",!0));var f=this.our_keyid-h.readLen(a[2]),i=this.their_keyid-h.readLen(a[1]);if(0>f||f>1)return void(e||this.error("Not of our latest keys.",!0));if(0>i||i>1)return void(e||this.error("Not of your latest keys.",!0));var j=i?this.their_old_y:this.their_y;if(1===i&&!j)return void(e||this.error("Do not have that key."));var k=this.sessKeys[f][i],l=h.unpackCtr(a[4]);if(l<=k.rcv_counter)return void(e||this.error("Counter in message is not larger."));k.rcv_counter=l,c+=a.slice(0,6).join("");var m=h.make1Mac(c,k.rcvmac);if(!h.compare(a[6],m))return void(e||this.error("MACs do not match."));k.rcvmacused=!0;var n=h.decryptAes(a[5].substring(4),k.rcvenc,h.padCtr(a[4]));n=n.toString(b.enc.Latin1),f||this.rotateOurKeys(),i||this.rotateTheirKeys(h.readMPI(a[3]));var o=n.indexOf("\x00");return~o&&(this.handleTLVs(n.substring(o+1),k),n=n.substring(0,o)),n=b.enc.Latin1.parse(n),n.toString(b.enc.Utf8)},a.prototype.handleTLVs=function(a,c){for(var d,e,f;a.length&&(d=h.unpackSHORT(a.substr(0,2)),e=h.unpackSHORT(a.substr(2,2)),f=a.substr(4,e),!(f.length<e));){switch(d){case 1:this.msgstate=g.MSGSTATE_FINISHED,this.trigger("status",[g.STATUS_END_OTR]);break;case 2:case 3:case 4:case 5:case 6:case 7:if(this.msgstate!==g.MSGSTATE_ENCRYPTED)return void(this.sm&&this.sm.abort());this.sm||this._smInit(),this.sm.handleSM({msg:f,type:d});break;case 8:f=f.substring(4),f=b.enc.Latin1.parse(f),f=f.toString(b.enc.Utf8),this.trigger("file",["receive",c.extra_symkey,f])}a=a.substring(4+e)}},a.prototype.smpSecret=function(a,b){return this.msgstate!==g.MSGSTATE_ENCRYPTED?this.error("Must be encrypted for SMP."):"string"!=typeof a||a.length<1?this.error("Secret is required."):(this.sm||this._smInit(),void this.sm.rcvSecret(a,b))},a.prototype.sendQueryMsg=function(){var a={},b=g.OTR_TAG;this.ALLOW_V2&&(a[2]=!0),this.ALLOW_V3&&(a[3]=!0);var c=Object.keys(a);c.length&&(b+="v",c.forEach(function(a){"1"!==a&&(b+=a)}),b+="?"),this._sendMsg(b,!0),this.trigger("status",[g.STATUS_SEND_QUERY])},a.prototype.sendMsg=function(a){(this.REQUIRE_ENCRYPTION||this.msgstate!==g.MSGSTATE_PLAINTEXT)&&(a=b.enc.Utf8.parse(a),a=a.toString(b.enc.Latin1)),this._sendMsg(a)},a.prototype._sendMsg=function(a,b){if(!b)switch(this.msgstate){case g.MSGSTATE_PLAINTEXT:if(this.REQUIRE_ENCRYPTION)return this.storedMgs.push(a),void this.sendQueryMsg();this.SEND_WHITESPACE_TAG&&!this.receivedPlaintext&&(a+=g.WHITESPACE_TAG,this.ALLOW_V3&&(a+=g.WHITESPACE_TAG_V3),this.ALLOW_V2&&(a+=g.WHITESPACE_TAG_V2));break;case g.MSGSTATE_FINISHED:return this.storedMgs.push(a),void this.error("Message cannot be sent at this time.");default:a=this.prepareMsg(a)}a&&this.io(a)},a.prototype.receiveMsg=function(a){if(a=i.parseMsg(this,a)){switch(a.cls){case"error":return void this.error(a.msg);case"ake":if(a.version===g.OTR_VERSION_3&&this.checkInstanceTags(a.instance_tags))return;return void this.ake.handleAKE(a);case"data":if(a.version===g.OTR_VERSION_3&&this.checkInstanceTags(a.instance_tags))return;a.msg=this.handleDataMsg(a),a.encrypted=!0;break;case"query":this.msgstate===g.MSGSTATE_ENCRYPTED&&this._akeInit(),this.doAKE(a);break;default:(this.REQUIRE_ENCRYPTION||this.msgstate!==g.MSGSTATE_PLAINTEXT)&&this.error("Received an unencrypted message."),this.receivedPlaintext=!0,this.WHITESPACE_START_AKE&&a.ver.length>0&&this.doAKE(a)}a.msg&&this.trigger("ui",[a.msg,a.encrypted])}},a.prototype.checkInstanceTags=function(a){var b=h.readLen(a.substr(0,4)),c=h.readLen(a.substr(4,4));if(c&&c!==h.readLen(this.our_instance_tag))return!0;if(h.readLen(this.their_instance_tag)){if(h.readLen(this.their_instance_tag)!==b)return!0}else{if(100>b)return!0;this.their_instance_tag=h.packINT(b)}},a.prototype.doAKE=function(a){this.ALLOW_V3&&~a.ver.indexOf(g.OTR_VERSION_3)?this.ake.initiateAKE(g.OTR_VERSION_3):this.ALLOW_V2&&~a.ver.indexOf(g.OTR_VERSION_2)?this.ake.initiateAKE(g.OTR_VERSION_2):this.error("OTR conversation requested, but no compatible protocol version found.")},a.prototype.error=function(a,b){return b?(this.debug||(a="An OTR error has occurred."),a="?OTR Error:"+a,void this._sendMsg(a,!0)):void this.trigger("error",[a])},a.prototype.sendStored=function(){var a=this;this.storedMgs.splice(0).forEach(function(b){a._sendMsg(b)})},a.prototype.sendFile=function(a){if(this.msgstate!==g.MSGSTATE_ENCRYPTED)return this.error("Not ready to encrypt.");if(this.ake.otr_version!==g.OTR_VERSION_3)return this.error("Protocol v3 required.");if(!a)return this.error("Please specify a filename.");var c=b.enc.Utf8.parse(a);if(c=c.toString(b.enc.Latin1),c.length>=65532)return this.error("filename is too long.");var d="\x00";d+="\x00\b",d+=h.packSHORT(4+c.length),d+="\x00\x00\x00",d+=c,d=this.prepareMsg(d,a),d&&this._sendMsg(d,!0)},a.prototype.endOtr=function(){this.msgstate===g.MSGSTATE_ENCRYPTED&&(this.sendMsg("\x00\x00\x00\x00"),this.sm&&(this.smw&&this.sm.worker.terminate(),this.sm=null)),this.msgstate=g.MSGSTATE_PLAINTEXT,this.receivedPlaintext=!1,this.trigger("status",[g.STATUS_END_OTR])},a.makeInstanceTag=function(){var b=c.randBigInt(32);return c.greater(c.str2bigInt("100",16),b)?a.makeInstanceTag():h.packINT(parseInt(c.bigInt2str(b,10),10))}}.call(this),{OTR:this.OTR,DSA:this.DSA}});var Base64=function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b={encode:function(b){var c,d,e,f,g,h,i,j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),e=b.charCodeAt(k++),f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,i=63&e,isNaN(d)?h=i=64:isNaN(e)&&(i=64),j=j+a.charAt(f)+a.charAt(g)+a.charAt(h)+a.charAt(i);while(k<b.length);return j},decode:function(b){var c,d,e,f,g,h,i,j="",k=0;b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),h=a.indexOf(b.charAt(k++)),i=a.indexOf(b.charAt(k++)),c=f<<2|g>>4,d=(15&g)<<4|h>>2,e=(3&h)<<6|i,j+=String.fromCharCode(c),64!=h&&(j+=String.fromCharCode(d)),64!=i&&(j+=String.fromCharCode(e));while(k<b.length);return j}};return b}(),hexcase=0,b64pad="=",chrsz=8,MD5=function(){var a=0,b="",c=8,d=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c},e=function(a,b){return a<<b|a>>>32-b},f=function(a){for(var b=[],d=(1<<c)-1,e=0;e<a.length*c;e+=c)b[e>>5]|=(a.charCodeAt(e/c)&d)<<e%32;return b},g=function(a){for(var b="",d=(1<<c)-1,e=0;e<32*a.length;e+=c)b+=String.fromCharCode(a[e>>5]>>>e%32&d);return b},h=function(b){for(var c=a?"0123456789ABCDEF":"0123456789abcdef",d="",e=0;e<4*b.length;e++)d+=c.charAt(b[e>>2]>>e%4*8+4&15)+c.charAt(b[e>>2]>>e%4*8&15);return d},i=function(a){for(var c,d,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f="",g=0;g<4*a.length;g+=3)for(c=(a[g>>2]>>8*(g%4)&255)<<16|(a[g+1>>2]>>8*((g+1)%4)&255)<<8|a[g+2>>2]>>8*((g+2)%4)&255,d=0;4>d;d++)f+=8*g+6*d>32*a.length?b:e.charAt(c>>6*(3-d)&63);return f},j=function(a,b,c,f,g,h){return d(e(d(d(b,a),d(f,h)),g),c)},k=function(a,b,c,d,e,f,g){return j(b&c|~b&d,a,b,e,f,g)},l=function(a,b,c,d,e,f,g){return j(b&d|c&~d,a,b,e,f,g)},m=function(a,b,c,d,e,f,g){return j(b^c^d,a,b,e,f,g)},n=function(a,b,c,d,e,f,g){return j(c^(b|~d),a,b,e,f,g)},o=function(a,b){a[b>>5]|=128<<b%32,a[(b+64>>>9<<4)+14]=b;for(var c,e,f,g,h=1732584193,i=-271733879,j=-1732584194,o=271733878,p=0;p<a.length;p+=16)c=h,e=i,f=j,g=o,h=k(h,i,j,o,a[p+0],7,-680876936),o=k(o,h,i,j,a[p+1],12,-389564586),j=k(j,o,h,i,a[p+2],17,606105819),i=k(i,j,o,h,a[p+3],22,-1044525330),h=k(h,i,j,o,a[p+4],7,-176418897),o=k(o,h,i,j,a[p+5],12,1200080426),j=k(j,o,h,i,a[p+6],17,-1473231341),i=k(i,j,o,h,a[p+7],22,-45705983),h=k(h,i,j,o,a[p+8],7,1770035416),o=k(o,h,i,j,a[p+9],12,-1958414417),j=k(j,o,h,i,a[p+10],17,-42063),i=k(i,j,o,h,a[p+11],22,-1990404162),h=k(h,i,j,o,a[p+12],7,1804603682),o=k(o,h,i,j,a[p+13],12,-40341101),j=k(j,o,h,i,a[p+14],17,-1502002290),i=k(i,j,o,h,a[p+15],22,1236535329),h=l(h,i,j,o,a[p+1],5,-165796510),o=l(o,h,i,j,a[p+6],9,-1069501632),j=l(j,o,h,i,a[p+11],14,643717713),i=l(i,j,o,h,a[p+0],20,-373897302),h=l(h,i,j,o,a[p+5],5,-701558691),o=l(o,h,i,j,a[p+10],9,38016083),j=l(j,o,h,i,a[p+15],14,-660478335),i=l(i,j,o,h,a[p+4],20,-405537848),h=l(h,i,j,o,a[p+9],5,568446438),o=l(o,h,i,j,a[p+14],9,-1019803690),j=l(j,o,h,i,a[p+3],14,-187363961),i=l(i,j,o,h,a[p+8],20,1163531501),h=l(h,i,j,o,a[p+13],5,-1444681467),o=l(o,h,i,j,a[p+2],9,-51403784),j=l(j,o,h,i,a[p+7],14,1735328473),i=l(i,j,o,h,a[p+12],20,-1926607734),h=m(h,i,j,o,a[p+5],4,-378558),o=m(o,h,i,j,a[p+8],11,-2022574463),j=m(j,o,h,i,a[p+11],16,1839030562),i=m(i,j,o,h,a[p+14],23,-35309556),h=m(h,i,j,o,a[p+1],4,-1530992060),o=m(o,h,i,j,a[p+4],11,1272893353),j=m(j,o,h,i,a[p+7],16,-155497632),i=m(i,j,o,h,a[p+10],23,-1094730640),h=m(h,i,j,o,a[p+13],4,681279174),o=m(o,h,i,j,a[p+0],11,-358537222),j=m(j,o,h,i,a[p+3],16,-722521979),i=m(i,j,o,h,a[p+6],23,76029189),h=m(h,i,j,o,a[p+9],4,-640364487),o=m(o,h,i,j,a[p+12],11,-421815835),j=m(j,o,h,i,a[p+15],16,530742520),i=m(i,j,o,h,a[p+2],23,-995338651),h=n(h,i,j,o,a[p+0],6,-198630844),o=n(o,h,i,j,a[p+7],10,1126891415),j=n(j,o,h,i,a[p+14],15,-1416354905),i=n(i,j,o,h,a[p+5],21,-57434055),h=n(h,i,j,o,a[p+12],6,1700485571),o=n(o,h,i,j,a[p+3],10,-1894986606),j=n(j,o,h,i,a[p+10],15,-1051523),i=n(i,j,o,h,a[p+1],21,-2054922799),h=n(h,i,j,o,a[p+8],6,1873313359),o=n(o,h,i,j,a[p+15],10,-30611744),j=n(j,o,h,i,a[p+6],15,-1560198380),i=n(i,j,o,h,a[p+13],21,1309151649),h=n(h,i,j,o,a[p+4],6,-145523070),o=n(o,h,i,j,a[p+11],10,-1120210379),j=n(j,o,h,i,a[p+2],15,718787259),i=n(i,j,o,h,a[p+9],21,-343485551),h=d(h,c),i=d(i,e),j=d(j,f),o=d(o,g);return[h,i,j,o]},p=function(a,b){var d=f(a);d.length>16&&(d=o(d,a.length*c));for(var e=new Array(16),g=new Array(16),h=0;16>h;h++)e[h]=909522486^d[h],g[h]=1549556828^d[h];var i=o(e.concat(f(b)),512+b.length*c);return o(g.concat(i),640)},q={hexdigest:function(a){return h(o(f(a),a.length*c))},b64digest:function(a){return i(o(f(a),a.length*c))},hash:function(a){return g(o(f(a),a.length*c))},hmac_hexdigest:function(a,b){return h(p(a,b))},hmac_b64digest:function(a,b){return i(p(a,b))},hmac_hash:function(a,b){return g(p(a,b))},test:function(){return"900150983cd24fb0d6963f7d28e17f72"===MD5.hexdigest("abc")}};return q}();Function.prototype.bind||(Function.prototype.bind=function(a){var b=this,c=Array.prototype.slice,d=Array.prototype.concat,e=c.call(arguments,1);return function(){return b.apply(a?a:this,d.call(e,c.call(arguments,0)))}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),function(a){function b(a,b){return new f.Builder(a,b)}function c(a){return new f.Builder("message",a)}function d(a){return new f.Builder("iq",a)}function e(a){return new f.Builder("presence",a)}var f;f={VERSION:"9b3af57",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(a){for(var b=0;b<f.XHTML.tags.length;b++)if(a==f.XHTML.tags[b])return!0;return!1},validAttribute:function(a,b){if("undefined"!=typeof f.XHTML.attributes[a]&&f.XHTML.attributes[a].length>0)for(var c=0;c<f.XHTML.attributes[a].length;c++)if(b==f.XHTML.attributes[a][c])return!0;return!1},validCSS:function(a){for(var b=0;b<f.XHTML.css.length;b++)if(a==f.XHTML.css[b])return!0;return!1}},addNamespace:function(a,b){f.NS[a]=b},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,forEachChild:function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++)e=a.childNodes[d],e.nodeType!=f.ElementType.NORMAL||b&&!this.isTagEqual(e,b)||c(e)},isTagEqual:function(a,b){return a.tagName.toLowerCase()==b.toLowerCase()},_xmlGenerator:null,_makeGenerator:function(){var a;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(a=this._getIEXmlDom(),a.appendChild(a.createElement("strophe"))):a=document.implementation.createDocument("jabber:client","strophe",null),a},xmlGenerator:function(){return f._xmlGenerator||(f._xmlGenerator=f._makeGenerator()),f._xmlGenerator},_getIEXmlDom:function(){for(var a=null,b=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],c=0;c<b.length&&null===a;c++)try{a=new ActiveXObject(b[c])}catch(d){a=null}return a},xmlElement:function(a){if(!a)return null;var b,c,d,e=f.xmlGenerator().createElement(a);for(b=1;b<arguments.length;b++)if(arguments[b])if("string"==typeof arguments[b]||"number"==typeof arguments[b])e.appendChild(f.xmlTextNode(arguments[b]));else if("object"==typeof arguments[b]&&"function"==typeof arguments[b].sort)for(c=0;c<arguments[b].length;c++)"object"==typeof arguments[b][c]&&"function"==typeof arguments[b][c].sort&&e.setAttribute(arguments[b][c][0],arguments[b][c][1]);else if("object"==typeof arguments[b])for(d in arguments[b])arguments[b].hasOwnProperty(d)&&e.setAttribute(d,arguments[b][d]);return e},xmlescape:function(a){return a=a.replace(/\&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/'/g,"&apos;"),a=a.replace(/"/g,"&quot;")},xmlTextNode:function(a){return f.xmlGenerator().createTextNode(a)},xmlHtmlNode:function(a){return window.DOMParser?(parser=new DOMParser,node=parser.parseFromString(a,"text/xml")):(node=new ActiveXObject("Microsoft.XMLDOM"),node.async="false",node.loadXML(a)),node},getText:function(a){if(!a)return null;var b="";0===a.childNodes.length&&a.nodeType==f.ElementType.TEXT&&(b+=a.nodeValue);for(var c=0;c<a.childNodes.length;c++)a.childNodes[c].nodeType==f.ElementType.TEXT&&(b+=a.childNodes[c].nodeValue);return f.xmlescape(b)},copyElement:function(a){var b,c;if(a.nodeType==f.ElementType.NORMAL){for(c=f.xmlElement(a.tagName),b=0;b<a.attributes.length;b++)c.setAttribute(a.attributes[b].nodeName.toLowerCase(),a.attributes[b].value);for(b=0;b<a.childNodes.length;b++)c.appendChild(f.copyElement(a.childNodes[b]))}else a.nodeType==f.ElementType.TEXT&&(c=f.xmlGenerator().createTextNode(a.nodeValue));return c},createHtml:function(a){var b,c,d,e,g,h,i,j,k,l,m;if(a.nodeType==f.ElementType.NORMAL)if(e=a.nodeName.toLowerCase(),f.XHTML.validTag(e))try{for(c=f.xmlElement(e),b=0;b<f.XHTML.attributes[e].length;b++)if(g=f.XHTML.attributes[e][b],h=a.getAttribute(g),"undefined"!=typeof h&&null!==h&&""!==h&&h!==!1&&0!==h)if("style"==g&&"object"==typeof h&&"undefined"!=typeof h.cssText&&(h=h.cssText),"style"==g){for(i=[],j=h.split(";"),d=0;d<j.length;d++)k=j[d].split(":"),l=k[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),f.XHTML.validCSS(l)&&(m=k[1].replace(/^\s*/,"").replace(/\s*$/,""),i.push(l+": "+m));i.length>0&&(h=i.join("; "),c.setAttribute(g,h))}else c.setAttribute(g,h);for(b=0;b<a.childNodes.length;b++)c.appendChild(f.createHtml(a.childNodes[b]))}catch(n){c=f.xmlTextNode("")}else for(c=f.xmlGenerator().createDocumentFragment(),b=0;b<a.childNodes.length;b++)c.appendChild(f.createHtml(a.childNodes[b]));else if(a.nodeType==f.ElementType.FRAGMENT)for(c=f.xmlGenerator().createDocumentFragment(),b=0;b<a.childNodes.length;b++)c.appendChild(f.createHtml(a.childNodes[b]));else a.nodeType==f.ElementType.TEXT&&(c=f.xmlTextNode(a.nodeValue));return c},escapeNode:function(a){return a.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(a){return a.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(a){return a.indexOf("@")<0?null:a.split("@")[0]},getDomainFromJid:function(a){var b=f.getBareJidFromJid(a);if(b.indexOf("@")<0)return b;var c=b.split("@");return c.splice(0,1),c.join("@")},getResourceFromJid:function(a){var b=a.split("/");return b.length<2?null:(b.splice(0,1),b.join("/"))},getBareJidFromJid:function(a){return a?a.split("/")[0]:null},log:function(){},debug:function(a){this.log(this.LogLevel.DEBUG,a)},info:function(a){this.log(this.LogLevel.INFO,a)},warn:function(a){this.log(this.LogLevel.WARN,a)},error:function(a){this.log(this.LogLevel.ERROR,a)},fatal:function(a){this.log(this.LogLevel.FATAL,a)},serialize:function(a){var b;if(!a)return null;"function"==typeof a.tree&&(a=a.tree());var c,d,e=a.nodeName;for(a.getAttribute("_realname")&&(e=a.getAttribute("_realname")),b="<"+e,c=0;c<a.attributes.length;c++)"_realname"!=a.attributes[c].nodeName&&(b+=" "+a.attributes[c].nodeName.toLowerCase()+"='"+a.attributes[c].value.replace(/&/g,"&amp;").replace(/\'/g,"&apos;").replace(/>/g,"&gt;").replace(/</g,"&lt;")+"'");if(a.childNodes.length>0){for(b+=">",c=0;c<a.childNodes.length;c++)switch(d=a.childNodes[c],d.nodeType){case f.ElementType.NORMAL:b+=f.serialize(d);break;case f.ElementType.TEXT:b+=f.xmlescape(d.nodeValue);break;case f.ElementType.CDATA:b+="<![CDATA["+d.nodeValue+"]]>"}b+="</"+e+">"}else b+="/>";return b},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(a,b){f._connectionPlugins[a]=b}},f.Builder=function(a,b){("presence"==a||"message"==a||"iq"==a)&&(b&&!b.xmlns?b.xmlns=f.NS.CLIENT:b||(b={xmlns:f.NS.CLIENT})),this.nodeTree=f.xmlElement(a,b),this.node=this.nodeTree},f.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return f.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(a){for(var b in a)a.hasOwnProperty(b)&&this.node.setAttribute(b,a[b]);return this},c:function(a,b,c){var d=f.xmlElement(a,b,c);return this.node.appendChild(d),c||(this.node=d),this},cnode:function(a){var b=f.xmlGenerator();try{var c=void 0!==b.importNode}catch(d){var c=!1}var e=c?b.importNode(a,!0):f.copyElement(a);return this.node.appendChild(e),this.node=e,this},t:function(a){var b=f.xmlTextNode(a);return this.node.appendChild(b),this},h:function(a){var b=document.createElement("body");b.innerHTML=a;for(var c=f.createHtml(b);c.childNodes.length>0;)this.node.appendChild(c.childNodes[0]);return this}},f.Handler=function(a,b,c,d,e,g,h){this.handler=a,this.ns=b,this.name=c,this.type=d,this.id=e,this.options=h||{matchBare:!1},this.options.matchBare||(this.options.matchBare=!1),this.from=this.options.matchBare?g?f.getBareJidFromJid(g):null:g,this.user=!0},f.Handler.prototype={isMatch:function(a){var b,c=null;if(c=this.options.matchBare?f.getBareJidFromJid(a.getAttribute("from")):a.getAttribute("from"),b=!1,this.ns){var d=this;f.forEachChild(a,null,function(a){a.getAttribute("xmlns")==d.ns&&(b=!0)}),b=b||a.getAttribute("xmlns")==this.ns}else b=!0;return!b||this.name&&!f.isTagEqual(a,this.name)||this.type&&a.getAttribute("type")!=this.type||this.id&&a.getAttribute("id")!=this.id||this.from&&c!=this.from?!1:!0},run:function(a){var b=null;try{b=this.handler(a)}catch(c){throw c.sourceURL?f.fatal("error: "+this.handler+" "+c.sourceURL+":"+c.line+" - "+c.name+": "+c.message):c.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",c,c.message)),f.fatal("error: "+this.handler+" "+c.fileName+":"+c.lineNumber+" - "+c.name+": "+c.message)):f.fatal("error: "+c.message+"\n"+c.stack),c}return b},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},f.TimedHandler=function(a,b){this.period=a,this.handler=b,this.lastCalled=(new Date).getTime(),this.user=!0},f.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},f.Request=function(a,b,c,d){this.id=++f._requestId,this.xmlData=a,this.data=f.serialize(a),this.origFunc=b,this.func=b,this.rid=c,this.date=0/0,this.sends=d||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var a=new Date;return(a-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var a=new Date;return(a-this.dead)/1e3},this.xhr=this._newXHR()},f.Request.prototype={getResponse:function(){var a=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(a=this.xhr.responseXML.documentElement,"parsererror"==a.tagName)throw f.error("invalid response received"),f.error("responseText: "+this.xhr.responseText),f.error("responseXML: "+f.serialize(this.xhr.responseXML)),"parsererror"}else this.xhr.responseText&&(f.error("invalid response received"),f.error("responseText: "+this.xhr.responseText),f.error("responseXML: "+f.serialize(this.xhr.responseXML)));return a},_newXHR:function(){var a=null;return window.XMLHttpRequest?(a=new XMLHttpRequest,a.overrideMimeType&&a.overrideMimeType("text/xml")):window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLHTTP")),a.onreadystatechange=this.func.bind(null,this),a}},f.Connection=function(a){this.service=a,this.jid="",this.domain=null,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.streamId=null,this.features=null,this._sasl_data=[],this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this._idleTimeout=null,this._disconnectTimeout=null,this.do_authentication=!0,this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this.paused=!1,this.hold=1,this.wait=60,this.window=5,this._data=[],this._requests=[],this._uniqueId=Math.round(1e4*Math.random()),this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var b in f._connectionPlugins)if(f._connectionPlugins.hasOwnProperty(b)){var c=f._connectionPlugins[b],d=function(){};d.prototype=c,this[b]=new d,this[b].init(this)}},f.Connection.prototype={reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.streamId=null,this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this._requests=[],this._uniqueId=Math.round(1e4*Math.random())},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(a){return"string"==typeof a||"number"==typeof a?++this._uniqueId+":"+a:++this._uniqueId+""},connect:function(a,b,c,d,e,g){this.jid=a,this.pass=b,this.connect_callback=c,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.errors=0,this.wait=d||this.wait,this.hold=e||this.hold,this.domain=this.domain||f.getDomainFromJid(this.jid);var h=this._buildBody().attrs({to:this.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":f.NS.BOSH});g&&h.attrs({route:g}),this._changeConnectStatus(f.Status.CONNECTING,null);var i=this._connect_callback||this._connect_cb;this._connect_callback=null,this._requests.push(new f.Request(h.tree(),this._onRequestStateChange.bind(this,i.bind(this)),h.tree().getAttribute("rid"))),this._throttledRequestHandler()},attach:function(a,b,c,d,e,g,h){this.jid=a,this.sid=b,this.rid=c,this.connect_callback=d,this.domain=f.getDomainFromJid(this.jid),this.authenticated=!0,this.connected=!0,this.wait=e||this.wait,this.hold=g||this.hold,this.window=h||this.window,this._changeConnectStatus(f.Status.ATTACHED,null)
},xmlInput:function(){},xmlOutput:function(){},rawInput:function(){},rawOutput:function(){},send:function(a){if(null!==a){if("function"==typeof a.sort)for(var b=0;b<a.length;b++)this._queueData(a[b]);else this._queueData("function"==typeof a.tree?a.tree():a);this._throttledRequestHandler(),clearTimeout(this._idleTimeout),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(a,b,c,d){var e=null,f=this;"function"==typeof a.tree&&(a=a.tree());var g=a.getAttribute("id");g||(g=this.getUniqueId("sendIQ"),a.setAttribute("id",g));var h=this.addHandler(function(a){e&&f.deleteTimedHandler(e);var d=a.getAttribute("type");if("result"==d)b&&b(a);else{if("error"!=d)throw{name:"StropheError",message:"Got bad IQ type of "+d};c&&c(a)}},null,"iq",null,g);return d&&(e=this.addTimedHandler(d,function(){return f.deleteHandler(h),c&&c(null),!1})),this.send(a),g},_queueData:function(a){if(null===a||!a.tagName||!a.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(a)},_sendRestart:function(){this._data.push("restart"),this._throttledRequestHandler(),clearTimeout(this._idleTimeout),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(a,b){var c=new f.TimedHandler(a,b);return this.addTimeds.push(c),c},deleteTimedHandler:function(a){this.removeTimeds.push(a)},addHandler:function(a,b,c,d,e,g,h){var i=new f.Handler(a,b,c,d,e,g,h);return this.addHandlers.push(i),i},deleteHandler:function(a){this.removeHandlers.push(a)},disconnect:function(a){this._changeConnectStatus(f.Status.DISCONNECTING,a),f.info("Disconnect was called because: "+a),this.connected&&(this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._sendTerminate())},_changeConnectStatus:function(a,b){for(var c in f._connectionPlugins)if(f._connectionPlugins.hasOwnProperty(c)){var d=this[c];if(d.statusChanged)try{d.statusChanged(a,b)}catch(e){f.error(""+c+" plugin caused an exception changing status: "+e)}}if(this.connect_callback)try{this.connect_callback(a,b)}catch(g){f.error("User connection callback caused an exception: "+g)}},_buildBody:function(){var a=b("body",{rid:this.rid++,xmlns:f.NS.HTTPBIND});return null!==this.sid&&a.attrs({sid:this.sid}),a},_removeRequest:function(a){f.debug("removing request");var b;for(b=this._requests.length-1;b>=0;b--)a==this._requests[b]&&this._requests.splice(b,1);a.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(a){var b=this._requests[a];null===b.dead&&(b.dead=new Date),this._processRequest(a)},_processRequest:function(a){var b=this._requests[a],c=-1;try{4==b.xhr.readyState&&(c=b.xhr.status)}catch(d){f.error("caught an error in _requests["+a+"], reqStatus: "+c)}if("undefined"==typeof c&&(c=-1),b.sends>this.maxRetries)return void this._onDisconnectTimeout();var e=b.age(),g=!isNaN(e)&&e>Math.floor(f.TIMEOUT*this.wait),h=null!==b.dead&&b.timeDead()>Math.floor(f.SECONDARY_TIMEOUT*this.wait),i=4==b.xhr.readyState&&(1>c||c>=500);if((g||h||i)&&(h&&f.error("Request "+this._requests[a].id+" timed out (secondary), restarting"),b.abort=!0,b.xhr.abort(),b.xhr.onreadystatechange=function(){},this._requests[a]=new f.Request(b.xmlData,b.origFunc,b.rid,b.sends),b=this._requests[a]),0===b.xhr.readyState){f.debug("request id "+b.id+"."+b.sends+" posting");try{b.xhr.open("POST",this.service,!0)}catch(j){return f.error("XHR open failed."),this.connected||this._changeConnectStatus(f.Status.CONNFAIL,"bad-service"),void this.disconnect()}var k=function(){b.date=new Date,b.xhr.send(b.data)};if(b.sends>1){var l=1e3*Math.min(Math.floor(f.TIMEOUT*this.wait),Math.pow(b.sends,3));setTimeout(k,l)}else k();b.sends++,this.xmlOutput!==f.Connection.prototype.xmlOutput&&this.xmlOutput(b.xmlData),this.rawOutput!==f.Connection.prototype.rawOutput&&this.rawOutput(b.data)}else f.debug("_processRequest: "+(0===a?"first":"second")+" request has readyState of "+b.xhr.readyState)},_throttledRequestHandler:function(){f.debug(this._requests?"_throttledRequestHandler called with "+this._requests.length+" requests":"_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))},_onRequestStateChange:function(a,b){if(f.debug("request id "+b.id+"."+b.sends+" state changed to "+b.xhr.readyState),b.abort)return void(b.abort=!1);var c;if(4==b.xhr.readyState){c=0;try{c=b.xhr.status}catch(d){}if("undefined"==typeof c&&(c=0),this.disconnecting&&c>=400)return void this._hitError(c);var e=this._requests[0]==b,g=this._requests[1]==b;(c>0&&500>c||b.sends>5)&&(this._removeRequest(b),f.debug("request id "+b.id+" should now be removed")),200==c?((g||e&&this._requests.length>0&&this._requests[0].age()>Math.floor(f.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),f.debug("request id "+b.id+"."+b.sends+" got 200"),a(b),this.errors=0):(f.error("request id "+b.id+"."+b.sends+" error "+c+" happened"),(0===c||c>=400&&600>c||c>=12e3)&&(this._hitError(c),c>=400&&500>c&&(this._changeConnectStatus(f.Status.DISCONNECTING,null),this._doDisconnect()))),c>0&&500>c||b.sends>5||this._throttledRequestHandler()}},_hitError:function(a){this.errors++,f.warn("request errored, status: "+a+", number of errors: "+this.errors),this.errors>4&&this._onDisconnectTimeout()},_doDisconnect:function(){f.info("_doDisconnect was called"),this.authenticated=!1,this.disconnecting=!1,this.sid=null,this.streamId=null,this.rid=Math.floor(4294967295*Math.random()),this.connected&&(this._changeConnectStatus(f.Status.DISCONNECTED,null),this.connected=!1),this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[]},_dataRecv:function(a){try{var b=a.getResponse()}catch(c){if("parsererror"!=c)throw c;this.disconnect("strophe-parsererror")}if(null!==b){this.xmlInput!==f.Connection.prototype.xmlInput&&this.xmlInput(b),this.rawInput!==f.Connection.prototype.rawInput&&this.rawInput(f.serialize(b));for(var d,e;this.removeHandlers.length>0;)e=this.removeHandlers.pop(),d=this.handlers.indexOf(e),d>=0&&this.handlers.splice(d,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&0===this._requests.length)return this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null,void this._doDisconnect();var g,h,i=b.getAttribute("type");if(null!==i&&"terminate"==i){if(this.disconnecting)return;return g=b.getAttribute("condition"),h=b.getElementsByTagName("conflict"),null!==g?("remote-stream-error"==g&&h.length>0&&(g="conflict"),this._changeConnectStatus(f.Status.CONNFAIL,g)):this._changeConnectStatus(f.Status.CONNFAIL,"unknown"),void this.disconnect()}var j=this;f.forEachChild(b,null,function(a){var b,c;for(c=j.handlers,j.handlers=[],b=0;b<c.length;b++){var d=c[b];try{!d.isMatch(a)||!j.authenticated&&d.user?j.handlers.push(d):d.run(a)&&j.handlers.push(d)}catch(e){}}})}},_sendTerminate:function(){f.info("_sendTerminate was called");var a=this._buildBody().attrs({type:"terminate"});this.authenticated&&a.c("presence",{xmlns:f.NS.CLIENT,type:"unavailable"}),this.disconnecting=!0;var b=new f.Request(a.tree(),this._onRequestStateChange.bind(this,this._dataRecv.bind(this)),a.tree().getAttribute("rid"));this._requests.push(b),this._throttledRequestHandler()},_connect_cb:function(a,b){f.info("_connect_cb was called"),this.connected=!0;var c=a.getResponse();if(c){this.xmlInput!==f.Connection.prototype.xmlInput&&this.xmlInput(c),this.rawInput!==f.Connection.prototype.rawInput&&this.rawInput(f.serialize(c));var d,e,g=c.getAttribute("type");if(null!==g&&"terminate"==g)return d=c.getAttribute("condition"),e=c.getElementsByTagName("conflict"),void(null!==d?("remote-stream-error"==d&&e.length>0&&(d="conflict"),this._changeConnectStatus(f.Status.CONNFAIL,d)):this._changeConnectStatus(f.Status.CONNFAIL,"unknown"));this.sid||(this.sid=c.getAttribute("sid")),this.stream_id||(this.stream_id=c.getAttribute("authid"));var h=c.getAttribute("requests");h&&(this.window=parseInt(h,10));var i=c.getAttribute("hold");i&&(this.hold=parseInt(i,10));var j=c.getAttribute("wait");j&&(this.wait=parseInt(j,10)),this._authentication.sasl_scram_sha1=!1,this._authentication.sasl_plain=!1,this._authentication.sasl_digest_md5=!1,this._authentication.sasl_anonymous=!1,this._authentication.legacy_auth=!1;var k=c.getElementsByTagName("stream:features").length>0;k||(k=c.getElementsByTagName("features").length>0);var l,m,n=c.getElementsByTagName("mechanism"),o=!1;if(k&&n.length>0){var p=0;for(l=0;l<n.length;l++)m=f.getText(n[l]),"SCRAM-SHA-1"==m?this._authentication.sasl_scram_sha1=!0:"DIGEST-MD5"==m?this._authentication.sasl_digest_md5=!0:"PLAIN"==m?this._authentication.sasl_plain=!0:"ANONYMOUS"==m?this._authentication.sasl_anonymous=!0:p++;this._authentication.legacy_auth=c.getElementsByTagName("auth").length>0,o=this._authentication.legacy_auth||p<n.length}if(!o){b=b||this._connect_cb;var q=this._buildBody();return this._requests.push(new f.Request(q.tree(),this._onRequestStateChange.bind(this,b.bind(this)),q.tree().getAttribute("rid"))),void this._throttledRequestHandler()}this.do_authentication!==!1&&this.authenticate()}},authenticate:function(){if(null===f.getNodeFromJid(this.jid)&&this._authentication.sasl_anonymous)this._changeConnectStatus(f.Status.AUTHENTICATING,null),this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(b("auth",{xmlns:f.NS.SASL,mechanism:"ANONYMOUS"}).tree());else if(null===f.getNodeFromJid(this.jid))this._changeConnectStatus(f.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect();else if(this._authentication.sasl_scram_sha1){var a=MD5.hexdigest(1234567890*Math.random()),c="n="+f.getNodeFromJid(this.jid);c+=",r=",c+=a,this._sasl_data.cnonce=a,this._sasl_data["client-first-message-bare"]=c,c="n,,"+c,this._changeConnectStatus(f.Status.AUTHENTICATING,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_scram_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(b("auth",{xmlns:f.NS.SASL,mechanism:"SCRAM-SHA-1"}).t(Base64.encode(c)).tree())}else this._authentication.sasl_digest_md5?(this._changeConnectStatus(f.Status.AUTHENTICATING,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_digest_challenge1_cb.bind(this),null,"challenge",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(b("auth",{xmlns:f.NS.SASL,mechanism:"DIGEST-MD5"}).tree())):this._authentication.sasl_plain?(c=f.getBareJidFromJid(this.jid),c+="\x00",c+=f.getNodeFromJid(this.jid),c+="\x00",c+=this.pass,this._changeConnectStatus(f.Status.AUTHENTICATING,null),this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),hashed_auth_str=Base64.encode(c),this.send(b("auth",{xmlns:f.NS.SASL,mechanism:"PLAIN"}).t(hashed_auth_str).tree())):(this._changeConnectStatus(f.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(d({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:f.NS.AUTH}).c("username",{}).t(f.getNodeFromJid(this.jid)).tree()))},_sasl_digest_challenge1_cb:function(a){var c,d=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,e=Base64.decode(f.getText(a)),g=MD5.hexdigest(""+1234567890*Math.random()),h="",i=null,j="",k="";for(this.deleteHandler(this._sasl_failure_handler);e.match(d);)switch(c=e.match(d),e=e.replace(c[0],""),c[2]=c[2].replace(/^"(.+)"$/,"$1"),c[1]){case"realm":h=c[2];break;case"nonce":j=c[2];break;case"qop":k=c[2];break;case"host":i=c[2]}var l="xmpp/"+this.domain;null!==i&&(l=l+"/"+i);var m=MD5.hash(f.getNodeFromJid(this.jid)+":"+h+":"+this.pass)+":"+j+":"+g,n="AUTHENTICATE:"+l,o="";return o+="username="+this._quote(f.getNodeFromJid(this.jid))+",",o+="realm="+this._quote(h)+",",o+="nonce="+this._quote(j)+",",o+="cnonce="+this._quote(g)+",",o+='nc="00000001",',o+='qop="auth",',o+="digest-uri="+this._quote(l)+",",o+="response="+this._quote(MD5.hexdigest(MD5.hexdigest(m)+":"+j+":00000001:"+g+":auth:"+MD5.hexdigest(n)))+",",o+='charset="utf-8"',this._sasl_challenge_handler=this._addSysHandler(this._sasl_digest_challenge2_cb.bind(this),null,"challenge",null,null),this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(b("response",{xmlns:f.NS.SASL}).t(Base64.encode(o)).tree()),!1},_quote:function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},_sasl_digest_challenge2_cb:function(){return this.deleteHandler(this._sasl_success_handler),this.deleteHandler(this._sasl_failure_handler),this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(b("response",{xmlns:f.NS.SASL}).tree()),!1},_sasl_scram_challenge_cb:function(a){var c,d,e,g,h,j,l,m,n,o="c=biws,",p=Base64.decode(f.getText(a)),q=this._sasl_data["client-first-message-bare"]+","+p+",",r=this._sasl_data.cnonce,s=/([a-z]+)=([^,]+)(,|$)/;for(this.deleteHandler(this._sasl_failure_handler);p.match(s);)switch(matches=p.match(s),p=p.replace(matches[0],""),matches[1]){case"r":c=matches[2];break;case"s":d=matches[2];break;case"i":e=matches[2]}if(c.substr(0,r.length)!==r)return this._sasl_data=[],this._sasl_failure_cb(null);for(o+="r="+c,q+=o,d=Base64.decode(d),d+="\x00\x00\x00",g=j=core_hmac_sha1(this.pass,d),i=1;e>i;i++){for(h=core_hmac_sha1(this.pass,binb2str(j)),k=0;5>k;k++)g[k]^=h[k];j=h}for(g=binb2str(g),l=core_hmac_sha1(g,"Client Key"),m=str_hmac_sha1(g,"Server Key"),n=core_hmac_sha1(str_sha1(binb2str(l)),q),this._sasl_data["server-signature"]=b64_hmac_sha1(m,q),k=0;5>k;k++)l[k]^=n[k];return o+=",p="+Base64.encode(binb2str(l)),this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this.send(b("response",{xmlns:f.NS.SASL}).t(Base64.encode(o)).tree()),!1},_auth1_cb:function(){var a=d({type:"set",id:"_auth_2"}).c("query",{xmlns:f.NS.AUTH}).c("username",{}).t(f.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return f.getResourceFromJid(this.jid)||(this.jid=f.getBareJidFromJid(this.jid)+"/strophe"),a.up().c("resource",{}).t(f.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(a.tree()),!1},_sasl_success_cb:function(a){if(this._sasl_data["server-signature"]){var b,c=Base64.decode(f.getText(a)),d=/([a-z]+)=([^,]+)(,|$)/;if(matches=c.match(d),"v"==matches[1]&&(b=matches[2]),b!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data=[],this._sasl_failure_cb(null)}return f.info("SASL authentication succeeded."),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null),this._sendRestart(),!1},_sasl_auth1_cb:function(a){this.features=a;var b,c;for(b=0;b<a.childNodes.length;b++)c=a.childNodes[b],"bind"==c.nodeName&&(this.do_bind=!0),"session"==c.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(f.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var e=f.getResourceFromJid(this.jid);return this.send(e?d({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:f.NS.BIND}).c("resource",{}).t(e).tree():d({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:f.NS.BIND}).tree()),!1},_sasl_bind_cb:function(a){if("error"==a.getAttribute("type")){f.info("SASL binding failed.");var b,c=a.getElementsByTagName("conflict");return c.length>0&&(b="conflict"),this._changeConnectStatus(f.Status.AUTHFAIL,b),!1}var e,g=a.getElementsByTagName("bind");return g.length>0?(e=g[0].getElementsByTagName("jid"),void(e.length>0&&(this.jid=f.getText(e[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(d({type:"set",id:"_session_auth_2"}).c("session",{xmlns:f.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,null))))):(f.info("SASL binding failed."),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(a){if("result"==a.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,null);else if("error"==a.getAttribute("type"))return f.info("Session creation failed."),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1},_auth2_cb:function(a){return"result"==a.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,null)):"error"==a.getAttribute("type")&&(this._changeConnectStatus(f.Status.AUTHFAIL,null),this.disconnect()),!1},_addSysTimedHandler:function(a,b){var c=new f.TimedHandler(a,b);return c.user=!1,this.addTimeds.push(c),c},_addSysHandler:function(a,b,c,d,e){var g=new f.Handler(a,b,c,d,e);return g.user=!1,this.addHandlers.push(g),g},_onDisconnectTimeout:function(){f.info("_onDisconnectTimeout was called");for(var a;this._requests.length>0;)a=this._requests.pop(),a.abort=!0,a.xhr.abort(),a.xhr.onreadystatechange=function(){};return this._doDisconnect(),!1},_onIdle:function(){for(var a,b,c,d;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)b=this.removeTimeds.pop(),a=this.timedHandlers.indexOf(b),a>=0&&this.timedHandlers.splice(a,1);var e=(new Date).getTime();for(d=[],a=0;a<this.timedHandlers.length;a++)b=this.timedHandlers[a],(this.authenticated||!b.user)&&(c=b.lastCalled+b.period,0>=c-e?b.run()&&d.push(b):d.push(b));this.timedHandlers=d;var g,h;if(this.authenticated&&0===this._requests.length&&0===this._data.length&&!this.disconnecting&&(f.info("no requests during idle cycle, sending blank request"),this._data.push(null)),this._requests.length<2&&this._data.length>0&&!this.paused){for(g=this._buildBody(),a=0;a<this._data.length;a++)null!==this._data[a]&&("restart"===this._data[a]?g.attrs({to:this.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":f.NS.BOSH}):g.cnode(this._data[a]).up());delete this._data,this._data=[],this._requests.push(new f.Request(g.tree(),this._onRequestStateChange.bind(this,this._dataRecv.bind(this)),g.tree().getAttribute("rid"))),this._processRequest(this._requests.length-1)}this._requests.length>0&&(h=this._requests[0].age(),null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(f.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),h>Math.floor(f.TIMEOUT*this.wait)&&(f.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(f.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())),clearTimeout(this._idleTimeout),this.connected&&(this._idleTimeout=setTimeout(this._onIdle.bind(this),100))}},a&&a(f,b,c,d,e)}(function(){window.Strophe=arguments[0],window.$build=arguments[1],window.$msg=arguments[2],window.$iq=arguments[3],window.$pres=arguments[4]}),Strophe.addConnectionPlugin("roster",{_connection:null,_callbacks:[],items:[],ver:null,init:function(a){this._connection=a,this.items=[];var b,c=this,d=a.connect,e=a.attach,f=function(d){if(d==Strophe.Status.ATTACHED||d==Strophe.Status.CONNECTED)try{a.addHandler(c._onReceivePresence.bind(c),null,"presence",null,null,null),a.addHandler(c._onReceiveIQ.bind(c),Strophe.NS.ROSTER,"iq","set",null,null)}catch(e){Strophe.error(e)}null!==b&&b.apply(this,arguments)};a.connect=function(c,e,g){b=g,"undefined"==typeof arguments[0]&&(arguments[0]=null),"undefined"==typeof arguments[1]&&(arguments[1]=null),arguments[2]=f,d.apply(a,arguments)},a.attach=function(c,d,g,h){b=h,"undefined"==typeof arguments[0]&&(arguments[0]=null),"undefined"==typeof arguments[1]&&(arguments[1]=null),"undefined"==typeof arguments[2]&&(arguments[2]=null),arguments[3]=f,e.apply(a,arguments)},Strophe.addNamespace("ROSTER_VER","urn:xmpp:features:rosterver"),Strophe.addNamespace("NICK","http://jabber.org/protocol/nick")},supportVersioning:function(){return this._connection.features&&this._connection.features.getElementsByTagName("ver").length>0},get:function(a,b,c){var d={xmlns:Strophe.NS.ROSTER};this.items=[],this.supportVersioning()&&(d.ver=b||"",this.items=c||[]);var e=$iq({type:"get",id:this._connection.getUniqueId("roster")}).c("query",d);return this._connection.sendIQ(e,this._onReceiveRosterSuccess.bind(this,a),this._onReceiveRosterError.bind(this,a))},registerCallback:function(a){this._callbacks.push(a)},findItem:function(a){for(var b=0;b<this.items.length;b++)if(this.items[b]&&this.items[b].jid==a)return this.items[b];return!1},removeItem:function(a){for(var b=0;b<this.items.length;b++)if(this.items[b]&&this.items[b].jid==a)return this.items.splice(b,1),!0;return!1},subscribe:function(a,b,c){var d=$pres({to:a,type:"subscribe"});b&&""!==b&&d.c("status").t(b),c&&""!==c&&d.c("nick",{xmlns:Strophe.NS.NICK}).t(c),this._connection.send(d)},unsubscribe:function(a,b){var c=$pres({to:a,type:"unsubscribe"});b&&""!=b&&c.c("status").t(b),this._connection.send(c)},authorize:function(a,b){var c=$pres({to:a,type:"subscribed"});b&&""!=b&&c.c("status").t(b),this._connection.send(c)},unauthorize:function(a,b){var c=$pres({to:a,type:"unsubscribed"});b&&""!=b&&c.c("status").t(b),this._connection.send(c)},add:function(a,b,c,d){for(var e=$iq({type:"set"}).c("query",{xmlns:Strophe.NS.ROSTER}).c("item",{jid:a,name:b}),f=0;f<c.length;f++)e.c("group").t(c[f]).up();this._connection.sendIQ(e,d,d)},update:function(a,b,c,d){var e=this.findItem(a);if(!e)throw"item not found";for(var f=b||e.name,g=c||e.groups,h=$iq({type:"set"}).c("query",{xmlns:Strophe.NS.ROSTER}).c("item",{jid:e.jid,name:f}),i=0;i<g.length;i++)h.c("group").t(g[i]).up();return this._connection.sendIQ(h,d,d)},remove:function(a,b){var c=this.findItem(a);if(!c)throw"item not found";var d=$iq({type:"set"}).c("query",{xmlns:Strophe.NS.ROSTER}).c("item",{jid:c.jid,subscription:"remove"});this._connection.sendIQ(d,b,b)},_onReceiveRosterSuccess:function(a,b){this._updateItems(b),a(this.items)},_onReceiveRosterError:function(a){a(this.items)},_onReceivePresence:function(a){var b=a.getAttribute("from"),c=Strophe.getBareJidFromJid(b),d=this.findItem(c);if(!d)return!0;var e=a.getAttribute("type");if("unavailable"==e)delete d.resources[Strophe.getResourceFromJid(b)];else{if(e)return!0;d.resources[Strophe.getResourceFromJid(b)]={show:0!=a.getElementsByTagName("show").length?Strophe.getText(a.getElementsByTagName("show")[0]):"",status:0!=a.getElementsByTagName("status").length?Strophe.getText(a.getElementsByTagName("status")[0]):"",priority:0!=a.getElementsByTagName("priority").length?Strophe.getText(a.getElementsByTagName("priority")[0]):""}}return this._call_backs(this.items,d),!0},_call_backs:function(a,b){for(var c=0;c<this._callbacks.length;c++)this._callbacks[c](a,b)},_onReceiveIQ:function(a){var b=a.getAttribute("id"),c=a.getAttribute("from");if(c&&""!=c&&c!=this._connection.jid&&c!=Strophe.getBareJidFromJid(this._connection.jid))return!0;var d=$iq({type:"result",id:b,from:this._connection.jid});return this._connection.send(d),this._updateItems(a),!0},_updateItems:function(a){var b=a.getElementsByTagName("query");if(0!=b.length){this.ver=b.item(0).getAttribute("ver");var c=this;Strophe.forEachChild(b.item(0),"item",function(a){c._updateItem(a)})}this._call_backs(this.items)},_updateItem:function(a){var b=a.getAttribute("jid"),c=a.getAttribute("name"),d=a.getAttribute("subscription"),e=a.getAttribute("ask"),f=[];if(Strophe.forEachChild(a,"group",function(a){f.push(Strophe.getText(a))}),"remove"==d)return void this.removeItem(b);var a=this.findItem(b);a?(a.name=c,a.subscription=d,a.ask=e,a.groups=f):this.items.push({name:c,jid:b,subscription:d,ask:e,groups:f,resources:{}})}}),function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}};Strophe.addConnectionPlugin("muc",{_connection:null,rooms:{},roomNames:[],init:function(a){return this._connection=a,this._muc_handler=null,Strophe.addNamespace("MUC_OWNER",Strophe.NS.MUC+"#owner"),Strophe.addNamespace("MUC_ADMIN",Strophe.NS.MUC+"#admin"),Strophe.addNamespace("MUC_USER",Strophe.NS.MUC+"#user"),Strophe.addNamespace("MUC_ROOMCONF",Strophe.NS.MUC+"#roomconfig")},join:function(a,b,d,e,f,g,h){var i,j,k=this;return j=this.test_append_nick(a,b),i=$pres({from:this._connection.jid,to:j}).c("x",{xmlns:Strophe.NS.MUC}),null!=h&&(i=i.c("history",h).up),null!=g&&i.cnode(Strophe.xmlElement("password",[],g)),"undefined"!=typeof extended_presence&&null!==extended_presence&&i.up.cnode(extended_presence),null==this._muc_handler&&(this._muc_handler=this._connection.addHandler(function(b){var c,d,e,f,g,h,i,j,l,m;if(c=b.getAttribute("from"),!c)return!0;if(g=c.split("/")[0],!k.rooms[g])return!0;if(a=k.rooms[g],e={},"message"===b.nodeName)e=a._message_handlers;else if("presence"===b.nodeName&&(j=b.getElementsByTagName("x"),j.length>0))for(l=0,m=j.length;m>l;l++)if(h=j[l],i=h.getAttribute("xmlns"),i&&i.match(Strophe.NS.MUC)){e=a._presence_handlers;break}for(f in e)d=e[f],d(b,a)||delete e[f];return!0})),this.rooms.hasOwnProperty(a)||(this.rooms[a]=new c(this,a,b,g),this.roomNames.push(a)),e&&this.rooms[a].addHandler("presence",e),d&&this.rooms[a].addHandler("message",d),f&&this.rooms[a].addHandler("roster",f),this._connection.send(i)},leave:function(a,b,c,d){var e,f,g,h;return e=this.roomNames.indexOf(a),delete this.rooms[a],e>=0&&(this.roomNames.splice(e,1),0===this.roomNames.length&&(this._connection.deleteHandler(this._muc_handler),this._muc_handler=null)),h=this.test_append_nick(a,b),g=this._connection.getUniqueId(),f=$pres({type:"unavailable",id:g,from:this._connection.jid,to:h}),null!=d&&f.c("status",d),null!=c&&this._connection.addHandler(c,null,"presence",null,g),this._connection.send(f),g},message:function(a,b,c,d,e){var f,g,h,i;return i=this.test_append_nick(a,b),e=e||(null!=b?"chat":"groupchat"),g=this._connection.getUniqueId(),f=$msg({to:i,from:this._connection.jid,type:e,id:g}).c("body",{xmlns:Strophe.NS.CLIENT}).t(c),f.up(),null!=d&&(f.c("html",{xmlns:Strophe.NS.XHTML_IM}).c("body",{xmlns:Strophe.NS.XHTML}).t(d),0===f.node.childNodes.length?(h=f.node.parentNode,f.up().up(),f.node.removeChild(h)):f.up().up()),f.c("x",{xmlns:"jabber:x:event"}).c("composing"),this._connection.send(f),g},groupchat:function(a,b,c){return this.message(a,null,b,c)},invite:function(a,b,c){var d,e;return e=this._connection.getUniqueId(),d=$msg({from:this._connection.jid,to:a,id:e}).c("x",{xmlns:Strophe.NS.MUC_USER}).c("invite",{to:b}),null!=c&&d.c("reason",c),this._connection.send(d),e},directInvite:function(a,b,c,d){var e,f,g;return g=this._connection.getUniqueId(),e={xmlns:"jabber:x:conference",jid:a},null!=c&&(e.reason=c),null!=d&&(e.password=d),f=$msg({from:this._connection.jid,to:b,id:g}).c("x",e),this._connection.send(f),g},queryOccupants:function(a,b,c){var d,e;return d={xmlns:Strophe.NS.DISCO_ITEMS},e=$iq({from:this._connection.jid,to:a,type:"get"}).c("query",d),this._connection.sendIQ(e,b,c)},configure:function(a,b,c){var d,e;return d=$iq({to:a,type:"get"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}),e=d.tree(),this._connection.sendIQ(e,b,c)},cancelConfigure:function(a){var b,c;return b=$iq({to:a,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"cancel"}),c=b.tree(),this._connection.sendIQ(c)},saveConfiguration:function(a,b,c,d){var e,f,g,h,i;if(f=$iq({to:a,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}),"undefined"!=typeof Form&&b instanceof Form)b.type="submit",f.cnode(b.toXML());else for(f.c("x",{xmlns:"jabber:x:data",type:"submit"}),h=0,i=b.length;i>h;h++)e=b[h],f.cnode(e).up();return g=f.tree(),this._connection.sendIQ(g,c,d)},createInstantRoom:function(a,b,c){var d;return d=$iq({to:a,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"}),this._connection.sendIQ(d.tree(),b,c)},setTopic:function(a,b){var c;return c=$msg({to:a,from:this._connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(b),this._connection.send(c.tree())},_modifyPrivilege:function(a,b,c,d,e){var f;return f=$iq({to:a,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_ADMIN}).cnode(b.node),null!=c&&f.c("reason",c),this._connection.sendIQ(f.tree(),d,e)},modifyRole:function(a,b,c,d,e,f){var g;return g=$build("item",{nick:b,role:c}),this._modifyPrivilege(a,g,d,e,f)},kick:function(a,b,c,d,e){return this.modifyRole(a,b,"none",c,d,e)},voice:function(a,b,c,d,e){return this.modifyRole(a,b,"participant",c,d,e)},mute:function(a,b,c,d,e){return this.modifyRole(a,b,"visitor",c,d,e)},op:function(a,b,c,d,e){return this.modifyRole(a,b,"moderator",c,d,e)},deop:function(a,b,c,d,e){return this.modifyRole(a,b,"participant",c,d,e)},modifyAffiliation:function(a,b,c,d,e,f){var g;return g=$build("item",{jid:b,affiliation:c}),this._modifyPrivilege(a,g,d,e,f)},ban:function(a,b,c,d,e){return this.modifyAffiliation(a,b,"outcast",c,d,e)},member:function(a,b,c,d,e){return this.modifyAffiliation(a,b,"member",c,d,e)},revoke:function(a,b,c,d,e){return this.modifyAffiliation(a,b,"none",c,d,e)},owner:function(a,b,c,d,e){return this.modifyAffiliation(a,b,"owner",c,d,e)},admin:function(a,b,c,d,e){return this.modifyAffiliation(a,b,"admin",c,d,e)},changeNick:function(a,b){var c,d;return d=this.test_append_nick(a,b),c=$pres({from:this._connection.jid,to:d,id:this._connection.getUniqueId()}),this._connection.send(c.tree())},setStatus:function(a,b,c,d){var e,f;return f=this.test_append_nick(a,b),e=$pres({from:this._connection.jid,to:f}),null!=c&&e.c("show",c).up(),null!=d&&e.c("status",d),this._connection.send(e.tree())},listRooms:function(a,b,c){var d;return d=$iq({to:a,from:this._connection.jid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS}),this._connection.sendIQ(d,b,c)},test_append_nick:function(a,b){return a+(null!=b?"/"+Strophe.escapeNode(b):"")}}),c=function(){function b(a,b,c,e){this.client=a,this.name=b,this.nick=c,this.password=e,this._roomRosterHandler=d(this._roomRosterHandler,this),this._addOccupant=d(this._addOccupant,this),this.roster={},this._message_handlers={},this._presence_handlers={},this._roster_handlers={},this._handler_ids=0,a.muc&&(this.client=a.muc),this.name=Strophe.getBareJidFromJid(b),this.addHandler("presence",this._roomRosterHandler)}return b.prototype.join=function(a,b,c){return this.client.join(this.name,this.nick,a,b,c,this.password)},b.prototype.leave=function(a,b){return this.client.leave(this.name,this.nick,a,b),delete this.client.rooms[this.name]},b.prototype.message=function(a,b,c,d){return this.client.message(this.name,a,b,c,d)},b.prototype.groupchat=function(a,b){return this.client.groupchat(this.name,a,b)},b.prototype.invite=function(a,b){return this.client.invite(this.name,a,b)
},b.prototype.directInvite=function(a,b){return this.client.directInvite(this.name,a,b,this.password)},b.prototype.configure=function(a){return this.client.configure(this.name,a)},b.prototype.cancelConfigure=function(){return this.client.cancelConfigure(this.name)},b.prototype.saveConfiguration=function(a){return this.client.saveConfiguration(this.name,a)},b.prototype.queryOccupants=function(a,b){return this.client.queryOccupants(this.name,a,b)},b.prototype.setTopic=function(a){return this.client.setTopic(this.name,a)},b.prototype.modifyRole=function(a,b,c,d,e){return this.client.modifyRole(this.name,a,b,c,d,e)},b.prototype.kick=function(a,b,c,d){return this.client.kick(this.name,a,b,c,d)},b.prototype.voice=function(a,b,c,d){return this.client.voice(this.name,a,b,c,d)},b.prototype.mute=function(a,b,c,d){return this.client.mute(this.name,a,b,c,d)},b.prototype.op=function(a,b,c,d){return this.client.op(this.name,a,b,c,d)},b.prototype.deop=function(a,b,c,d){return this.client.deop(this.name,a,b,c,d)},b.prototype.modifyAffiliation=function(a,b,c,d,e){return this.client.modifyAffiliation(this.name,a,b,c,d,e)},b.prototype.ban=function(a,b,c,d){return this.client.ban(this.name,a,b,c,d)},b.prototype.member=function(a,b,c,d){return this.client.member(this.name,a,b,c,d)},b.prototype.revoke=function(a,b,c,d){return this.client.revoke(this.name,a,b,c,d)},b.prototype.owner=function(a,b,c,d){return this.client.owner(this.name,a,b,c,d)},b.prototype.admin=function(a,b,c,d){return this.client.admin(this.name,a,b,c,d)},b.prototype.changeNick=function(a){return this.nick=a,this.client.changeNick(this.name,a)},b.prototype.setStatus=function(a,b){return this.client.setStatus(this.name,this.nick,a,b)},b.prototype.addHandler=function(a,b){var c;switch(c=this._handler_ids++,a){case"presence":this._presence_handlers[c]=b;break;case"message":this._message_handlers[c]=b;break;case"roster":this._roster_handlers[c]=b;break;default:return this._handler_ids--,null}return c},b.prototype.removeHandler=function(a){return delete this._presence_handlers[a],delete this._message_handlers[a],delete this._roster_handlers[a]},b.prototype._addOccupant=function(b){var c;return c=new a(b,this),this.roster[c.nick]=c,c},b.prototype._roomRosterHandler=function(a){var c,d,e,f,g,h;switch(c=b._parsePresence(a),g=c.nick,f=c.newnick||null,c.type){case"error":return;case"unavailable":f&&(c.nick=f,this.roster[g]&&this.roster[f]&&(this.roster[g].update(this.roster[f]),this.roster[f]=this.roster[g]),this.roster[g]&&!this.roster[f]&&(this.roster[f]=this.roster[g].update(c))),delete this.roster[g];break;default:this.roster[g]?this.roster[g].update(c):this._addOccupant(c)}h=this._roster_handlers;for(e in h)d=h[e],d(this.roster,this)||delete this._roster_handlers[e];return!0},b._parsePresence=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(e={},b=a.attributes,e.nick=Strophe.getResourceFromJid(b.from.textContent),e.type=(null!=(j=b.type)?j.textContent:void 0)||null,e.states=[],k=a.childNodes,f=0,h=k.length;h>f;f++)switch(c=k[f],c.nodeName){case"status":e.status=c.textContent||null;break;case"show":e.show=c.textContent||null;break;case"x":if(b=c.attributes,(null!=(l=b.xmlns)?l.textContent:void 0)===Strophe.NS.MUC_USER)for(m=c.childNodes,g=0,i=m.length;i>g;g++)switch(d=m[g],d.nodeName){case"item":b=d.attributes,e.affiliation=(null!=(n=b.affiliation)?n.textContent:void 0)||null,e.role=(null!=(o=b.role)?o.textContent:void 0)||null,e.jid=(null!=(p=b.jid)?p.textContent:void 0)||null,e.newnick=(null!=(q=b.nick)?q.textContent:void 0)||null;break;case"status":d.attributes.code&&e.states.push(d.attributes.code.textContent)}}return e},b}(),b=function(){function a(a){this.parse=d(this.parse,this),null!=a&&this.parse(a)}return a.prototype.parse=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;for(g=a.getElementsByTagName("query")[0].childNodes,this.identities=[],this.features=[],this.x=[],h=0,k=g.length;k>h;h++)switch(d=g[h],c=d.attributes,d.nodeName){case"identity":for(f={},i=0,l=c.length;l>i;i++)b=c[i],f[b.name]=b.textContent;this.identities.push(f);break;case"feature":this.features.push(c["var"].textContent);break;case"x":if(c=d.childNodes[0].attributes,"FORM_TYPE"===!c["var"].textContent||"hidden"===!c.type.textContent)break;for(n=d.childNodes,j=0,m=n.length;m>j;j++)e=n[j],e.attributes.type||(c=e.attributes,this.x.push({"var":c["var"].textContent,label:c.label.textContent||"",value:e.firstChild.textContent||""}))}return{identities:this.identities,features:this.features,x:this.x}},a}(),a=function(){function a(a,b){this.room=b,this.update=d(this.update,this),this.admin=d(this.admin,this),this.owner=d(this.owner,this),this.revoke=d(this.revoke,this),this.member=d(this.member,this),this.ban=d(this.ban,this),this.modifyAffiliation=d(this.modifyAffiliation,this),this.deop=d(this.deop,this),this.op=d(this.op,this),this.mute=d(this.mute,this),this.voice=d(this.voice,this),this.kick=d(this.kick,this),this.modifyRole=d(this.modifyRole,this),this.update(a)}return a.prototype.modifyRole=function(a,b,c,d){return this.room.modifyRole(this.nick,a,b,c,d)},a.prototype.kick=function(a,b,c){return this.room.kick(this.nick,a,b,c)},a.prototype.voice=function(a,b,c){return this.room.voice(this.nick,a,b,c)},a.prototype.mute=function(a,b,c){return this.room.mute(this.nick,a,b,c)},a.prototype.op=function(a,b,c){return this.room.op(this.nick,a,b,c)},a.prototype.deop=function(a,b,c){return this.room.deop(this.nick,a,b,c)},a.prototype.modifyAffiliation=function(a,b,c,d){return this.room.modifyAffiliation(this.jid,a,b,c,d)},a.prototype.ban=function(a,b,c){return this.room.ban(this.jid,a,b,c)},a.prototype.member=function(a,b,c){return this.room.member(this.jid,a,b,c)},a.prototype.revoke=function(a,b,c){return this.room.revoke(this.jid,a,b,c)},a.prototype.owner=function(a,b,c){return this.room.owner(this.jid,a,b,c)},a.prototype.admin=function(a,b,c){return this.room.admin(this.jid,a,b,c)},a.prototype.update=function(a){return this.nick=a.nick||null,this.affiliation=a.affiliation||null,this.role=a.role||null,this.jid=a.jid||null,this.status=a.status||null,this.show=a.show||null,this},a}()}.call(this);var buildIq;buildIq=function(a,b,c){var d;return d=$iq(b?{type:a,to:b}:{type:a}),d.c("vCard",{xmlns:Strophe.NS.VCARD}),c&&d.cnode(c),d},Strophe.addConnectionPlugin("vcard",{_connection:null,init:function(a){return this._connection=a,Strophe.addNamespace("VCARD","vcard-temp")},get:function(a,b,c){var d;return d=buildIq("get",b),this._connection.sendIQ(d,a,c)},set:function(a,b,c){var d;return d=buildIq("set",c,b),this._connection.sendIQ(d,a,error_rb)}}),Strophe.addConnectionPlugin("disco",{_connection:null,_identities:[],_features:[],_items:[],init:function(a){this._connection=a,this._identities=[],this._features=[],this._items=[],a.addHandler(this._onDiscoInfo.bind(this),Strophe.NS.DISCO_INFO,"iq","get",null,null),a.addHandler(this._onDiscoItems.bind(this),Strophe.NS.DISCO_ITEMS,"iq","get",null,null)},addIdentity:function(a,b,c,d){for(var e=0;e<this._identities.length;e++)if(this._identities[e].category==a&&this._identities[e].type==b&&this._identities[e].name==c&&this._identities[e].lang==d)return!1;return this._identities.push({category:a,type:b,name:c,lang:d}),!0},addFeature:function(a){for(var b=0;b<this._features.length;b++)if(this._features[b]==a)return!1;return this._features.push(a),!0},removeFeature:function(a){for(var b=0;b<this._features.length;b++)if(this._features[b]===a)return this._features.splice(b,1),!0;return!1},addItem:function(a,b,c,d){return c&&!d?!1:(this._items.push({jid:a,name:b,node:c,call_back:d}),!0)},info:function(a,b,c,d,e){var f={xmlns:Strophe.NS.DISCO_INFO};b&&(f.node=b);var g=$iq({from:this._connection.jid,to:a,type:"get"}).c("query",f);this._connection.sendIQ(g,c,d,e)},items:function(a,b,c,d,e){var f={xmlns:Strophe.NS.DISCO_ITEMS};b&&(f.node=b);var g=$iq({from:this._connection.jid,to:a,type:"get"}).c("query",f);this._connection.sendIQ(g,c,d,e)},_buildIQResult:function(a,b){var c=a.getAttribute("id"),d=a.getAttribute("from"),e=$iq({type:"result",id:c});return null!==d&&e.attrs({to:d}),e.c("query",b)},_onDiscoInfo:function(a){var b=a.getElementsByTagName("query")[0].getAttribute("node"),c={xmlns:Strophe.NS.DISCO_INFO};b&&(c.node=b);for(var d=this._buildIQResult(a,c),e=0;e<this._identities.length;e++){var c={category:this._identities[e].category,type:this._identities[e].type};this._identities[e].name&&(c.name=this._identities[e].name),this._identities[e].lang&&(c["xml:lang"]=this._identities[e].lang),d.c("identity",c).up()}for(var e=0;e<this._features.length;e++)d.c("feature",{"var":this._features[e]}).up();return this._connection.send(d.tree()),!0},_onDiscoItems:function(a){var b={xmlns:Strophe.NS.DISCO_ITEMS},c=a.getElementsByTagName("query")[0].getAttribute("node");if(c){b.node=c;for(var d=[],e=0;e<this._items.length;e++)if(this._items[e].node==c){d=this._items[e].call_back(a);break}}else var d=this._items;for(var f=this._buildIQResult(a,b),e=0;e<d.length;e++){var g={jid:d[e].jid};d[e].name&&(g.name=d[e].name),d[e].node&&(g.node=d[e].node),f.c("item",g).up()}return this._connection.send(f.tree()),!0}}),function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?void(this._wrapped=a):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.5.1";var y=x.each=x.forEach=function(a,b,d){if(null!=a)if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g in a)if(x.has(a,g)&&b.call(d,a[g],g,a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.where=function(a,b,c){return x.isEmpty(b)?c?void 0:[]:x[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},x.findWhere=function(a,b){return x.where(a,b,!0)},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-1/0;var d={computed:-1/0,value:-1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d};var B=function(a){return x.isFunction(a)?a:function(b){return b[a]}};x.sortBy=function(a,b,c){var d=B(b);return x.pluck(x.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index<b.index?-1:1}),"value")};var C=function(a,b,c,d){var e={},f=B(null==b?x.identity:b);return y(a,function(b,g){var h=f.call(c,b,g,a);d(e,h,b)}),e};x.groupBy=function(a,b,c){return C(a,b,c,function(a,b,c){(x.has(a,b)?a[b]:a[b]=[]).push(c)})},x.countBy=function(a,b,c){return C(a,b,c,function(a,b){x.has(a,b)||(a[b]=0),a[b]++})},x.sortedIndex=function(a,b,c,d){c=null==c?x.identity:B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return b&&x.every(a,x.isArray)?i.apply(c,a):(y(a,function(a){x.isArray(a)||x.isArguments(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c)};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=x.max(x.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=x.pluck(arguments,""+c);return b},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return Object(f)===f?f:e}},x.partial=function(a){var b=h.call(arguments,1);return function(){return a.apply(this,b.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:new Date,g=null,f=a.apply(d,e)};return function(){var j=new Date;h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},x.debounce=function(a,b,c){var d,e=null;return function(){var f=this,g=arguments,h=function(){e=null,c||(d=a.apply(f,g))},i=c&&!e;return clearTimeout(e),e=setTimeout(h,b),i&&(d=a.apply(f,g)),d}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&b.push(c);return b},x.values=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push(a[c]);return b},x.pairs=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push([c,a[c]]);return b},x.invert=function(a){var b={};for(var c in a)x.has(a,c)&&(b[a[c]]=c);return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(x.isFunction(g)&&g instanceof g&&x.isFunction(h)&&h instanceof h))return!1;c.push(a),d.push(b);var i=0,k=!0;if("[object Array]"==e){if(i=a.length,k=i==b.length)for(;i--&&(k=F(a[i],b[i],c,d)););}else{for(var l in a)if(x.has(a,l)&&(i++,!(k=x.has(b,l)&&F(a[l],b[l],c,d))))break;if(k){for(l in b)if(x.has(b,l)&&!i--)break;k=!i}}return c.pop(),d.pop(),k};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};G.unescape=x.invert(G.escape);var H={escape:new RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(null==a)return void 0;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=++I+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(L,function(a){return"\\"+K[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(){var a,b=this,c=b.Backbone,d=[],e=d.push,f=d.slice,g=d.splice;a="undefined"!=typeof exports?exports:b.Backbone={},a.VERSION="1.0.0";var h=b._;h||"undefined"==typeof require||(h=require("underscore")),a.$=b.jQuery||b.Zepto||b.ender||b.$,a.noConflict=function(){return b.Backbone=c,this},a.emulateHTTP=!1,a.emulateJSON=!1;var i=a.Events={on:function(a,b,c){if(!k(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!k(this,"once",a,[b,c])||!b)return this;var d=this,e=h.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,f,g,i,j,l,m;if(!this._events||!k(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(g=a?[a]:h.keys(this._events),i=0,j=g.length;j>i;i++)if(a=g[i],f=this._events[a]){if(this._events[a]=d=[],b||c)for(l=0,m=f.length;m>l;l++)e=f[l],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=f.call(arguments,1);if(!k(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&l(c,b),d&&l(d,arguments),this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;"object"==typeof b&&(c=this),a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}},j=/\s+/,k=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(j.test(c)){for(var f=c.split(j),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},l=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},m={listenTo:"on",listenToOnce:"once"};h.each(m,function(a,b){i[b]=function(b,c,d){var e=this._listeners||(this._listeners={}),f=b._listenerId||(b._listenerId=h.uniqueId("l"));return e[f]=b,"object"==typeof c&&(d=this),b[a](c,d,this),this}}),i.bind=i.on,i.unbind=i.off,h.extend(a,i);var n=a.Model=function(a,b){var c,d=a||{};b||(b={}),this.cid=h.uniqueId("c"),this.attributes={},h.extend(this,h.pick(b,o)),b.parse&&(d=this.parse(d,b)||{}),(c=h.result(this,"defaults"))&&(d=h.defaults({},d,c)),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)},o=["url","urlRoot","collection"];h.extend(n.prototype,i,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return h.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return h.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,f,g,i,j,k,l;if(null==a)return this;if("object"==typeof a?(e=a,c=b):(e={})[a]=b,c||(c={}),!this._validate(e,c))return!1;f=c.unset,i=c.silent,g=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=h.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],h.isEqual(l[d],b)||g.push(d),h.isEqual(k[d],b)?delete this.changed[d]:this.changed[d]=b,f?delete l[d]:l[d]=b;if(!i){g.length&&(this._pending=!0);for(var m=0,n=g.length;n>m;m++)this.trigger("change:"+g[m],this,l[g[m]],c)}if(j)return this;if(!i)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,h.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,h.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!h.isEmpty(this.changed):h.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?h.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)h.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return h.clone(this._previousAttributes)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d){return b.set(b.parse(d,a),a)?(c&&c(b,d,a),void b.trigger("sync",b,d,a)):!1},L(this,a),this.sync("read",this,a)},save:function(a,b,c){var d,e,f,g=this.attributes;if(null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b,!(!d||c&&c.wait||this.set(d,c)))return!1;if(c=h.extend({validate:!0},c),!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=h.extend({},g,d)),void 0===c.parse&&(c.parse=!0);var i=this,j=c.success;return c.success=function(a){i.attributes=g;var b=i.parse(a,c);return c.wait&&(b=h.extend(d||{},b)),h.isObject(b)&&!i.set(b,c)?!1:(j&&j(i,a,c),void i.trigger("sync",i,a,c))},L(this,c),e=this.isNew()?"create":c.patch?"patch":"update","patch"===e&&(c.attrs=d),f=this.sync(e,this,c),d&&c.wait&&(this.attributes=g),f},destroy:function(a){a=a?h.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(e){(a.wait||b.isNew())&&d(),c&&c(b,e,a),b.isNew()||b.trigger("sync",b,e,a)},this.isNew())return a.success(),!1;L(this,a);var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=h.result(this,"urlRoot")||h.result(this.collection,"url")||K();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},h.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=h.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c?(this.trigger("invalid",this,c,h.extend(b||{},{validationError:c})),!1):!0}});var p=["keys","values","pairs","invert","pick","omit"];h.each(p,function(a){n.prototype[a]=function(){var b=f.call(arguments);return b.unshift(this.attributes),h[a].apply(h,b)}});var q=a.Collection=function(a,b){b||(b={}),b.url&&(this.url=b.url),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,h.extend({silent:!0},b))},r={add:!0,remove:!0,merge:!0},s={add:!0,merge:!1,remove:!1};h.extend(q.prototype,i,{model:n,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return a.sync.apply(this,arguments)},add:function(a,b){return this.set(a,h.defaults(b||{},s))},remove:function(a,b){a=h.isArray(a)?a.slice():[a],b||(b={});var c,d,e,f;for(c=0,d=a.length;d>c;c++)f=this.get(a[c]),f&&(delete this._byId[f.id],delete this._byId[f.cid],e=this.indexOf(f),this.models.splice(e,1),this.length--,b.silent||(b.index=e,f.trigger("remove",f,this,b)),this._removeReference(f));return this},set:function(a,b){b=h.defaults(b||{},r),b.parse&&(a=this.parse(a,b)),h.isArray(a)||(a=a?[a]:[]);var c,d,f,i,j,k=b.at,l=this.comparator&&null==k&&b.sort!==!1,m=h.isString(this.comparator)?this.comparator:null,n=[],o=[],p={};for(c=0,d=a.length;d>c;c++)(f=this._prepareModel(a[c],b))&&((i=this.get(f))?(b.remove&&(p[i.cid]=!0),b.merge&&(i.set(f.attributes,b),l&&!j&&i.hasChanged(m)&&(j=!0))):b.add&&(n.push(f),f.on("all",this._onModelEvent,this),this._byId[f.cid]=f,null!=f.id&&(this._byId[f.id]=f)));if(b.remove){for(c=0,d=this.length;d>c;++c)p[(f=this.models[c]).cid]||o.push(f);o.length&&this.remove(o,b)}if(n.length&&(l&&(j=!0),this.length+=n.length,null!=k?g.apply(this.models,[k,0].concat(n)):e.apply(this.models,n)),j&&this.sort({silent:!0}),b.silent)return this;for(c=0,d=n.length;d>c;c++)(f=n[c]).trigger("add",f,this,b);return j&&this.trigger("sort",this,b),this},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c]);return b.previousModels=this.models,this._reset(),this.add(a,h.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:this.length},b)),a},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){return h.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)
},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),h.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(h.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=h.isFunction(b)?b:function(a){return a.get(b)};return h.sortedIndex(this.models,a,d,c)},pluck:function(a){return h.invoke(this.models,"get",a)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;return a.success=function(d){var e=a.reset?"reset":"set";c[e](d,a),b&&b(c,d,a),c.trigger("sync",c,d,a)},L(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?h.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;return b.success=function(e){b.wait&&c.add(a,b),d&&d(a,e,b)},a.save(null,b),a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof n)return a.collection||(a.collection=this),a;b||(b={}),b.collection=this;var c=new this.model(a,b);return c._validate(a,b)?c:(this.trigger("invalid",this,a,b),!1)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var t=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];h.each(t,function(a){q.prototype[a]=function(){var b=f.call(arguments);return b.unshift(this.models),h[a].apply(h,b)}});var u=["groupBy","countBy","sortBy"];h.each(u,function(a){q.prototype[a]=function(b,c){var d=h.isFunction(b)?b:function(a){return a.get(b)};return h[a](this.models,d,c)}});var v=a.View=function(a){this.cid=h.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];h.extend(v.prototype,i,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(b,c){return this.$el&&this.undelegateEvents(),this.$el=b instanceof a.$?b:a.$(b),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=h.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];if(h.isFunction(c)||(c=this[a[b]]),c){var d=b.match(w),e=d[1],f=d[2];c=h.bind(c,this),e+=".delegateEvents"+this.cid,""===f?this.$el.on(e,c):this.$el.on(e,f,c)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(a){this.options&&(a=h.extend({},h.result(this,"options"),a)),h.extend(this,h.pick(a,x)),this.options=a},_ensureElement:function(){if(this.el)this.setElement(h.result(this,"el"),!1);else{var b=h.extend({},h.result(this,"attributes"));this.id&&(b.id=h.result(this,"id")),this.className&&(b["class"]=h.result(this,"className"));var c=a.$("<"+h.result(this,"tagName")+">").attr(b);this.setElement(c,!1)}}}),a.sync=function(b,c,d){var e=y[b];h.defaults(d||(d={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var f={type:e,dataType:"json"};if(d.url||(f.url=h.result(c,"url")||K()),null!=d.data||!c||"create"!==b&&"update"!==b&&"patch"!==b||(f.contentType="application/json",f.data=JSON.stringify(d.attrs||c.toJSON(d))),d.emulateJSON&&(f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{}),d.emulateHTTP&&("PUT"===e||"DELETE"===e||"PATCH"===e)){f.type="POST",d.emulateJSON&&(f.data._method=e);var g=d.beforeSend;d.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",e),g?g.apply(this,arguments):void 0}}"GET"===f.type||d.emulateJSON||(f.processData=!1),"PATCH"!==f.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(f.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=d.xhr=a.ajax(h.extend(f,d));return c.trigger("request",c,i,d),i};var y={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var z=a.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},A=/\((.*?)\)/g,B=/(\(\?)?:\w+/g,C=/\*\w+/g,D=/[\-{}\[\]+?.,\\\^$|#\s]/g;h.extend(z.prototype,i,{initialize:function(){},route:function(b,c,d){h.isRegExp(b)||(b=this._routeToRegExp(b)),h.isFunction(c)&&(d=c,c=""),d||(d=this[c]);var e=this;return a.history.route(b,function(f){var g=e._extractParameters(b,f);d&&d.apply(e,g),e.trigger.apply(e,["route:"+c].concat(g)),e.trigger("route",c,g),a.history.trigger("route",e,c,g)}),this},navigate:function(b,c){return a.history.navigate(b,c),this},_bindRoutes:function(){if(this.routes){this.routes=h.result(this,"routes");for(var a,b=h.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(D,"\\$&").replace(A,"(?:$1)?").replace(B,function(a,b){return b?a:"([^/]+)"}).replace(C,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return h.map(c,function(a){return a?decodeURIComponent(a):null})}});var E=a.History=function(){this.handlers=[],h.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},F=/^[#\/]|\s+$/g,G=/^\/+|\/+$/g,H=/msie [\w.]+/,I=/\/$/;E.started=!1,h.extend(E.prototype,i,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(I,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(F,"")},start:function(b){if(E.started)throw new Error("Backbone.history has already been started");E.started=!0,this.options=h.extend({},{root:"/"},this.options,b),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var c=this.getFragment(),d=document.documentMode,e=H.exec(navigator.userAgent.toLowerCase())&&(!d||7>=d);this.root=("/"+this.root+"/").replace(G,"/"),e&&this._wantsHashChange&&(this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(c)),this._hasPushState?a.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?a.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=c;var f=this.location,g=f.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!g?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&g&&f.hash&&(this.fragment=this.getHash().replace(F,""),this.history.replaceState({},document.title,this.root+this.fragment+f.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),E.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();return a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe))),a===this.fragment?!1:(this.iframe&&this.navigate(a),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(a){var b=this.fragment=this.getFragment(a),c=h.any(this.handlers,function(a){return a.route.test(b)?(a.callback(b),!0):void 0});return c},navigate:function(a,b){if(!E.started)return!1;if(b&&b!==!0||(b={trigger:b}),a=this.getFragment(a||""),this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),a.history=new E;var J=function(a,b){var c,d=this;c=a&&h.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},h.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&h.extend(c.prototype,a),c.__super__=d.prototype,c};n.extend=q.extend=z.extend=v.extend=E.extend=J;var K=function(){throw new Error('A "url" property or function must be specified')},L=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}}}.call(this),function(a,b){"object"==typeof exports&&a.require?module.exports=b(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],function(c,d){return b(c||a._,d||a.Backbone)}):b(_,Backbone)}(this,function(a,b){function c(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function d(){return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}return b.LocalStorage=window.Store=function(a){if(!this.localStorage)throw"Backbone.localStorage: Environment does not support localStorage.";this.name=a;var b=this.localStorage().getItem(this.name);this.records=b&&b.split(",")||[]},a.extend(b.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(a){return a.id||(a.id=d(),a.set(a.idAttribute,a.id)),this.localStorage().setItem(this.name+"-"+a.id,JSON.stringify(a)),this.records.push(a.id.toString()),this.save(),this.find(a)},update:function(b){return this.localStorage().setItem(this.name+"-"+b.id,JSON.stringify(b)),a.include(this.records,b.id.toString())||this.records.push(b.id.toString()),this.save(),this.find(b)},find:function(a){return this.jsonData(this.localStorage().getItem(this.name+"-"+a.id))},findAll:function(){return(a.chain||a)(this.records).map(function(a){return this.jsonData(this.localStorage().getItem(this.name+"-"+a))},this).compact().value()},destroy:function(b){return b.isNew()?!1:(this.localStorage().removeItem(this.name+"-"+b.id),this.records=a.reject(this.records,function(a){return a===b.id.toString()}),this.save(),b)},localStorage:function(){return localStorage},jsonData:function(a){return a&&JSON.parse(a)},_clear:function(){var b=this.localStorage(),c=new RegExp("^"+this.name+"-");b.removeItem(this.name),(a.chain||a)(b).keys().filter(function(a){return c.test(a)}).each(function(a){b.removeItem(a)}),this.records.length=0},_storageSize:function(){return this.localStorage().length}}),b.LocalStorage.sync=window.Store.sync=b.localSync=function(a,c,d){var e,f,g=c.localStorage||c.collection.localStorage,h=b.$.Deferred&&b.$.Deferred();try{switch(a){case"read":e=void 0!=c.id?g.find(c):g.findAll();break;case"create":e=g.create(c);break;case"update":e=g.update(c);break;case"delete":e=g.destroy(c)}}catch(i){f=22===i.code&&0===g._storageSize()?"Private browsing is unsupported":i.message}return e?(d&&d.success&&("0.9.10"===b.VERSION?d.success(c,e,d):d.success(e)),h&&h.resolve(e)):(f=f?f:"Record Not Found",d&&d.error&&("0.9.10"===b.VERSION?d.error(c,f,d):d.error(f)),h&&h.reject(f)),d&&d.complete&&d.complete(e),h&&h.promise()},b.ajaxSync=b.sync,b.getSyncMethod=function(a){return a.localStorage||a.collection&&a.collection.localStorage?b.localSync:b.ajaxSync},b.sync=function(a,c,d){return b.getSyncMethod(c).apply(this,[a,c,d])},b.LocalStorage}),function(a,b){"use strict";function c(a){return a&&a.toLowerCase?a.toLowerCase():a}function d(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]==b)return!e;return e}var e=!1,f=null,g=parseFloat,h=Math.min,i=/(-?\d+\.?\d*)$/g,j=/(\d+\.?\d*)$/g,k=[],l=[],m=function(a){return"string"==typeof a},n=function(a,b){for(var c,d=a.length,e=d;e--;)c=d-e-1,b(a[c],c)},o=Array.prototype.indexOf||function(a){var b=this.length,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1};a.tinysort={id:"TinySort",version:"1.5.6",copyright:"Copyright (c) 2008-2013 Ron Valstar",uri:"http://tinysort.sjeiti.com/",licensed:{MIT:"http://www.opensource.org/licenses/mit-license.php",GPL:"http://www.gnu.org/licenses/gpl.html"},plugin:function(){var a=function(a,b){k.push(a),l.push(b)};return a.indexOf=o,a}(),defaults:{order:"asc",attr:f,data:f,useVal:e,place:"start",returns:e,cases:e,forceStrings:e,ignoreDashes:e,sortFunction:f}},a.fn.extend({tinysort:function(){var p,q,r,s,t=this,u=[],v=[],w=[],x=[],y=0,z=[],A=[],B=function(a){n(k,function(b){b.call(b,a)})},C=function(a,b){return"string"==typeof b&&(a.cases||(b=c(b)),b=b.replace(/^\s*(.*?)\s*$/i,"$1")),b},D=function(a,b){var c=0;for(0!==y&&(y=0);0===c&&s>y;){var d=x[y],f=d.oSettings,h=f.ignoreDashes?j:i;if(B(f),f.sortFunction)c=f.sortFunction(a,b);else if("rand"==f.order)c=Math.random()<.5?1:-1;else{var k=e,o=C(f,a.s[y]),p=C(f,b.s[y]);if(!f.forceStrings){var q=m(o)?o&&o.match(h):e,r=m(p)?p&&p.match(h):e;if(q&&r){var t=o.substr(0,o.length-q[0].length),u=p.substr(0,p.length-r[0].length);t==u&&(k=!e,o=g(q[0]),p=g(r[0]))}}c=d.iAsc*(p>o?-1:o>p?1:0)}n(l,function(a){c=a.call(a,k,o,p,c)}),0===c&&y++}return c};for(p=0,r=arguments.length;r>p;p++){var E=arguments[p];m(E)?z.push(E)-1>A.length&&(A.length=z.length-1):A.push(E)>z.length&&(z.length=A.length)}for(z.length>A.length&&(A.length=z.length),s=z.length,0===s&&(s=z.length=1,A.push({})),p=0,r=s;r>p;p++){var F=z[p],G=a.extend({},a.tinysort.defaults,A[p]),H=!(!F||""===F),I=H&&":"===F[0];x.push({sFind:F,oSettings:G,bFind:H,bAttr:!(G.attr===f||""===G.attr),bData:G.data!==f,bFilter:I,$Filter:I?t.filter(F):t,fnSort:G.sortFunction,iAsc:"asc"==G.order?1:-1})}return t.each(function(c,d){var e,f=a(d),g=f.parent().get(0),h=[];for(q=0;s>q;q++){var i=x[q],j=i.bFind?i.bFilter?i.$Filter.filter(d):f.find(i.sFind):f;h.push(i.bData?j.data(i.oSettings.data):i.bAttr?j.attr(i.oSettings.attr):i.oSettings.useVal?j.val():j.text()),e===b&&(e=j)}var k=o.call(w,g);0>k&&(k=w.push(g)-1,v[k]={s:[],n:[]}),e.length>0?v[k].s.push({s:h,e:f,n:c}):v[k].n.push({e:f,n:c})}),n(v,function(a){a.s.sort(D)}),n(v,function(a){var b=a.s,c=a.n,f=b.length,g=c.length,i=f+g,j=[],k=i,l=[0,0];switch(G.place){case"first":n(b,function(a){k=h(k,a.n)});break;case"org":n(b,function(a){j.push(a.n)});break;case"end":k=g;break;default:k=0}for(p=0;i>p;p++){var m=d(j,p)?!e:p>=k&&k+f>p,o=m?0:1,q=(m?b:c)[l[o]].e;q.parent().append(q),(m||!G.returns)&&u.push(q.get(0)),l[o]++}}),t.length=0,Array.prototype.push.apply(t,u),t}}),a.fn.TinySort=a.fn.Tinysort=a.fn.tsort=a.fn.tinysort}(jQuery),function(a,b){function c(a){return l.PF.compile(a||"nplurals=2; plural=(n != 1);")}function d(a,b){this._key=a,this._i18n=b}var e=Array.prototype,f=Object.prototype,g=e.slice,h=f.hasOwnProperty,i=e.forEach,j={},k={forEach:function(a,b,c){var d,e,f;if(null!==a)if(i&&a.forEach===i)a.forEach(b,c);else if(a.length===+a.length){for(d=0,e=a.length;e>d;d++)if(d in a&&b.call(c,a[d],d,a)===j)return}else for(f in a)if(h.call(a,f)&&b.call(c,a[f],f,a)===j)return},extend:function(a){return this.forEach(g.call(arguments,1),function(b){for(var c in b)a[c]=b[c]}),a}},l=function(a){if(this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages"},this.options=k.extend({},this.defaults,a),this.textdomain(this.options.domain),a.domain&&!this.options.locale_data[this.options.domain])throw new Error("Text domain set to non-existent domain: `"+a.domain+"`")};l.context_delimiter=String.fromCharCode(4),k.extend(d.prototype,{onDomain:function(a){return this._domain=a,this},withContext:function(a){return this._context=a,this},ifPlural:function(a,b){return this._val=a,this._pkey=b,this},fetch:function(a){return"[object Array]"!={}.toString.call(a)&&(a=[].slice.call(arguments)),(a&&a.length?l.sprintf:function(a){return a})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),a)}}),k.extend(l.prototype,{translate:function(a){return new d(a,this)},textdomain:function(a){return a?void(this._textdomain=a):this._textdomain},gettext:function(a){return this.dcnpgettext.call(this,b,b,a)},dgettext:function(a,c){return this.dcnpgettext.call(this,a,b,c)},dcgettext:function(a,c){return this.dcnpgettext.call(this,a,b,c)},ngettext:function(a,c,d){return this.dcnpgettext.call(this,b,b,a,c,d)},dngettext:function(a,c,d,e){return this.dcnpgettext.call(this,a,b,c,d,e)},dcngettext:function(a,c,d,e){return this.dcnpgettext.call(this,a,b,c,d,e)},pgettext:function(a,c){return this.dcnpgettext.call(this,b,a,c)},dpgettext:function(a,b,c){return this.dcnpgettext.call(this,a,b,c)},dcpgettext:function(a,b,c){return this.dcnpgettext.call(this,a,b,c)},npgettext:function(a,c,d,e){return this.dcnpgettext.call(this,b,a,c,d,e)},dnpgettext:function(a,b,c,d,e){return this.dcnpgettext.call(this,a,b,c,d,e)},dcnpgettext:function(a,b,d,e,f){e=e||d,a=a||this._textdomain,f="undefined"==typeof f?1:f;var g;if(!this.options)return g=new l,g.dcnpgettext.call(g,void 0,void 0,d,e,f);if(!this.options.locale_data)throw new Error("No locale data provided.");if(!this.options.locale_data[a])throw new Error("Domain `"+a+"` was not found.");if(!this.options.locale_data[a][""])throw new Error("No locale meta information provided.");if(!d)throw new Error("No translation key found.");if("number"!=typeof f&&(f=parseInt(f,10),isNaN(f)))throw new Error("The number that was passed in is not a number.");var h,i,j=b?b+l.context_delimiter+d:d,k=this.options.locale_data,m=k[a],n=m[""].plural_forms||(k.messages||this.defaults.locale_data.messages)[""].plural_forms,o=c(n)(f)+1;if(!m)throw new Error("No domain named `"+a+"` could be found.");return h=m[j],!h||o>=h.length?(this.options.missing_key_callback&&this.options.missing_key_callback(j),i=[null,d,e],i[c(n)(f)+1]):(i=h[o],i?i:(i=[null,d,e],i[c(n)(f)+1]))}});var m=function(){function a(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}function b(a,b){for(var c=[];b>0;c[--b]=a);return c.join("")}var c=function(){return c.cache.hasOwnProperty(arguments[0])||(c.cache[arguments[0]]=c.parse(arguments[0])),c.format.call(null,c.cache[arguments[0]],arguments)};return c.format=function(c,d){var e,f,g,h,i,j,k,l=1,n=c.length,o="",p=[];for(f=0;n>f;f++)if(o=a(c[f]),"string"===o)p.push(c[f]);else if("array"===o){if(h=c[f],h[2])for(e=d[l],g=0;g<h[2].length;g++){if(!e.hasOwnProperty(h[2][g]))throw m('[sprintf] property "%s" does not exist',h[2][g]);e=e[h[2][g]]}else e=h[1]?d[h[1]]:d[l++];if(/[^s]/.test(h[8])&&"number"!=a(e))throw m("[sprintf] expecting number but found %s",a(e));switch(("undefined"==typeof e||null===e)&&(e=""),h[8]){case"b":e=e.toString(2);break;case"c":e=String.fromCharCode(e);break;case"d":e=parseInt(e,10);break;case"e":e=h[7]?e.toExponential(h[7]):e.toExponential();break;case"f":e=h[7]?parseFloat(e).toFixed(h[7]):parseFloat(e);break;case"o":e=e.toString(8);break;case"s":e=(e=String(e))&&h[7]?e.substring(0,h[7]):e;break;case"u":e=Math.abs(e);break;case"x":e=e.toString(16);break;case"X":e=e.toString(16).toUpperCase()}e=/[def]/.test(h[8])&&h[3]&&e>=0?"+"+e:e,j=h[4]?"0"==h[4]?"0":h[4].charAt(1):" ",k=h[6]-String(e).length,i=h[6]?b(j,k):"",p.push(h[5]?e+i:i+e)}return p.join("")},c.cache={},c.parse=function(a){for(var b=a,c=[],d=[],e=0;b;){if(null!==(c=/^[^\x25]+/.exec(b)))d.push(c[0]);else if(null!==(c=/^\x25{2}/.exec(b)))d.push("%");else{if(null===(c=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(b)))throw"[sprintf] huh?";if(c[2]){e|=1;var f=[],g=c[2],h=[];if(null===(h=/^([a-z_][a-z_\d]*)/i.exec(g)))throw"[sprintf] huh?";for(f.push(h[1]);""!==(g=g.substring(h[0].length));)if(null!==(h=/^\.([a-z_][a-z_\d]*)/i.exec(g)))f.push(h[1]);else{if(null===(h=/^\[(\d+)\]/.exec(g)))throw"[sprintf] huh?";f.push(h[1])}c[2]=f}else e|=2;if(3===e)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";d.push(c)}b=b.substring(c[0].length)}return d},c}(),n=function(a,b){return b.unshift(a),m.apply(null,b)};l.parse_plural=function(a,b){return a=a.replace(/n/g,b),l.parse_expression(a)},l.sprintf=function(a,b){return"[object Array]"=={}.toString.call(b)?n(a,[].slice.call(b)):m.apply(this,[].slice.call(arguments))},l.prototype.sprintf=function(){return l.sprintf.apply(this,arguments)},l.PF={},l.PF.parse=function(a){var b=l.PF.extractPluralExpr(a);return l.PF.parser.parse.call(l.PF.parser,b)},l.PF.compile=function(a){function b(a){return a===!0?1:a?a:0}var c=l.PF.parse(a);return function(a){return b(l.PF.interpreter(c)(a))}},l.PF.interpreter=function(a){return function(b){switch(a.type){case"GROUP":return l.PF.interpreter(a.expr)(b);case"TERNARY":return l.PF.interpreter(a.expr)(b)?l.PF.interpreter(a.truthy)(b):l.PF.interpreter(a.falsey)(b);case"OR":return l.PF.interpreter(a.left)(b)||l.PF.interpreter(a.right)(b);case"AND":return l.PF.interpreter(a.left)(b)&&l.PF.interpreter(a.right)(b);case"LT":return l.PF.interpreter(a.left)(b)<l.PF.interpreter(a.right)(b);case"GT":return l.PF.interpreter(a.left)(b)>l.PF.interpreter(a.right)(b);case"LTE":return l.PF.interpreter(a.left)(b)<=l.PF.interpreter(a.right)(b);case"GTE":return l.PF.interpreter(a.left)(b)>=l.PF.interpreter(a.right)(b);case"EQ":return l.PF.interpreter(a.left)(b)==l.PF.interpreter(a.right)(b);case"NEQ":return l.PF.interpreter(a.left)(b)!=l.PF.interpreter(a.right)(b);case"MOD":return l.PF.interpreter(a.left)(b)%l.PF.interpreter(a.right)(b);case"VAR":return b;case"NUM":return a.val;default:throw new Error("Invalid Token found.")}}},l.PF.extractPluralExpr=function(a){a=a.replace(/^\s\s*/,"").replace(/\s\s*$/,""),/;\s*$/.test(a)||(a=a.concat(";"));var b,c=/nplurals\=(\d+);/,d=/plural\=(.*);/,e=a.match(c),f={};if(!(e.length>1))throw new Error("nplurals not found in plural_forms string: "+a);if(f.nplurals=e[1],a=a.replace(c,""),b=a.match(d),!(b&&b.length>1))throw new Error("`plural` expression not found: "+a);return b[1]},l.PF.parser=function(){var a={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function(a,b,c,d,e,f){var g=f.length-1;switch(e){case 1:return{type:"GROUP",expr:f[g-1]};case 2:this.$={type:"TERNARY",expr:f[g-4],truthy:f[g-2],falsey:f[g]};break;case 3:this.$={type:"OR",left:f[g-2],right:f[g]};break;case 4:this.$={type:"AND",left:f[g-2],right:f[g]};break;case 5:this.$={type:"LT",left:f[g-2],right:f[g]};break;case 6:this.$={type:"LTE",left:f[g-2],right:f[g]};break;case 7:this.$={type:"GT",left:f[g-2],right:f[g]};break;case 8:this.$={type:"GTE",left:f[g-2],right:f[g]};break;case 9:this.$={type:"NEQ",left:f[g-2],right:f[g]};break;case 10:this.$={type:"EQ",left:f[g-2],right:f[g]};break;case 11:this.$={type:"MOD",left:f[g-2],right:f[g]};break;case 12:this.$={type:"GROUP",expr:f[g-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(a)}}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function(a){throw new Error(a)},parse:function(a){function b(a){e.length=e.length-2*a,f.length=f.length-a,g.length=g.length-a}function c(){var a;return a=d.lexer.lex()||1,"number"!=typeof a&&(a=d.symbols_[a]||a),a}var d=this,e=[0],f=[null],g=[],h=this.table,i="",j=0,k=0,l=0,m=2,n=1;this.lexer.setInput(a),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var o=this.lexer.yylloc;g.push(o),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var p,q,r,s,t,u,v,w,x,y={};;){if(r=e[e.length-1],this.defaultActions[r]?s=this.defaultActions[r]:(null==p&&(p=c()),s=h[r]&&h[r][p]),"undefined"==typeof s||!s.length||!s[0]){if(!l){x=[];for(u in h[r])this.terminals_[u]&&u>2&&x.push("'"+this.terminals_[u]+"'");var z="";z=this.lexer.showPosition?"Parse error on line "+(j+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+x.join(", ")+", got '"+this.terminals_[p]+"'":"Parse error on line "+(j+1)+": Unexpected "+(1==p?"end of input":"'"+(this.terminals_[p]||p)+"'"),this.parseError(z,{text:this.lexer.match,token:this.terminals_[p]||p,line:this.lexer.yylineno,loc:o,expected:x})}if(3==l){if(p==n)throw new Error(z||"Parsing halted.");k=this.lexer.yyleng,i=this.lexer.yytext,j=this.lexer.yylineno,o=this.lexer.yylloc,p=c()}for(;;){if(m.toString()in h[r])break;if(0==r)throw new Error(z||"Parsing halted.");b(1),r=e[e.length-1]}q=p,p=m,r=e[e.length-1],s=h[r]&&h[r][m],l=3}if(s[0]instanceof Array&&s.length>1)throw new Error("Parse Error: multiple actions possible at state: "+r+", token: "+p);switch(s[0]){case 1:e.push(p),f.push(this.lexer.yytext),g.push(this.lexer.yylloc),e.push(s[1]),p=null,q?(p=q,q=null):(k=this.lexer.yyleng,i=this.lexer.yytext,j=this.lexer.yylineno,o=this.lexer.yylloc,l>0&&l--);break;case 2:if(v=this.productions_[s[1]][1],y.$=f[f.length-v],y._$={first_line:g[g.length-(v||1)].first_line,last_line:g[g.length-1].last_line,first_column:g[g.length-(v||1)].first_column,last_column:g[g.length-1].last_column},t=this.performAction.call(y,i,k,j,this.yy,s[1],f,g),"undefined"!=typeof t)return t;v&&(e=e.slice(0,-1*v*2),f=f.slice(0,-1*v),g=g.slice(0,-1*v)),e.push(this.productions_[s[1]][0]),f.push(y.$),g.push(y._$),w=h[e[e.length-2]][e[e.length-1]],e.push(w);break;case 3:return!0}}return!0}},b=function(){var a={EOF:1,parseError:function(a,b){if(!this.yy.parseError)throw new Error(a);this.yy.parseError(a,b)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.match+=a,this.matched+=a;var b=a.match(/\n/);return b&&this.yylineno++,this._input=this._input.slice(1),a},unput:function(a){return this._input=a+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=new Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c;this._more||(this.yytext="",this.match="");for(var d=this._currentRules(),e=0;e<d.length;e++)if(b=this._input.match(this.rules[d[e]]))return c=b[0].match(/\n.*/g),c&&(this.yylineno+=c.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:c?c[c.length-1].length-1:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,d[e],this.conditionStack[this.conditionStack.length-1]),a?a:void 0;return""===this._input?this.EOF:void this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return"undefined"!=typeof a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(a){this.begin(a)}};return a.performAction=function(a,b,c,d){switch(c){case 0:break;case 1:return 20;case 2:return 19;case 3:return 8;case 4:return 9;case 5:return 6;case 6:return 7;case 7:return 11;case 8:return 13;case 9:return 10;case 10:return 12;case 11:return 14;case 12:return 15;case 13:return 16;case 14:return 17;case 15:return 18;case 16:return 5;case 17:return"INVALID"}},a.rules=[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./],a.conditions={INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:!0}},a}();return a.lexer=b,a}(),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=l),exports.Jed=l):("function"==typeof define&&define.amd&&define("jed",function(){return l
}),a.Jed=l)}(this),function(a,b){var c={domain:"converse",locale_data:{converse:{"":{domain:"converse",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}}};"function"==typeof define&&define.amd?define("en",["jed"],function(){return b(new Jed(c))}):(window.locales||(window.locales={}),window.locales.en=b(new Jed(c)))}(this,function(a){return a});var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=a.URL||a.webkitURL||a,e=b.createElementNS("http://www.w3.org/1999/xhtml","a"),f=!a.externalHost&&"download"in e,g=a.webkitRequestFileSystem,h=a.requestFileSystem||g||a.mozRequestFileSystem,i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=0,l=[],m=function(){for(var a=l.length;a--;){var b=l[a];"string"==typeof b?d.revokeObjectURL(b):b.remove()}l.length=0},n=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(f){i(f)}}},o=function(d,i){var m,o,p,q=this,r=d.type,s=!1,t=function(){var a=c().createObjectURL(d);return l.push(a),a},u=function(){n(q,"writestart progress write writeend".split(" "))},v=function(){(s||!m)&&(m=t(d)),o?o.location.href=m:window.open(m,"_blank"),q.readyState=q.DONE,u()},w=function(a){return function(){return q.readyState!==q.DONE?a.apply(this,arguments):void 0}},x={create:!0,exclusive:!1};if(q.readyState=q.INIT,i||(i="download"),f){m=t(d),b=a.document,e=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e.href=m,e.download=i;var y=b.createEvent("MouseEvents");return y.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(y),q.readyState=q.DONE,void u()}return a.chrome&&r&&r!==j&&(p=d.slice||d.webkitSlice,d=p.call(d,0,d.size,j),s=!0),g&&"download"!==i&&(i+=".download"),(r===j||g)&&(o=a),h?(k+=d.size,void h(a.TEMPORARY,k,w(function(a){a.root.getDirectory("saved",x,w(function(a){var b=function(){a.getFile(i,x,w(function(a){a.createWriter(w(function(b){b.onwriteend=function(b){o.location.href=a.toURL(),l.push(a),q.readyState=q.DONE,n(q,"writeend",b)},b.onerror=function(){var a=b.error;a.code!==a.ABORT_ERR&&v()},"writestart progress write abort".split(" ").forEach(function(a){b["on"+a]=q["on"+a]}),b.write(d),q.abort=function(){b.abort(),q.readyState=q.DONE},q.readyState=q.WRITING}),v)}),v)};a.getFile(i,{create:!1},w(function(a){a.remove(),b()}),w(function(a){a.code===a.NOT_FOUND_ERR?b():v()}))}),v)}),v)):void v()},p=o.prototype,q=function(a,b){return new o(a,b)};return p.abort=function(){var a=this;a.readyState=a.DONE,n(a,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,a.addEventListener("unload",m,!1),q.unload=function(){m(),a.removeEventListener("unload",m,!1)},q}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&(module.exports=saveAs);var __slice=Array.prototype.slice;!function(a){var b;return a.fn.sketch=function(){var c,d,e;return d=arguments[0],c=2<=arguments.length?__slice.call(arguments,1):[],this.length>1&&a.error("Sketch.js can only be called on one element at a time."),e=this.data("sketch"),"string"==typeof d&&e?e[d]?"function"==typeof e[d]?e[d].apply(e,c):0===c.length?e[d]:1===c.length?e[d]=c[0]:void 0:a.error("Sketch.js did not recognize the given command."):e?e:(this.data("sketch",new b(this.get(0),d)),this)},b=function(){function b(b,c){this.el=b,this.canvas=a(b),this.context=b.getContext("2d"),this.options=a.extend({toolLinks:!0,defaultTool:"marker",defaultColor:"#000000",defaultSize:5},c),this.painting=!1,this.color=this.options.defaultColor,this.size=this.options.defaultSize,this.tool=this.options.defaultTool,this.actions=[],this.action=[],this.canvas.bind("click mousedown mouseup mousemove mouseleave mouseout touchstart touchmove touchend touchcancel",this.onEvent),this.options.toolLinks&&a("body").delegate('a[href="#'+this.canvas.attr("id")+'"]',"click",function(){var b,c,d,e,f,g,h;for(c=a(this),b=a(c.attr("href")),e=b.data("sketch"),h=["color","size","tool"],f=0,g=h.length;g>f;f++)d=h[f],c.attr("data-"+d)&&e.set(d,a(this).attr("data-"+d));return a(this).attr("data-download")&&e.download(a(this).attr("data-download")),!1})}return b.prototype.download=function(a){var b;return a||(a="png"),"jpg"===a&&(a="jpeg"),b="image/"+a,window.open(this.el.toDataURL(b))},b.prototype.set=function(a,b){return this[a]=b,this.canvas.trigger("sketch.change"+a,b)},b.prototype.startPainting=function(){return this.painting=!0,this.action={tool:this.tool,color:this.color,size:parseFloat(this.size),events:[]}},b.prototype.stopPainting=function(){return this.action&&this.actions.push(this.action),this.painting=!1,this.action=null,this.redraw()},b.prototype.onEvent=function(b){return b.originalEvent&&b.originalEvent.targetTouches&&(b.pageX=b.originalEvent.targetTouches[0].pageX,b.pageY=b.originalEvent.targetTouches[0].pageY),a.sketch.tools[a(this).data("sketch").tool].onEvent.call(a(this).data("sketch"),b),b.preventDefault(),!1},b.prototype.redraw=function(){},b}(),a.sketch={tools:{}},a.sketch.tools.marker={onEvent:function(a){switch(a.type){case"mousedown":case"touchstart":this.startPainting();break;case"mouseup":case"mouseout":case"mouseleave":case"touchend":case"touchcancel":this.stopPainting()}return this.painting?(this.action.events.push({x:a.pageX-this.canvas.offset().left,y:a.pageY-this.canvas.offset().top,event:a.type}),this.redraw()):void 0},draw:function(a){var b,c,d,e,f;for(this.context.lineJoin="round",this.context.lineCap="round",this.context.beginPath(),this.context.moveTo(a.events[0].x,a.events[0].y),f=a.events,d=0,e=f.length;e>d;d++)b=f[d],this.context.lineTo(b.x,b.y),c=b;return this.context.strokeStyle=a.color,this.context.lineWidth=a.size,this.context.stroke()}},a.sketch.tools.eraser={onEvent:function(b){return a.sketch.tools.marker.onEvent.call(this,b)},draw:function(b){var c;return c=this.context.globalCompositeOperation,this.context.globalCompositeOperation="copy",b.color="rgba(0,0,0,0)",a.sketch.tools.marker.draw.call(this,b),this.context.globalCompositeOperation=c}}}(jQuery),function(a,b){("undefined"==typeof console||"undefined"==typeof console.log)&&(console={log:function(){},error:function(){}}),"function"==typeof define&&define.amd?define("converse",["converse-dependencies"],function(a){return _.templateSettings={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g},"undefined"!=typeof a?b(jQuery,_,a.OTR,a.DSA,console):b(jQuery,_,void 0,void 0,console)}):(_.templateSettings={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g},a.converse="undefined"!=typeof OTR&&"undefined"!=typeof DSA?b(jQuery,_,OTR,DSA,console):b(jQuery,_,void 0,void 0,console))}(this,function(a,b,c,d,e){a.fn.addHyperlinks=function(){return this.length>0&&this.each(function(b,c){var d=a(c).html(),e=d.match(/\b(https?:\/\/|www\.|https?:\/\/www\.)[^\s<]{2,200}\b/g);if(e)for(b=0;b<e.length;b++){var f=0===e[b].indexOf("http://")||0===e[b].indexOf("https://")?"":"http://",g=encodeURI(decodeURI(e[b])).replace(/[!'()]/g,escape).replace(/\*/g,"%2A");d=d.replace(e[b],"<a target='_blank' href='"+f+g+"'>"+e[b]+"</a>")}a(c).html(d)}),this},a.fn.addEmoticons=function(){return f.show_emoticons&&this.length>0&&this.each(function(b,c){var d=a(c).html();d=d.replace(/:\)/g,'<span class="emoticon icon-smiley"></span>'),d=d.replace(/:\-\)/g,'<span class="emoticon icon-smiley"></span>'),d=d.replace(/;\)/g,'<span class="emoticon icon-wink"></span>'),d=d.replace(/;\-\)/g,'<span class="emoticon icon-wink"></span>'),d=d.replace(/:D/g,'<span class="emoticon icon-grin"></span>'),d=d.replace(/:\-D/g,'<span class="emoticon icon-grin"></span>'),d=d.replace(/:P/g,'<span class="emoticon icon-tongue"></span>'),d=d.replace(/:\-P/g,'<span class="emoticon icon-tongue"></span>'),d=d.replace(/:p/g,'<span class="emoticon icon-tongue"></span>'),d=d.replace(/:\-p/g,'<span class="emoticon icon-tongue"></span>'),d=d.replace(/8\)/g,'<span class="emoticon icon-cool"></span>'),d=d.replace(/&gt;:\)/g,'<span class="emoticon icon-evil"></span>'),d=d.replace(/:S/g,'<span class="emoticon icon-confused"></span>'),d=d.replace(/:\\/g,'<span class="emoticon icon-wondering"></span>'),d=d.replace(/:\/ /g,'<span class="emoticon icon-wondering"></span>'),d=d.replace(/&gt;:\(/g,'<span class="emoticon icon-angry"></span>'),d=d.replace(/:\(/g,'<span class="emoticon icon-sad"></span>'),d=d.replace(/:\-\(/g,'<span class="emoticon icon-sad"></span>'),d=d.replace(/:O/g,'<span class="emoticon icon-shocked"></span>'),d=d.replace(/:\-O/g,'<span class="emoticon icon-shocked"></span>'),d=d.replace(/\=\-O/g,'<span class="emoticon icon-shocked"></span>'),d=d.replace(/\(\^.\^\)b/g,'<span class="emoticon icon-thumbs-up"></span>'),d=d.replace(/<3/g,'<span class="emoticon icon-heart"></span>'),a(c).html(d)}),this};var f={emit:function(b,c){a(this).trigger(b,c)},once:function(b,c){a(this).one(b,c)},on:function(b,c){a(this).bind(b,c)},off:function(b,c){a(this).unbind(b,c)}};return f.initialize=function(f,g){var h=this,i=0,j=1,k=2,l=3,m={ENTER:13},n="undefined"!=typeof crypto&&("function"==typeof crypto.randomBytes||"function"==typeof crypto.getRandomValues),o=n&&"undefined"!=typeof CryptoJS&&"undefined"!=typeof c&&"undefined"!=typeof d;this.allow_contact_requests=!0,this.allow_muc=!0,this.allow_otr=!0,this.animate=!0,this.auto_list_rooms=!1,this.auto_reconnect=!0,this.auto_subscribe=!1,this.bosh_service_url=void 0,this.cache_otr_key=!1,this.debug=!1,this.expose_rid_and_sid=!1,this.hide_muc_server=!1,this.i18n=locales.en,this.prebind=!1,this.show_controlbox_by_default=!1,this.show_only_online_users=!1,this.show_call_button=!1,this.show_emoticons=!0,this.show_toolbar=!0,this.use_otr_by_default=!1,this.use_vcards=!0,this.xhr_custom_status=!1,this.xhr_custom_status_url="",this.xhr_user_search=!1,this.xhr_user_search_url="",b.extend(this,b.pick(f,["allow_contact_requests","allow_muc","allow_otr","animate","auto_list_rooms","auto_reconnect","auto_subscribe","bosh_service_url","cache_otr_key","connection","debug","expose_rid_and_sid","fullname","hide_muc_server","i18n","jid","prebind","rid","show_call_button","show_controlbox_by_default","show_emoticons","show_only_online_users","show_toolbar","sid","use_otr_by_default","use_vcards","xhr_custom_status","xhr_custom_status_url","xhr_user_search","xhr_user_search_url"])),this.allow_otr=this.allow_otr&&o,this.use_otr_by_default=this.use_otr_by_default&&this.allow_otr;var p=a.proxy(function(a){void 0===this.i18n&&(this.i18n=locales.en);var b=this.i18n.translate(a);return arguments.length>1?b.fetch.apply(b,[].slice.call(arguments,1)):b.fetch()},this),q=function(a){return a},r={};r[i]="unencrypted",r[j]="unverified",r[k]="verified",r[l]="finished";var s={};s[i]=p("unencrypted"),s[j]=p("unverified"),s[k]=p("verified"),s[l]=p("finished");var t={dnd:p("This contact is busy"),online:p("This contact is online"),offline:p("This contact is offline"),unavailable:p("This contact is unavailable"),xa:p("This contact is away for an extended period"),away:p("This contact is away")};if(this.callback=g||function(){},this.initial_presence_sent=0,this.msg_counter=0,this.giveFeedback=function(b,c){a(".conn-feedback").text(b),a(".conn-feedback").attr("class","conn-feedback"),c&&a(".conn-feedback").addClass(c)},this.log=function(a,b){this.debug&&e.log("error"==b?"ERROR: "+a:a)},this.getVCard=function(c,d,e){return this.use_vcards?void h.connection.vcard.get(a.proxy(function(e){var f=a(e).find("vCard"),g=f.find("FN").text(),i=f.find("BINVAL").text(),j=f.find("TYPE").text(),k=f.find("URL").text();if(c){var l=h.roster.get(c);l&&(g=b.isEmpty(g)?l.get("fullname")||c:g,l.save({fullname:g,image_type:j,image:i,url:k,vcard_updated:h.toISOString(new Date)}))}d&&d(c,g,i,j,k)},this),c,function(a){var b=h.roster.get(c);b&&b.save({vcard_updated:h.toISOString(new Date)}),e&&e(a)}):void(d&&d(c,c))},this.reconnect=function(){h.giveFeedback(p("Reconnecting"),"error"),h.prebind||this.connection.connect(this.connection.jid,this.connection.pass,function(a,b){h.onConnect(a,b,!0)},this.connection.wait,this.connection.hold,this.connection.route)},this.showLoginButton=function(){var a=h.chatboxesview.views.controlbox;"undefined"!=typeof a.loginpanel&&a.loginpanel.showLoginButton()},this.onConnect=function(a,b,c){a===Strophe.Status.CONNECTED||a===Strophe.Status.ATTACHED?"undefined"!=typeof c&&c?(h.log(a===Strophe.Status.CONNECTED?"Reconnected":"Reattached"),h.onReconnected()):(h.log(a===Strophe.Status.CONNECTED?"Connected":"Attached"),h.onConnected()):a===Strophe.Status.DISCONNECTED?(h.giveFeedback(p("Disconnected"),"error"),h.auto_reconnect?h.reconnect():h.showLoginButton()):a===Strophe.Status.Error?(h.showLoginButton(),h.giveFeedback(p("Error"),"error")):a===Strophe.Status.CONNECTING?h.giveFeedback(p("Connecting")):a===Strophe.Status.CONNFAIL?(h.showLoginButton(),h.giveFeedback(p("Connection Failed"),"error")):a===Strophe.Status.AUTHENTICATING?h.giveFeedback(p("Authenticating")):a===Strophe.Status.AUTHFAIL?(h.showLoginButton(),h.giveFeedback(p("Authentication Failed"),"error")):a===Strophe.Status.DISCONNECTING&&h.giveFeedback(p("Disconnecting"),"error")},this.toISOString=function(a){var b;return"undefined"!=typeof a.toISOString?a.toISOString():(b=function(a){return 10>a?"0"+a:""+a},a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+".000Z")},this.parseISO8601=function(a){var b,c,d=[1,4,5,6,7,10,11],e=/^\s*(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}\.?\d*)Z\s*$/.exec(a),f=0;for(b=0;c=d[b];++b)e[c]=+e[c]||0;return e[2]=(+e[2]||1)-1,e[3]=+e[3]||1,"Z"!==e[8]&&void 0!==e[9]&&(f=60*e[10]+e[11],"+"===e[9]&&(f=0-f)),new Date(Date.UTC(e[1],e[2],e[3],e[4],e[5]+f,e[6],e[7]))},this.updateMsgCounter=function(){this.msg_counter>0?(document.title=-1==document.title.search(/^Messages \(\d+\) /)?"Messages ("+this.msg_counter+") "+document.title:document.title.replace(/^Messages \(\d+\) /,"Messages ("+this.msg_counter+") "),window.blur(),window.focus()):-1!=document.title.search(/^Messages \(\d+\) /)&&(document.title=document.title.replace(/^Messages \(\d+\) /,""))},this.incrementMsgCounter=function(){this.msg_counter+=1,this.updateMsgCounter()},this.clearMsgCounter=function(){this.msg_counter=0,this.updateMsgCounter()},this.initStatus=function(a){this.xmppstatus=new this.XMPPStatus;var b=hex_sha1("converse.xmppstatus-"+this.bare_jid);this.xmppstatus.id=b,this.xmppstatus.localStorage=new Backbone.LocalStorage(b),this.xmppstatus.fetch({success:a,error:a})},this.registerRosterHandler=function(){this.connection.roster.registerCallback(a.proxy(this.roster.rosterHandler,this.roster),null,"presence",null)},this.registerRosterXHandler=function(){this.connection.addHandler(a.proxy(this.roster.subscribeToSuggestedItems,this.roster),"http://jabber.org/protocol/rosterx","message",null)},this.registerPresenceHandler=function(){this.connection.addHandler(a.proxy(function(a){return this.presenceHandler(a),!0},this.roster),null,"presence",null)},this.initRoster=function(){this.roster=new this.RosterItems,this.roster.localStorage=new Backbone.LocalStorage(hex_sha1("converse.rosteritems-"+h.bare_jid)),this.registerRosterHandler(),this.registerRosterXHandler(),this.registerPresenceHandler(),this.rosterview=new this.RosterView({model:this.roster})},this.registerGlobalEventHandlers=function(){a(document).click(function(){a(".toggle-otr ul").is(":visible")&&a(".toggle-otr ul",this).slideUp(),a(".toggle-smiley ul").is(":visible")&&a(".toggle-smiley ul",this).slideUp()}),a(window).on("blur focus",a.proxy(function(a){this.windowState!=a.type&&"focus"==a.type&&h.clearMsgCounter(),this.windowState=a.type},this))},this.onReconnected=function(){this.initStatus(a.proxy(function(){this.registerRosterXHandler(),this.registerPresenceHandler(),this.chatboxes.registerMessageHandler(),h.xmppstatus.sendPresence(),this.giveFeedback(p("Online Contacts"))},this))},this.onConnected=function(){this.debug&&(this.connection.xmlInput=function(a){e.log(a)},this.connection.xmlOutput=function(a){e.log(a)},Strophe.log=function(a,b){e.log(a+" "+b)},Strophe.error=function(a){e.log("ERROR: "+a)}),this.bare_jid=Strophe.getBareJidFromJid(this.connection.jid),this.domain=Strophe.getDomainFromJid(this.connection.jid),this.features=new this.Features,this.initStatus(a.proxy(function(){this.initRoster(),this.chatboxes.onConnected(),this.connection.roster.get(function(){}),this.registerGlobalEventHandlers(),this.giveFeedback(p("Online Contacts")),this.callback&&("jasmine tests"===this.connection.service?this.callback(this):this.callback())},this)),h.emit("onReady")},this.OTR=Backbone.Model.extend({getSessionPassphrase:function(){if(h.prebind){var a=hex_sha1(h.connection.jid),b=window.sessionStorage[a];return"undefined"==typeof b&&(b=Math.floor(4294967295*Math.random()).toString(),window.sessionStorage[a]=b),b}return h.connection.pass},generatePrivateKey:function(){var a=new d,b=h.connection.jid;if(h.cache_otr_key){var c=CryptoJS.lib.PasswordBasedCipher,e=this.getSessionPassphrase();"undefined"!=typeof e&&(window.sessionStorage[hex_sha1(b+"priv_key")]=c.encrypt(CryptoJS.algo.AES,a.packPrivate(),e).toString(),window.sessionStorage[hex_sha1(b+"instance_tag")]=instance_tag,window.sessionStorage[hex_sha1(b+"pass_check")]=c.encrypt(CryptoJS.algo.AES,"match",e).toString())}return a}}),this.Message=Backbone.Model.extend(),this.Messages=Backbone.Collection.extend({model:h.Message}),this.ChatBox=Backbone.Model.extend({initialize:function(){"controlbox"!==this.get("box_id")&&(this.messages=new h.Messages,this.messages.localStorage=new Backbone.LocalStorage(hex_sha1("converse.messages"+this.get("jid")+h.bare_jid)),this.set({user_id:Strophe.getNodeFromJid(this.get("jid")),box_id:hex_sha1(this.get("jid")),otr_status:this.get("otr_status")||i}))},getSession:function(a){var b,e,f,g,i=CryptoJS.lib.PasswordBasedCipher;if(h.cache_otr_key&&(b=h.otr.getSessionPassphrase(),"undefined"!=typeof b&&(e=window.sessionStorage[hex_sha1(this.id+"instance_tag")],f=window.sessionStorage[hex_sha1(this.id+"priv_key")],g=window.sessionStorage[hex_sha1(this.connection.jid+"pass_check")],f&&e&&"undefined"!=typeof g))){var j=i.decrypt(CryptoJS.algo.AES,f,b),k=d.parsePrivate(j.toString(CryptoJS.enc.Latin1));if("match"===i.decrypt(CryptoJS.algo.AES,g,b).toString(CryptoJS.enc.Latin1))return this.trigger("showHelpMessages",[p("Re-establishing encrypted session")]),void a({key:k,instance_tag:e})}this.trigger("showHelpMessages",[p("Generating private key."),p("Your browser might become unresponsive.")],null,!0),setTimeout(function(){a({key:h.otr.generatePrivateKey.apply(this),instance_tag:c.makeInstanceTag()})},500)},updateOTRStatus:function(a){switch(a){case c.CONST.STATUS_AKE_SUCCESS:this.otr.msgstate===c.CONST.MSGSTATE_ENCRYPTED&&this.save({otr_status:j});break;case c.CONST.STATUS_END_OTR:this.otr.msgstate===c.CONST.MSGSTATE_FINISHED?this.save({otr_status:l}):this.otr.msgstate===c.CONST.MSGSTATE_PLAINTEXT&&this.save({otr_status:i})}},onSMP:function(a,b){switch(a){case"question":this.otr.smpSecret(prompt(p("Authentication request from %1$s\n\nYour buddy is attempting to verify your identity, by asking you the question below.\n\n%2$s",[this.get("fullname"),b])));break;case"trust":b===!0?this.save({otr_status:k}):(this.trigger("showHelpMessages",[p("Could not verify this user's identify.")],"error"),this.save({otr_status:j}));break;default:throw new Error("Unknown type.")}},initiateOTR:function(b){this.save({otr_status:i});this.getSession(a.proxy(function(d){this.otr=new c({fragment_size:140,send_interval:200,priv:d.key,instance_tag:d.instance_tag,debug:this.debug}),this.otr.on("status",a.proxy(this.updateOTRStatus,this)),this.otr.on("smp",a.proxy(this.onSMP,this)),this.otr.on("ui",a.proxy(function(a){this.trigger("showReceivedOTRMessage",a)},this)),this.otr.on("io",a.proxy(function(a){this.trigger("sendMessageStanza",a)},this)),this.otr.on("error",a.proxy(function(a){this.trigger("showOTRError",a)},this)),this.trigger("showHelpMessages",[p("Exchanging private key with buddy.")]),b?this.otr.receiveMsg(b):this.otr.sendQueryMsg()},this))},endOTR:function(){this.otr&&this.otr.endOtr(),this.save({otr_status:i})},createMessage:function(c){var d,e,f,g=a(c),i=g.children("body").text(),j=Strophe.getBareJidFromJid(g.attr("from")),k=g.find("composing"),l=g.find("delay").length>0,m=this.get("fullname");m=(b.isEmpty(m)?j:m).split(" ")[0],i?(l?(d=g.find("delay").attr("stamp"),e=d):e=h.toISOString(new Date),f=j==h.bare_jid?"me":"them",this.messages.create({fullname:m,sender:f,delayed:l,time:e,message:i})):k.length&&this.messages.add({fullname:m,sender:"them",delayed:l,time:h.toISOString(new Date),composing:k.length})},receiveMessage:function(c){var d=a(c).children("body"),e=d.length>0?d.text():void 0;return e&&h.allow_otr?void(e.match(/^\?OTRv23?/)?this.initiateOTR(e):b.contains([j,k],this.get("otr_status"))?this.otr.receiveMsg(e):e.match(/^\?OTR/)?this.otr?this.otr.receiveMsg(e):this.initiateOTR(e):this.createMessage(c)):this.createMessage(c)}}),this.ChatBoxView=Backbone.View.extend({length:200,tagName:"div",className:"chatbox",is_chatroom:!1,events:{"click .close-chatbox-button":"closeChat","keypress textarea.chat-textarea":"keyPressed","click .toggle-smiley":"toggleEmoticonMenu","click .toggle-smiley ul li":"insertEmoticon","click .toggle-otr":"toggleOTRMenu","click .start-otr":"startOTRFromToolbar","click .end-otr":"endOTR","click .auth-otr":"authOTR","click .toggle-call":"toggleCall"},template:b.template('<div class="chat-head chat-head-chatbox"><a class="close-chatbox-button icon-close"></a><a href="{{url}}" target="_blank" class="user"><div class="chat-title"> {{ fullname }} </div></a><p class="user-custom-message"><p/></div><div class="chat-content"></div><form class="sendXMPPMessage" action="" method="post">{[ if ('+h.show_toolbar+') { ]}<ul class="chat-toolbar no-text-select"></ul>{[ } ]}<textarea type="text" class="chat-textarea" placeholder="'+p("Personal message")+'"/></form>'),toolbar_template:b.template('{[ if (show_emoticons)  { ]}<li class="toggle-smiley icon-happy" title="Insert a smilery"><ul><li><a class="icon-smiley" href="#" data-emoticon=":)"></a></li><li><a class="icon-wink" href="#" data-emoticon=";)"></a></li><li><a class="icon-grin" href="#" data-emoticon=":D"></a></li><li><a class="icon-tongue" href="#" data-emoticon=":P"></a></li><li><a class="icon-cool" href="#" data-emoticon="8)"></a></li><li><a class="icon-evil" href="#" data-emoticon=">:)"></a></li><li><a class="icon-confused" href="#" data-emoticon=":S"></a></li><li><a class="icon-wondering" href="#" data-emoticon=":\\"></a></li><li><a class="icon-angry" href="#" data-emoticon=">:("></a></li><li><a class="icon-sad" href="#" data-emoticon=":("></a></li><li><a class="icon-shocked" href="#" data-emoticon=":O"></a></li><li><a class="icon-thumbs-up" href="#" data-emoticon="(^.^)b"></a></li><li><a class="icon-heart" href="#" data-emoticon="<3"></a></li></ul></li>{[ } ]}{[ if ('+h.show_call_button+')  { ]}<li><a class="toggle-call icon-phone" title="Start a call"></a></li>{[ } ]}{[ if (allow_otr)  { ]}<li class="toggle-otr {{otr_status_class}}" title="{{otr_tooltip}}"><span class="chat-toolbar-text">{{otr_translated_status}}</span>{[ if (otr_status == "'+i+'") { ]}<span class="icon-unlocked"></span>{[ } ]}{[ if (otr_status == "'+j+'") { ]}<span class="icon-lock"></span>{[ } ]}{[ if (otr_status == "'+k+'") { ]}<span class="icon-lock"></span>{[ } ]}{[ if (otr_status == "'+l+'") { ]}<span class="icon-unlocked"></span>{[ } ]}<ul>{[ if (otr_status == "'+i+'") { ]}<li><a class="start-otr" href="#">'+p("Start encrypted conversation")+'</a></li>{[ } ]}{[ if (otr_status != "'+i+'") { ]}<li><a class="start-otr" href="#">'+p("Refresh encrypted conversation")+'</a></li><li><a class="end-otr" href="#">'+p("End encrypted conversation")+'</a></li><li><a class="auth-otr" data-scheme="smp" href="#">'+p("Verify with SMP")+'</a></li>{[ } ]}{[ if (otr_status == "'+j+'") { ]}<li><a class="auth-otr" data-scheme="fingerprint" href="#">'+p("Verify with fingerprints")+'</a></li>{[ } ]}<li><a href="http://www.cypherpunks.ca/otr/help/3.2.0/levels.php" target="_blank">'+p("What's this?")+"</a></li></ul></li>{[ } ]}"),message_template:b.template('<div class="chat-message {{extra_classes}}"><span class="chat-message-{{sender}}">{{time}} {{username}}:&nbsp;</span><span class="chat-message-content">{{message}}</span></div>'),action_template:b.template('<div class="chat-message {{extra_classes}}"><span class="chat-message-{{sender}}">{{time}} **{{username}} </span><span class="chat-message-content">{{message}}</span></div>'),new_day_template:b.template('<time class="chat-date" datetime="{{isodate}}">{{datestring}}</time>'),initialize:function(){this.model.messages.on("add",this.onMessageAdded,this),this.model.on("show",this.show,this),this.model.on("destroy",this.hide,this),this.model.on("change",this.onChange,this),this.model.on("showOTRError",this.showOTRError,this),this.model.on("buddyStartsOTR",this.buddyStartsOTR,this),this.model.on("showHelpMessages",this.showHelpMessages,this),this.model.on("sendMessageStanza",this.sendMessageStanza,this),this.model.on("showSentOTRMessage",function(a){this.showMessage({message:a,sender:"me"})},this),this.model.on("showReceivedOTRMessage",function(a){this.showMessage({message:a,sender:"them"})},this),this.updateVCard(),this.$el.appendTo(h.chatboxesview.$el),this.render().show().model.messages.fetch({add:!0}),this.model.get("status")&&this.showStatusMessage(this.model.get("status")),(b.contains([j,k],this.model.get("otr_status"))||h.use_otr_by_default)&&this.model.initiateOTR()},render:function(){return this.$el.attr("id",this.model.get("box_id")).html(this.template(this.model.toJSON())),this.renderToolbar().renderAvatar(),this},showStatusNotification:function(b){var c=this.$el.find(".chat-content");c.find("div.chat-event").remove().end().append(a('<div class="chat-event"></div>').text(b)),this.scrollDown()},showMessage:function(b){var c,d,e=this.$el.find(".chat-content"),f=b.time?h.parseISO8601(b.time):new Date,g=b.message,i=g.match(/^\/(.*?)(?: (.*))?$/),j=b.fullname||this.model.get("fullname");i&&"me"===i[1]?(g=g.replace(/^\/me/,""),c=this.action_template,d=j):(c=this.message_template,d="me"===b.sender&&p("me")||j),e.find("div.chat-event").remove();var k=c({sender:b.sender,time:f.toTimeString().substring(0,5),username:d,message:"",extra_classes:b.delayed&&"delayed"||""});return e.append(a(k).children(".chat-message-content").first().text(g).addHyperlinks().addEmoticons().parent()),this.scrollDown()},showHelpMessages:function(b,c,d){var e,f=this.$el.find(".chat-content"),g=b.length;for(e=0;g>e;e++)f.append(a('<div class="chat-'+(c||"info")+'">'+b[e]+"</div>"));return d===!0?f.append('<span class="spinner"/>'):d===!1&&f.find("span.spinner").remove(),this.scrollDown()},onMessageAdded:function(a){var c,d,e,f,g=a.get("time"),i=this.model.messages.pluck("time"),j=h.parseISO8601(g);return d=b.indexOf(i,g)-1,d>=0&&(c=this.model.messages.at(d),e=h.parseISO8601(c.get("time")),f=new Date(j.getTime()),f.setUTCHours(0,0,0,0),f=h.toISOString(f),this.isDifferentDay(e,j)&&this.$el.find(".chat-content").append(this.new_day_template({isodate:f,datestring:j.toString().substring(0,15)}))),a.get("composing")?void this.showStatusNotification(a.get("fullname")+" is typing"):(this.showMessage(b.clone(a.attributes)),"me"!=a.get("sender")&&"blur"==h.windowState&&h.incrementMsgCounter(),this.scrollDown())},isDifferentDay:function(a,b){return b.getDate()!=a.getDate()||b.getFullYear()!=a.getFullYear()||b.getMonth()!=a.getMonth()},sendMessageStanza:function(a){var b=(new Date).getTime(),c=this.model.get("jid"),d=$msg({from:h.connection.jid,to:c,type:"chat",id:b}).c("body").t(a).up().c("active",{xmlns:"http://jabber.org/protocol/chatstates"}),e=$msg({to:h.bare_jid,type:"chat",id:b}).c("forwarded",{xmlns:"urn:xmpp:forward:0"}).c("delay",{xmns:"urn:xmpp:delay",stamp:b}).up().cnode(d.tree());h.connection.send(d),h.connection.send(e)},sendMessage:function(a){var c,d=a.replace(/^\s*/,"").match(/^\/(.*)\s*$/);if(d){if("clear"===d[1])return this.$el.find(".chat-content").empty(),void this.model.messages.reset().localStorage._clear();if("help"===d[1])return c=["<strong>/help</strong>:"+p("Show this menu"),"<strong>/me</strong>:"+p("Write in the third person"),"<strong>/clear</strong>:"+p("Remove messages")],void this.showHelpMessages(c);if(h.allow_otr&&"endotr"===d[1])return this.endOTR();if(h.allow_otr&&"otr"===d[1])return this.model.initiateOTR()}if(b.contains([j,k],this.model.get("otr_status")))this.model.otr.sendMsg(a),this.model.trigger("showSentOTRMessage",a);else{var e=h.xmppstatus.get("fullname");e=b.isEmpty(e)?h.bare_jid:e,this.model.messages.create({fullname:e,sender:"me",time:h.toISOString(new Date),message:a}),this.sendMessageStanza(a)}},keyPressed:function(b){var c,d,e,f=a(b.target);b.keyCode==m.ENTER?(b.preventDefault(),c=f.val(),f.val("").focus(),""!==c&&(this.model.get("chatroom")?this.sendChatRoomMessage(c):this.sendMessage(c),h.emit("onMessageSend",c)),this.$el.data("composing",!1)):this.model.get("chatroom")||(e=this.$el.data("composing"),e||(47!=b.keyCode&&(d=$msg({to:this.model.get("jid"),type:"chat"}).c("composing",{xmlns:"http://jabber.org/protocol/chatstates"}),h.connection.send(d)),this.$el.data("composing",!0)))},insertEmoticon:function(b){b.stopPropagation(),this.$el.find(".toggle-smiley ul").slideToggle(200);var c=this.$el.find("textarea.chat-textarea"),d=c.val(),e=a(b.target);e=e.is("a")?e:e.children("a"),d&&" "!==d[d.length-1]&&(d+=" "),c.focus().val(d+e.data("emoticon")+" ")},toggleEmoticonMenu:function(a){a.stopPropagation(),this.$el.find(".toggle-smiley ul").slideToggle(200)},toggleOTRMenu:function(a){a.stopPropagation(),this.$el.find(".toggle-otr ul").slideToggle(200)},showOTRError:function(a){"Message cannot be sent at this time."==a?this.showHelpMessages([p("Your message could not be sent")],"error"):"Received an unencrypted message."==a?this.showHelpMessages([p("We received an unencrypted message")],"error"):"Received an unreadable encrypted message."==a?this.showHelpMessages([p("We received an unreadable encrypted message")],"error"):this.showHelpMessages(["Encryption error occured: "+a],"error"),e.log("OTR ERROR:"+a)},buddyStartsOTR:function(){this.showHelpMessages([p("This user has requested an encrypted session.")]),this.model.initiateOTR()},startOTRFromToolbar:function(b){a(b.target).parent().parent().slideUp(),b.stopPropagation(),this.model.initiateOTR()},endOTR:function(a){"undefined"!=typeof a&&(a.preventDefault(),a.stopPropagation()),this.model.endOTR()},authOTR:function(b){var c,d,e,f=a(b.target).data().scheme;"fingerprint"===f?(c=confirm(p("Here are the fingerprints, please confirm them with %1$s, outside of this chat.\n\nFingerprint for you, %2$s: %3$s\n\nFingerprint for %1$s: %4$s\n\nIf you have confirmed that the fingerprints match, click OK, otherwise click Cancel.",[this.model.get("fullname"),h.xmppstatus.get("fullname")||h.bare_jid,this.model.otr.priv.fingerprint(),this.model.otr.their_priv_pk.fingerprint()])),this.model.save(c===!0?{otr_status:k}:{otr_status:j})):"smp"===f?(alert(p("You will be prompted to provide a security question and then an answer to that question.\n\nYour buddy will then be prompted the same question and if they type the exact same answer (case sensitive), their identity will be verified.")),d=prompt(p("What is your security question?")),d&&(e=prompt(p("What is the answer to the security question?")),this.model.otr.smpSecret(e,d))):this.showHelpMessages([p("Invalid authentication scheme provided")],"error")},toggleCall:function(a){a.stopPropagation(),h.emit("onCallButtonClicked",{connection:h.connection,model:this.model})},onChange:function(a){if(b.has(a.changed,"chat_status")){var c=a.get("chat_status"),d=a.get("fullname");
d=b.isEmpty(d)?a.get("jid"):d,this.$el.is(":visible")&&("offline"===c?this.showStatusNotification(d+" has gone offline"):"away"===c?this.showStatusNotification(d+" has gone away"):"dnd"===c?this.showStatusNotification(d+" is busy"):"online"===c&&this.$el.find("div.chat-event").remove()),h.emit("onBuddyStatusChanged",a.attributes,a.get("chat_status"))}b.has(a.changed,"status")&&(this.showStatusMessage(a.get("status")),h.emit("onBuddyStatusMessageChanged",a.attributes,a.get("status"))),b.has(a.changed,"image")&&this.renderAvatar(),b.has(a.changed,"otr_status")&&this.renderToolbar().informOTRChange()},showStatusMessage:function(a){this.$el.find("p.user-custom-message").text(a).attr("title",a)},closeChat:function(){h.connection?this.model.destroy():this.model.trigger("hide")},updateVCard:function(){var b=this.model.get("jid"),c=h.roster.get(b);c&&!c.get("vcard_updated")&&h.getVCard(b,a.proxy(function(a,b,c,d,e){this.model.save({fullname:b||a,url:e,image_type:d,image:c})},this),a.proxy(function(){h.log("ChatBoxView.initialize: An error occured while fetching vcard")},this))},informOTRChange:function(){var a=this.model.toJSON(),b=[];return a.otr_status==i?b.push(p("Your messages are not encrypted anymore")):a.otr_status==j?b.push(p("Your messages are now encrypted but your buddy's identity has not been verified.")):a.otr_status==k?b.push(p("Your buddy's identify has been verified.")):a.otr_status==l&&b.push(p("Your buddy has ended encryption on their end, you should do the same.")),this.showHelpMessages(b,"info",!1)},renderToolbar:function(){if(h.show_toolbar){var a=this.model.toJSON();a.otr_status==i?a.otr_tooltip=p("Your messages are not encrypted. Click here to enable OTR encryption."):a.otr_status==j?a.otr_tooltip=p("Your messages are encrypted, but your buddy has not been verified."):a.otr_status==k?a.otr_tooltip=p("Your messages are encrypted and your buddy verified."):a.otr_status==l&&(a.otr_tooltip=p("Your buddy has closed their end of the private session, you should do the same")),a.allow_otr=h.allow_otr&&!this.is_chatroom,a.show_emoticons=h.show_emoticons,a.otr_translated_status=s[a.otr_status],a.otr_status_class=r[a.otr_status],this.$el.find(".chat-toolbar").html(this.toolbar_template(a))}return this},renderAvatar:function(){if(this.model.get("image")){var b="data:"+this.model.get("image_type")+";base64,"+this.model.get("image"),c=a('<canvas height="33px" width="33px" class="avatar"></canvas>').get(0);if(!c.getContext||!c.getContext("2d"))return this;var d=c.getContext("2d"),e=new Image;return e.onload=function(){var a=e.width/e.height;d.drawImage(e,0,0,35*a,35)},e.src=b,this.$el.find(".chat-title").before(c),this}},focus:function(){return this.$el.find(".chat-textarea").focus(),this},hide:function(){this.$el.is(":visible")&&"1"==this.$el.css("opacity")&&(h.animate?this.$el.hide("fast"):this.$el.hide(),h.emit("onChatBoxClosed",this))},show:function(){return this.$el.is(":visible")&&"1"==this.$el.css("opacity")?(h.emit("onChatBoxFocused",this),this.focus()):(h.animate?this.$el.css({opacity:0,display:"inline"}).animate({opacity:"1"},200):this.$el.css({opacity:1,display:"inline"}),h.connection&&this.model.save(),h.emit("onChatBoxOpened",this),this)},scrollDown:function(){var a=this.$el.find(".chat-content");return a.scrollTop(a[0].scrollHeight),this}}),this.ContactsPanel=Backbone.View.extend({tagName:"div",className:"oc-chat-content",id:"users",events:{"click a.toggle-xmpp-contact-form":"toggleContactForm","submit form.add-xmpp-contact":"addContactFromForm","submit form.search-xmpp-contact":"searchContacts","click a.subscribe-to-user":"addContactFromList"},tab_template:b.template('<li><a class="s current" href="#users">'+p("Contacts")+"</a></li>"),template:b.template('<form class="set-xmpp-status" action="" method="post"><span id="xmpp-status-holder"><select id="select-xmpp-status" style="display:none"><option value="online">'+p("Online")+'</option><option value="dnd">'+p("Busy")+'</option><option value="away">'+p("Away")+'</option><option value="offline">'+p("Offline")+"</option></select></span></form>"),add_contact_dropdown_template:b.template('<dl class="add-converse-contact dropdown"><dt id="xmpp-contact-search" class="fancy-dropdown"><a class="toggle-xmpp-contact-form" href="#"title="'+p("Click to add new chat contacts")+'"><span class="icon-plus"></span>'+p("Add a contact")+'</a></dt><dd class="search-xmpp" style="display:none"><ul></ul></dd></dl>'),add_contact_form_template:b.template('<li><form class="add-xmpp-contact"><input type="text" name="identifier" class="username" placeholder="'+p("Contact username")+'"/><button type="submit">'+p("Add")+"</button></form><li>"),search_contact_template:b.template('<li><form class="search-xmpp-contact"><input type="text" name="identifier" class="username" placeholder="'+p("Contact name")+'"/><button type="submit">'+p("Search")+"</button></form><li>"),initialize:function(a){a.$parent.append(this.$el),this.$tabs=a.$parent.parent().find("#controlbox-tabs")},render:function(){var a,b=this.template();return this.$tabs.append(this.tab_template()),a=h.xhr_user_search?this.search_contact_template():this.add_contact_form_template(),h.allow_contact_requests&&(b+=this.add_contact_dropdown_template()),this.$el.html(b),this.$el.find(".search-xmpp ul").append(a),this.$el.append(h.rosterview.$el),this},toggleContactForm:function(b){b.preventDefault(),this.$el.find(".search-xmpp").toggle("fast",function(){a(this).is(":visible")&&a(this).find("input.username").focus()})},searchContacts:function(b){b.preventDefault(),a.getJSON(xhr_user_search_url+"?q="+a(b.target).find("input.username").val(),function(b){var c=a(".search-xmpp ul");c.find("li.found-user").remove(),c.find("li.chat-info").remove(),b.length||c.append('<li class="chat-info">'+p("No users found")+"</li>"),a(b).each(function(b,d){c.append(a('<li class="found-user"></li>').append(a('<a class="subscribe-to-user" href="#" title="'+p("Click to add as a chat contact")+'"></a>').attr("data-recipient",Strophe.escapeNode(d.id)+"@"+h.domain).text(d.fullname)))})})},addContactFromForm:function(b){b.preventDefault();var c=a(b.target).find("input"),d=c.val();return d?(this.addContact(d),void a(".search-xmpp").hide()):void c.addClass("error")},addContactFromList:function(b){b.preventDefault();var c=a(b.target),d=c.attr("data-recipient"),e=c.text();this.addContact(d,e),c.parent().remove(),a(".search-xmpp").hide()},addContact:function(a,c){c=b.isEmpty(c)?a:c,h.connection.roster.add(a,c,[],function(){h.connection.roster.subscribe(a,null,h.xmppstatus.get("fullname"))})}}),this.RoomsPanel=Backbone.View.extend({tagName:"div",id:"chatrooms",events:{"submit form.add-chatroom":"createChatRoom","click input#show-rooms":"showRooms","click a.open-room":"createChatRoom","click a.room-info":"showRoomInfo"},room_template:b.template('<dd class="available-chatroom"><a class="open-room" data-room-jid="{{jid}}"title="'+p("Click to open this room")+'" href="#">{{name}}</a><a class="room-info icon-room-info" data-room-jid="{{jid}}"title="'+p("Show more information on this room")+'" href="#">&nbsp;</a></dd>'),room_description_template:b.template('<div class="room-info"><p class="room-info"><strong>'+p("Description:")+'</strong> {{desc}}</p><p class="room-info"><strong>'+p("Occupants:")+'</strong> {{occ}}</p><p class="room-info"><strong>'+p("Features:")+'</strong> <ul>{[ if (passwordprotected) { ]}<li class="room-info locked">'+p("Requires authentication")+'</li>{[ } ]}{[ if (hidden) { ]}<li class="room-info">'+p("Hidden")+'</li>{[ } ]}{[ if (membersonly) { ]}<li class="room-info">'+p("Requires an invitation")+'</li>{[ } ]}{[ if (moderated) { ]}<li class="room-info">'+p("Moderated")+'</li>{[ } ]}{[ if (nonanonymous) { ]}<li class="room-info">'+p("Non-anonymous")+'</li>{[ } ]}{[ if (open) { ]}<li class="room-info">'+p("Open room")+'</li>{[ } ]}{[ if (persistent) { ]}<li class="room-info">'+p("Permanent room")+'</li>{[ } ]}{[ if (publicroom) { ]}<li class="room-info">'+p("Public")+'</li>{[ } ]}{[ if (semianonymous) { ]}<li class="room-info">'+p("Semi-anonymous")+'</li>{[ } ]}{[ if (temporary) { ]}<li class="room-info">'+p("Temporary room")+'</li>{[ } ]}{[ if (unmoderated) { ]}<li class="room-info">'+p("Unmoderated")+"</li>{[ } ]}</p></div>"),tab_template:b.template('<li><a class="s" href="#chatrooms">'+p("Rooms")+"</a></li>"),template:b.template('<form class="add-chatroom" action="" method="post"><input type="text" name="chatroom" class="new-chatroom-name" placeholder="'+p("Room name")+'"/><input type="text" name="nick" class="new-chatroom-nick" placeholder="'+p("Nickname")+'"/><input type="{{ server_input_type }}" name="server" class="new-chatroom-server" placeholder="'+p("Server")+'"/><input type="submit" name="join" value="'+p("Join")+'"/><input type="button" name="show" id="show-rooms" value="'+p("Show rooms")+'"/></form><dl id="available-chatrooms"></dl>'),initialize:function(c){c.$parent.append(this.$el.html(this.template({server_input_type:h.hide_muc_server&&"hidden"||"text"})).hide()),this.$tabs=c.$parent.parent().find("#controlbox-tabs"),this.on("update-rooms-list",function(){this.updateRoomsList()}),h.xmppstatus.on("change",a.proxy(function(a){if(b.has(a.changed,"fullname")){var c=this.$el.find("input.new-chatroom-nick");c.is(":focus")||c.val(a.get("fullname"))}},this))},render:function(){return this.$tabs.append(this.tab_template()),this},informNoRoomsFound:function(){var b=this.$el.find("#available-chatrooms");b.html("<dt>"+p("No rooms on %1$s",this.muc_domain)+"</dt>"),a("input#show-rooms").show().siblings("span.spinner").remove()},updateRoomsList:function(){h.connection.muc.listRooms(this.muc_domain,a.proxy(function(b){var c,d,e,f,g=this.$el.find("#available-chatrooms");if(this.rooms=a(b).find("query").find("item"),this.rooms.length){for(g.html("<dt>"+p("Rooms on %1$s",this.muc_domain)+"</dt>"),f=document.createDocumentFragment(),e=0;e<this.rooms.length;e++)c=Strophe.unescapeNode(a(this.rooms[e]).attr("name")||a(this.rooms[e]).attr("jid")),d=a(this.rooms[e]).attr("jid"),f.appendChild(a(this.room_template({name:c,jid:d}))[0]);g.append(f),a("input#show-rooms").show().siblings("span.spinner").remove()}else this.informNoRoomsFound();return!0},this),a.proxy(function(){this.informNoRoomsFound()},this))},showRooms:function(){var b=this.$el.find("#available-chatrooms"),c=this.$el.find("input.new-chatroom-server"),d=c.val();return d?(this.$el.find("input.new-chatroom-name").removeClass("error"),c.removeClass("error"),b.empty(),a("input#show-rooms").hide().after('<span class="spinner"/>'),this.muc_domain=d,void this.updateRoomsList()):void c.addClass("error")},showRoomInfo:function(b){var c=b.target,d=a(c).parent("dd"),e=d.find("div.room-info");e.length?e.remove():(d.find("span.spinner").remove(),d.append('<span class="spinner hor_centered"/>'),h.connection.disco.info(a(c).attr("data-room-jid"),null,a.proxy(function(b){var c=a(b);d.find("span.spinner").replaceWith(this.room_description_template({desc:c.find('field[var="muc#roominfo_description"] value').text(),occ:c.find('field[var="muc#roominfo_occupants"] value').text(),hidden:c.find('feature[var="muc_hidden"]').length,membersonly:c.find('feature[var="muc_membersonly"]').length,moderated:c.find('feature[var="muc_moderated"]').length,nonanonymous:c.find('feature[var="muc_nonanonymous"]').length,open:c.find('feature[var="muc_open"]').length,passwordprotected:c.find('feature[var="muc_passwordprotected"]').length,persistent:c.find('feature[var="muc_persistent"]').length,publicroom:c.find('feature[var="muc_public"]').length,semianonymous:c.find('feature[var="muc_semianonymous"]').length,temporary:c.find('feature[var="muc_temporary"]').length,unmoderated:c.find('feature[var="muc_unmoderated"]').length}))},this)))},createChatRoom:function(b){b.preventDefault();var c,d,e,f,g,i,j=this.$el.find("input.new-chatroom-nick"),k=j.val();if(k?j.removeClass("error"):j.addClass("error"),"click"===b.type)g=a(b.target).attr("data-room-jid");else{if(d=this.$el.find("input.new-chatroom-name"),f=this.$el.find("input.new-chatroom-server"),e=f.val(),c=d.val().trim().toLowerCase(),d.val(""),!c||!e)return c||d.addClass("error"),void(e||f.addClass("error"));g=Strophe.escapeNode(c)+"@"+e,d.removeClass("error"),f.removeClass("error"),this.muc_domain=e}k&&(i=h.chatboxesview.showChatBox({id:g,jid:g,name:Strophe.unescapeNode(Strophe.getNodeFromJid(g)),nick:k,chatroom:!0,box_id:hex_sha1(g)}),i.get("connected")||h.chatboxesview.views[g].connect(null))}}),this.ControlBoxView=h.ChatBoxView.extend({tagName:"div",className:"chatbox",id:"controlbox",events:{"click a.close-chatbox-button":"closeChat","click ul#controlbox-tabs li a":"switchTab"},initialize:function(){this.$el.appendTo(h.chatboxesview.$el),this.model.on("change",a.proxy(function(c){if(b.has(c.changed,"connected")){this.render(),h.features.on("add",a.proxy(this.featureAdded,this));var d=h.features.findWhere({"var":"http://jabber.org/protocol/muc"});d&&this.featureAdded(d)}b.has(c.changed,"visible")&&c.changed.visible===!0&&this.show()},this)),this.model.on("show",this.show,this),this.model.on("destroy",this.hide,this),this.model.on("hide",this.hide,this),this.model.get("visible")&&this.show()},featureAdded:function(a){if("http://jabber.org/protocol/muc"==a.get("var")&&h.allow_muc){this.roomspanel.muc_domain=a.get("from");var b=this.$el.find("input.new-chatroom-server");b.is(":focus")||b.val(this.roomspanel.muc_domain),h.auto_list_rooms&&this.roomspanel.trigger("update-rooms-list")}},template:b.template('<div class="chat-head oc-chat-head"><ul id="controlbox-tabs"></ul><a class="close-chatbox-button icon-close"></a></div><div class="controlbox-panes"></div>'),switchTab:function(b){b.preventDefault();var c=a(b.target),d=c.parent().siblings("li").children("a"),e=a(c.attr("href")),f=a(d.attr("href"));f.fadeOut("fast",function(){d.removeClass("current"),c.addClass("current"),e.fadeIn("fast",function(){})})},showHelpMessages:function(){},render:function(){return h.prebind||h.connection?this.contactspanel||(this.$el.html(this.template(this.model.toJSON())),this.contactspanel=new h.ContactsPanel({$parent:this.$el.find(".controlbox-panes")}),this.contactspanel.render(),h.xmppstatusview=new h.XMPPStatusView({model:h.xmppstatus}),h.xmppstatusview.render(),h.allow_muc&&(this.roomspanel=new h.RoomsPanel({$parent:this.$el.find(".controlbox-panes")}),this.roomspanel.render())):(this.$el.html(this.template(this.model.toJSON())),this.loginpanel=new h.LoginPanel({$parent:this.$el.find(".controlbox-panes"),model:this}),this.loginpanel.render()),this}}),this.ChatRoomView=h.ChatBoxView.extend({length:300,tagName:"div",className:"chatroom",events:{"click a.close-chatbox-button":"closeChat","click a.configure-chatroom-button":"configureChatRoom","click .toggle-smiley":"toggleEmoticonMenu","click .toggle-smiley ul li":"insertEmoticon","keypress textarea.chat-textarea":"keyPressed"},info_template:b.template('<div class="chat-info">{{message}}</div>'),is_chatroom:!0,sendChatRoomMessage:function(a){var b,c=a.replace(/^\s*/,"").match(/^\/(.*?)(?: (.*))?$/)||[!1];switch(c[1]){case"msg":break;case"clear":this.$el.find(".chat-content").empty();break;case"topic":h.connection.muc.setTopic(this.model.get("jid"),c[2]);break;case"kick":h.connection.muc.kick(this.model.get("jid"),c[2]);break;case"ban":h.connection.muc.ban(this.model.get("jid"),c[2]);break;case"op":h.connection.muc.op(this.model.get("jid"),c[2]);break;case"deop":h.connection.muc.deop(this.model.get("jid"),c[2]);break;case"help":b=this.$el.find(".chat-content"),msgs=["<strong>/help</strong>:"+p("Show this menu"),"<strong>/me</strong>:"+p("Write in the third person"),"<strong>/topic</strong>:"+p("Set chatroom topic"),"<strong>/kick</strong>:"+p("Kick user from chatroom"),"<strong>/ban</strong>:"+p("Ban user from chatroom"),"<strong>/clear</strong>:"+p("Remove messages")],this.showHelpMessages(msgs);break;default:this.last_msgid=h.connection.muc.groupchat(this.model.get("jid"),a)}},template:b.template('<div class="chat-head chat-head-chatroom"><a class="close-chatbox-button icon-close"></a><a class="configure-chatroom-button icon-wrench" style="display:none"></a><div class="chat-title"> {{ name }} </div><p class="chatroom-topic"><p/></div><div class="chat-body"><span class="spinner centered"/></div>'),chatarea_template:b.template('<div class="chat-area"><div class="chat-content"></div><form class="sendXMPPMessage" action="" method="post">{[ if ('+h.show_toolbar+') { ]}<ul class="chat-toolbar no-text-select"></ul>{[ } ]}<textarea type="text" class="chat-textarea" placeholder="'+p("Message")+'"/></form></div><div class="participants"><ul class="participant-list"></ul></div>'),render:function(){return this.$el.attr("id",this.model.get("box_id")).html(this.template(this.model.toJSON())),this},renderChatArea:function(){return this.$el.find(".chat-area").length||(this.$el.find(".chat-body").empty().append(this.chatarea_template()),this.renderToolbar()),this},connect:function(c){b.has(h.connection.muc.rooms,this.model.get("jid"))?h.connection.muc.join(this.model.get("jid"),this.model.get("nick"),null,null,null,c):h.connection.muc.join(this.model.get("jid"),this.model.get("nick"),a.proxy(this.onChatRoomMessage,this),a.proxy(this.onChatRoomPresence,this),a.proxy(this.onChatRoomRoster,this),c)},initialize:function(){this.connect(null),this.model.messages.on("add",this.onMessageAdded,this),this.model.on("destroy",function(){this.hide(),h.connection.muc.leave(this.model.get("jid"),this.model.get("nick"),a.proxy(this.onLeave,this),void 0)},this),this.$el.appendTo(h.chatboxesview.$el),this.render().show().model.messages.fetch({add:!0})},onLeave:function(){this.model.set("connected",!1)},form_input_template:b.template('<label>{{label}}<input name="{{name}}" type="{{type}}" value="{{value}}"></label>'),select_option_template:b.template('<option value="{{value}}">{{label}}</option>'),form_select_template:b.template('<label>{{label}}<select name="{{name}}">{{options}}</select></label>'),form_checkbox_template:b.template('<label>{{label}}<input name="{{name}}" type="{{type}}" {{checked}}"></label>'),renderConfigurationForm:function(b){var c,d,e=this.$el.find("form.chatroom-form"),f=a(b),g=f.find("field"),h=f.find("title").text(),i=f.find("instructions").text(),j=[],k={"text-private":"password","text-single":"textline","boolean":"checkbox",hidden:"hidden","list-single":"dropdown"};for(e.find("span.spinner").remove(),e.append(a("<legend>").text(h)),i!=h&&e.append(a("<p>").text(i)),c=0;c<g.length;c++)if($field=a(g[c]),"list-single"==$field.attr("type")){for(j=[],$options=$field.find("option"),d=0;d<$options.length;d++)j.push(this.select_option_template({value:a($options[d]).find("value").text(),label:a($options[d]).attr("label")}));e.append(this.form_select_template({name:$field.attr("var"),label:$field.attr("label"),options:j.join("")}))}else e.append("boolean"==$field.attr("type")?this.form_checkbox_template({name:$field.attr("var"),type:k[$field.attr("type")],label:$field.attr("label")||"",checked:"1"===$field.find("value").text()&&'checked="1"'||""}):this.form_input_template({name:$field.attr("var"),type:k[$field.attr("type")],label:$field.attr("label")||"",value:$field.find("value").text()}));e.append('<input type="submit" value="'+p("Save")+'"/>'),e.append('<input type="button" value="'+p("Cancel")+'"/>'),e.on("submit",a.proxy(this.saveConfiguration,this)),e.find("input[type=button]").on("click",a.proxy(this.cancelConfiguration,this))},field_template:b.template('<field var="{{name}}"><value>{{value}}</value></field>'),saveConfiguration:function(b){b.preventDefault();var c=this,d=a(b.target).find(":input:not([type=button]):not([type=submit])"),e=d.length,f=[];d.each(function(){var b,d=a(this);b=d.is("[type=checkbox]")?d.is(":checked")&&1||0:d.val();var g=a(c.field_template({name:d.attr("name"),value:b}))[0];f.push(g),--e||h.connection.muc.saveConfiguration(c.model.get("jid"),f,a.proxy(c.onConfigSaved,c),a.proxy(c.onErrorConfigSaved,c))}),this.$el.find("div.chatroom-form-container").hide(function(){a(this).remove(),c.$el.find(".chat-area").show(),c.$el.find(".participants").show()})},onConfigSaved:function(){},onErrorConfigSaved:function(){this.showStatusNotification(p("An error occurred while trying to save the form."))},cancelConfiguration:function(b){b.preventDefault();var c=this;this.$el.find("div.chatroom-form-container").hide(function(){a(this).remove(),c.$el.find(".chat-area").show(),c.$el.find(".participants").show()})},configureChatRoom:function(b){b.preventDefault(),this.$el.find("div.chatroom-form-container").length||(this.$el.find(".chat-area").hide(),this.$el.find(".participants").hide(),this.$el.find(".chat-body").append(a('<div class="chatroom-form-container"><form class="chatroom-form"><span class="spinner centered"/></form></div>')),h.connection.muc.configure(this.model.get("jid"),a.proxy(this.renderConfigurationForm,this)))},submitPassword:function(a){a.preventDefault();var b=this.$el.find(".chatroom-form").find("input[type=password]").val();this.$el.find(".chatroom-form-container").replaceWith('<span class="spinner centered"/>'),this.connect(b)},renderPasswordForm:function(){this.$el.find("span.centered.spinner").remove(),this.$el.find(".chat-body").append(a('<div class="chatroom-form-container"><form class="chatroom-form"><legend>'+p("This chatroom requires a password")+"</legend><label>"+p("Password: ")+'<input type="password" name="password"/></label><input type="submit" value="'+p("Submit")+"/></form></div>")),this.$el.find(".chatroom-form").on("submit",a.proxy(this.submitPassword,this))},showDisconnectMessage:function(b){this.$el.find(".chat-area").remove(),this.$el.find(".participants").remove(),this.$el.find("span.centered.spinner").remove(),this.$el.find(".chat-body").append(a("<p>"+b+"</p>"))},infoMessages:{100:p("This room is not anonymous"),102:p("This room now shows unavailable members"),103:p("This room does not show unavailable members"),104:p("Non-privacy-related room configuration has changed"),170:p("Room logging is now enabled"),171:p("Room logging is now disabled"),172:p("This room is now non-anonymous"),173:p("This room is now semi-anonymous"),174:p("This room is now fully-anonymous"),201:p("A new room has been created"),210:p("Your nickname has been changed")},actionInfoMessages:{301:q("<strong>%1$s</strong> has been banned"),307:q("<strong>%1$s</strong> has been kicked out"),321:q("<strong>%1$s</strong> has been removed because of an affiliation change"),322:q("<strong>%1$s</strong> has been removed for not being a member")},disconnectMessages:{301:p("You have been banned from this room"),307:p("You have been kicked from this room"),321:p("You have been removed from this room because of an affiliation change"),322:p("You have been removed from this room because the room has changed to members-only and you're not a member"),332:p("You have been removed from this room because the MUC (Multi-user chat) service is being shut down.")},showStatusMessages:function(a,c){var d,e=this.$el.find(".chat-content"),f=a.find("status"),g=[],h=[],i=[];for(d=0;d<f.length;d++){var j=f[d].getAttribute("code");c?b.contains(b.keys(this.disconnectMessages),j)&&g.push(this.disconnectMessages[j]):b.contains(b.keys(this.infoMessages),j)?h.push(this.infoMessages[j]):b.contains(b.keys(this.actionInfoMessages),j)&&i.push(p(this.actionInfoMessages[j],Strophe.unescapeNode(Strophe.getResourceFromJid(a.attr("from")))))}if(g.length>0){for(d=0;d<g.length;d++)this.showDisconnectMessage(g[d]);return void this.model.set("connected",!1)}for(this.renderChatArea(),d=0;d<h.length;d++)e.append(this.info_template({message:h[d]}));for(d=0;d<i.length;d++)e.append(this.info_template({message:i[d]}));return this.scrollDown()},showErrorMessage:function(a,b){delete h.connection.muc[b.name],"auth"==a.attr("type")?a.find("not-authorized").length?this.renderPasswordForm():a.find("registration-required").length?this.showDisconnectMessage(p("You are not on the member list of this room")):a.find("forbidden").length&&this.showDisconnectMessage(p("You have been banned from this room")):"modify"==a.attr("type")?a.find("jid-malformed").length&&this.showDisconnectMessage(p("No nickname was specified")):"cancel"==a.attr("type")&&(a.find("not-allowed").length?this.showDisconnectMessage(p("You are not allowed to create new rooms")):a.find("not-acceptable").length?this.showDisconnectMessage(p("Your nickname doesn't conform to this room's policies")):a.find("conflict").length?this.showDisconnectMessage(p("Your nickname is already taken")):a.find("item-not-found").length?this.showDisconnectMessage(p("This room does not (yet) exist")):a.find("service-unavailable").length&&this.showDisconnectMessage(p("This room has reached it's maximum number of occupants")))},onChatRoomPresence:function(b,c){var d,e=c.nick,f=a(b),g=f.attr("from"),i=f.find("status[code='110']").length||g==c.name+"/"+Strophe.escapeNode(e);if("error"===f.attr("type"))this.model.set("connected",!1),this.showErrorMessage(f.find("error"),c);else{if(this.model.set("connected",!0),this.showStatusMessages(f,i),!this.model.get("connected"))return!0;f.find("status[code='201']").length&&h.connection.muc.createInstantRoom(c.name),i&&(d=f.find("item"),d.length&&"owner"==d.attr("affiliation")&&this.$el.find("a.configure-chatroom-button").show(),f.find("status[code='210']").length&&this.model.set({nick:Strophe.getResourceFromJid(g)}))}return!0},onChatRoomMessage:function(c){var d,e,f,g,i,j=a(c),k=j.children("body").text(),l=j.attr("from"),m=this.$el.find(".chat-content"),n=Strophe.getResourceFromJid(l),o=n&&Strophe.unescapeNode(n)||"",q=j.find("delay").length>0,r=j.children("subject").text();if(q?(i=j.find("delay").attr("stamp"),d=h.parseISO8601(i)):d=new Date,f=m.find("time").map(function(){return a(this).attr("datetime")}).get(),e=new Date(d.getTime()),e.setUTCHours(0,0,0,0),g=h.toISOString(e),-1==b.indexOf(f,g)&&m.append(this.new_day_template({isodate:g,datestring:e.toString().substring(0,15)})),this.showStatusMessages(j),r&&(this.$el.find(".chatroom-topic").text(r).attr("title",r),m.append(this.info_template({message:p("Topic set by %1$s to: %2$s",o,r)}))),!k)return!0;var s=o===this.model.get("nick")&&"me"||"room";return this.showMessage({message:k,sender:s,fullname:o,time:h.toISOString(d)}),"room"===s&&h.emit("onMessage",c),!0},occupant_template:b.template('<li class="{{role}}" {[ if (role === "moderator") { ]}title="'+p("This user is a moderator")+'"{[ } ]}{[ if (role === "participant") { ]}title="'+p("This user can send messages in this room")+'"{[ } ]}{[ if (role === "visitor") { ]}title="'+p("This user can NOT send messages in this room")+'"{[ } ]}>{{nick}}</li>'),onChatRoomRoster:function(a){this.renderChatArea();var c,d=(h.chatboxesview.views.controlbox,b.size(a)),e=this.$el.find(".participant-list"),f=[],g=b.keys(a);for(this.$el.find(".participant-list").empty(),c=0;d>c;c++)f.push(this.occupant_template({role:a[g[c]].role,nick:Strophe.unescapeNode(g[c])}));return e.append(f.join("")),!0}}),this.ChatBoxes=Backbone.Collection.extend({model:h.ChatBox,registerMessageHandler:function(){h.connection.addHandler(a.proxy(function(a){return this.onMessage(a),!0},this),null,"message","chat")},onConnected:function(){this.localStorage=new Backbone.LocalStorage(hex_sha1("converse.chatboxes-"+h.bare_jid)),this.get("controlbox")?this.get("controlbox").save():this.add({id:"controlbox",box_id:"controlbox"}),this.get("controlbox").set({connected:!0}),this.registerMessageHandler(),this.fetch({add:!0,success:a.proxy(function(a,c){b.include(b.pluck(c,"id"),"controlbox")&&this.get("controlbox").set({visible:!0}).save()},this)})},onMessage:function(c){var d,e=a(c),f=e.attr("from");if(f==h.connection.jid)return!0;var g=e.children("forwarded");g.length&&(e=g.children("message"));var i,j,k,l=Strophe.getBareJidFromJid(f),m=Strophe.getBareJidFromJid(e.attr("to"));if(l==h.bare_jid?(d=m,i=Strophe.getResourceFromJid(e.attr("to"))):(d=l,i=Strophe.getResourceFromJid(f)),j=this.get(d),k=h.roster.get(d),void 0===k)return h.log("Could not get roster item for JID "+d,"error"),!0;if(!j){var n=k.get("fullname");n=b.isEmpty(n)?d:n,j=this.create({id:d,jid:d,fullname:n,image_type:k.get("image_type"),image:k.get("image"),url:k.get("url")})}return j.receiveMessage(c),h.roster.addResource(d,i),h.emit("onMessage",c),!0}}),this.ChatBoxesView=Backbone.View.extend({el:"#conversejs",initialize:function(){this.views={},this.model.on("add",function(a){var b=this.views[a.get("id")];b?(delete b.model,b.model=a,b.initialize(),"controlbox"!==a.get("id")&&b.$el.appendTo(this.$el)):(a.get("chatroom")?b=new h.ChatRoomView({model:a}):"controlbox"===a.get("box_id")?(b=new h.ControlBoxView({model:a}),b.render()):b=new h.ChatBoxView({model:a}),this.views[a.get("id")]=b)},this)},showChatBox:function(a){var b=this.model.get(a.jid);return b?b.trigger("show"):b=this.model.create(a,{error:function(a,b){h.log(b.responseText)}}),b}}),this.RosterItem=Backbone.Model.extend({initialize:function(a){var c=a.jid;a.fullname||(a.fullname=c);var d=b.extend({id:c,user_id:Strophe.getNodeFromJid(c),resources:[],status:""},a);d.sorted=!1,d.chat_status="offline",this.set(d)}}),this.RosterItemView=Backbone.View.extend({tagName:"dd",events:{"click .accept-xmpp-request":"acceptRequest","click .decline-xmpp-request":"declineRequest","click .open-chat":"openChat","click .remove-xmpp-contact":"removeContact"},openChat:function(a){a.preventDefault(),h.chatboxesview.showChatBox({id:this.model.get("jid"),jid:this.model.get("jid"),fullname:this.model.get("fullname"),image_type:this.model.get("image_type"),image:this.model.get("image"),url:this.model.get("url"),status:this.model.get("status")})},removeContact:function(a){a.preventDefault();var b=confirm("Are you sure you want to remove this contact?");if(b===!0){var c=this.model.get("jid");h.connection.roster.remove(c,function(){h.connection.roster.unauthorize(c),h.rosterview.model.remove(c)})}},acceptRequest:function(a){var b=this.model.get("jid");h.connection.roster.authorize(b),h.connection.roster.add(b,this.model.get("fullname"),[],function(){h.connection.roster.subscribe(b,null,h.xmppstatus.get("fullname"))}),a.preventDefault()},declineRequest:function(a){a.preventDefault(),h.connection.roster.unauthorize(this.model.get("jid")),this.model.destroy()},template:b.template('<a class="open-chat" title="'+p("Click to chat with this contact")+'" href="#"><span class="icon-{{ chat_status }}" title="{{ status_desc }}"></span>{{ fullname }}</a><a class="remove-xmpp-contact icon-remove" title="'+p("Click to remove this contact")+'" href="#"></a>'),pending_template:b.template('<span>{{ fullname }}</span><a class="remove-xmpp-contact icon-remove" title="'+p("Click to remove this contact")+'" href="#"></a>'),request_template:b.template('<div>{{ fullname }}</div><button type="button" class="accept-xmpp-request">Accept</button><button type="button" class="decline-xmpp-request">Decline</button>'),render:function(){var a=this.model,c=a.get("ask"),d=a.get("requesting"),e=a.get("subscription"),f=["current-xmpp-contact","pending-xmpp-contact","requesting-xmpp-contact"].concat(b.keys(t));return b.each(f,function(a){-1!==this.el.className.indexOf(a)&&this.$el.removeClass(a)},this),this.$el.addClass(a.get("chat_status")),"subscribe"===c?(this.$el.addClass("pending-xmpp-contact"),this.$el.html(this.pending_template(a.toJSON()))):d===!0?(this.$el.addClass("requesting-xmpp-contact"),this.$el.html(this.request_template(a.toJSON())),h.controlboxtoggle.showControlBox()):("both"===e||"to"===e)&&(this.$el.addClass("current-xmpp-contact"),this.$el.html(this.template(b.extend(a.toJSON(),{status_desc:t[a.get("chat_status")||"offline"]})))),this}}),this.RosterItems=Backbone.Collection.extend({model:h.RosterItem,comparator:function(a){var b=a.get("chat_status"),c=4;switch(b){case"offline":c=0;break;case"unavailable":c=1;break;case"xa":c=2;break;case"away":c=3;break;case"dnd":c=4;break;case"online":c=5}return c},subscribeToSuggestedItems:function(b){return a(b).find("item").each(function(){var b=a(this),c=b.attr("jid"),d=b.attr("action"),e=b.attr("name");
"add"===d&&h.connection.roster.add(c,e,[],function(){h.connection.roster.subscribe(c,null,h.xmppstatus.get("fullname"))})}),!0},isSelf:function(a){return Strophe.getBareJidFromJid(a)===Strophe.getBareJidFromJid(h.connection.jid)},addResource:function(a,c){var d,e=this.get(a);e&&(d=e.get("resources"),d?-1==b.indexOf(d,c)&&(d.push(c),e.set({resources:d})):e.set({resources:[c]}))},removeResource:function(a,c){var d,e,f=this.get(a);return f&&(d=f.get("resources"),e=b.indexOf(d,c),-1!==e)?(d.splice(e,1),f.set({resources:d}),d.length):0},subscribeBack:function(a){var b=Strophe.getBareJidFromJid(a);h.connection.roster.findItem(b)?(h.connection.roster.authorize(b),h.connection.roster.subscribe(a,null,h.xmppstatus.get("fullname"))):h.connection.roster.add(a,"",[],function(){h.connection.roster.authorize(b),h.connection.roster.subscribe(a,null,h.xmppstatus.get("fullname"))})},unsubscribe:function(a){h.xmppstatus.sendPresence("unsubscribe"),h.connection.roster.findItem(a)&&h.connection.roster.remove(a,function(){h.rosterview.model.remove(a)})},getNumOnlineContacts:function(){var a,c=0,d=["offline","unavailable"],e=this.models,f=e.length;for(h.show_only_online_users&&(d=b.union(d,["dnd","xa","away"])),a=0;f>a;a++)-1===b.indexOf(d,e[a].get("chat_status"))&&c++;return c},cleanCache:function(a){var c,d,e=[];for(d=0;d<a.length;++d)e.push(a[d].jid);for(d=0;d<this.models.length;++d)c=this.models[d].get("id"),-1===b.indexOf(e,c)&&this.get(c).destroy()},rosterHandler:function(a){h.emit("onRoster",a),this.cleanCache(a),b.each(a,function(a,b,c){if(!this.isSelf(a.jid)){var d=this.get(a.jid);if(d)"none"===a.subscription&&null===a.ask?d.destroy():(d.get("subscription")!==a.subscription||d.get("ask")!==a.ask)&&(d.set({subscription:a.subscription,ask:a.ask,requesting:null}),d.save());else{var e=b===c.length-1?!0:!1;if("none"===a.subscription&&null===a.ask&&!e)return;this.create({jid:a.jid,subscription:a.subscription,ask:a.ask,fullname:a.name||a.jid,is_last:e})}}},this),h.initial_presence_sent||(h.initial_presence_sent=1,h.xmppstatus.sendPresence())},handleIncomingSubscription:function(b){var c=Strophe.getBareJidFromJid(b),d=this.get(c);if(!h.allow_contact_requests)return h.connection.roster.unauthorize(c),!0;if(h.auto_subscribe)d&&"to"==d.get("subscription")?h.connection.roster.authorize(c):this.subscribeBack(b);else if(d&&"none"!=d.get("subscription"))h.connection.roster.authorize(c);else{if(this.get(c))return!0;h.getVCard(c,a.proxy(function(a,b,d,e,f){this.add({jid:c,subscription:"none",ask:null,requesting:!0,fullname:b,image:d,image_type:e,url:f,vcard_updated:h.toISOString(new Date),is_last:!0})},this),a.proxy(function(a){h.log("Error while retrieving vcard"),this.add({jid:c,subscription:"none",ask:null,requesting:!0,fullname:a,is_last:!0})},this))}return!0},presenceHandler:function(b){var c=a(b),d=c.attr("type");if("error"===d)return!0;var e,f=c.attr("from"),g=Strophe.getBareJidFromJid(f),i=Strophe.getResourceFromJid(f),j=c.find("show"),k=j.text()||"online",l=c.find("status");return this.isSelf(g)?(h.connection.jid!==f&&"unavailable"!==d&&h.xmppstatus.save({status:k}),!0):0===(c.find("x").attr("xmlns")||"").indexOf(Strophe.NS.MUC)?!0:(e=this.get(g),e&&l.text()!=e.get("status")&&e.save({status:l.text()}),"subscribed"===d||"unsubscribe"===d?!0:"subscribe"===d?this.handleIncomingSubscription(f):("unsubscribed"===d?this.unsubscribe(g):"unavailable"===d?0===this.removeResource(g,i)&&e&&e.set({chat_status:"offline"}):e&&(this.addResource(g,i),e.set({chat_status:k})),!0))}}),this.RosterView=Backbone.View.extend({tagName:"dl",id:"converse-roster",rosteritemviews:{},requesting_contacts_template:b.template('<dt id="xmpp-contact-requests">'+p("Contact requests")+"</dt>"),contacts_template:b.template('<dt id="xmpp-contacts">'+p("My contacts")+"</dt>"),pending_contacts_template:b.template('<dt id="pending-xmpp-contacts">'+p("Pending contacts")+"</dt>"),initialize:function(){this.model.on("add",function(a){this.addRosterItemView(a).render(a),a.get("vcard_updated")||h.getVCard(a.get("jid"))},this),this.model.on("change",function(a){1===b.size(a.changed)&&b.contains(b.keys(a.changed),"sorted")||this.updateChatBox(a).render(a)},this),this.model.on("remove",function(a){this.removeRosterItemView(a)},this),this.model.on("destroy",function(a){this.removeRosterItemView(a)},this);var a=this.contacts_template();h.allow_contact_requests&&(a=this.requesting_contacts_template()+a+this.pending_contacts_template()),this.$el.hide().html(a),this.model.fetch({add:!0})},updateChatBox:function(a){var c=h.chatboxes.get(a.get("jid")),d={};return c?(b.has(a.changed,"chat_status")&&(d.chat_status=a.get("chat_status")),b.has(a.changed,"status")&&(d.status=a.get("status")),c.save(d),this):this},addRosterItemView:function(a){var b=new h.RosterItemView({model:a});return this.rosteritemviews[a.id]=b,this},removeRosterItemView:function(a){var b=this.rosteritemviews[a.id];return b&&(b.$el.remove(),delete this.rosteritemviews[a.id],this.render()),this},renderRosterItem:function(b,c){return h.show_only_online_users&&"online"!==b.get("chat_status")?(c.$el.remove(),c.delegateEvents(),this):void(a.contains(document.documentElement,c.el)?c.render():this.$el.find("#xmpp-contacts").after(c.render().el))},render:function(c){var d,e,f=this.$el.find("#xmpp-contacts"),g=this.$el.find("#xmpp-contact-requests"),i=this.$el.find("#pending-xmpp-contacts"),j=!1;if(c){var k=(c.id,this.rosteritemviews[c.id]),l=c.get("ask"),m=c.get("subscription"),n=c.get("requesting"),o={order:"asc"};"subscribe"===l&&"none"==m?(i.after(k.render().el),i.after(i.siblings("dd.pending-xmpp-contact").tsort(o))):"subscribe"===l&&"from"==m?(i.after(k.render().el),i.after(i.siblings("dd.pending-xmpp-contact").tsort(o))):n===!0?(g.after(k.render().el),g.after(g.siblings("dd.requesting-xmpp-contact").tsort(o))):("both"===m||"to"===m)&&this.renderRosterItem(c,k),e=c.changed.chat_status,e&&(this.sortRoster(e),j=!0),c.get("is_last")&&(j||this.sortRoster(c.get("chat_status")),this.$el.is(":visible")||this.$el.show())}return b.each([f,g,i],function(a){a.nextUntil("dt").length?a.is(":visible")||a.show():a.is(":visible")&&a.hide()}),d=a("#online-count"),d.text("("+this.model.getNumOnlineContacts()+")"),d.is(":visible")||d.show(),h.emit("onRosterViewUpdated"),this},sortRoster:function(a){var b=this.$el.find("#xmpp-contacts");b.siblings("dd.current-xmpp-contact."+a).tsort("a",{order:"asc"}),b.after(b.siblings("dd.current-xmpp-contact.offline")),b.after(b.siblings("dd.current-xmpp-contact.unavailable")),b.after(b.siblings("dd.current-xmpp-contact.xa")),b.after(b.siblings("dd.current-xmpp-contact.away")),b.after(b.siblings("dd.current-xmpp-contact.dnd")),b.after(b.siblings("dd.current-xmpp-contact.online"))}}),this.XMPPStatus=Backbone.Model.extend({initialize:function(){this.set({status:this.get("status")||"online"}),this.on("change",a.proxy(function(c){void 0===this.get("fullname")&&h.getVCard(null,a.proxy(function(a,b){this.save({fullname:b})},this)),b.has(c.changed,"status")&&h.emit("onStatusChanged",this.get("status")),b.has(c.changed,"status_message")&&h.emit("onStatusMessageChanged",this.get("status_message"))},this))},sendPresence:function(a){void 0===a&&(a=this.get("status")||"online");var b,c=this.get("status_message");"unavailable"===a||"probe"===a||"error"===a||"unsubscribe"===a||"unsubscribed"===a||"subscribe"===a||"subscribed"===a?b=$pres({type:a}):(b="online"===a?$pres():$pres().c("show").t(a).up(),c&&b.c("status").t(c)),h.connection.send(b)},setStatus:function(a){this.sendPresence(a),this.save({status:a})},setStatusMessage:function(b){h.connection.send($pres().c("show").t(this.get("status")).up().c("status").t(b)),this.save({status_message:b}),this.xhr_custom_status&&a.ajax({url:this.xhr_custom_status_url,type:"POST",data:{msg:b}})}}),this.XMPPStatusView=Backbone.View.extend({el:"span#xmpp-status-holder",events:{"click a.choose-xmpp-status":"toggleOptions","click #fancy-xmpp-status-select a.change-xmpp-status-message":"renderStatusChangeForm","submit #set-custom-xmpp-status":"setStatusMessage","click .dropdown dd ul li a":"setStatus"},toggleOptions:function(b){b.preventDefault(),a(b.target).parent().parent().siblings("dd").find("ul").toggle("fast")},change_status_message_template:b.template('<form id="set-custom-xmpp-status"><input type="text" class="custom-xmpp-status" {{ status_message }}"placeholder="'+p("Custom status")+'"/><button type="submit">'+p("Save")+"</button></form>"),status_template:b.template('<div class="xmpp-status"><a class="choose-xmpp-status {{ chat_status }}" data-value="{{status_message}}" href="#" title="'+p("Click to change your chat status")+'"><span class="icon-{{ chat_status }}"></span>{{ status_message }}</a><a class="change-xmpp-status-message icon-pencil" href="#" title="'+p("Click here to write a custom status message")+'"></a></div>'),renderStatusChangeForm:function(a){a.preventDefault();var b=this.model.get("status")||"offline",c=this.change_status_message_template({status_message:b});this.$el.find(".xmpp-status").replaceWith(c),this.$el.find(".custom-xmpp-status").focus().focus()},setStatusMessage:function(b){b.preventDefault();var c=a(b.target).find("input").val();this.model.setStatusMessage(c)},setStatus:function(b){b.preventDefault();var c=a(b.target),d=c.attr("data-value");this.model.setStatus(d),this.$el.find(".dropdown dd ul").hide()},getPrettyStatus:function(a){return pretty_status="chat"===a?p("online"):"dnd"===a?p("busy"):"xa"===a?p("away for long"):"away"===a?p("away"):p(a)||p("online")},updateStatusUI:function(a){if(b.has(a.changed,"status")||b.has(a.changed,"status_message")){var c=a.get("status"),d=a.get("status_message")||p("I am %1$s",this.getPrettyStatus(c));this.$el.find("#fancy-xmpp-status-select").html(this.status_template({chat_status:c,status_message:d}))}},choose_template:b.template('<dl id="target" class="dropdown"><dt id="fancy-xmpp-status-select" class="fancy-dropdown"></dt><dd><ul class="xmpp-status-menu"></ul></dd></dl>'),option_template:b.template('<li><a href="#" class="{{ value }}" data-value="{{ value }}"><span class="icon-{{ value }}"></span>{{ text }}</a></li>'),initialize:function(){this.model.on("change",this.updateStatusUI,this)},render:function(){var b,c=this.$el.find("select#select-xmpp-status"),d=this.model.get("status")||"offline",e=a("option",c),f=[],g=this;return this.$el.html(this.choose_template()),this.$el.find("#fancy-xmpp-status-select").html(this.status_template({status_message:this.model.get("status_message")||p("I am %1$s",this.getPrettyStatus(d)),chat_status:d})),e.each(function(){f.push(g.option_template({value:a(this).val(),text:this.text}))}),b=this.$el.find("#target dd ul").hide(),b.append(f.join("")),c.remove(),this}}),this.Feature=Backbone.Model.extend(),this.Features=Backbone.Collection.extend({model:h.Feature,initialize:function(){this.localStorage=new Backbone.LocalStorage(hex_sha1("converse.features"+h.bare_jid)),0===this.localStorage.records.length?(h.connection.disco.info(h.domain,null,a.proxy(this.onInfo,this)),h.connection.disco.items(h.domain,null,a.proxy(this.onItems,this))):this.fetch({add:!0})},onItems:function(b){a(b).find("query item").each(a.proxy(function(b,c){h.connection.disco.info(a(c).attr("jid"),null,a.proxy(this.onInfo,this))},this))},onInfo:function(b){var c=a(b);(0!==c.find("identity[category=server][type=im]").length||0!==c.find("identity[category=conference][type=text]").length)&&c.find("feature").each(a.proxy(function(b,d){this.create({"var":a(d).attr("var"),from:c.attr("from")})},this))}}),this.LoginPanel=Backbone.View.extend({tagName:"div",id:"login-dialog",events:{"submit form#converse-login":"authenticate"},tab_template:b.template('<li><a class="current" href="#login">'+p("Sign in")+"</a></li>"),template:b.template('<form id="converse-login"><label>'+p("XMPP/Jabber Username:")+'</label><input type="username" name="jid"><label>'+p("Password:")+'</label><input type="password" name="password"><input class="login-submit" type="submit" value="'+p("Log In")+'"></form">'),bosh_url_input:b.template("<label>"+p("BOSH Service URL:")+'</label><input type="text" id="bosh_service_url">'),connect:function(a,b,c){a&&a.find("input[type=submit]").hide().after('<span class="spinner login-submit"/>'),h.connection=new Strophe.Connection(h.bosh_service_url),h.connection.connect(b,c,h.onConnect)},showLoginButton:function(){var a=this.$el.find("#converse-login"),b=a.find("input[type=submit]");b.length&&b.show().siblings("span").remove()},initialize:function(a){a.$parent.html(this.$el.html(this.template())),this.$tabs=a.$parent.parent().find("#controlbox-tabs")},render:function(){return this.$tabs.append(this.tab_template()),this.$el.find("input#jid").focus(),this},authenticate:function(b){var c=a(b.target),d=c.find("input[name=jid]"),e=d.val(),f=c.find("input[name=password]"),g=f.val(),i=null,j=!1;return h.bosh_service_url||(i=c.find("input#bosh_service_url"),h.bosh_service_url=i.val(),h.bosh_service_url||(j=!0,i.addClass("error"))),e||(j=!0,d.addClass("error")),g||(j=!0,f.addClass("error")),j?void 0:(this.connect(c,e,g),!1)},remove:function(){this.$tabs.empty(),this.$el.parent().empty()}}),this.ControlBoxToggle=Backbone.View.extend({tagName:"a",className:"toggle-online-users",id:"toggle-controlbox",events:{click:"onClick"},attributes:{href:"#"},template:b.template('<strong class="conn-feedback">Toggle chat</strong><strong style="display: none" id="online-count">(0)</strong>'),initialize:function(){this.render()},render:function(){return a("#conversejs").append(this.$el.html(this.template())),this},showControlBox:function(){var a=h.chatboxes.get("controlbox");a?a.trigger("show"):(h.chatboxes.add({id:"controlbox",box_id:"controlbox",visible:!0}),h.connection&&h.chatboxes.get("controlbox").save())},onClick:function(b){if(b.preventDefault(),a("div#controlbox").is(":visible")){var c=h.chatboxes.get("controlbox");h.connection?c.destroy():c.trigger("hide")}else this.showControlBox()}}),this.chatboxes=new this.ChatBoxes,this.chatboxesview=new this.ChatBoxesView({model:this.chatboxes}),this.controlboxtoggle=new this.ControlBoxToggle,this.otr=new this.OTR,this.prebind&&!this.connection){if(!(this.jid&&this.sid&&this.rid&&this.bosh_service_url))return void this.log("If you set prebind=true, you MUST supply JID, RID and SID values");this.connection=new Strophe.Connection(this.bosh_service_url),this.connection.attach(this.jid,this.sid,this.rid,this.onConnect)}else this.connection&&this.onConnected();this.show_controlbox_by_default&&this.controlboxtoggle.showControlBox(),h.emit("onInitialized")},{initialize:function(a,b){f.initialize(a,b)},setStatus:function(a){f.xmppstatus&&f.xmppstatus.setStatus(a)},getStatus:function(){return f.xmppstatus&&f.xmppstatus.attributes?f.xmppstatus.attributes.status:null},getRID:function(){return f.expose_rid_and_sid&&"undefined"!=typeof f.connection?f.connection.rid:null},getSID:function(){return f.expose_rid_and_sid&&"undefined"!=typeof f.connection?f.connection.sid:null},once:function(a,b){f.once(a,b)},on:function(a,b){f.on(a,b)},off:function(a,b){f.off(a,b)}}}),function(a){var b=a.ajaxSettings;a.xhr={r:{xhr:b.xhr},register:function(a,b){this.r[a]=b}},b.transport="xhr",b.xhr=function(){return a.xhr.r[this.transport](this)}}(jQuery);(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){ClientConfig={enableHD:false,enableCallControl:true,enableCallTimer:true,enableCallHistory:true,enableFullScreen:true,enableSelfView:true,enableCallStats:true,enableDialpad:true,enableMute:true,enableMessages:true,enableRegistrationIcon:true,enableConnectionIcon:true,enableWindowDrag:true,enableAutoAcceptReInvite:true,enableConnectLocalMedia:true,enableIms:false,enableSettings:false,enableAutoAnswer:false,enableTransfer:true,enableHold:true,pAssertedIdentity:"<sip:webguest@broadsoftlabs.com>",allowOutside:true,disableICE:true,volumeClick:1,volumeDTMF:1,websocketsServers:[{ws_uri:"wss://webrtc-gw.broadsoftlabs.com:8443",weight:0}],stunServer:"64.212.220.81",stunPort:3478,domainFrom:"broadsoftlabs.com",domainTo:"broadsoftlabs.com",endCallURL:false,bandwidthLow:128,bandwidthMed:512,bandwidthHigh:2048,expires:365,debug:false,register:false,encodingResolution:"640x480",displayResolution:"640x480",view:"audioVideo",selfViewLocation:"bl",messageProgress:"Ringing",messageOutsideDomain:"Invalid Destination",messageStarted:"Call Started",messageHold:"Call placed on hold",messageResume:"Call removed from hold",messageEnded:"Call Ended",messageCall:"Performing NAT Tests",messageConnected:"Connected",messageConnectionFailed:"Connection failed",messageUnregistered:"Unregistered",messageRegistered:"Registration successful",messageRegistrationFailed:"Registration failed",messageEmptyDestination:"Invalid Destination",messageGetUserMedia:"Unable to Access Camera and/or Microphone"};module.exports=ClientConfig},{}],2:[function(require,module,exports){(function(root,factory){if(typeof define==="function"&&define.amd){define([],factory)}else if(typeof exports==="object"){module.exports=factory()}else if(typeof root==="undefined"||root!==Object(root)){throw new Error("templatizer: window does not exist or is not an object")}else{root.templatizer=factory()}})(this,function(){var jade=function(){function e(e){return null!=e&&""!==e}function n(t){return(Array.isArray(t)?t.map(n):t&&"object"==typeof t?Object.keys(t).filter(function(e){return t[e]}):[t]).filter(e).join(" ")}var t={};return t.merge=function r(n,t){if(1===arguments.length){for(var a=n[0],i=1;i<n.length;i++)a=r(a,n[i]);return a}var o=n["class"],s=t["class"];(o||s)&&(o=o||[],s=s||[],Array.isArray(o)||(o=[o]),Array.isArray(s)||(s=[s]),n["class"]=o.concat(s).filter(e));for(var l in t)"class"!=l&&(n[l]=t[l]);return n},t.joinClasses=n,t.cls=function(e,r){for(var a=[],i=0;i<e.length;i++)a.push(r&&r[i]?t.escape(n([e[i]])):n(e[i]));var o=n(a);return o.length?' class="'+o+'"':""},t.style=function(e){return e&&"object"==typeof e?Object.keys(e).map(function(n){return n+":"+e[n]}).join(";"):e},t.attr=function(e,n,r,a){return"style"===e&&(n=t.style(n)),"boolean"==typeof n||null==n?n?" "+(a?e:e+'="'+e+'"'):"":0==e.indexOf("data")&&"string"!=typeof n?(-1!==JSON.stringify(n).indexOf("&")&&console.warn("Since Jade 2.0.0, ampersands (`&`) in data attributes will be escaped to `&amp;`"),n&&"function"==typeof n.toISOString&&console.warn("Jade will eliminate the double quotes around dates in ISO form after 2.0.0")," "+e+"='"+JSON.stringify(n).replace(/'/g,"&apos;")+"'"):r?(n&&"function"==typeof n.toISOString&&console.warn("Jade will stringify dates in ISO form after 2.0.0")," "+e+'="'+t.escape(n)+'"'):(n&&"function"==typeof n.toISOString&&console.warn("Jade will stringify dates in ISO form after 2.0.0")," "+e+'="'+n+'"')},t.attrs=function(e,r){var a=[],i=Object.keys(e);if(i.length)for(var o=0;o<i.length;++o){var s=i[o],l=e[s];"class"==s?(l=n(l))&&a.push(" "+s+'="'+l+'"'):a.push(t.attr(s,l,!1,r))}return a.join("")},t.escape=function(e){var n=String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");return n===""+e?e:n},t.rethrow=function a(e,n,t,r){if(!(e instanceof Error))throw e;if(!("undefined"==typeof window&&n||r))throw e.message+=" on line "+t,e;try{r=r||require("fs").readFileSync(n,"utf8")}catch(i){a(e,null,t)}var o=3,s=r.split("\n"),l=Math.max(t-o,0),f=Math.min(s.length,t+o),o=s.slice(l,f).map(function(e,n){var r=n+l+1;return(r==t?"  > ":"    ")+r+"| "+e}).join("\n");throw e.path=n,e.message=(n||"Jade")+":"+t+"\n"+o+"\n\n"+e.message,e},t}();var templatizer={};templatizer["webrtc"]=function tmpl_webrtc(){return'<div id="unsupported" class="unsupported"></div><div id="whiteboard_unsupported" class="unsupported"></div><div id="screen_sharing_unsupported" class="unsupported">Could not retrieve screen capture. Do you have it enabled?<br/>  Open link to check : <span>chrome://flags/#enable-usermedia-screen-capture</span></div><noscript><div id="javascript_disabled" class="unsupported">JavaScript must be enabled to load the WebRTC client</div></noscript><div id="conversejs"></div><div id="client" class="client"><div class="authPopup fadeable popup"><span>User ID</span><br/><input type="text" value="" class="userid"/><br/><span>Auth User ID</span><br/><input type="text" value="" class="authUserid"/><br/><span>Password</span><br/><input type="password" value="" class="password"/><br/><br/><div class="alert"></div><button type="button" class="authPopupButton button">Sign in</button></div><div class="fileshare-container table"><div class="cell"><div class="file_share fadeable"><span>Share File:</span><br/><input type="file"/><div class="status"></div></div></div></div><div class="main"><div class="errorPopup"></div><div class="callPopup fadeable popup"><span class="incomingCallTitle">Incoming Call</span><span class="incomingCallName"></span><span class="incomingCallUser"></span><div class="table"><div class="cell"><button type="button" class="acceptIncomingCall button">Accept</button><button type="button" class="holdAndAnswerButton button">Hold And Answer</button><button type="button" class="dropAndAnswerButton button">Drop And Answer</button></div><div id="rejectIncomingCallContainer" class="cell"><button type="button" class="rejectIncomingCall button">Reject</button></div></div></div><div class="reInvitePopup fadeable popup"><span class="title">ReInvite</span><br/><br/><span class="incomingCallName"></span><br/><span class="incomingCallUser"></span><br/><br/><button type="button" class="acceptReInviteCall button">Accept</button><button type="button" class="rejectReInviteCall button">Reject</button></div><div class="transferPopup fadeable popup"><div class="title">Transfer</div><div><input type="text" placeholder="To Target" class="transferTarget"/><input type="checkbox" class="transferTypeAttended"/>Attended</div><div class="actions"><button type="button" class="acceptTransfer button">Transfer</button><button type="button" class="rejectTransfer button">Cancel</button></div></div><div class="settingsPopup table collapse fixed fadeable popup"><div class="row"><ul class="tabs"><li><a href="#tab1"><span class="icon-cog"></span>Configure</a></li><li><a href="#tab2"><span class="icon-th"></span>Layout</a></li></ul><div id="tab1"><div class="settingDisplayNameRow row"><span class="cell">Display Name</span><input type="text" value="" class="settingDisplayName cell"/></div><div class="settingAuthenticationUseridRow row"><span class="cell">Auth User ID</span><input type="text" value="" class="settingAuthenticationUserid cell"/></div><div class="settingUseridRow row"><span class="cell">User ID</span><input type="text" value="" class="settingUserid cell"/></div><div class="settingPasswordRow row"><span class="cell">Password</span><input type="password" value="" class="settingPassword cell"/></div><div class="settingHDRow row"><span class="cell">Start in HD</span><input type="checkbox" class="settingHD cell"/><br/></div><div class="settingAutoAnswerRow row"><span class="cell">Auto Answer</span><input type="checkbox" class="settingAutoAnswer cell"/></div><div class="settingBandwidthRow row"><span class="cell">Bandwidth</span><span class="cell"><input type="text" maxlength="4" value="" placeholder="low" class="settingBandwidthLow short"/><input type="text" maxlength="4" value="" placeholder="medium" class="settingBandwidthMed short"/><input type="text" maxlength="4" value="" placeholder="high" class="settingBandwidthHigh short"/></span></div><div class="row"><span class="cell"><a href="" title="Sign In" class="btn sign-in">Sign In</a><a href="" title="Sign Out" class="btn sign-out">Sign Out</a></span></div></div><div id="tab2"><div class="settingSelfViewDisableRow row"><span class="cell">Disable Self View</span><input type="checkbox" class="settingSelfViewDisable cell"/></div><!--<div class="row">\n<span class="cell">Window Zoom</span>\n<input class="settingZoom cell short" type="text" maxlength="4" value=""/>\n</div>\n<div class="row">\n<span class="cell">Self View Window</span>\n<span class="cell">\n<input class="settingLocalVideoTop short" type="text" maxlength="4" value=""/><span> top </span>\n<input class="settingLocalVideoLeft short" type="text" maxlength="4" value=""/><span> left </span>\n</span>\n</div>\n<div class="row">\n<span class="cell">Call History Window</span>\n<span class="cell">\n<input class="settingCallHistoryTop short" type="text" maxlength="4" value=""/><span> top </span>\n<input class="settingCallHistoryLeft short" type="text" maxlength="4" value=""/><span> left </span>\n</span>\n</div>\n<div class="row">\n<span class="cell">Call Stats Window</span>\n<span class="cell">\n<input class="settingCallStatsTop short" type="text" maxlength="4" value=""/><span> top </span>\n<input class="settingCallStatsLeft short" type="text" maxlength="4" value=""/><span> left </span>\n</span>\n</div>\n<div class="row">\n<span class="cell">Page Color</span>\n<input class="settingColor cell" type="color" /><br>\n</div>--><div class="settingResolutionRow"><!-- <span class="cell">Resolution</span>--><div class="row"><span class="settingResolutionTypeRow cell">Mode</span><select class="resolutionTypeSelect cell"></select></div><div class="row"><span class="settingResolutionDisplayRow cell">Resolution</span><span class="cell"><select class="resolutionDisplayStandardSelect resolutionSubType"></select><select class="resolutionDisplayWidescreenSelect resolutionSubType"></select></span></div><div class="row"><span class="settingResolutionEncodingRow cell">Encoding</span><span class="cell"><select class="resolutionEncodingStandardSelect resolutionSubType"></select><select class="resolutionEncodingWidescreenSelect resolutionSubType"></select></span></div></div><div class="row"><span class="cell"><a href="" title="Save Settings" class="btn saveSettings">Save Settings</a><a href="" title="Reset Settings" class="clear">Reset Settings</a></span></div></div></div></div><div class="video"><span class="icon-facetime-video watermark-icon"></span><video autoplay="autoplay" class="remoteVideo"></video><div class="localVideo fadeable"><div class="inner"><video autoplay="autoplay" muted="true"></video></div></div></div><div class="videoBar"><div class="table fixed collapse"><div class="cell leftSpacer"></div><div class="cell cell-selfView"><div class="selfViewDisable icon fadeable"><a href="" title="Disable Self View" class="icon-selfViewDisable"></a></div><div class="selfViewEnable icon fadeable"><a href="" title="Enable Self View" class="icon-selfViewEnable"></a></div></div><div class="cell cell-dialpad"><div class="dialpadIconShow icon fadeable"><a href="" title="Show Dialpad" class="icon-dialpadShow"></a></div><div class="dialpadIconHide icon fadeable"><a href="" title="Hide Dialpad" class="icon-dialpadHide"></a></div></div><div class="cell cell-muteAudio"><div class="icon fadeable muteAudioIcon"><a href="" title="Mute Audio" class="icon-muteAudio"></a></div><div class="icon fadeable unmuteAudioIcon"><a href="" title="Unmute Audio" class="icon-unmuteAudio"></a></div></div><div class="cell cell-hold"><div class="hold icon fadeable"><a href="" title="Hold Call" class="icon-hold"></a></div><div class="resume icon fadeable"><a href="" title="Resume Call" class="icon-resume"></a></div></div><div class="cell cell-hangup"><div class="hangup icon fadeable"><a href="" title="Hangup" class="icon-hangup"></a><div class="subtitle">End Conference</div></div></div><div class="cell cell-transfer"><div class="transfer icon fadeable"><a href="" title="Transfer" class="icon-transfer"></a></div></div><div class="cell cell-shareScreen"><div class="icon fadeable shareScreen"><a href="" title="Share Screen" class="icon-screen-sharing"></a></div><div class="icon fadeable stopShareScreen"><a href="" title="Stop Share Screen" class="icon-screen-sharing-off"></a></div></div><div class="cell cell-timer"><div class="timer fadeable"></div></div><div class="cell cell-settings"><div class="settings icon fadeable"><a href="" title="Settings" class="icon-settings"></a></div></div><div class="cell cell-fullScreen"><div class="fullScreenExpand icon fadeable"><a href="" title="Expand Full Screen" class="icon-fullScreenExpand"></a></div><div class="fullScreenContract icon fadeable"><a href="" title="Contract Full Screen" class="icon-fullScreenContract"></a></div></div><div class="cell rightSpacer"></div></div></div><div class="connection-status connected-icon"><span title="Websockets Status" class="icon-link"></span></div><div class="connection-status registered-icon"><span title="Registered" class="icon-link"></span></div><div class="quality quality1"><span title="Call Quality" class="icon-quality icon-quality1"></span></div><div class="quality quality2"><span title="Call Quality" class="icon-quality icon-quality2"></span></div><div class="quality quality3"><span title="Call Quality" class="icon-quality icon-quality3"></span></div><div class="quality quality4"><span title="Call Quality" class="icon-quality icon-quality4"></span></div><div class="dialpad fadeable popup"><div class="callControl destination-container"><input type="text" onclick="this.focus();this.select()" class="destination"/><button title="Call History" class="history-button"><i class="icon-clock"></i></button><hr/></div><div class="button-row"><button>1</button><button>2</button><button>3</button></div><div class="button-row"><button>4</button><button>5</button><button>6</button></div><div class="button-row"><button>7</button><button>8</button><button>9</button></div><div class="button-row"><button class="btn-star">*</button><button>0</button><button>#</button></div><div class="dialpad-control-bar"><div class="call main-button"><a href="">Call</a></div></div></div><div class="callHistory"><div class="content"></div><div class="classHistoryActions"><!--<span class="historyBack">\n<a href="" title="Previous" class="icon-arrow-up-thick"></a>\n</span>--><span class="historyClear"><a href="" title="Clear History">Clear</a></span><span class="historyClose"><a href="" title="Close History">Close</a></span><!--<span class="historyForward">\n<a href="" title="Next" class="icon-arrow-down-thick"></a>\n</span>--></div><div class="callHistoryDetails popup"><div id="history-dt-close-container"><span class="historyDetailsClose cell"><a href="" title="Close" class="icon-cancel3"></a></span></div><div class="table"><div class="row"><div class="cell">Resolution In : </div><div class="resolutionIn cell default-color"></div></div><div class="row"><div class="cell">Resolution Out : </div><div class="resolutionOut cell default-color"></div></div><div class="row"><div class="cell">Bitrate In : </div><div class="bitrateIn cell default-color"></div></div><div class="row"><div class="cell">Bitrate Out : </div><div class="bitrateOut cell default-color"></div></div><div class="row"><div class="cell">Frame Rate In : </div><div class="frameRateIn cell default-color"></div></div><div class="row"><div class="cell">Frame Rate Out : </div><div class="frameRateOut cell default-color"></div></div><div class="row"><div class="cell">Audio Lost : </div><div class="audioLostPer cell default-color">%</div></div><div class="row"><div class="cell">Video Out : </div><div class="videoLostPer cell default-color">%</div></div><div class="row"><div class="cell">Jitter : </div><div class="jitter cell default-color"></div></div></div><div class="actions table"><a href="" title="Call" class="callLink cell"></a></div></div></div><div class="callStats"><div class="stats-container"></div><div class="table fixed collapse"><div class="heading"><div class="cell">Video Stats</div><div class="cell">Audio Stats</div></div><div class="row"><div class="cell">Bitrate out: <a href="javascript:;" data-type="video" data-var="kiloBitsSentPerSecond" class="stats-var"></a> kb/s</div><div class="cell">Bitrate out: <a href="javascript:;" data-type="audio" data-var="kiloBitsSentPerSecond" class="stats-var"></a> kb/s</div></div><div class="row"><div class="cell">Bitrate in: <a href="javascript:;" data-type="video" data-var="kiloBitsReceivedPerSecond" class="stats-var"></a> kb/s</div><div class="cell">Bitrate in: <a href="javascript:;" data-type="audio" data-var="kiloBitsReceivedPerSecond" class="stats-var"></a> kb/s</div></div><div class="row"><div class="cell">Lost: <a href="javascript:;" data-type="video" data-var="packetsLost" class="stats-var"></a> packets (<a href="javascript:;" data-type="video" data-var="packetsLostPer" class="stats-var"></a> %)</div><div class="cell">Lost: <a href="javascript:;" data-type="audio" data-var="packetsLost" class="stats-var"></a> packets (<a href="javascript:;" data-type="audio" data-var="packetsLostPer" class="stats-var"></a> %)</div></div><div class="row"><div class="cell">Frame rate out: <a href="javascript:;" data-type="video" data-var="googFrameRateSent" class="stats-var"></a> in: <a href="javascript:;" data-type="video" data-var="googFrameRateReceived" class="stats-var"></a></div><div class="cell">Audio Level out: <a href="javascript:;" data-type="audio" data-var="audioInputLevel" class="stats-var"></a> in: <a href="javascript:;" data-type="audio" data-var="audioOutputLevel" class="stats-var"></a></div></div><div class="row spacer"></div><div class="heading"><div class="cell">Resolution</div><div class="cell">Link</div></div><div class="row"><div class="cell">In: <span data-type="video" data-var="googFrameWidthReceived" class="stats-var"></span> x <span data-type="video" data-var="googFrameHeightReceived" class="stats-var"></span> Out: <span data-type="video" data-var="googFrameWidthSent" class="stats-var"></span> x <span data-type="video" data-var="googFrameHeightSent" class="stats-var"></span></div><div class="cell"><span class="statsDelay">Delay: <a href="javascript:;" data-type="audio" data-var="googRtt" class="stats-var"></a></span> Jitter: <a href="javascript:;" data-type="audio" data-var="googJitterReceived" class="stats-var"></a></div></div><div class="row spacer"></div></div></div><div class="messages"><div class="alert"></div><div class="success"></div><div class="warning"></div><div class="normal"></div></div></div><div class="historyRowSample"><div class="row"><a href="" title="Number" class="hist-destination"></a><span class="hist-direction"></span><span class="hist-date"></span><span class="hist-length"></span><span class="hist-details-arrow icon-angle-right"></span></div></div><div class="whiteboard"><div class="tools"><a href=".simple_sketch" data-tool="marker" class="tooltype">Marker</a><a href=".simple_sketch" data-tool="eraser" class="tooltype">Eraser</a></div><canvas width="600" height="400" class="simple_sketch"></canvas></div><div class="sms"><div class="smsView"><div class="table fixed smsLoginForm"><div class="row"><label class="cell">Name:</label><input type="text" name="name" placeholder="Email or TN" class="cell smsName"/></div><div class="row"><label class="cell">Password:</label><input type="password" name="password" class="cell smsPassword"/></div><div class="row"><div class="cell"></div><input type="button" value="Log In" class="cell smsLogin"/></div></div><div class="smsInbox"><fieldset><legend>Inbox</legend><div class="inner"><div class="table fixed"><div class="row"><div class="cell title status">Status</div><div class="cell title time">Received</div><div class="cell title from">From</div><div class="cell title body">Message</div><div class="cell title actions"></div></div><div class="content"></div></div></div></fieldset></div><div class="smsSendForm"><div><div><span>To</span><input type="text" placeholder="US Phone Number" class="smsSendTo"/><span>Text</span><input type="text" placeholder="Message to Send" class="smsSendBody"/><input type="button" value="Send SMS" class="smsSendButton"/></div></div></div><div id="sample" class="sms-inbox-item sms-inbox-item-sample row"><div class="status cell"></div><div class="time cell"></div><div class="from cell"></div><div class="body cell"><div class="image"><a href="" target="_blank"><span></span><img src=""/></a></div><div class="video"><video controls=""></video></div><div class="audio"><audio controls=""></audio></div><div class="text"></div></div><div class="actions cell"><a href="javascript:;" title="Delete SMS" class="icon-trash icon-highlightable"></a></div></div></div><div class="smsStatus"><span class="content"></span></div></div></div>'
};return templatizer})},{fs:3}],3:[function(require,module,exports){},{}],4:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}throw TypeError('Uncaught, unspecified "error" event.')}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}}else if(isObject(handler)){len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){var m;if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else{while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(isFunction(emitter._events[type]))ret=1;else ret=emitter._events[type].length;return ret};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],5:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],6:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:7}],7:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener("message",function(ev){var source=ev.source;if((source===window||source===null)&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}],8:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],9:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":8,_process:7,inherits:5}],10:[function(require,module,exports){exports=module.exports=require("./debug");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;var storage;if(typeof chrome!=="undefined"&&typeof chrome.storage!=="undefined")storage=chrome.storage.local;else storage=window.localStorage;exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff);if(!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if("%%"===match)return;index++;if("%c"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){storage.removeItem("debug")}else{storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=storage.debug}catch(e){}return r}exports.enable(load())},{"./debug":11}],11:[function(require,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=require("ms");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if("string"!==typeof args[0]){args=["%o"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match==="%%")return match;index++;var formatter=exports.formatters[format];if("function"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if("function"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||"").split(/[\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\*/g,".*?");if(namespaces[0]==="-"){exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$"))}else{exports.names.push(new RegExp("^"+namespaces+"$"))}}}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:12}],12:[function(require,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if("string"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){var match=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"h":return n*h;case"minutes":case"minute":case"m":return n*m;case"seconds":case"second":case"s":return n*s;case"ms":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+"d";if(ms>=h)return Math.round(ms/h)+"h";if(ms>=m)return Math.round(ms/m)+"m";if(ms>=s)return Math.round(ms/s)+"s";return ms+"ms"}function long(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+" "+name;return Math.ceil(ms/n)+" "+name+"s"}},{}],13:[function(require,module,exports){var utils=require("./utils"),path=require("path"),dirname=path.dirname,extname=path.extname,join=path.join,fs=require("fs"),read=fs.readFileSync;var filters=exports.filters=require("./filters");var cache={};exports.clearCache=function(){cache={}};function filtered(js){return js.substr(1).split("|").reduce(function(js,filter){var parts=filter.split(":"),name=parts.shift(),args=parts.join(":")||"";if(args)args=", "+args;return"filters."+name+"("+js+args+")"})}function rethrow(err,str,filename,lineno){var lines=str.split("\n"),start=Math.max(lineno-3,0),end=Math.min(lines.length,lineno+3);var context=lines.slice(start,end).map(function(line,i){var curr=i+start+1;return(curr==lineno?" >> ":"    ")+curr+"| "+line}).join("\n");err.path=filename;err.message=(filename||"ejs")+":"+lineno+"\n"+context+"\n\n"+err.message;throw err}var parse=exports.parse=function(str,options){var options=options||{},open=options.open||exports.open||"<%",close=options.close||exports.close||"%>",filename=options.filename,compileDebug=options.compileDebug!==false,buf="";buf+="var buf = [];";if(false!==options._with)buf+="\nwith (locals || {}) { (function(){ ";buf+="\n buf.push('";var lineno=1;var consumeEOL=false;for(var i=0,len=str.length;i<len;++i){var stri=str[i];if(str.slice(i,open.length+i)==open){i+=open.length;var prefix,postfix,line=(compileDebug?"__stack.lineno=":"")+lineno;switch(str[i]){case"=":prefix="', escape(("+line+", ";postfix=")), '";++i;break;case"-":prefix="', ("+line+", ";postfix="), '";++i;break;default:prefix="');"+line+";";postfix="; buf.push('"}var end=str.indexOf(close,i);if(end<0){throw new Error('Could not find matching close tag "'+close+'".')}var js=str.substring(i,end),start=i,include=null,n=0;if("-"==js[js.length-1]){js=js.substring(0,js.length-2);consumeEOL=true}if(0==js.trim().indexOf("include")){var name=js.trim().slice(7).trim();if(!filename)throw new Error("filename option is required for includes");var path=resolveInclude(name,filename);include=read(path,"utf8");include=exports.parse(include,{filename:path,_with:false,open:open,close:close,compileDebug:compileDebug});buf+="' + (function(){"+include+"})() + '";js=""}while(~(n=js.indexOf("\n",n)))n++,lineno++;if(js.substr(0,1)==":")js=filtered(js);if(js){if(js.lastIndexOf("//")>js.lastIndexOf("\n"))js+="\n";buf+=prefix;buf+=js;buf+=postfix}i+=end-start+close.length-1}else if(stri=="\\"){buf+="\\\\"}else if(stri=="'"){buf+="\\'"}else if(stri=="\r"){}else if(stri=="\n"){if(consumeEOL){consumeEOL=false}else{buf+="\\n";lineno++}}else{buf+=stri}}if(false!==options._with)buf+="'); })();\n} \nreturn buf.join('');";else buf+="');\nreturn buf.join('');";return buf};var compile=exports.compile=function(str,options){options=options||{};var escape=options.escape||utils.escape;var input=JSON.stringify(str),compileDebug=options.compileDebug!==false,client=options.client,filename=options.filename?JSON.stringify(options.filename):"undefined";if(compileDebug){str=["var __stack = { lineno: 1, input: "+input+", filename: "+filename+" };",rethrow.toString(),"try {",exports.parse(str,options),"} catch (err) {","  rethrow(err, __stack.input, __stack.filename, __stack.lineno);","}"].join("\n")}else{str=exports.parse(str,options)}if(options.debug)console.log(str);if(client)str="escape = escape || "+escape.toString()+";\n"+str;try{var fn=new Function("locals, filters, escape, rethrow",str)}catch(err){if("SyntaxError"==err.name){err.message+=options.filename?" in "+filename:" while compiling ejs"}throw err}if(client)return fn;return function(locals){return fn.call(this,locals,filters,escape,rethrow)}};exports.render=function(str,options){var fn,options=options||{};if(options.cache){if(options.filename){fn=cache[options.filename]||(cache[options.filename]=compile(str,options))}else{throw new Error('"cache" option requires "filename".')}}else{fn=compile(str,options)}options.__proto__=options.locals;return fn.call(options.scope,options)};exports.renderFile=function(path,options,fn){var key=path+":string";if("function"==typeof options){fn=options,options={}}options.filename=path;var str;try{str=options.cache?cache[key]||(cache[key]=read(path,"utf8")):read(path,"utf8")}catch(err){fn(err);return}fn(null,exports.render(str,options))};function resolveInclude(name,filename){var path=join(dirname(filename),name);var ext=extname(name);if(!ext)path+=".ejs";return path}exports.__express=exports.renderFile;if(require.extensions){require.extensions[".ejs"]=function(module,filename){filename=filename||module.filename;var options={filename:filename,client:true},template=fs.readFileSync(filename).toString(),fn=compile(template,options);module._compile("module.exports = "+fn.toString()+";",filename)}}else if(require.registerExtension){require.registerExtension(".ejs",function(src){return compile(src,{})})}},{"./filters":14,"./utils":15,fs:3,path:6}],14:[function(require,module,exports){exports.first=function(obj){return obj[0]};exports.last=function(obj){return obj[obj.length-1]};exports.capitalize=function(str){str=String(str);return str[0].toUpperCase()+str.substr(1,str.length)};exports.downcase=function(str){return String(str).toLowerCase()};exports.upcase=function(str){return String(str).toUpperCase()};exports.sort=function(obj){return Object.create(obj).sort()};exports.sort_by=function(obj,prop){return Object.create(obj).sort(function(a,b){a=a[prop],b=b[prop];if(a>b)return 1;if(a<b)return-1;return 0})};exports.size=exports.length=function(obj){return obj.length};exports.plus=function(a,b){return Number(a)+Number(b)};exports.minus=function(a,b){return Number(a)-Number(b)};exports.times=function(a,b){return Number(a)*Number(b)};exports.divided_by=function(a,b){return Number(a)/Number(b)};exports.join=function(obj,str){return obj.join(str||", ")};exports.truncate=function(str,len,append){str=String(str);if(str.length>len){str=str.slice(0,len);if(append)str+=append}return str};exports.truncate_words=function(str,n){var str=String(str),words=str.split(/ +/);return words.slice(0,n).join(" ")};exports.replace=function(str,pattern,substitution){return String(str).replace(pattern,substitution||"")};exports.prepend=function(obj,val){return Array.isArray(obj)?[val].concat(obj):val+obj};exports.append=function(obj,val){return Array.isArray(obj)?obj.concat(val):obj+val};exports.map=function(arr,prop){return arr.map(function(obj){return obj[prop]})};exports.reverse=function(obj){return Array.isArray(obj)?obj.reverse():String(obj).split("").reverse().join("")};exports.get=function(obj,prop){return obj[prop]};exports.json=function(obj){return JSON.stringify(obj)}},{}],15:[function(require,module,exports){exports.escape=function(html){return String(html).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")}},{}],16:[function(require,module,exports){var grammar=module.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-]*)\/(\d*)(?:\s*\/(\S*))?/,names:["payload","codec","rate","encoding"],format:function(o){return o.encoding?"rtpmap:%d %s/%s/%s":"rtpmap:%d %s/%s"}},{push:"fmtp",reg:/^fmtp:(\d*) (\S*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(o){return o.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(o){return o.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"
}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(o){return o.config!=null?"extmap:%s %s %s":"extmap:%s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(o){return o.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:(\w*)/,format:"mid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/,format:"%s"},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","generation"],format:function(o){var str="candidate:%s %d %s %d %s %d typ %s";str+=o.raddr!=null?" raddr %s rport %d":"%v%v";if(o.generation!=null){str+=" generation %d"}return str}},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{name:"msidSemantic",reg:/^msid-semantic: (\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{push:"invalid",names:["value"]}]};Object.keys(grammar).forEach(function(key){var objs=grammar[key];objs.forEach(function(obj){if(!obj.reg){obj.reg=/(.*)/}if(!obj.format){obj.format="%s"}})})},{}],17:[function(require,module,exports){var parser=require("./parser");var writer=require("./writer");exports.write=writer;exports.parse=parser.parse;exports.parseFmtpConfig=parser.parseFmtpConfig;exports.parsePayloads=parser.parsePayloads;exports.parseRemoteCandidates=parser.parseRemoteCandidates},{"./parser":18,"./writer":19}],18:[function(require,module,exports){var toIntIfInt=function(v){return String(Number(v))===v?Number(v):v};var attachProperties=function(match,location,names,rawName){if(rawName&&!names){location[rawName]=toIntIfInt(match[1])}else{for(var i=0;i<names.length;i+=1){if(match[i+1]!=null){location[names[i]]=toIntIfInt(match[i+1])}}}};var parseReg=function(obj,location,content){var needsBlank=obj.name&&obj.names;if(obj.push&&!location[obj.push]){location[obj.push]=[]}else if(needsBlank&&!location[obj.name]){location[obj.name]={}}var keyLocation=obj.push?{}:needsBlank?location[obj.name]:location;attachProperties(content.match(obj.reg),keyLocation,obj.names,obj.name);if(obj.push){location[obj.push].push(keyLocation)}};var grammar=require("./grammar");var validLine=RegExp.prototype.test.bind(/^([a-z])=(.*)/);exports.parse=function(sdp){var session={},media=[],location=session;sdp.split("\r\n").filter(validLine).forEach(function(l){var type=l[0];var content=l.slice(2);if(type==="m"){media.push({rtp:[],fmtp:[]});location=media[media.length-1]}for(var j=0;j<(grammar[type]||[]).length;j+=1){var obj=grammar[type][j];if(obj.reg.test(content)){return parseReg(obj,location,content)}}});session.media=media;return session};var fmtpReducer=function(acc,expr){var s=expr.split("=");if(s.length===2){acc[s[0]]=toIntIfInt(s[1])}return acc};exports.parseFmtpConfig=function(str){return str.split(";").reduce(fmtpReducer,{})};exports.parsePayloads=function(str){return str.split(" ").map(Number)};exports.parseRemoteCandidates=function(str){var candidates=[];var parts=str.split(" ").map(toIntIfInt);for(var i=0;i<parts.length;i+=3){candidates.push({component:parts[i],ip:parts[i+1],port:parts[i+2]})}return candidates}},{"./grammar":16}],19:[function(require,module,exports){var grammar=require("./grammar");var formatRegExp=/%[sdv%]/g;var format=function(formatStr){var i=1;var args=arguments;var len=args.length;return formatStr.replace(formatRegExp,function(x){if(i>=len){return x}var arg=args[i];i+=1;switch(x){case"%%":return"%";case"%s":return String(arg);case"%d":return Number(arg);case"%v":return""}})};var makeLine=function(type,obj,location){var str=obj.format instanceof Function?obj.format(obj.push?location:location[obj.name]):obj.format;var args=[type+"="+str];if(obj.names){for(var i=0;i<obj.names.length;i+=1){var n=obj.names[i];if(obj.name){args.push(location[obj.name][n])}else{args.push(location[obj.names[i]])}}}else{args.push(location[obj.name])}return format.apply(null,args)};var defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"];var defaultInnerOrder=["i","c","b","a"];module.exports=function(session,opts){opts=opts||{};if(session.version==null){session.version=0}if(session.name==null){session.name=" "}session.media.forEach(function(mLine){if(mLine.payloads==null){mLine.payloads=""}});var outerOrder=opts.outerOrder||defaultOuterOrder;var innerOrder=opts.innerOrder||defaultInnerOrder;var sdp=[];outerOrder.forEach(function(type){grammar[type].forEach(function(obj){if(obj.name in session){sdp.push(makeLine(type,obj,session))}else if(obj.push in session){session[obj.push].forEach(function(el){sdp.push(makeLine(type,obj,el))})}})});session.media.forEach(function(mLine){sdp.push(makeLine("m",grammar.m[0],mLine));innerOrder.forEach(function(type){grammar[type].forEach(function(obj){if(obj.name in mLine){sdp.push(makeLine(type,obj,mLine))}else if(obj.push in mLine){mLine[obj.push].forEach(function(el){sdp.push(makeLine(type,obj,el))})}})})});return sdp.join("\r\n")+"\r\n"}},{"./grammar":16}],20:[function(require,module,exports){var global=function(){return this}();var WebSocket=global.WebSocket||global.MozWebSocket;module.exports=WebSocket?ws:null;function ws(uri,protocols,opts){var instance;if(protocols){instance=new WebSocket(uri,protocols)}else{instance=new WebSocket(uri)}return instance}if(WebSocket)ws.prototype=WebSocket.prototype},{}],21:[function(require,module,exports){module.exports={name:"exsip",title:"ExSIP",description:"BroadSoft Javascript SIP library",version:"2.0.0",homepage:"http://www.broadsoft.com",author:"BroadSoft, Inc.",contributors:[{url:""}],main:"src/ExSIP.js",repository:{type:"git",url:""},keywords:["sip","websocket","webrtc","library"],dependencies:{"sdp-transform":"0.6.1",ws:"0.4.32"},devDependencies:{nodeunit:"0.9.0",grunt:"0.4.5","grunt-contrib-jshint":"0.10.0","grunt-contrib-concat":"0.5.0","grunt-contrib-nodeunit":"0.4.1","grunt-contrib-uglify":"0.6.0","grunt-contrib-watch":"0.6.1","grunt-contrib-symlink":"0.3.0","grunt-browserify":"3.0.1","grunt-jsdoc":"0.5.7","grunt-notify":">=0.2.6","grunt-bumpx":"0.1.5",pegjs:"0.7.0"},engines:{node:">=0.8"},license:"MIT",scripts:{test:"grunt travis --verbose"}}},{}],22:[function(require,module,exports){var pkg=require("../package.json");var C={USER_AGENT:"BroadSoft WebRTC Client - "+pkg.version,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",BYE:"Terminated",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout",NOT_ACCEPTABLE_ERROR:"Not Acceptable"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488],AUTHENTICATION_ERROR:[401,407],NOT_ACCEPTABLE_ERROR:[606]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",REFER:"REFER",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",SENDONLY:"sendonly",RECVONLY:"recvonly",SENDRECV:"sendrecv",INACTIVE:"inactive",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"ExSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69};module.exports=C},{"../package.json":21}],23:[function(require,module,exports){module.exports=Dialog;var C={STATUS_EARLY:1,STATUS_CONFIRMED:2};Dialog.C=C;var SIPMessage=require("./SIPMessage");var ExSIP_C=require("./Constants");var Transactions=require("./Transactions");var Utils=require("./Utils");var Dialog_RequestSender=require("./Dialog/RequestSender");function Dialog(owner,message,type,state){var contact;this.uac_pending_reply=false;this.uas_pending_reply=false;this.is_acknowledged=false;this.type=type;if(!message.hasHeader("contact")){return{error:"unable to create a Dialog without Contact header field"}}if(message instanceof SIPMessage.IncomingResponse){state=message.status_code<200?C.STATUS_EARLY:C.STATUS_CONFIRMED}else{state=state||C.STATUS_CONFIRMED}contact=message.parseHeader("contact");if(type==="UAS"){this.id={call_id:message.call_id,local_tag:message.to_tag,remote_tag:message.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}};this.state=state;this.remote_seqnum=message.cseq;this.local_uri=message.parseHeader("to").uri;this.remote_uri=message.parseHeader("from").uri;this.remote_target=contact.uri;this.route_set=message.getHeaders("record-route")}else if(type==="UAC"){this.id={call_id:message.call_id,local_tag:message.from_tag,remote_tag:message.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}};this.state=state;this.local_seqnum=message.cseq;this.local_uri=message.parseHeader("from").uri;this.remote_uri=message.parseHeader("to").uri;this.remote_target=contact.uri;this.route_set=message.getHeaders("record-route").reverse()}this.logger=owner.ua.getLogger("ExSIP.dialog",this.id.toString());this.owner=owner;owner.ua.dialogs[this.id.toString()]=this;this.logger.debug("new "+type+" dialog created with status "+(this.state===C.STATUS_EARLY?"EARLY":"CONFIRMED"))}Dialog.prototype={isUAS:function(){return this.type==="UAS"},isUAC:function(){return this.type==="UAC"},update:function(message,type){this.state=C.STATUS_CONFIRMED;this.logger.debug("dialog "+this.id.toString()+"  changed to CONFIRMED state");if(type==="UAC"){this.route_set=message.getHeaders("record-route").reverse()}},terminate:function(){this.logger.debug("dialog "+this.id.toString()+" deleted");delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(method,extraHeaders,body){var cseq,request;extraHeaders=extraHeaders&&extraHeaders.slice()||[];if(!this.local_seqnum){this.local_seqnum=Math.floor(Math.random()*1e4)}cseq=method===ExSIP_C.CANCEL||method===ExSIP_C.ACK?this.local_seqnum:this.local_seqnum+=1;request=new SIPMessage.OutgoingRequest(method,this.remote_target,this.owner.ua,{cseq:cseq,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},extraHeaders,body);this.logger.debug("createRequest : dialog.request_sender.request.extraHeaders : "+Utils.toString(request.extraHeaders));request.dialog=this;return request},checkInDialogRequest:function(request){var self=this;if(request.method===ExSIP_C.INVITE||request.method===ExSIP_C.UPDATE&&request.body){if(this.uac_pending_reply===true){request.reply(491)}else if(this.uas_pending_reply===true||this.type==="UAS"&&!this.is_acknowledged){var retryAfter=(Math.random()*10|0)+1;request.reply(500,null,["Retry-After:"+retryAfter]);return false}else{this.uas_pending_reply=true;request.server_transaction.on("stateChanged",function stateChanged(e){if(e.sender.state===Transactions.C.STATUS_ACCEPTED||e.sender.state===Transactions.C.STATUS_COMPLETED||e.sender.state===Transactions.C.STATUS_TERMINATED){request.server_transaction.removeListener("stateChanged",stateChanged);self.uas_pending_reply=false;if(self.uac_pending_reply===false){self.owner.onReadyToReinvite()}}})}if(request.hasHeader("contact")){request.server_transaction.on("stateChanged",function(e){if(e.sender.state===Transactions.C.STATUS_ACCEPTED){self.remote_target=request.parseHeader("contact").uri}})}}else if(request.method===ExSIP_C.NOTIFY){if(request.hasHeader("contact")){request.server_transaction.on("stateChanged",function(e){if(e.sender.state===Transactions.C.STATUS_COMPLETED){self.remote_target=request.parseHeader("contact").uri}})}}else if(request.method===ExSIP_C.ACK){this.is_acknowledged=true}if(!this.remote_seqnum){this.remote_seqnum=request.cseq}else if(request.cseq<this.remote_seqnum){if(request.method!==ExSIP_C.ACK){request.reply(500)}return false}else if(request.cseq>this.remote_seqnum){this.remote_seqnum=request.cseq}return true},createRequestSender:function(applicant,method,options){options=options||{};var extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],body=options.body||null,request=this.createRequest(method,extraHeaders,body),request_sender=new Dialog_RequestSender(this,applicant,request);this.logger.debug("dialog.request_sender.request.extraHeaders : "+Utils.toString(request.extraHeaders));return request_sender},sendRequest:function(applicant,method,options){var request_sender=this.createRequestSender(applicant,method,options);request_sender.send()},receiveRequest:function(request){if(!this.checkInDialogRequest(request)){return}this.owner.receiveRequest(request)}}},{"./Constants":22,"./Dialog/RequestSender":24,"./SIPMessage":41,"./Transactions":43,"./Utils":47}],24:[function(require,module,exports){module.exports=DialogRequestSender;var ExSIP_C=require("../Constants");var Transactions=require("../Transactions");var RTCSession=require("../RTCSession");var RequestSender=require("../RequestSender");function DialogRequestSender(dialog,applicant,request){this.dialog=dialog;this.applicant=applicant;this.request=request;this.logger=dialog.owner.ua.getLogger("ExSIP.dialog.requestsender",dialog.id);this.reattempt=false;this.reattemptTimer=null}DialogRequestSender.prototype={send:function(callbacks){var self=this,request_sender=new RequestSender(this,this.dialog.owner.ua);request_sender.send(callbacks);if(this.request.method===ExSIP_C.INVITE&&request_sender.clientTransaction.state!==Transactions.C.STATUS_TERMINATED){this.dialog.uac_pending_reply=true;request_sender.clientTransaction.on("stateChanged",function stateChanged(e){if(e.sender.state===Transactions.C.STATUS_ACCEPTED||e.sender.state===Transactions.C.STATUS_COMPLETED||e.sender.state===Transactions.C.STATUS_TERMINATED){request_sender.clientTransaction.removeListener("stateChanged",stateChanged);self.dialog.uac_pending_reply=false;if(self.dialog.uas_pending_reply===false){self.dialog.owner.onReadyToReinvite()}}})}},onRequestTimeout:function(){this.logger.log("********* onRequestTimeout : ",this.applicant);this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(response){var self=this;this.logger.debug("receiveResponse : "+response);if(response.status_code===408||response.status_code===481){this.applicant.onDialogError(response)}else if(response.method===ExSIP_C.INVITE&&response.status_code===491){if(this.reattempt){this.applicant.receiveResponse(response)}else{this.request.cseq.value=this.dialog.local_seqnum+=1;this.reattemptTimer=setTimeout(function(){if(self.applicant.owner.status!==RTCSession.C.STATUS_TERMINATED){self.reattempt=true;self.request_sender.send()}},this.getReattemptTimeout())}}else{this.applicant.receiveResponse(response)}}}},{"../Constants":22,"../RTCSession":35,"../RequestSender":40,"../Transactions":43}],25:[function(require,module,exports){module.exports=DigestAuthentication;function DigestAuthentication(ua){this.logger=ua.getLogger("ExSIP.digestauthentication");this.username=ua.configuration.authorization_user;this.password=ua.configuration.password;this.cnonce=null;this.nc=0;this.ncHex="00000000";this.response=null}var Utils=require("./Utils");DigestAuthentication.prototype.authenticate=function(request,challenge){this.algorithm=challenge.algorithm;this.realm=challenge.realm;this.nonce=challenge.nonce;this.opaque=challenge.opaque;this.stale=challenge.stale;if(this.algorithm){if(this.algorithm!=="MD5"){this.logger.warn('challenge with Digest algorithm different than "MD5", authentication aborted');return false}}else{this.algorithm="MD5"}if(!this.realm){this.logger.warn("challenge without Digest realm, authentication aborted");return false}if(!this.nonce){this.logger.warn("challenge without Digest nonce, authentication aborted");return false}if(challenge.qop){if(challenge.qop.indexOf("auth")>-1){this.qop="auth"}else if(challenge.qop.indexOf("auth-int")>-1){this.qop="auth-int"}else{this.logger.warn('challenge without Digest qop different than "auth" or "auth-int", authentication aborted');return false}}else{this.qop=null}this.method=request.method;this.uri=request.ruri;this.cnonce=Utils.createRandomToken(12);this.nc+=1;this.updateNcHex();if(this.nc===4294967296){this.nc=1;this.ncHex="00000001"}this.calculateResponse();return true};DigestAuthentication.prototype.calculateResponse=function(){var ha1,ha2;ha1=Utils.calculateMD5(this.username+":"+this.realm+":"+this.password);if(this.qop==="auth"){ha2=Utils.calculateMD5(this.method+":"+this.uri);this.response=Utils.calculateMD5(ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+ha2)}else if(this.qop==="auth-int"){ha2=Utils.calculateMD5(this.method+":"+this.uri+":"+Utils.calculateMD5(this.body?this.body:""));this.response=Utils.calculateMD5(ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+ha2)}else if(this.qop===null){ha2=Utils.calculateMD5(this.method+":"+this.uri);this.response=Utils.calculateMD5(ha1+":"+this.nonce+":"+ha2)}};DigestAuthentication.prototype.toString=function(){var auth_params=[];if(!this.response){throw new Error("response field does not exist, cannot generate Authorization header")}auth_params.push("algorithm="+this.algorithm);auth_params.push('username="'+this.username+'"');auth_params.push('realm="'+this.realm+'"');auth_params.push('nonce="'+this.nonce+'"');auth_params.push('uri="'+this.uri+'"');auth_params.push('response="'+this.response+'"');if(this.opaque){auth_params.push('opaque="'+this.opaque+'"')}if(this.qop){auth_params.push("qop="+this.qop);auth_params.push('cnonce="'+this.cnonce+'"');auth_params.push("nc="+this.ncHex)}return"Digest "+auth_params.join(", ")};DigestAuthentication.prototype.updateNcHex=function(){var hex=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-hex.length)+hex}},{"./Utils":47}],26:[function(require,module,exports){module.exports=EventEmitter;function EventEmitter(){}var LoggerFactory=require("./LoggerFactory");function Event(type,sender,data){this.type=type;this.sender=sender;this.data=data}var logger=(new LoggerFactory).getLogger("ExSIP.eventemitter"),C={MAX_LISTENERS:50};EventEmitter.prototype={initEvents:function(events){var idx,length;if(!this.logger){this.logger=logger}this.maxListeners=C.MAX_LISTENERS;this.events={};this.oneTimeListeners={};length=events.length;for(idx=0;idx<length;idx++){this.events[events[idx]]=[];this.oneTimeListeners[events[idx]]=[]}},checkEvent:function(event){return!!this.events[event]},addListener:function(event,listener){if(listener===undefined){return}else if(typeof listener!=="function"){this.logger.error("listener must be a function");return}else if(!this.checkEvent(event)){this.logger.error("unable to add a listener to a nonexistent event "+event);return}if(this.events[event].length>=this.maxListeners){this.logger.warn("max listeners exceeded for event "+event)}this.events[event].push(listener)},on:function(event,listener){this.addListener(event,listener)},once:function(event,listener){this.on(event,listener);this.oneTimeListeners[event].push(listener)},removeListener:function(event,listener){var events,length,idx=0;if(listener===undefined){return}else if(typeof listener!=="function"){this.logger.error("listener must be a function");return}else if(!this.checkEvent(event)){this.logger.error("unable to remove a listener from a nonexistent event"+event);return}events=this.events[event];length=events.length;while(idx<length){if(events[idx]===listener){events.splice(idx,1)}else{idx++}}},removeAllListener:function(event){if(!this.checkEvent(event)){this.logger.error("unable to remove listeners from a nonexistent event"+event);return}this.events[event]=[];this.oneTimeListeners[event]=[]},setMaxListeners:function(listeners){if(typeof listeners!=="number"||listeners<0){this.logger.error("listeners must be a positive number");return}this.maxListeners=listeners},listeners:function(event){if(!this.checkEvent(event)){this.logger.error("no event "+event);return}return this.events[event]},emit:function(event,sender,data){var listeners,length,e,idx,self=this;if(!this.checkEvent(event)){this.logger.error("unable to emit a nonexistent event"+event);return}this.logger.debug("emitting event "+event);listeners=this.events[event];length=listeners.length;e=new Event(event,sender,data);listeners.map(function(listener){return function(){listener.call(null,e)}}).forEach(function(callback){try{callback()}catch(err){self.logger.error(err.stack)}});for(idx in this.oneTimeListeners[event]){this.removeListener(event,this.oneTimeListeners[event][idx])}this.oneTimeListeners[event]=[]}}},{"./LoggerFactory":31}],27:[function(require,module,exports){var ExSIP={C:require("./Constants"),Exceptions:require("./Exceptions"),Utils:require("./Utils"),UA:require("./UA"),URI:require("./URI"),NameAddrHeader:require("./NameAddrHeader"),Grammar:require("./Grammar"),WebRTC:require("./WebRTC"),RTCSession:require("./RTCSession")};module.exports=ExSIP;var pkg=require("../package.json");Object.defineProperties(ExSIP,{name:{get:function(){return pkg.title}},version:{get:function(){return pkg.version}}})},{"../package.json":21,"./Constants":22,"./Exceptions":28,"./Grammar":29,"./NameAddrHeader":33,"./RTCSession":35,"./UA":45,"./URI":46,"./Utils":47,"./WebRTC":48}],28:[function(require,module,exports){var Exceptions={ConfigurationError:function(){var exception=function(parameter,value){console.trace("----------------------ConfigurationError : "+parameter+", "+value);this.code=1;this.name="CONFIGURATION_ERROR";this.parameter=parameter;this.value=value;this.message=!this.value?"Missing parameter: "+this.parameter:"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"'};exception.prototype=new Error;return exception}(),InvalidStateError:function(){var exception=function(status){console.trace("----------------------InvalidStateError : "+status);this.code=2;this.name="INVALID_STATE_ERROR";this.status=status;this.message="Invalid status: "+status};exception.prototype=new Error;return exception}(),NotSupportedError:function(){var exception=function(message){console.trace("----------------------NotSupportedError : "+message);this.code=3;this.name="NOT_SUPPORTED_ERROR";this.message=message};exception.prototype=new Error;return exception}(),NotReadyError:function(){var exception=function(message){console.trace("----------------------NotReadyError : "+message);this.code=4;this.name="NOT_READY_ERROR";this.message=message};exception.prototype=new Error;return exception}()};module.exports=Exceptions},{}],29:[function(require,module,exports){module.exports=function(){function quote(s){return'"'+s.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var result={parse:function(input,startRule){var parseFunctions={CRLF:parse_CRLF,DIGIT:parse_DIGIT,ALPHA:parse_ALPHA,HEXDIG:parse_HEXDIG,WSP:parse_WSP,OCTET:parse_OCTET,DQUOTE:parse_DQUOTE,SP:parse_SP,HTAB:parse_HTAB,alphanum:parse_alphanum,reserved:parse_reserved,unreserved:parse_unreserved,mark:parse_mark,escaped:parse_escaped,LWS:parse_LWS,SWS:parse_SWS,HCOLON:parse_HCOLON,TEXT_UTF8_TRIM:parse_TEXT_UTF8_TRIM,TEXT_UTF8char:parse_TEXT_UTF8char,UTF8_NONASCII:parse_UTF8_NONASCII,UTF8_CONT:parse_UTF8_CONT,LHEX:parse_LHEX,token:parse_token,token_nodot:parse_token_nodot,separators:parse_separators,word:parse_word,STAR:parse_STAR,SLASH:parse_SLASH,EQUAL:parse_EQUAL,LPAREN:parse_LPAREN,RPAREN:parse_RPAREN,RAQUOT:parse_RAQUOT,LAQUOT:parse_LAQUOT,COMMA:parse_COMMA,SEMI:parse_SEMI,COLON:parse_COLON,LDQUOT:parse_LDQUOT,RDQUOT:parse_RDQUOT,comment:parse_comment,ctext:parse_ctext,quoted_string:parse_quoted_string,quoted_string_clean:parse_quoted_string_clean,qdtext:parse_qdtext,quoted_pair:parse_quoted_pair,SIP_URI_noparams:parse_SIP_URI_noparams,SIP_URI:parse_SIP_URI,uri_scheme:parse_uri_scheme,userinfo:parse_userinfo,user:parse_user,user_unreserved:parse_user_unreserved,password:parse_password,hostport:parse_hostport,host:parse_host,hostname:parse_hostname,domainlabel:parse_domainlabel,toplabel:parse_toplabel,IPv6reference:parse_IPv6reference,IPv6address:parse_IPv6address,h16:parse_h16,ls32:parse_ls32,IPv4address:parse_IPv4address,dec_octet:parse_dec_octet,port:parse_port,uri_parameters:parse_uri_parameters,uri_parameter:parse_uri_parameter,transport_param:parse_transport_param,user_param:parse_user_param,method_param:parse_method_param,ttl_param:parse_ttl_param,maddr_param:parse_maddr_param,lr_param:parse_lr_param,other_param:parse_other_param,pname:parse_pname,pvalue:parse_pvalue,paramchar:parse_paramchar,param_unreserved:parse_param_unreserved,headers:parse_headers,header:parse_header,hname:parse_hname,hvalue:parse_hvalue,hnv_unreserved:parse_hnv_unreserved,Request_Response:parse_Request_Response,Request_Line:parse_Request_Line,Request_URI:parse_Request_URI,absoluteURI:parse_absoluteURI,hier_part:parse_hier_part,net_path:parse_net_path,abs_path:parse_abs_path,opaque_part:parse_opaque_part,uric:parse_uric,uric_no_slash:parse_uric_no_slash,path_segments:parse_path_segments,segment:parse_segment,param:parse_param,pchar:parse_pchar,scheme:parse_scheme,authority:parse_authority,srvr:parse_srvr,reg_name:parse_reg_name,query:parse_query,SIP_Version:parse_SIP_Version,INVITEm:parse_INVITEm,ACKm:parse_ACKm,OPTIONSm:parse_OPTIONSm,BYEm:parse_BYEm,CANCELm:parse_CANCELm,REGISTERm:parse_REGISTERm,SUBSCRIBEm:parse_SUBSCRIBEm,NOTIFYm:parse_NOTIFYm,Method:parse_Method,Status_Line:parse_Status_Line,Status_Code:parse_Status_Code,extension_code:parse_extension_code,Reason_Phrase:parse_Reason_Phrase,Allow_Events:parse_Allow_Events,Call_ID:parse_Call_ID,Contact:parse_Contact,contact_param:parse_contact_param,name_addr:parse_name_addr,display_name:parse_display_name,contact_params:parse_contact_params,c_p_q:parse_c_p_q,c_p_expires:parse_c_p_expires,delta_seconds:parse_delta_seconds,qvalue:parse_qvalue,generic_param:parse_generic_param,gen_value:parse_gen_value,Content_Disposition:parse_Content_Disposition,disp_type:parse_disp_type,disp_param:parse_disp_param,handling_param:parse_handling_param,Content_Encoding:parse_Content_Encoding,Content_Length:parse_Content_Length,Content_Type:parse_Content_Type,media_type:parse_media_type,m_type:parse_m_type,discrete_type:parse_discrete_type,composite_type:parse_composite_type,extension_token:parse_extension_token,x_token:parse_x_token,m_subtype:parse_m_subtype,m_parameter:parse_m_parameter,m_value:parse_m_value,CSeq:parse_CSeq,CSeq_value:parse_CSeq_value,Expires:parse_Expires,Event:parse_Event,event_type:parse_event_type,From:parse_From,from_param:parse_from_param,tag_param:parse_tag_param,Max_Forwards:parse_Max_Forwards,Min_Expires:parse_Min_Expires,Name_Addr_Header:parse_Name_Addr_Header,Proxy_Authenticate:parse_Proxy_Authenticate,challenge:parse_challenge,other_challenge:parse_other_challenge,auth_param:parse_auth_param,digest_cln:parse_digest_cln,realm:parse_realm,realm_value:parse_realm_value,domain:parse_domain,URI:parse_URI,nonce:parse_nonce,nonce_value:parse_nonce_value,opaque:parse_opaque,stale:parse_stale,algorithm:parse_algorithm,qop_options:parse_qop_options,qop_value:parse_qop_value,Proxy_Require:parse_Proxy_Require,Record_Route:parse_Record_Route,rec_route:parse_rec_route,Require:parse_Require,Route:parse_Route,route_param:parse_route_param,Subscription_State:parse_Subscription_State,substate_value:parse_substate_value,subexp_params:parse_subexp_params,event_reason_value:parse_event_reason_value,Subject:parse_Subject,Supported:parse_Supported,To:parse_To,to_param:parse_to_param,Via:parse_Via,via_parm:parse_via_parm,via_params:parse_via_params,via_ttl:parse_via_ttl,via_maddr:parse_via_maddr,via_received:parse_via_received,via_branch:parse_via_branch,response_port:parse_response_port,sent_protocol:parse_sent_protocol,protocol_name:parse_protocol_name,transport:parse_transport,sent_by:parse_sent_by,via_host:parse_via_host,via_port:parse_via_port,ttl:parse_ttl,WWW_Authenticate:parse_WWW_Authenticate,extension_header:parse_extension_header,header_value:parse_header_value,message_body:parse_message_body,stun_URI:parse_stun_URI,stun_scheme:parse_stun_scheme,stun_host_port:parse_stun_host_port,stun_host:parse_stun_host,reg_name:parse_reg_name,stun_unreserved:parse_stun_unreserved,sub_delims:parse_sub_delims,turn_URI:parse_turn_URI,turn_scheme:parse_turn_scheme,turn_transport:parse_turn_transport,uuid_URI:parse_uuid_URI,uuid:parse_uuid,hex4:parse_hex4,hex8:parse_hex8,hex12:parse_hex12};if(startRule!==undefined){if(parseFunctions[startRule]===undefined){throw new Error("Invalid rule name: "+quote(startRule)+".")}}else{startRule="CRLF"}var pos=0;var reportFailures=0;var rightmostFailuresPos=0;var rightmostFailuresExpected=[];function padLeft(input,padding,length){var result=input;var padLength=length-input.length;for(var i=0;i<padLength;i++){result=padding+result}return result}function escape(ch){var charCode=ch.charCodeAt(0);var escapeChar;var length;if(charCode<=255){escapeChar="x";length=2}else{escapeChar="u";length=4}return"\\"+escapeChar+padLeft(charCode.toString(16).toUpperCase(),"0",length)
}function matchFailed(failure){if(pos<rightmostFailuresPos){return}if(pos>rightmostFailuresPos){rightmostFailuresPos=pos;rightmostFailuresExpected=[]}rightmostFailuresExpected.push(failure)}function parse_CRLF(){var result0;if(input.substr(pos,2)==="\r\n"){result0="\r\n";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"\\r\\n"')}}return result0}function parse_DIGIT(){var result0;if(/^[0-9]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[0-9]")}}return result0}function parse_ALPHA(){var result0;if(/^[a-zA-Z]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[a-zA-Z]")}}return result0}function parse_HEXDIG(){var result0;if(/^[0-9a-fA-F]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[0-9a-fA-F]")}}return result0}function parse_WSP(){var result0;result0=parse_SP();if(result0===null){result0=parse_HTAB()}return result0}function parse_OCTET(){var result0;if(/^[\0-\xFF]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[\\0-\\xFF]")}}return result0}function parse_DQUOTE(){var result0;if(/^["]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed('["]')}}return result0}function parse_SP(){var result0;if(input.charCodeAt(pos)===32){result0=" ";pos++}else{result0=null;if(reportFailures===0){matchFailed('" "')}}return result0}function parse_HTAB(){var result0;if(input.charCodeAt(pos)===9){result0="	";pos++}else{result0=null;if(reportFailures===0){matchFailed('"\\t"')}}return result0}function parse_alphanum(){var result0;if(/^[a-zA-Z0-9]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[a-zA-Z0-9]")}}return result0}function parse_reserved(){var result0;if(input.charCodeAt(pos)===59){result0=";";pos++}else{result0=null;if(reportFailures===0){matchFailed('";"')}}if(result0===null){if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}if(result0===null){if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===64){result0="@";pos++}else{result0=null;if(reportFailures===0){matchFailed('"@"')}}if(result0===null){if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')}}}}}}}}}}}return result0}function parse_unreserved(){var result0;result0=parse_alphanum();if(result0===null){result0=parse_mark()}return result0}function parse_mark(){var result0;if(input.charCodeAt(pos)===45){result0="-";pos++}else{result0=null;if(reportFailures===0){matchFailed('"-"')}}if(result0===null){if(input.charCodeAt(pos)===95){result0="_";pos++}else{result0=null;if(reportFailures===0){matchFailed('"_"')}}if(result0===null){if(input.charCodeAt(pos)===46){result0=".";pos++}else{result0=null;if(reportFailures===0){matchFailed('"."')}}if(result0===null){if(input.charCodeAt(pos)===33){result0="!";pos++}else{result0=null;if(reportFailures===0){matchFailed('"!"')}}if(result0===null){if(input.charCodeAt(pos)===126){result0="~";pos++}else{result0=null;if(reportFailures===0){matchFailed('"~"')}}if(result0===null){if(input.charCodeAt(pos)===42){result0="*";pos++}else{result0=null;if(reportFailures===0){matchFailed('"*"')}}if(result0===null){if(input.charCodeAt(pos)===39){result0="'";pos++}else{result0=null;if(reportFailures===0){matchFailed('"\'"')}}if(result0===null){if(input.charCodeAt(pos)===40){result0="(";pos++}else{result0=null;if(reportFailures===0){matchFailed('"("')}}if(result0===null){if(input.charCodeAt(pos)===41){result0=")";pos++}else{result0=null;if(reportFailures===0){matchFailed('")"')}}}}}}}}}}return result0}function parse_escaped(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.charCodeAt(pos)===37){result0="%";pos++}else{result0=null;if(reportFailures===0){matchFailed('"%"')}}if(result0!==null){result1=parse_HEXDIG();if(result1!==null){result2=parse_HEXDIG();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,escaped){return escaped.join("")}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_LWS(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;pos2=pos;result0=[];result1=parse_WSP();while(result1!==null){result0.push(result1);result1=parse_WSP()}if(result0!==null){result1=parse_CRLF();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos2}}else{result0=null;pos=pos2}result0=result0!==null?result0:"";if(result0!==null){result2=parse_WSP();if(result2!==null){result1=[];while(result2!==null){result1.push(result2);result2=parse_WSP()}}else{result1=null}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return" "}(pos0)}if(result0===null){pos=pos0}return result0}function parse_SWS(){var result0;result0=parse_LWS();result0=result0!==null?result0:"";return result0}function parse_HCOLON(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=[];result1=parse_SP();if(result1===null){result1=parse_HTAB()}while(result1!==null){result0.push(result1);result1=parse_SP();if(result1===null){result1=parse_HTAB()}}if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return":"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_TEXT_UTF8_TRIM(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result1=parse_TEXT_UTF8char();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_TEXT_UTF8char()}}else{result0=null}if(result0!==null){result1=[];pos2=pos;result2=[];result3=parse_LWS();while(result3!==null){result2.push(result3);result3=parse_LWS()}if(result2!==null){result3=parse_TEXT_UTF8char();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=[];result3=parse_LWS();while(result3!==null){result2.push(result3);result3=parse_LWS()}if(result2!==null){result3=parse_TEXT_UTF8char();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_TEXT_UTF8char(){var result0;if(/^[!-~]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[!-~]")}}if(result0===null){result0=parse_UTF8_NONASCII()}return result0}function parse_UTF8_NONASCII(){var result0;if(/^[\x80-\uFFFF]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[\\x80-\\uFFFF]")}}return result0}function parse_UTF8_CONT(){var result0;if(/^[\x80-\xBF]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[\\x80-\\xBF]")}}return result0}function parse_LHEX(){var result0;result0=parse_DIGIT();if(result0===null){if(/^[a-f]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[a-f]")}}}return result0}function parse_token(){var result0,result1;var pos0;pos0=pos;result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}}}}}}}}}}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}}}}}}}}}}}}}else{result0=null}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_token_nodot(){var result0,result1;var pos0;pos0=pos;result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}}}}}}}}}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}}}}}}}}}}}}else{result0=null}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_separators(){var result0;if(input.charCodeAt(pos)===40){result0="(";pos++}else{result0=null;if(reportFailures===0){matchFailed('"("')}}if(result0===null){if(input.charCodeAt(pos)===41){result0=")";pos++}else{result0=null;if(reportFailures===0){matchFailed('")"')}}if(result0===null){if(input.charCodeAt(pos)===60){result0="<";pos++}else{result0=null;if(reportFailures===0){matchFailed('"<"')}}if(result0===null){if(input.charCodeAt(pos)===62){result0=">";pos++}else{result0=null;if(reportFailures===0){matchFailed('">"')}}if(result0===null){if(input.charCodeAt(pos)===64){result0="@";pos++}else{result0=null;if(reportFailures===0){matchFailed('"@"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')}}if(result0===null){if(input.charCodeAt(pos)===59){result0=";";pos++}else{result0=null;if(reportFailures===0){matchFailed('";"')}}if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===92){result0="\\";pos++}else{result0=null;if(reportFailures===0){matchFailed('"\\\\"')}}if(result0===null){result0=parse_DQUOTE();if(result0===null){if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}if(result0===null){if(input.charCodeAt(pos)===91){result0="[";pos++}else{result0=null;if(reportFailures===0){matchFailed('"["')}}if(result0===null){if(input.charCodeAt(pos)===93){result0="]";pos++}else{result0=null;if(reportFailures===0){matchFailed('"]"')}}if(result0===null){if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}if(result0===null){if(input.charCodeAt(pos)===123){result0="{";pos++}else{result0=null;if(reportFailures===0){matchFailed('"{"')}}if(result0===null){if(input.charCodeAt(pos)===125){result0="}";pos++}else{result0=null;if(reportFailures===0){matchFailed('"}"')}}if(result0===null){result0=parse_SP();if(result0===null){result0=parse_HTAB()}}}}}}}}}}}}}}}}}}return result0}function parse_word(){var result0,result1;var pos0;pos0=pos;result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}if(result1===null){if(input.charCodeAt(pos)===40){result1="(";pos++}else{result1=null;if(reportFailures===0){matchFailed('"("')}}if(result1===null){if(input.charCodeAt(pos)===41){result1=")";pos++}else{result1=null;if(reportFailures===0){matchFailed('")"')}}if(result1===null){if(input.charCodeAt(pos)===60){result1="<";pos++}else{result1=null;if(reportFailures===0){matchFailed('"<"')}}if(result1===null){if(input.charCodeAt(pos)===62){result1=">";pos++}else{result1=null;if(reportFailures===0){matchFailed('">"')}}if(result1===null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1===null){if(input.charCodeAt(pos)===92){result1="\\";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\\\\"')}}if(result1===null){result1=parse_DQUOTE();if(result1===null){if(input.charCodeAt(pos)===47){result1="/";pos++}else{result1=null;if(reportFailures===0){matchFailed('"/"')}}if(result1===null){if(input.charCodeAt(pos)===91){result1="[";pos++}else{result1=null;if(reportFailures===0){matchFailed('"["')}}if(result1===null){if(input.charCodeAt(pos)===93){result1="]";pos++}else{result1=null;if(reportFailures===0){matchFailed('"]"')}}if(result1===null){if(input.charCodeAt(pos)===63){result1="?";pos++}else{result1=null;if(reportFailures===0){matchFailed('"?"')}}if(result1===null){if(input.charCodeAt(pos)===123){result1="{";pos++}else{result1=null;if(reportFailures===0){matchFailed('"{"')}}if(result1===null){if(input.charCodeAt(pos)===125){result1="}";pos++}else{result1=null;if(reportFailures===0){matchFailed('"}"')}}}}}}}}}}}}}}}}}}}}}}}}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_alphanum();if(result1===null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1===null){if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1===null){if(input.charCodeAt(pos)===33){result1="!";pos++}else{result1=null;if(reportFailures===0){matchFailed('"!"')}}if(result1===null){if(input.charCodeAt(pos)===37){result1="%";pos++}else{result1=null;if(reportFailures===0){matchFailed('"%"')}}if(result1===null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1===null){if(input.charCodeAt(pos)===95){result1="_";pos++}else{result1=null;if(reportFailures===0){matchFailed('"_"')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===96){result1="`";pos++}else{result1=null;if(reportFailures===0){matchFailed('"`"')}}if(result1===null){if(input.charCodeAt(pos)===39){result1="'";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\'"')}}if(result1===null){if(input.charCodeAt(pos)===126){result1="~";pos++}else{result1=null;if(reportFailures===0){matchFailed('"~"')}}if(result1===null){if(input.charCodeAt(pos)===40){result1="(";pos++}else{result1=null;if(reportFailures===0){matchFailed('"("')}}if(result1===null){if(input.charCodeAt(pos)===41){result1=")";pos++}else{result1=null;if(reportFailures===0){matchFailed('")"')}}if(result1===null){if(input.charCodeAt(pos)===60){result1="<";pos++}else{result1=null;if(reportFailures===0){matchFailed('"<"')}}if(result1===null){if(input.charCodeAt(pos)===62){result1=">";pos++}else{result1=null;if(reportFailures===0){matchFailed('">"')}}if(result1===null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1===null){if(input.charCodeAt(pos)===92){result1="\\";pos++}else{result1=null;if(reportFailures===0){matchFailed('"\\\\"')}}if(result1===null){result1=parse_DQUOTE();if(result1===null){if(input.charCodeAt(pos)===47){result1="/";pos++}else{result1=null;if(reportFailures===0){matchFailed('"/"')}}if(result1===null){if(input.charCodeAt(pos)===91){result1="[";pos++}else{result1=null;if(reportFailures===0){matchFailed('"["')}}if(result1===null){if(input.charCodeAt(pos)===93){result1="]";pos++}else{result1=null;if(reportFailures===0){matchFailed('"]"')}}if(result1===null){if(input.charCodeAt(pos)===63){result1="?";pos++}else{result1=null;if(reportFailures===0){matchFailed('"?"')}}if(result1===null){if(input.charCodeAt(pos)===123){result1="{";pos++}else{result1=null;if(reportFailures===0){matchFailed('"{"')}}if(result1===null){if(input.charCodeAt(pos)===125){result1="}";pos++}else{result1=null;if(reportFailures===0){matchFailed('"}"')}}}}}}}}}}}}}}}}}}}}}}}}}}}else{result0=null}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_STAR(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===42){result1="*";pos++}else{result1=null;if(reportFailures===0){matchFailed('"*"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return"*"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_SLASH(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===47){result1="/";pos++}else{result1=null;if(reportFailures===0){matchFailed('"/"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return"/"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_EQUAL(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return"="}(pos0)}if(result0===null){pos=pos0}return result0}function parse_LPAREN(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===40){result1="(";pos++}else{result1=null;if(reportFailures===0){matchFailed('"("')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return"("}(pos0)}if(result0===null){pos=pos0}return result0}function parse_RPAREN(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===41){result1=")";pos++}else{result1=null;if(reportFailures===0){matchFailed('")"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return")"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_RAQUOT(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.charCodeAt(pos)===62){result0=">";pos++}else{result0=null;if(reportFailures===0){matchFailed('">"')}}if(result0!==null){result1=parse_SWS();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return">"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_LAQUOT(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===60){result1="<";pos++}else{result1=null;if(reportFailures===0){matchFailed('"<"')}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return"<"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_COMMA(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===44){result1=",";pos++}else{result1=null;if(reportFailures===0){matchFailed('","')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return","}(pos0)}if(result0===null){pos=pos0}return result0}function parse_SEMI(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===59){result1=";";pos++}else{result1=null;if(reportFailures===0){matchFailed('";"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return";"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_COLON(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_SWS();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return":"}(pos0)}if(result0===null){pos=pos0}return result0}function parse_LDQUOT(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){result1=parse_DQUOTE();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return'"'}(pos0)}if(result0===null){pos=pos0}return result0}function parse_RDQUOT(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_DQUOTE();if(result0!==null){result1=parse_SWS();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return'"'}(pos0)}if(result0===null){pos=pos0}return result0}function parse_comment(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_LPAREN();if(result0!==null){result1=[];result2=parse_ctext();if(result2===null){result2=parse_quoted_pair();if(result2===null){result2=parse_comment()}}while(result2!==null){result1.push(result2);result2=parse_ctext();if(result2===null){result2=parse_quoted_pair();if(result2===null){result2=parse_comment()}}}if(result1!==null){result2=parse_RPAREN();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_ctext(){var result0;if(/^[!-']/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[!-']")}}if(result0===null){if(/^[*-[]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[*-[]")}}if(result0===null){if(/^[\]-~]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[\\]-~]")}}if(result0===null){result0=parse_UTF8_NONASCII();if(result0===null){result0=parse_LWS()}}}}return result0}function parse_quoted_string(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){result1=parse_DQUOTE();if(result1!==null){result2=[];result3=parse_qdtext();if(result3===null){result3=parse_quoted_pair()}while(result3!==null){result2.push(result3);result3=parse_qdtext();if(result3===null){result3=parse_quoted_pair()}}if(result2!==null){result3=parse_DQUOTE();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_quoted_string_clean(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_SWS();if(result0!==null){result1=parse_DQUOTE();if(result1!==null){result2=[];result3=parse_qdtext();if(result3===null){result3=parse_quoted_pair()}while(result3!==null){result2.push(result3);result3=parse_qdtext();if(result3===null){result3=parse_quoted_pair()}}if(result2!==null){result3=parse_DQUOTE();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return input.substring(pos-1,offset+1)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_qdtext(){var result0;result0=parse_LWS();if(result0===null){if(input.charCodeAt(pos)===33){result0="!";pos++}else{result0=null;if(reportFailures===0){matchFailed('"!"')}}if(result0===null){if(/^[#-[]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[#-[]")}}if(result0===null){if(/^[\]-~]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[\\]-~]")}}if(result0===null){result0=parse_UTF8_NONASCII()}}}}return result0}function parse_quoted_pair(){var result0,result1;var pos0;pos0=pos;if(input.charCodeAt(pos)===92){result0="\\";pos++}else{result0=null;if(reportFailures===0){matchFailed('"\\\\"')}}if(result0!==null){if(/^[\0-\t]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[\\0-\\t]")}}if(result1===null){if(/^[\x0B-\f]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[\\x0B-\\f]")}}if(result1===null){if(/^[\x0E-]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[\\x0E-]")
}}}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_SIP_URI_noparams(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_uri_scheme();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_userinfo();result2=result2!==null?result2:"";if(result2!==null){result3=parse_hostport();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){try{data.uri=new URI(data.scheme,data.user,data.host,data.port);delete data.scheme;delete data.user;delete data.host;delete data.host_type;delete data.port}catch(e){data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_SIP_URI(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_uri_scheme();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_userinfo();result2=result2!==null?result2:"";if(result2!==null){result3=parse_hostport();if(result3!==null){result4=parse_uri_parameters();if(result4!==null){result5=parse_headers();result5=result5!==null?result5:"";if(result5!==null){result0=[result0,result1,result2,result3,result4,result5]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var header;try{data.uri=new URI(data.scheme,data.user,data.host,data.port,data.uri_params,data.uri_headers);delete data.scheme;delete data.user;delete data.host;delete data.host_type;delete data.port;delete data.uri_params;if(startRule==="SIP_URI"){data=data.uri}}catch(e){data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_uri_scheme(){var result0;var pos0;if(input.substr(pos,3).toLowerCase()==="sip"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"sip"')}}if(result0===null){pos0=pos;if(input.substr(pos,4).toLowerCase()==="sips"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"sips"')}}if(result0!==null){result0=function(offset){data.scheme=uri_scheme.toLowerCase()}(pos0)}if(result0===null){pos=pos0}}return result0}function parse_userinfo(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_user();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_password();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){if(input.charCodeAt(pos)===64){result2="@";pos++}else{result2=null;if(reportFailures===0){matchFailed('"@"')}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.user=decodeURIComponent(input.substring(pos-1,offset))}(pos0)}if(result0===null){pos=pos0}return result0}function parse_user(){var result0,result1;result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_user_unreserved()}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_user_unreserved()}}}}else{result0=null}return result0}function parse_user_unreserved(){var result0;if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')}}if(result0===null){if(input.charCodeAt(pos)===59){result0=";";pos++}else{result0=null;if(reportFailures===0){matchFailed('";"')}}if(result0===null){if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0===null){if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}}}}}}}}return result0}function parse_password(){var result0,result1;var pos0;pos0=pos;result0=[];result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){if(input.charCodeAt(pos)===38){result1="&";pos++}else{result1=null;if(reportFailures===0){matchFailed('"&"')}}if(result1===null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===36){result1="$";pos++}else{result1=null;if(reportFailures===0){matchFailed('"$"')}}if(result1===null){if(input.charCodeAt(pos)===44){result1=",";pos++}else{result1=null;if(reportFailures===0){matchFailed('","')}}}}}}}}while(result1!==null){result0.push(result1);result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){if(input.charCodeAt(pos)===38){result1="&";pos++}else{result1=null;if(reportFailures===0){matchFailed('"&"')}}if(result1===null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}if(result1===null){if(input.charCodeAt(pos)===36){result1="$";pos++}else{result1=null;if(reportFailures===0){matchFailed('"$"')}}if(result1===null){if(input.charCodeAt(pos)===44){result1=",";pos++}else{result1=null;if(reportFailures===0){matchFailed('","')}}}}}}}}}if(result0!==null){result0=function(offset){data.password=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_hostport(){var result0,result1,result2;var pos0,pos1;pos0=pos;result0=parse_host();if(result0!==null){pos1=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_port();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos1}}else{result1=null;pos=pos1}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_host(){var result0;var pos0;pos0=pos;result0=parse_IPv4address();if(result0===null){result0=parse_IPv6reference();if(result0===null){result0=parse_hostname()}}if(result0!==null){result0=function(offset){data.host=input.substring(pos,offset).toLowerCase();return data.host}(pos0)}if(result0===null){pos=pos0}return result0}function parse_hostname(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=[];pos2=pos;result1=parse_domainlabel();if(result1!==null){if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}while(result1!==null){result0.push(result1);pos2=pos;result1=parse_domainlabel();if(result1!==null){if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}}if(result0!==null){result1=parse_toplabel();if(result1!==null){if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}result2=result2!==null?result2:"";if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.host_type="domain";return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_domainlabel(){var result0,result1;if(/^[a-zA-Z0-9_\-]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[a-zA-Z0-9_\\-]")}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);if(/^[a-zA-Z0-9_\-]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[a-zA-Z0-9_\\-]")}}}}else{result0=null}return result0}function parse_toplabel(){var result0,result1;if(/^[a-zA-Z0-9_\-]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[a-zA-Z0-9_\\-]")}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);if(/^[a-zA-Z0-9_\-]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[a-zA-Z0-9_\\-]")}}}}else{result0=null}return result0}function parse_IPv6reference(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.charCodeAt(pos)===91){result0="[";pos++}else{result0=null;if(reportFailures===0){matchFailed('"["')}}if(result0!==null){result1=parse_IPv6address();if(result1!==null){if(input.charCodeAt(pos)===93){result2="]";pos++}else{result2=null;if(reportFailures===0){matchFailed('"]"')}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.host_type="IPv6";return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_IPv6address(){var result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10,result11,result12;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_h16();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){if(input.charCodeAt(pos)===58){result5=":";pos++}else{result5=null;if(reportFailures===0){matchFailed('":"')}}if(result5!==null){result6=parse_h16();if(result6!==null){if(input.charCodeAt(pos)===58){result7=":";pos++}else{result7=null;if(reportFailures===0){matchFailed('":"')}}if(result7!==null){result8=parse_h16();if(result8!==null){if(input.charCodeAt(pos)===58){result9=":";pos++}else{result9=null;if(reportFailures===0){matchFailed('":"')}}if(result9!==null){result10=parse_h16();if(result10!==null){if(input.charCodeAt(pos)===58){result11=":";pos++}else{result11=null;if(reportFailures===0){matchFailed('":"')}}if(result11!==null){result12=parse_ls32();if(result12!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10,result11,result12]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_h16();if(result7!==null){if(input.charCodeAt(pos)===58){result8=":";pos++}else{result8=null;if(reportFailures===0){matchFailed('":"')}}if(result8!==null){result9=parse_h16();if(result9!==null){if(input.charCodeAt(pos)===58){result10=":";pos++}else{result10=null;if(reportFailures===0){matchFailed('":"')}}if(result10!==null){result11=parse_ls32();if(result11!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10,result11]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_h16();if(result7!==null){if(input.charCodeAt(pos)===58){result8=":";pos++}else{result8=null;if(reportFailures===0){matchFailed('":"')}}if(result8!==null){result9=parse_ls32();if(result9!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_ls32();if(result7!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_ls32();if(result5!==null){result0=[result0,result1,result2,result3,result4,result5]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_ls32();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_ls32();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;if(input.substr(pos,2)==="::"){result0="::";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"::"')}}if(result0!==null){result1=parse_h16();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){if(input.substr(pos,2)==="::"){result1="::";pos+=2}else{result1=null;if(reportFailures===0){matchFailed('"::"')}}if(result1!==null){result2=parse_h16();if(result2!==null){if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){if(input.charCodeAt(pos)===58){result5=":";pos++}else{result5=null;if(reportFailures===0){matchFailed('":"')}}if(result5!==null){result6=parse_h16();if(result6!==null){if(input.charCodeAt(pos)===58){result7=":";pos++}else{result7=null;if(reportFailures===0){matchFailed('":"')}}if(result7!==null){result8=parse_h16();if(result8!==null){if(input.charCodeAt(pos)===58){result9=":";pos++}else{result9=null;if(reportFailures===0){matchFailed('":"')}}if(result9!==null){result10=parse_ls32();if(result10!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){if(input.substr(pos,2)==="::"){result2="::";pos+=2}else{result2=null;if(reportFailures===0){matchFailed('"::"')}}if(result2!==null){result3=parse_h16();if(result3!==null){if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_h16();if(result7!==null){if(input.charCodeAt(pos)===58){result8=":";pos++}else{result8=null;if(reportFailures===0){matchFailed('":"')}}if(result8!==null){result9=parse_ls32();if(result9!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){pos2=pos;if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}result2=result2!==null?result2:"";if(result2!==null){if(input.substr(pos,2)==="::"){result3="::";pos+=2}else{result3=null;if(reportFailures===0){matchFailed('"::"')}}if(result3!==null){result4=parse_h16();if(result4!==null){if(input.charCodeAt(pos)===58){result5=":";pos++}else{result5=null;if(reportFailures===0){matchFailed('":"')}}if(result5!==null){result6=parse_h16();if(result6!==null){if(input.charCodeAt(pos)===58){result7=":";pos++}else{result7=null;if(reportFailures===0){matchFailed('":"')}}if(result7!==null){result8=parse_ls32();if(result8!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){pos2=pos;if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}result2=result2!==null?result2:"";if(result2!==null){pos2=pos;if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos2}}else{result3=null;pos=pos2}result3=result3!==null?result3:"";if(result3!==null){if(input.substr(pos,2)==="::"){result4="::";pos+=2}else{result4=null;if(reportFailures===0){matchFailed('"::"')}}if(result4!==null){result5=parse_h16();if(result5!==null){if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_ls32();if(result7!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){pos2=pos;if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}result2=result2!==null?result2:"";if(result2!==null){pos2=pos;if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos2}}else{result3=null;pos=pos2}result3=result3!==null?result3:"";if(result3!==null){pos2=pos;if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos2}}else{result4=null;pos=pos2}result4=result4!==null?result4:"";if(result4!==null){if(input.substr(pos,2)==="::"){result5="::";pos+=2}else{result5=null;if(reportFailures===0){matchFailed('"::"')}}if(result5!==null){result6=parse_ls32();if(result6!==null){result0=[result0,result1,result2,result3,result4,result5,result6]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){pos2=pos;if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}result2=result2!==null?result2:"";if(result2!==null){pos2=pos;if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos2}}else{result3=null;pos=pos2}result3=result3!==null?result3:"";if(result3!==null){pos2=pos;if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos2}}else{result4=null;pos=pos2}result4=result4!==null?result4:"";if(result4!==null){pos2=pos;if(input.charCodeAt(pos)===58){result5=":";pos++}else{result5=null;if(reportFailures===0){matchFailed('":"')}}if(result5!==null){result6=parse_h16();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}result5=result5!==null?result5:"";if(result5!==null){if(input.substr(pos,2)==="::"){result6="::";pos+=2}else{result6=null;if(reportFailures===0){matchFailed('"::"')}}if(result6!==null){result7=parse_h16();if(result7!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){pos1=pos;result0=parse_h16();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){pos2=pos;if(input.charCodeAt(pos)===58){result2=":";pos++}else{result2=null;if(reportFailures===0){matchFailed('":"')}}if(result2!==null){result3=parse_h16();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}result2=result2!==null?result2:"";if(result2!==null){pos2=pos;if(input.charCodeAt(pos)===58){result3=":";pos++}else{result3=null;if(reportFailures===0){matchFailed('":"')}}if(result3!==null){result4=parse_h16();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos2}}else{result3=null;pos=pos2}result3=result3!==null?result3:"";if(result3!==null){pos2=pos;if(input.charCodeAt(pos)===58){result4=":";pos++}else{result4=null;if(reportFailures===0){matchFailed('":"')}}if(result4!==null){result5=parse_h16();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos2}}else{result4=null;pos=pos2}result4=result4!==null?result4:"";if(result4!==null){pos2=pos;if(input.charCodeAt(pos)===58){result5=":";pos++}else{result5=null;if(reportFailures===0){matchFailed('":"')}}if(result5!==null){result6=parse_h16();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}result5=result5!==null?result5:"";if(result5!==null){pos2=pos;if(input.charCodeAt(pos)===58){result6=":";pos++}else{result6=null;if(reportFailures===0){matchFailed('":"')}}if(result6!==null){result7=parse_h16();if(result7!==null){result6=[result6,result7]}else{result6=null;pos=pos2}}else{result6=null;pos=pos2}result6=result6!==null?result6:"";if(result6!==null){if(input.substr(pos,2)==="::"){result7="::";pos+=2}else{result7=null;if(reportFailures===0){matchFailed('"::"')}}if(result7!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}}}}}}}}}}}}}}if(result0!==null){result0=function(offset){data.host_type="IPv6";return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_h16(){var result0,result1,result2,result3;var pos0;pos0=pos;result0=parse_HEXDIG();if(result0!==null){result1=parse_HEXDIG();result1=result1!==null?result1:"";if(result1!==null){result2=parse_HEXDIG();result2=result2!==null?result2:"";if(result2!==null){result3=parse_HEXDIG();result3=result3!==null?result3:"";if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_ls32(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_h16();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_h16();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){result0=parse_IPv4address()}return result0}function parse_IPv4address(){var result0,result1,result2,result3,result4,result5,result6;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_dec_octet();if(result0!==null){if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1!==null){result2=parse_dec_octet();if(result2!==null){if(input.charCodeAt(pos)===46){result3=".";pos++}else{result3=null;if(reportFailures===0){matchFailed('"."')}}if(result3!==null){result4=parse_dec_octet();if(result4!==null){if(input.charCodeAt(pos)===46){result5=".";pos++}else{result5=null;if(reportFailures===0){matchFailed('"."')}}if(result5!==null){result6=parse_dec_octet();if(result6!==null){result0=[result0,result1,result2,result3,result4,result5,result6]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.host_type="IPv4";return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_dec_octet(){var result0,result1,result2;var pos0;pos0=pos;if(input.substr(pos,2)==="25"){result0="25";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"25"')
}}if(result0!==null){if(/^[0-5]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[0-5]")}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){pos0=pos;if(input.charCodeAt(pos)===50){result0="2";pos++}else{result0=null;if(reportFailures===0){matchFailed('"2"')}}if(result0!==null){if(/^[0-4]/.test(input.charAt(pos))){result1=input.charAt(pos);pos++}else{result1=null;if(reportFailures===0){matchFailed("[0-4]")}}if(result1!==null){result2=parse_DIGIT();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){pos0=pos;if(input.charCodeAt(pos)===49){result0="1";pos++}else{result0=null;if(reportFailures===0){matchFailed('"1"')}}if(result0!==null){result1=parse_DIGIT();if(result1!==null){result2=parse_DIGIT();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){pos0=pos;if(/^[1-9]/.test(input.charAt(pos))){result0=input.charAt(pos);pos++}else{result0=null;if(reportFailures===0){matchFailed("[1-9]")}}if(result0!==null){result1=parse_DIGIT();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){result0=parse_DIGIT()}}}}return result0}function parse_port(){var result0,result1,result2,result3,result4;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_DIGIT();result0=result0!==null?result0:"";if(result0!==null){result1=parse_DIGIT();result1=result1!==null?result1:"";if(result1!==null){result2=parse_DIGIT();result2=result2!==null?result2:"";if(result2!==null){result3=parse_DIGIT();result3=result3!==null?result3:"";if(result3!==null){result4=parse_DIGIT();result4=result4!==null?result4:"";if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,port){port=parseInt(port.join(""));data.port=port;return port}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_uri_parameters(){var result0,result1,result2;var pos0;result0=[];pos0=pos;if(input.charCodeAt(pos)===59){result1=";";pos++}else{result1=null;if(reportFailures===0){matchFailed('";"')}}if(result1!==null){result2=parse_uri_parameter();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos0}}else{result1=null;pos=pos0}while(result1!==null){result0.push(result1);pos0=pos;if(input.charCodeAt(pos)===59){result1=";";pos++}else{result1=null;if(reportFailures===0){matchFailed('";"')}}if(result1!==null){result2=parse_uri_parameter();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos0}}else{result1=null;pos=pos0}}return result0}function parse_uri_parameter(){var result0;result0=parse_transport_param();if(result0===null){result0=parse_user_param();if(result0===null){result0=parse_method_param();if(result0===null){result0=parse_ttl_param();if(result0===null){result0=parse_maddr_param();if(result0===null){result0=parse_lr_param();if(result0===null){result0=parse_other_param()}}}}}}return result0}function parse_transport_param(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,10).toLowerCase()==="transport="){result0=input.substr(pos,10);pos+=10}else{result0=null;if(reportFailures===0){matchFailed('"transport="')}}if(result0!==null){if(input.substr(pos,3).toLowerCase()==="udp"){result1=input.substr(pos,3);pos+=3}else{result1=null;if(reportFailures===0){matchFailed('"udp"')}}if(result1===null){if(input.substr(pos,3).toLowerCase()==="tcp"){result1=input.substr(pos,3);pos+=3}else{result1=null;if(reportFailures===0){matchFailed('"tcp"')}}if(result1===null){if(input.substr(pos,4).toLowerCase()==="sctp"){result1=input.substr(pos,4);pos+=4}else{result1=null;if(reportFailures===0){matchFailed('"sctp"')}}if(result1===null){if(input.substr(pos,3).toLowerCase()==="tls"){result1=input.substr(pos,3);pos+=3}else{result1=null;if(reportFailures===0){matchFailed('"tls"')}}if(result1===null){result1=parse_token()}}}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,transport){if(!data.uri_params)data.uri_params={};data.uri_params["transport"]=transport.toLowerCase()}(pos0,result0[1])}if(result0===null){pos=pos0}return result0}function parse_user_param(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,5).toLowerCase()==="user="){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"user="')}}if(result0!==null){if(input.substr(pos,5).toLowerCase()==="phone"){result1=input.substr(pos,5);pos+=5}else{result1=null;if(reportFailures===0){matchFailed('"phone"')}}if(result1===null){if(input.substr(pos,2).toLowerCase()==="ip"){result1=input.substr(pos,2);pos+=2}else{result1=null;if(reportFailures===0){matchFailed('"ip"')}}if(result1===null){result1=parse_token()}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,user){if(!data.uri_params)data.uri_params={};data.uri_params["user"]=user.toLowerCase()}(pos0,result0[1])}if(result0===null){pos=pos0}return result0}function parse_method_param(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,7).toLowerCase()==="method="){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"method="')}}if(result0!==null){result1=parse_Method();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,method){if(!data.uri_params)data.uri_params={};data.uri_params["method"]=method}(pos0,result0[1])}if(result0===null){pos=pos0}return result0}function parse_ttl_param(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,4).toLowerCase()==="ttl="){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"ttl="')}}if(result0!==null){result1=parse_ttl();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,ttl){if(!data.params)data.params={};data.params["ttl"]=ttl}(pos0,result0[1])}if(result0===null){pos=pos0}return result0}function parse_maddr_param(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,6).toLowerCase()==="maddr="){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"maddr="')}}if(result0!==null){result1=parse_host();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,maddr){if(!data.uri_params)data.uri_params={};data.uri_params["maddr"]=maddr}(pos0,result0[1])}if(result0===null){pos=pos0}return result0}function parse_lr_param(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;if(input.substr(pos,2).toLowerCase()==="lr"){result0=input.substr(pos,2);pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"lr"')}}if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1!==null){result2=parse_token();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){if(!data.uri_params)data.uri_params={};data.uri_params["lr"]=undefined}(pos0)}if(result0===null){pos=pos0}return result0}function parse_other_param(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_pname();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1!==null){result2=parse_pvalue();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,param,value){if(!data.uri_params)data.uri_params={};if(typeof value==="undefined"){value=undefined}else{value=value[1]}data.uri_params[param.toLowerCase()]=value&&value.toLowerCase()}(pos0,result0[0],result0[1])}if(result0===null){pos=pos0}return result0}function parse_pname(){var result0,result1;var pos0;pos0=pos;result1=parse_paramchar();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_paramchar()}}else{result0=null}if(result0!==null){result0=function(offset,pname){return pname.join("")}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_pvalue(){var result0,result1;var pos0;pos0=pos;result1=parse_paramchar();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_paramchar()}}else{result0=null}if(result0!==null){result0=function(offset,pvalue){return pvalue.join("")}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_paramchar(){var result0;result0=parse_param_unreserved();if(result0===null){result0=parse_unreserved();if(result0===null){result0=parse_escaped()}}return result0}function parse_param_unreserved(){var result0;if(input.charCodeAt(pos)===91){result0="[";pos++}else{result0=null;if(reportFailures===0){matchFailed('"["')}}if(result0===null){if(input.charCodeAt(pos)===93){result0="]";pos++}else{result0=null;if(reportFailures===0){matchFailed('"]"')}}if(result0===null){if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}}}}}}}return result0}function parse_headers(){var result0,result1,result2,result3,result4;var pos0,pos1;pos0=pos;if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0!==null){result1=parse_header();if(result1!==null){result2=[];pos1=pos;if(input.charCodeAt(pos)===38){result3="&";pos++}else{result3=null;if(reportFailures===0){matchFailed('"&"')}}if(result3!==null){result4=parse_header();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos1}}else{result3=null;pos=pos1}while(result3!==null){result2.push(result3);pos1=pos;if(input.charCodeAt(pos)===38){result3="&";pos++}else{result3=null;if(reportFailures===0){matchFailed('"&"')}}if(result3!==null){result4=parse_header();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos1}}else{result3=null;pos=pos1}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_header(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_hname();if(result0!==null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1!==null){result2=parse_hvalue();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,hname,hvalue){hname=hname.join("").toLowerCase();hvalue=hvalue.join("");if(!data.uri_headers)data.uri_headers={};if(!data.uri_headers[hname]){data.uri_headers[hname]=[hvalue]}else{data.uri_headers[hname].push(hvalue)}}(pos0,result0[0],result0[2])}if(result0===null){pos=pos0}return result0}function parse_hname(){var result0,result1;result1=parse_hnv_unreserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped()}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_hnv_unreserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped()}}}}else{result0=null}return result0}function parse_hvalue(){var result0,result1;result0=[];result1=parse_hnv_unreserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped()}}while(result1!==null){result0.push(result1);result1=parse_hnv_unreserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped()}}}return result0}function parse_hnv_unreserved(){var result0;if(input.charCodeAt(pos)===91){result0="[";pos++}else{result0=null;if(reportFailures===0){matchFailed('"["')}}if(result0===null){if(input.charCodeAt(pos)===93){result0="]";pos++}else{result0=null;if(reportFailures===0){matchFailed('"]"')}}if(result0===null){if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}if(result0===null){if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}}}}}}}return result0}function parse_Request_Response(){var result0;result0=parse_Status_Line();if(result0===null){result0=parse_Request_Line()}return result0}function parse_Request_Line(){var result0,result1,result2,result3,result4;var pos0;pos0=pos;result0=parse_Method();if(result0!==null){result1=parse_SP();if(result1!==null){result2=parse_Request_URI();if(result2!==null){result3=parse_SP();if(result3!==null){result4=parse_SIP_Version();if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Request_URI(){var result0;result0=parse_SIP_URI();if(result0===null){result0=parse_absoluteURI()}return result0}function parse_absoluteURI(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_scheme();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_hier_part();if(result2===null){result2=parse_opaque_part()}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_hier_part(){var result0,result1,result2;var pos0,pos1;pos0=pos;result0=parse_net_path();if(result0===null){result0=parse_abs_path()}if(result0!==null){pos1=pos;if(input.charCodeAt(pos)===63){result1="?";pos++}else{result1=null;if(reportFailures===0){matchFailed('"?"')}}if(result1!==null){result2=parse_query();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos1}}else{result1=null;pos=pos1}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_net_path(){var result0,result1,result2;var pos0;pos0=pos;if(input.substr(pos,2)==="//"){result0="//";pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"//"')}}if(result0!==null){result1=parse_authority();if(result1!==null){result2=parse_abs_path();result2=result2!==null?result2:"";if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_abs_path(){var result0,result1;var pos0;pos0=pos;if(input.charCodeAt(pos)===47){result0="/";pos++}else{result0=null;if(reportFailures===0){matchFailed('"/"')}}if(result0!==null){result1=parse_path_segments();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_opaque_part(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_uric_no_slash();if(result0!==null){result1=[];result2=parse_uric();while(result2!==null){result1.push(result2);result2=parse_uric()}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_uric(){var result0;result0=parse_reserved();if(result0===null){result0=parse_unreserved();if(result0===null){result0=parse_escaped()}}return result0}function parse_uric_no_slash(){var result0;result0=parse_unreserved();if(result0===null){result0=parse_escaped();if(result0===null){if(input.charCodeAt(pos)===59){result0=";";pos++}else{result0=null;if(reportFailures===0){matchFailed('";"')}}if(result0===null){if(input.charCodeAt(pos)===63){result0="?";pos++}else{result0=null;if(reportFailures===0){matchFailed('"?"')}}if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===64){result0="@";pos++}else{result0=null;if(reportFailures===0){matchFailed('"@"')}}if(result0===null){if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')}}}}}}}}}}}}return result0}function parse_path_segments(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_segment();if(result0!==null){result1=[];pos1=pos;if(input.charCodeAt(pos)===47){result2="/";pos++}else{result2=null;if(reportFailures===0){matchFailed('"/"')}}if(result2!==null){result3=parse_segment();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;if(input.charCodeAt(pos)===47){result2="/";pos++}else{result2=null;if(reportFailures===0){matchFailed('"/"')}}if(result2!==null){result3=parse_segment();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_segment(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=[];result1=parse_pchar();while(result1!==null){result0.push(result1);result1=parse_pchar()}if(result0!==null){result1=[];pos1=pos;if(input.charCodeAt(pos)===59){result2=";";pos++}else{result2=null;if(reportFailures===0){matchFailed('";"')}}if(result2!==null){result3=parse_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;if(input.charCodeAt(pos)===59){result2=";";pos++}else{result2=null;if(reportFailures===0){matchFailed('";"')}}if(result2!==null){result3=parse_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_param(){var result0,result1;result0=[];result1=parse_pchar();while(result1!==null){result0.push(result1);result1=parse_pchar()}return result0}function parse_pchar(){var result0;result0=parse_unreserved();if(result0===null){result0=parse_escaped();if(result0===null){if(input.charCodeAt(pos)===58){result0=":";pos++}else{result0=null;if(reportFailures===0){matchFailed('":"')}}if(result0===null){if(input.charCodeAt(pos)===64){result0="@";pos++}else{result0=null;if(reportFailures===0){matchFailed('"@"')}}if(result0===null){if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')}}}}}}}}}}return result0}function parse_scheme(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_ALPHA();if(result0!==null){result1=[];result2=parse_ALPHA();if(result2===null){result2=parse_DIGIT();if(result2===null){if(input.charCodeAt(pos)===43){result2="+";pos++}else{result2=null;if(reportFailures===0){matchFailed('"+"')}}if(result2===null){if(input.charCodeAt(pos)===45){result2="-";pos++}else{result2=null;if(reportFailures===0){matchFailed('"-"')}}if(result2===null){if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}}}}}while(result2!==null){result1.push(result2);result2=parse_ALPHA();if(result2===null){result2=parse_DIGIT();if(result2===null){if(input.charCodeAt(pos)===43){result2="+";pos++}else{result2=null;if(reportFailures===0){matchFailed('"+"')}}if(result2===null){if(input.charCodeAt(pos)===45){result2="-";pos++}else{result2=null;if(reportFailures===0){matchFailed('"-"')}}if(result2===null){if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}}}}}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.scheme=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_authority(){var result0;result0=parse_srvr();if(result0===null){result0=parse_reg_name()}return result0}function parse_srvr(){var result0,result1;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_userinfo();if(result0!==null){if(input.charCodeAt(pos)===64){result1="@";pos++}else{result1=null;if(reportFailures===0){matchFailed('"@"')}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}result0=result0!==null?result0:"";if(result0!==null){result1=parse_hostport();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}result0=result0!==null?result0:"";return result0}function parse_reg_name(){var result0,result1;result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){if(input.charCodeAt(pos)===36){result1="$";pos++}else{result1=null;if(reportFailures===0){matchFailed('"$"')}}if(result1===null){if(input.charCodeAt(pos)===44){result1=",";pos++}else{result1=null;if(reportFailures===0){matchFailed('","')}}if(result1===null){if(input.charCodeAt(pos)===59){result1=";";pos++}else{result1=null;if(reportFailures===0){matchFailed('";"')}}if(result1===null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1===null){if(input.charCodeAt(pos)===64){result1="@";pos++}else{result1=null;if(reportFailures===0){matchFailed('"@"')}}if(result1===null){if(input.charCodeAt(pos)===38){result1="&";pos++}else{result1=null;if(reportFailures===0){matchFailed('"&"')}}if(result1===null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}}}}}}}}}}if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){if(input.charCodeAt(pos)===36){result1="$";pos++}else{result1=null;if(reportFailures===0){matchFailed('"$"')}}if(result1===null){if(input.charCodeAt(pos)===44){result1=",";pos++}else{result1=null;if(reportFailures===0){matchFailed('","')}}if(result1===null){if(input.charCodeAt(pos)===59){result1=";";pos++}else{result1=null;if(reportFailures===0){matchFailed('";"')}}if(result1===null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1===null){if(input.charCodeAt(pos)===64){result1="@";pos++}else{result1=null;if(reportFailures===0){matchFailed('"@"')}}if(result1===null){if(input.charCodeAt(pos)===38){result1="&";pos++}else{result1=null;if(reportFailures===0){matchFailed('"&"')}}if(result1===null){if(input.charCodeAt(pos)===61){result1="=";pos++}else{result1=null;if(reportFailures===0){matchFailed('"="')}}if(result1===null){if(input.charCodeAt(pos)===43){result1="+";pos++}else{result1=null;if(reportFailures===0){matchFailed('"+"')}}}}}}}}}}}}}else{result0=null}return result0}function parse_query(){var result0,result1;result0=[];result1=parse_uric();while(result1!==null){result0.push(result1);result1=parse_uric()}return result0}function parse_SIP_Version(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,3).toLowerCase()==="sip"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"SIP"')}}if(result0!==null){if(input.charCodeAt(pos)===47){result1="/";pos++}else{result1=null;if(reportFailures===0){matchFailed('"/"')}}if(result1!==null){result3=parse_DIGIT();if(result3!==null){result2=[];while(result3!==null){result2.push(result3);result3=parse_DIGIT()}}else{result2=null}if(result2!==null){if(input.charCodeAt(pos)===46){result3=".";pos++}else{result3=null;if(reportFailures===0){matchFailed('"."')}}if(result3!==null){result5=parse_DIGIT();if(result5!==null){result4=[];while(result5!==null){result4.push(result5);result5=parse_DIGIT()}}else{result4=null}if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.sip_version=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_INVITEm(){var result0;if(input.substr(pos,6)==="INVITE"){result0="INVITE";pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"INVITE"')}}return result0}function parse_ACKm(){var result0;if(input.substr(pos,3)==="ACK"){result0="ACK";pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"ACK"')}}return result0}function parse_OPTIONSm(){var result0;if(input.substr(pos,7)==="OPTIONS"){result0="OPTIONS";pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"OPTIONS"')}}return result0}function parse_BYEm(){var result0;if(input.substr(pos,3)==="BYE"){result0="BYE";pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"BYE"')}}return result0}function parse_CANCELm(){var result0;if(input.substr(pos,6)==="CANCEL"){result0="CANCEL";pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"CANCEL"')}}return result0}function parse_REGISTERm(){var result0;if(input.substr(pos,8)==="REGISTER"){result0="REGISTER";pos+=8}else{result0=null;if(reportFailures===0){matchFailed('"REGISTER"')}}return result0}function parse_SUBSCRIBEm(){var result0;if(input.substr(pos,9)==="SUBSCRIBE"){result0="SUBSCRIBE";pos+=9}else{result0=null;if(reportFailures===0){matchFailed('"SUBSCRIBE"')}}return result0}function parse_NOTIFYm(){var result0;if(input.substr(pos,6)==="NOTIFY"){result0="NOTIFY";pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"NOTIFY"')}}return result0}function parse_Method(){var result0;var pos0;pos0=pos;result0=parse_INVITEm();if(result0===null){result0=parse_ACKm();if(result0===null){result0=parse_OPTIONSm();if(result0===null){result0=parse_BYEm();if(result0===null){result0=parse_CANCELm();if(result0===null){result0=parse_REGISTERm();if(result0===null){result0=parse_SUBSCRIBEm();if(result0===null){result0=parse_NOTIFYm();if(result0===null){result0=parse_token()}}}}}}}}if(result0!==null){result0=function(offset){data.method=input.substring(pos,offset);return data.method}(pos0)}if(result0===null){pos=pos0}return result0}function parse_Status_Line(){var result0,result1,result2,result3,result4;var pos0;pos0=pos;result0=parse_SIP_Version();if(result0!==null){result1=parse_SP();if(result1!==null){result2=parse_Status_Code();if(result2!==null){result3=parse_SP();if(result3!==null){result4=parse_Reason_Phrase();if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Status_Code(){var result0;var pos0;pos0=pos;result0=parse_extension_code();if(result0!==null){result0=function(offset,status_code){data.status_code=parseInt(status_code.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_extension_code(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_DIGIT();if(result0!==null){result1=parse_DIGIT();if(result1!==null){result2=parse_DIGIT();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Reason_Phrase(){var result0,result1;var pos0;pos0=pos;result0=[];result1=parse_reserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_UTF8_NONASCII();if(result1===null){result1=parse_UTF8_CONT();if(result1===null){result1=parse_SP();if(result1===null){result1=parse_HTAB()}}}}}}while(result1!==null){result0.push(result1);result1=parse_reserved();if(result1===null){result1=parse_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_UTF8_NONASCII();if(result1===null){result1=parse_UTF8_CONT();if(result1===null){result1=parse_SP();if(result1===null){result1=parse_HTAB()}}}}}}}if(result0!==null){result0=function(offset){data.reason_phrase=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_Allow_Events(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_event_type();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_event_type();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_event_type();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Call_ID(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_word();if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===64){result1="@";pos++}else{result1=null;if(reportFailures===0){matchFailed('"@"')}}if(result1!==null){result2=parse_word();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";
if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_Contact(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;result0=parse_STAR();if(result0===null){pos1=pos;result0=parse_contact_param();if(result0!==null){result1=[];pos2=pos;result2=parse_COMMA();if(result2!==null){result3=parse_contact_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_COMMA();if(result2!==null){result3=parse_contact_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}if(result0!==null){result0=function(offset){var idx,length;length=data.multi_header.length;for(idx=0;idx<length;idx++){if(data.multi_header[idx].parsed===null){data=null;break}}if(data!==null){data=data.multi_header}else{data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_contact_param(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_SIP_URI_noparams();if(result0===null){result0=parse_name_addr()}if(result0!==null){result1=[];pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_contact_params();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_contact_params();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var header;if(!data.multi_header)data.multi_header=[];try{header=new NameAddrHeader(data.uri,data.display_name,data.params);delete data.uri;delete data.display_name;delete data.params}catch(e){header=null}data.multi_header.push({possition:pos,offset:offset,parsed:header})}(pos0)}if(result0===null){pos=pos0}return result0}function parse_name_addr(){var result0,result1,result2,result3;var pos0;pos0=pos;result0=parse_display_name();result0=result0!==null?result0:"";if(result0!==null){result1=parse_LAQUOT();if(result1!==null){result2=parse_SIP_URI();if(result2!==null){result3=parse_RAQUOT();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_display_name(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_token();if(result0!==null){result1=[];pos2=pos;result2=parse_LWS();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_LWS();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0===null){result0=parse_quoted_string()}if(result0!==null){result0=function(offset,display_name){display_name=input.substring(pos,offset).trim();if(display_name[0]==='"'){display_name=display_name.substring(1,display_name.length-1)}data.display_name=display_name}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_contact_params(){var result0;result0=parse_c_p_q();if(result0===null){result0=parse_c_p_expires();if(result0===null){result0=parse_generic_param()}}return result0}function parse_c_p_q(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,1).toLowerCase()==="q"){result0=input.substr(pos,1);pos++}else{result0=null;if(reportFailures===0){matchFailed('"q"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_qvalue();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,q){if(!data.params)data.params={};data.params["q"]=q}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_c_p_expires(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,7).toLowerCase()==="expires"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"expires"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_delta_seconds();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,expires){if(!data.params)data.params={};data.params["expires"]=expires}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_delta_seconds(){var result0,result1;var pos0;pos0=pos;result1=parse_DIGIT();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_DIGIT()}}else{result0=null}if(result0!==null){result0=function(offset,delta_seconds){return parseInt(delta_seconds.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_qvalue(){var result0,result1,result2,result3,result4;var pos0,pos1,pos2;pos0=pos;pos1=pos;if(input.charCodeAt(pos)===48){result0="0";pos++}else{result0=null;if(reportFailures===0){matchFailed('"0"')}}if(result0!==null){pos2=pos;if(input.charCodeAt(pos)===46){result1=".";pos++}else{result1=null;if(reportFailures===0){matchFailed('"."')}}if(result1!==null){result2=parse_DIGIT();result2=result2!==null?result2:"";if(result2!==null){result3=parse_DIGIT();result3=result3!==null?result3:"";if(result3!==null){result4=parse_DIGIT();result4=result4!==null?result4:"";if(result4!==null){result1=[result1,result2,result3,result4]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){return parseFloat(input.substring(pos,offset))}(pos0)}if(result0===null){pos=pos0}return result0}function parse_generic_param(){var result0,result1,result2;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_token();if(result0!==null){pos2=pos;result1=parse_EQUAL();if(result1!==null){result2=parse_gen_value();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,param,value){if(!data.params)data.params={};if(typeof value==="undefined"){value=undefined}else{value=value[1]}data.params[param.toLowerCase()]=value}(pos0,result0[0],result0[1])}if(result0===null){pos=pos0}return result0}function parse_gen_value(){var result0;result0=parse_token();if(result0===null){result0=parse_host();if(result0===null){result0=parse_quoted_string()}}return result0}function parse_Content_Disposition(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_disp_type();if(result0!==null){result1=[];pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_disp_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_disp_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_disp_type(){var result0;if(input.substr(pos,6).toLowerCase()==="render"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"render"')}}if(result0===null){if(input.substr(pos,7).toLowerCase()==="session"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"session"')}}if(result0===null){if(input.substr(pos,4).toLowerCase()==="icon"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"icon"')}}if(result0===null){if(input.substr(pos,5).toLowerCase()==="alert"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"alert"')}}if(result0===null){result0=parse_token()}}}}return result0}function parse_disp_param(){var result0;result0=parse_handling_param();if(result0===null){result0=parse_generic_param()}return result0}function parse_handling_param(){var result0,result1,result2;var pos0;pos0=pos;if(input.substr(pos,8).toLowerCase()==="handling"){result0=input.substr(pos,8);pos+=8}else{result0=null;if(reportFailures===0){matchFailed('"handling"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){if(input.substr(pos,8).toLowerCase()==="optional"){result2=input.substr(pos,8);pos+=8}else{result2=null;if(reportFailures===0){matchFailed('"optional"')}}if(result2===null){if(input.substr(pos,8).toLowerCase()==="required"){result2=input.substr(pos,8);pos+=8}else{result2=null;if(reportFailures===0){matchFailed('"required"')}}if(result2===null){result2=parse_token()}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Content_Encoding(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_token();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Content_Length(){var result0,result1;var pos0;pos0=pos;result1=parse_DIGIT();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_DIGIT()}}else{result0=null}if(result0!==null){result0=function(offset,length){data=parseInt(length.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Content_Type(){var result0;var pos0;pos0=pos;result0=parse_media_type();if(result0!==null){result0=function(offset){data=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_media_type(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;result0=parse_m_type();if(result0!==null){result1=parse_SLASH();if(result1!==null){result2=parse_m_subtype();if(result2!==null){result3=[];pos1=pos;result4=parse_SEMI();if(result4!==null){result5=parse_m_parameter();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}while(result4!==null){result3.push(result4);pos1=pos;result4=parse_SEMI();if(result4!==null){result5=parse_m_parameter();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}}if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_m_type(){var result0;result0=parse_discrete_type();if(result0===null){result0=parse_composite_type()}return result0}function parse_discrete_type(){var result0;if(input.substr(pos,4).toLowerCase()==="text"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"text"')}}if(result0===null){if(input.substr(pos,5).toLowerCase()==="image"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"image"')}}if(result0===null){if(input.substr(pos,5).toLowerCase()==="audio"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"audio"')}}if(result0===null){if(input.substr(pos,5).toLowerCase()==="video"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"video"')}}if(result0===null){if(input.substr(pos,11).toLowerCase()==="application"){result0=input.substr(pos,11);pos+=11}else{result0=null;if(reportFailures===0){matchFailed('"application"')}}if(result0===null){result0=parse_extension_token()}}}}}return result0}function parse_composite_type(){var result0;if(input.substr(pos,7).toLowerCase()==="message"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"message"')}}if(result0===null){if(input.substr(pos,9).toLowerCase()==="multipart"){result0=input.substr(pos,9);pos+=9}else{result0=null;if(reportFailures===0){matchFailed('"multipart"')}}if(result0===null){result0=parse_extension_token()}}return result0}function parse_extension_token(){var result0;result0=parse_token();if(result0===null){result0=parse_x_token()}return result0}function parse_x_token(){var result0,result1;var pos0;pos0=pos;if(input.substr(pos,2).toLowerCase()==="x-"){result0=input.substr(pos,2);pos+=2}else{result0=null;if(reportFailures===0){matchFailed('"x-"')}}if(result0!==null){result1=parse_token();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_m_subtype(){var result0;result0=parse_extension_token();if(result0===null){result0=parse_token()}return result0}function parse_m_parameter(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_token();if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_m_value();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_m_value(){var result0;result0=parse_token();if(result0===null){result0=parse_quoted_string()}return result0}function parse_CSeq(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_CSeq_value();if(result0!==null){result1=parse_LWS();if(result1!==null){result2=parse_Method();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_CSeq_value(){var result0,result1;var pos0;pos0=pos;result1=parse_DIGIT();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_DIGIT()}}else{result0=null}if(result0!==null){result0=function(offset,cseq_value){data.value=parseInt(cseq_value.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Expires(){var result0;var pos0;pos0=pos;result0=parse_delta_seconds();if(result0!==null){result0=function(offset,expires){data=expires}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Event(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_event_type();if(result0!==null){result1=[];pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,event_type){data.event=event_type.join("").toLowerCase()}(pos0,result0[0])}if(result0===null){pos=pos0}return result0}function parse_event_type(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_token_nodot();if(result0!==null){result1=[];pos1=pos;if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}if(result2!==null){result3=parse_token_nodot();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;if(input.charCodeAt(pos)===46){result2=".";pos++}else{result2=null;if(reportFailures===0){matchFailed('"."')}}if(result2!==null){result3=parse_token_nodot();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_From(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_SIP_URI_noparams();if(result0===null){result0=parse_name_addr()}if(result0!==null){result1=[];pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_from_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_from_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var tag=data.tag;try{data=new NameAddrHeader(data.uri,data.display_name,data.params);if(tag){data.setParam("tag",tag)}}catch(e){data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_from_param(){var result0;result0=parse_tag_param();if(result0===null){result0=parse_generic_param()}return result0}function parse_tag_param(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,3).toLowerCase()==="tag"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"tag"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_token();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,tag){data.tag=tag}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_Max_Forwards(){var result0,result1;var pos0;pos0=pos;result1=parse_DIGIT();if(result1!==null){result0=[];while(result1!==null){result0.push(result1);result1=parse_DIGIT()}}else{result0=null}if(result0!==null){result0=function(offset,forwards){data=parseInt(forwards.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Min_Expires(){var result0;var pos0;pos0=pos;result0=parse_delta_seconds();if(result0!==null){result0=function(offset,min_expires){data=min_expires}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Name_Addr_Header(){var result0,result1,result2,result3,result4,result5,result6;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=[];result1=parse_display_name();while(result1!==null){result0.push(result1);result1=parse_display_name()}if(result0!==null){result1=parse_LAQUOT();if(result1!==null){result2=parse_SIP_URI();if(result2!==null){result3=parse_RAQUOT();if(result3!==null){result4=[];pos2=pos;result5=parse_SEMI();if(result5!==null){result6=parse_generic_param();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}while(result5!==null){result4.push(result5);pos2=pos;result5=parse_SEMI();if(result5!==null){result6=parse_generic_param();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}}if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){try{data=new NameAddrHeader(data.uri,data.display_name,data.params)}catch(e){data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_Proxy_Authenticate(){var result0;result0=parse_challenge();return result0}function parse_challenge(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;if(input.substr(pos,6).toLowerCase()==="digest"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"Digest"')}}if(result0!==null){result1=parse_LWS();if(result1!==null){result2=parse_digest_cln();if(result2!==null){result3=[];pos1=pos;result4=parse_COMMA();if(result4!==null){result5=parse_digest_cln();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}while(result4!==null){result3.push(result4);pos1=pos;result4=parse_COMMA();if(result4!==null){result5=parse_digest_cln();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}}if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}if(result0===null){result0=parse_other_challenge()}return result0}function parse_other_challenge(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;result0=parse_token();if(result0!==null){result1=parse_LWS();if(result1!==null){result2=parse_auth_param();if(result2!==null){result3=[];pos1=pos;result4=parse_COMMA();if(result4!==null){result5=parse_auth_param();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}while(result4!==null){result3.push(result4);pos1=pos;result4=parse_COMMA();if(result4!==null){result5=parse_auth_param();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}}if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_auth_param(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_token();if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_token();if(result2===null){result2=parse_quoted_string()}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_digest_cln(){var result0;result0=parse_realm();if(result0===null){result0=parse_domain();if(result0===null){result0=parse_nonce();if(result0===null){result0=parse_opaque();if(result0===null){result0=parse_stale();if(result0===null){result0=parse_algorithm();if(result0===null){result0=parse_qop_options();if(result0===null){result0=parse_auth_param()}}}}}}}return result0}function parse_realm(){var result0,result1,result2;var pos0;pos0=pos;if(input.substr(pos,5).toLowerCase()==="realm"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"realm"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_realm_value();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_realm_value(){var result0;var pos0;pos0=pos;result0=parse_quoted_string_clean();if(result0!==null){result0=function(offset,realm){data.realm=realm}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_domain(){var result0,result1,result2,result3,result4,result5,result6;var pos0,pos1;pos0=pos;if(input.substr(pos,6).toLowerCase()==="domain"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"domain"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_LDQUOT();if(result2!==null){result3=parse_URI();if(result3!==null){result4=[];pos1=pos;result6=parse_SP();if(result6!==null){result5=[];while(result6!==null){result5.push(result6);result6=parse_SP()}}else{result5=null}if(result5!==null){result6=parse_URI();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos1}}else{result5=null;pos=pos1}while(result5!==null){result4.push(result5);pos1=pos;result6=parse_SP();if(result6!==null){result5=[];while(result6!==null){result5.push(result6);result6=parse_SP()}}else{result5=null}if(result5!==null){result6=parse_URI();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos1}}else{result5=null;pos=pos1}}if(result4!==null){result5=parse_RDQUOT();if(result5!==null){result0=[result0,result1,result2,result3,result4,result5]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_URI(){var result0;result0=parse_absoluteURI();if(result0===null){result0=parse_abs_path()}return result0}function parse_nonce(){var result0,result1,result2;var pos0;pos0=pos;if(input.substr(pos,5).toLowerCase()==="nonce"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"nonce"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_nonce_value();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_nonce_value(){var result0;var pos0;pos0=pos;result0=parse_quoted_string_clean();if(result0!==null){result0=function(offset,nonce){data.nonce=nonce}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_opaque(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,6).toLowerCase()==="opaque"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"opaque"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_quoted_string_clean();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,opaque){data.opaque=opaque}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_stale(){var result0,result1,result2;var pos0,pos1;pos0=pos;if(input.substr(pos,5).toLowerCase()==="stale"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"stale"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){pos1=pos;if(input.substr(pos,4).toLowerCase()==="true"){result2=input.substr(pos,4);pos+=4}else{result2=null;if(reportFailures===0){matchFailed('"true"')}}if(result2!==null){result2=function(offset){data.stale=true}(pos1)}if(result2===null){pos=pos1}if(result2===null){pos1=pos;if(input.substr(pos,5).toLowerCase()==="false"){result2=input.substr(pos,5);pos+=5}else{result2=null;if(reportFailures===0){matchFailed('"false"')}}if(result2!==null){result2=function(offset){data.stale=false}(pos1)}if(result2===null){pos=pos1}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_algorithm(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,9).toLowerCase()==="algorithm"){result0=input.substr(pos,9);pos+=9}else{result0=null;if(reportFailures===0){matchFailed('"algorithm"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){if(input.substr(pos,3).toLowerCase()==="md5"){result2=input.substr(pos,3);pos+=3}else{result2=null;if(reportFailures===0){matchFailed('"MD5"')}}if(result2===null){if(input.substr(pos,8).toLowerCase()==="md5-sess"){result2=input.substr(pos,8);pos+=8}else{result2=null;if(reportFailures===0){matchFailed('"MD5-sess"')}}if(result2===null){result2=parse_token()}}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,algorithm){data.algorithm=algorithm.toUpperCase()}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_qop_options(){var result0,result1,result2,result3,result4,result5,result6;var pos0,pos1,pos2;pos0=pos;if(input.substr(pos,3).toLowerCase()==="qop"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"qop"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_LDQUOT();if(result2!==null){pos1=pos;result3=parse_qop_value();if(result3!==null){result4=[];pos2=pos;if(input.charCodeAt(pos)===44){result5=",";pos++}else{result5=null;if(reportFailures===0){matchFailed('","')}}if(result5!==null){result6=parse_qop_value();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}while(result5!==null){result4.push(result5);pos2=pos;if(input.charCodeAt(pos)===44){result5=",";pos++}else{result5=null;if(reportFailures===0){matchFailed('","')}}if(result5!==null){result6=parse_qop_value();if(result6!==null){result5=[result5,result6]}else{result5=null;pos=pos2}}else{result5=null;pos=pos2}}if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos1}}else{result3=null;pos=pos1}if(result3!==null){result4=parse_RDQUOT();if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_qop_value(){var result0;var pos0;pos0=pos;if(input.substr(pos,8).toLowerCase()==="auth-int"){result0=input.substr(pos,8);pos+=8}else{result0=null;if(reportFailures===0){matchFailed('"auth-int"')}}if(result0===null){if(input.substr(pos,4).toLowerCase()==="auth"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"auth"')}}if(result0===null){result0=parse_token()}}if(result0!==null){result0=function(offset,qop_value){data.qop||(data.qop=[]);data.qop.push(qop_value.toLowerCase())}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_Proxy_Require(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_token();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Record_Route(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_rec_route();if(result0!==null){result1=[];pos2=pos;result2=parse_COMMA();if(result2!==null){result3=parse_rec_route();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_COMMA();if(result2!==null){result3=parse_rec_route();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var idx,length;length=data.multi_header.length;for(idx=0;idx<length;idx++){if(data.multi_header[idx].parsed===null){data=null;break}}if(data!==null){data=data.multi_header}else{data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_rec_route(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_name_addr();if(result0!==null){result1=[];pos2=pos;
result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var header;if(!data.multi_header)data.multi_header=[];try{header=new NameAddrHeader(data.uri,data.display_name,data.params);delete data.uri;delete data.display_name;delete data.params}catch(e){header=null}data.multi_header.push({possition:pos,offset:offset,parsed:header})}(pos0)}if(result0===null){pos=pos0}return result0}function parse_Require(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_token();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Route(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_route_param();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_route_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_route_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_route_param(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_name_addr();if(result0!==null){result1=[];pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_generic_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_Subscription_State(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_substate_value();if(result0!==null){result1=[];pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_subexp_params();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_SEMI();if(result2!==null){result3=parse_subexp_params();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_substate_value(){var result0;var pos0;pos0=pos;if(input.substr(pos,6).toLowerCase()==="active"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"active"')}}if(result0===null){if(input.substr(pos,7).toLowerCase()==="pending"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"pending"')}}if(result0===null){if(input.substr(pos,10).toLowerCase()==="terminated"){result0=input.substr(pos,10);pos+=10}else{result0=null;if(reportFailures===0){matchFailed('"terminated"')}}if(result0===null){result0=parse_token()}}}if(result0!==null){result0=function(offset){data.state=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_subexp_params(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,6).toLowerCase()==="reason"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"reason"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_event_reason_value();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,reason){if(typeof reason!=="undefined")data.reason=reason}(pos0,result0[2])}if(result0===null){pos=pos0}if(result0===null){pos0=pos;pos1=pos;if(input.substr(pos,7).toLowerCase()==="expires"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"expires"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_delta_seconds();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,expires){if(typeof expires!=="undefined")data.expires=expires}(pos0,result0[2])}if(result0===null){pos=pos0}if(result0===null){pos0=pos;pos1=pos;if(input.substr(pos,11).toLowerCase()==="retry_after"){result0=input.substr(pos,11);pos+=11}else{result0=null;if(reportFailures===0){matchFailed('"retry_after"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_delta_seconds();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,retry_after){if(typeof retry_after!=="undefined")data.retry_after=retry_after}(pos0,result0[2])}if(result0===null){pos=pos0}if(result0===null){result0=parse_generic_param()}}}return result0}function parse_event_reason_value(){var result0;if(input.substr(pos,11).toLowerCase()==="deactivated"){result0=input.substr(pos,11);pos+=11}else{result0=null;if(reportFailures===0){matchFailed('"deactivated"')}}if(result0===null){if(input.substr(pos,9).toLowerCase()==="probation"){result0=input.substr(pos,9);pos+=9}else{result0=null;if(reportFailures===0){matchFailed('"probation"')}}if(result0===null){if(input.substr(pos,8).toLowerCase()==="rejected"){result0=input.substr(pos,8);pos+=8}else{result0=null;if(reportFailures===0){matchFailed('"rejected"')}}if(result0===null){if(input.substr(pos,7).toLowerCase()==="timeout"){result0=input.substr(pos,7);pos+=7}else{result0=null;if(reportFailures===0){matchFailed('"timeout"')}}if(result0===null){if(input.substr(pos,6).toLowerCase()==="giveup"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"giveup"')}}if(result0===null){if(input.substr(pos,10).toLowerCase()==="noresource"){result0=input.substr(pos,10);pos+=10}else{result0=null;if(reportFailures===0){matchFailed('"noresource"')}}if(result0===null){if(input.substr(pos,9).toLowerCase()==="invariant"){result0=input.substr(pos,9);pos+=9}else{result0=null;if(reportFailures===0){matchFailed('"invariant"')}}if(result0===null){result0=parse_token()}}}}}}}return result0}function parse_Subject(){var result0;result0=parse_TEXT_UTF8_TRIM();result0=result0!==null?result0:"";return result0}function parse_Supported(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_token();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_token();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}result0=result0!==null?result0:"";return result0}function parse_To(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;result0=parse_SIP_URI_noparams();if(result0===null){result0=parse_name_addr()}if(result0!==null){result1=[];pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_to_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}while(result2!==null){result1.push(result2);pos2=pos;result2=parse_SEMI();if(result2!==null){result3=parse_to_param();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos2}}else{result2=null;pos=pos2}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){var tag=data.tag;try{data=new NameAddrHeader(data.uri,data.display_name,data.params);if(tag){data.setParam("tag",tag)}}catch(e){data=-1}}(pos0)}if(result0===null){pos=pos0}return result0}function parse_to_param(){var result0;result0=parse_tag_param();if(result0===null){result0=parse_generic_param()}return result0}function parse_Via(){var result0,result1,result2,result3;var pos0,pos1;pos0=pos;result0=parse_via_parm();if(result0!==null){result1=[];pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_via_parm();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}while(result2!==null){result1.push(result2);pos1=pos;result2=parse_COMMA();if(result2!==null){result3=parse_via_parm();if(result3!==null){result2=[result2,result3]}else{result2=null;pos=pos1}}else{result2=null;pos=pos1}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_via_parm(){var result0,result1,result2,result3,result4,result5;var pos0,pos1;pos0=pos;result0=parse_sent_protocol();if(result0!==null){result1=parse_LWS();if(result1!==null){result2=parse_sent_by();if(result2!==null){result3=[];pos1=pos;result4=parse_SEMI();if(result4!==null){result5=parse_via_params();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}while(result4!==null){result3.push(result4);pos1=pos;result4=parse_SEMI();if(result4!==null){result5=parse_via_params();if(result5!==null){result4=[result4,result5]}else{result4=null;pos=pos1}}else{result4=null;pos=pos1}}if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_via_params(){var result0;result0=parse_via_ttl();if(result0===null){result0=parse_via_maddr();if(result0===null){result0=parse_via_received();if(result0===null){result0=parse_via_branch();if(result0===null){result0=parse_response_port();if(result0===null){result0=parse_generic_param()}}}}}return result0}function parse_via_ttl(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,3).toLowerCase()==="ttl"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"ttl"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_ttl();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,via_ttl_value){data.ttl=via_ttl_value}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_via_maddr(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,5).toLowerCase()==="maddr"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"maddr"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_host();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,via_maddr){data.maddr=via_maddr}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_via_received(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,8).toLowerCase()==="received"){result0=input.substr(pos,8);pos+=8}else{result0=null;if(reportFailures===0){matchFailed('"received"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_IPv4address();if(result2===null){result2=parse_IPv6address()}if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,via_received){data.received=via_received}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_via_branch(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;if(input.substr(pos,6).toLowerCase()==="branch"){result0=input.substr(pos,6);pos+=6}else{result0=null;if(reportFailures===0){matchFailed('"branch"')}}if(result0!==null){result1=parse_EQUAL();if(result1!==null){result2=parse_token();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,via_branch){data.branch=via_branch}(pos0,result0[2])}if(result0===null){pos=pos0}return result0}function parse_response_port(){var result0,result1,result2,result3;var pos0,pos1,pos2;pos0=pos;pos1=pos;if(input.substr(pos,5).toLowerCase()==="rport"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"rport"')}}if(result0!==null){pos2=pos;result1=parse_EQUAL();if(result1!==null){result2=[];result3=parse_DIGIT();while(result3!==null){result2.push(result3);result3=parse_DIGIT()}if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos2}}else{result1=null;pos=pos2}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){if(typeof response_port!=="undefined")data.rport=response_port.join("")}(pos0)}if(result0===null){pos=pos0}return result0}function parse_sent_protocol(){var result0,result1,result2,result3,result4;var pos0;pos0=pos;result0=parse_protocol_name();if(result0!==null){result1=parse_SLASH();if(result1!==null){result2=parse_token();if(result2!==null){result3=parse_SLASH();if(result3!==null){result4=parse_transport();if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_protocol_name(){var result0;var pos0;pos0=pos;if(input.substr(pos,3).toLowerCase()==="sip"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"SIP"')}}if(result0===null){result0=parse_token()}if(result0!==null){result0=function(offset,via_protocol){data.protocol=via_protocol}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_transport(){var result0;var pos0;pos0=pos;if(input.substr(pos,3).toLowerCase()==="udp"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"UDP"')}}if(result0===null){if(input.substr(pos,3).toLowerCase()==="tcp"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"TCP"')}}if(result0===null){if(input.substr(pos,3).toLowerCase()==="tls"){result0=input.substr(pos,3);pos+=3}else{result0=null;if(reportFailures===0){matchFailed('"TLS"')}}if(result0===null){if(input.substr(pos,4).toLowerCase()==="sctp"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"SCTP"')}}if(result0===null){result0=parse_token()}}}}if(result0!==null){result0=function(offset,via_transport){data.transport=via_transport}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_sent_by(){var result0,result1,result2;var pos0,pos1;pos0=pos;result0=parse_via_host();if(result0!==null){pos1=pos;result1=parse_COLON();if(result1!==null){result2=parse_via_port();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos1}}else{result1=null;pos=pos1}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_via_host(){var result0;var pos0;pos0=pos;result0=parse_IPv4address();if(result0===null){result0=parse_IPv6reference();if(result0===null){result0=parse_hostname()}}if(result0!==null){result0=function(offset){data.host=input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_via_port(){var result0,result1,result2,result3,result4;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_DIGIT();result0=result0!==null?result0:"";if(result0!==null){result1=parse_DIGIT();result1=result1!==null?result1:"";if(result1!==null){result2=parse_DIGIT();result2=result2!==null?result2:"";if(result2!==null){result3=parse_DIGIT();result3=result3!==null?result3:"";if(result3!==null){result4=parse_DIGIT();result4=result4!==null?result4:"";if(result4!==null){result0=[result0,result1,result2,result3,result4]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,via_sent_by_port){data.port=parseInt(via_sent_by_port.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_ttl(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_DIGIT();if(result0!==null){result1=parse_DIGIT();result1=result1!==null?result1:"";if(result1!==null){result2=parse_DIGIT();result2=result2!==null?result2:"";if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,ttl){return parseInt(ttl.join(""))}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_WWW_Authenticate(){var result0;result0=parse_challenge();return result0}function parse_extension_header(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_token();if(result0!==null){result1=parse_HCOLON();if(result1!==null){result2=parse_header_value();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_header_value(){var result0,result1;result0=[];result1=parse_TEXT_UTF8char();if(result1===null){result1=parse_UTF8_CONT();if(result1===null){result1=parse_LWS()}}while(result1!==null){result0.push(result1);result1=parse_TEXT_UTF8char();if(result1===null){result1=parse_UTF8_CONT();if(result1===null){result1=parse_LWS()}}}return result0}function parse_message_body(){var result0,result1;result0=[];result1=parse_OCTET();while(result1!==null){result0.push(result1);result1=parse_OCTET()}return result0}function parse_stun_URI(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_stun_scheme();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_stun_host_port();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_stun_scheme(){var result0;var pos0;pos0=pos;if(input.substr(pos,5).toLowerCase()==="stuns"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"stuns"')}}if(result0===null){if(input.substr(pos,4).toLowerCase()==="stun"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"stun"')}}}if(result0!==null){result0=function(offset,scheme){data.scheme=scheme}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_stun_host_port(){var result0,result1,result2;var pos0,pos1;pos0=pos;result0=parse_stun_host();if(result0!==null){pos1=pos;if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_port();if(result2!==null){result1=[result1,result2]}else{result1=null;pos=pos1}}else{result1=null;pos=pos1}result1=result1!==null?result1:"";if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_stun_host(){var result0;var pos0;pos0=pos;result0=parse_IPv4address();if(result0===null){result0=parse_IPv6reference();if(result0===null){result0=parse_reg_name()}}if(result0!==null){result0=function(offset,host){data.host=host}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_reg_name(){var result0,result1;var pos0;pos0=pos;result0=[];result1=parse_stun_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_sub_delims()}}while(result1!==null){result0.push(result1);result1=parse_stun_unreserved();if(result1===null){result1=parse_escaped();if(result1===null){result1=parse_sub_delims()}}}if(result0!==null){result0=function(offset){return input.substring(pos,offset)}(pos0)}if(result0===null){pos=pos0}return result0}function parse_stun_unreserved(){var result0;result0=parse_ALPHA();if(result0===null){result0=parse_DIGIT();if(result0===null){if(input.charCodeAt(pos)===45){result0="-";pos++}else{result0=null;if(reportFailures===0){matchFailed('"-"')}}if(result0===null){if(input.charCodeAt(pos)===46){result0=".";pos++}else{result0=null;if(reportFailures===0){matchFailed('"."')}}if(result0===null){if(input.charCodeAt(pos)===95){result0="_";pos++}else{result0=null;if(reportFailures===0){matchFailed('"_"')}}if(result0===null){if(input.charCodeAt(pos)===126){result0="~";pos++}else{result0=null;if(reportFailures===0){matchFailed('"~"')}}}}}}}return result0}function parse_sub_delims(){var result0;if(input.charCodeAt(pos)===33){result0="!";pos++}else{result0=null;if(reportFailures===0){matchFailed('"!"')}}if(result0===null){if(input.charCodeAt(pos)===36){result0="$";pos++}else{result0=null;if(reportFailures===0){matchFailed('"$"')}}if(result0===null){if(input.charCodeAt(pos)===38){result0="&";pos++}else{result0=null;if(reportFailures===0){matchFailed('"&"')}}if(result0===null){if(input.charCodeAt(pos)===39){result0="'";pos++}else{result0=null;if(reportFailures===0){matchFailed('"\'"')}}if(result0===null){if(input.charCodeAt(pos)===40){result0="(";pos++}else{result0=null;if(reportFailures===0){matchFailed('"("')}}if(result0===null){if(input.charCodeAt(pos)===41){result0=")";pos++}else{result0=null;if(reportFailures===0){matchFailed('")"')}}if(result0===null){if(input.charCodeAt(pos)===42){result0="*";pos++}else{result0=null;if(reportFailures===0){matchFailed('"*"')}}if(result0===null){if(input.charCodeAt(pos)===43){result0="+";pos++}else{result0=null;if(reportFailures===0){matchFailed('"+"')}}if(result0===null){if(input.charCodeAt(pos)===44){result0=",";pos++}else{result0=null;if(reportFailures===0){matchFailed('","')}}if(result0===null){if(input.charCodeAt(pos)===59){result0=";";pos++}else{result0=null;if(reportFailures===0){matchFailed('";"')}}if(result0===null){if(input.charCodeAt(pos)===61){result0="=";pos++}else{result0=null;if(reportFailures===0){matchFailed('"="')}}}}}}}}}}}}return result0}function parse_turn_URI(){var result0,result1,result2,result3,result4;var pos0,pos1;pos0=pos;result0=parse_turn_scheme();if(result0!==null){if(input.charCodeAt(pos)===58){result1=":";pos++}else{result1=null;if(reportFailures===0){matchFailed('":"')}}if(result1!==null){result2=parse_stun_host_port();if(result2!==null){pos1=pos;if(input.substr(pos,11)==="?transport="){result3="?transport=";pos+=11}else{result3=null;if(reportFailures===0){matchFailed('"?transport="')}}if(result3!==null){result4=parse_transport();if(result4!==null){result3=[result3,result4]}else{result3=null;pos=pos1}}else{result3=null;pos=pos1}result3=result3!==null?result3:"";if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_turn_scheme(){var result0;var pos0;pos0=pos;if(input.substr(pos,5).toLowerCase()==="turns"){result0=input.substr(pos,5);pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"turns"')}}if(result0===null){if(input.substr(pos,4).toLowerCase()==="turn"){result0=input.substr(pos,4);pos+=4}else{result0=null;if(reportFailures===0){matchFailed('"turn"')}}}if(result0!==null){result0=function(offset,scheme){data.scheme=scheme}(pos0,result0)}if(result0===null){pos=pos0}return result0}function parse_turn_transport(){var result0,result1,result2;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_transport();if(result0!==null){if(input.substr(pos,3).toLowerCase()==="udp"){result1=input.substr(pos,3);pos+=3}else{result1=null;if(reportFailures===0){matchFailed('"udp"')}}if(result1===null){if(input.substr(pos,3).toLowerCase()==="tcp"){result1=input.substr(pos,3);pos+=3}else{result1=null;if(reportFailures===0){matchFailed('"tcp"')}}if(result1===null){result1=[];result2=parse_unreserved();while(result2!==null){result1.push(result2);result2=parse_unreserved()}}}if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset){data.transport=transport}(pos0)}if(result0===null){pos=pos0}return result0}function parse_uuid_URI(){var result0,result1;var pos0;pos0=pos;if(input.substr(pos,5)==="uuid:"){result0="uuid:";pos+=5}else{result0=null;if(reportFailures===0){matchFailed('"uuid:"')}}if(result0!==null){result1=parse_uuid();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_uuid(){var result0,result1,result2,result3,result4,result5,result6,result7,result8;var pos0,pos1;pos0=pos;pos1=pos;result0=parse_hex8();if(result0!==null){if(input.charCodeAt(pos)===45){result1="-";pos++}else{result1=null;if(reportFailures===0){matchFailed('"-"')}}if(result1!==null){result2=parse_hex4();if(result2!==null){if(input.charCodeAt(pos)===45){result3="-";pos++}else{result3=null;if(reportFailures===0){matchFailed('"-"')}}if(result3!==null){result4=parse_hex4();if(result4!==null){if(input.charCodeAt(pos)===45){result5="-";pos++}else{result5=null;if(reportFailures===0){matchFailed('"-"')}}if(result5!==null){result6=parse_hex4();if(result6!==null){if(input.charCodeAt(pos)===45){result7="-";pos++}else{result7=null;if(reportFailures===0){matchFailed('"-"')}}if(result7!==null){result8=parse_hex12();if(result8!==null){result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8]}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}}else{result0=null;pos=pos1}if(result0!==null){result0=function(offset,uuid){data=input.substring(pos+5,offset)}(pos0,result0[0])}if(result0===null){pos=pos0}return result0}function parse_hex4(){var result0,result1,result2,result3;var pos0;pos0=pos;result0=parse_HEXDIG();if(result0!==null){result1=parse_HEXDIG();if(result1!==null){result2=parse_HEXDIG();if(result2!==null){result3=parse_HEXDIG();if(result3!==null){result0=[result0,result1,result2,result3]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_hex8(){var result0,result1;var pos0;pos0=pos;result0=parse_hex4();if(result0!==null){result1=parse_hex4();if(result1!==null){result0=[result0,result1]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function parse_hex12(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_hex4();if(result0!==null){result1=parse_hex4();if(result1!==null){result2=parse_hex4();if(result2!==null){result0=[result0,result1,result2]}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}}else{result0=null;pos=pos0}return result0}function cleanupExpected(expected){expected.sort();var lastExpected=null;var cleanExpected=[];for(var i=0;i<expected.length;i++){if(expected[i]!==lastExpected){cleanExpected.push(expected[i]);lastExpected=expected[i]}}return cleanExpected}function computeErrorPosition(){var line=1;var column=1;var seenCR=false;for(var i=0;i<Math.max(pos,rightmostFailuresPos);i++){var ch=input.charAt(i);if(ch==="\n"){if(!seenCR){line++}column=1;seenCR=false}else if(ch==="\r"||ch==="\u2028"||ch==="\u2029"){line++;column=1;seenCR=true}else{column++;seenCR=false}}return{line:line,column:column}}var URI=require("./URI");var NameAddrHeader=require("./NameAddrHeader");var data={};var result=parseFunctions[startRule]();if(result===null||pos!==input.length){var offset=Math.max(pos,rightmostFailuresPos);var found=offset<input.length?input.charAt(offset):null;var errorPosition=computeErrorPosition();new this.SyntaxError(cleanupExpected(rightmostFailuresExpected),found,offset,errorPosition.line,errorPosition.column);return-1}return data},toSource:function(){return this._source}};result.SyntaxError=function(expected,found,offset,line,column){function buildMessage(expected,found){var expectedHumanized,foundHumanized;switch(expected.length){case 0:expectedHumanized="end of input";break;case 1:expectedHumanized=expected[0];break;default:expectedHumanized=expected.slice(0,expected.length-1).join(", ")+" or "+expected[expected.length-1]}foundHumanized=found?quote(found):"end of input";return"Expected "+expectedHumanized+" but "+foundHumanized+" found."}this.name="SyntaxError";this.expected=expected;this.found=found;this.message=buildMessage(expected,found);this.offset=offset;this.line=line;this.column=column};result.SyntaxError.prototype=Error.prototype;return result}()},{"./NameAddrHeader":33,"./URI":46}],30:[function(require,module,exports){module.exports=Logger;function DateFmt(fstr){this.formatString=fstr;var mthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var zeroPad=function(number){return("0"+number).substr(-2,2)};var dateMarkers={d:["getDate",function(v){return zeroPad(v)}],m:["getMonth",function(v){return zeroPad(v+1)}],n:["getMonth",function(v){return mthNames[v]}],w:["getDay",function(v){return dayNames[v]}],y:["getFullYear"],H:["getHours",function(v){return zeroPad(v)}],M:["getMinutes",function(v){return zeroPad(v)}],S:["getSeconds",function(v){return zeroPad(v)}],i:["toISOString"]};this.format=function(date){var dateTxt=this.formatString.replace(/%(.)/g,function(m,p){var dateMarker=dateMarkers[p];var method=dateMarker[0];var rv=date[method]();if(dateMarker[1]!==null){rv=dateMarker[1](rv)}return rv});return dateTxt}}function Logger(logger,category,label){this.logger=logger;this.category=category;this.label=label;this.fmt=new DateFmt("%m%d/%H%M%S")}Logger.prototype.debug=function(content){this.logger.debug(this.category,this.label,content)};Logger.prototype.log=function(content){this.logger.log(this.category,this.label,content)};Logger.prototype.warn=function(content){this.logger.warn(this.category,this.label,content)};Logger.prototype.error=function(content){this.logger.error(this.category,this.label,content)};Logger.prototype.formatMsg=function(msg){return this.getTime()+" : "+msg};Logger.prototype.getTime=function(){return this.getTimeFor(new Date)};Logger.prototype.getTimeFor=function(date){return this.fmt.format(date)}},{}],31:[function(require,module,exports){module.exports=LoggerFactory;var Logger=require("./Logger");function LoggerFactory(){var logger,levels={error:0,warn:1,log:2,debug:3},level=1,builtinEnabled=true,connector=null;this.loggers={};logger=this.getLogger("ExSIP.loggerfactory");Object.defineProperties(this,{builtinEnabled:{get:function(){return builtinEnabled
},set:function(value){if(typeof value==="boolean"){builtinEnabled=value}else{logger.error('invalid "builtinEnabled" parameter value: '+JSON.stringify(value))}}},level:{get:function(){return level},set:function(value){if(value>=0&&value<=3){level=value}else if(value>3){level=3}else if(levels.hasOwnProperty(value)){level=levels[value]}else{logger.error('invalid "level" parameter value: '+JSON.stringify(value))}}},connector:{get:function(){return connector},set:function(value){if(value===null||value===""||value===undefined){connector=null}else if(typeof value==="function"){connector=value}else{logger.error('invalid "connector" parameter value: '+JSON.stringify(value))}}}})}LoggerFactory.prototype.print=function(target,category,label,content){var prefix=[];prefix.push(new Date);prefix.push(category);if(label){prefix.push(label)}prefix.push("");if(typeof content==="string"){target.call(console,prefix.join(" | ")+content)}else{target.call(console,content)}};LoggerFactory.prototype.debug=function(category,label,content){if(this.level===3){if(this.builtinEnabled){this.print(console.info,category,label,content)}if(this.connector){this.connector("debug",category,label,content)}}};LoggerFactory.prototype.log=function(category,label,content){if(this.level>=2){if(this.builtinEnabled){this.print(console.log,category,label,content)}if(this.connector){this.connector("log",category,label,content)}}};LoggerFactory.prototype.warn=function(category,label,content){if(this.level>=1){if(this.builtinEnabled){this.print(console.warn,category,label,content)}if(this.connector){this.connector("warn",category,label,content)}}};LoggerFactory.prototype.error=function(category,label,content){if(this.builtinEnabled){this.print(console.error,category,label,content)}if(this.connector){this.connector("error",category,label,content)}};LoggerFactory.prototype.getLogger=function(category,label){var logger;if(label&&this.level===1){return new Logger(this,category,label)}else if(this.loggers[category]){return this.loggers[category]}else{logger=new Logger(this,category);this.loggers[category]=logger;return logger}}},{"./Logger":30}],32:[function(require,module,exports){module.exports=Message;function Message(ua){this.ua=ua;this.logger=ua.getLogger("ExSIP.message");this.data={}}var ExSIP_C=require("./Constants");var EventEmitter=require("./EventEmitter");var SIPMessage=require("./SIPMessage");var Utils=require("./Utils");var RequestSender=require("./RequestSender");var Transactions=require("./Transactions");var Exceptions=require("./Exceptions");Message.prototype=new EventEmitter;Message.prototype.isDebug=function(){return this.ua.isDebug()};Message.prototype.send=function(target,body,options){var request_sender,event,contentType,eventHandlers,extraHeaders,events=["succeeded","failed"],originalTarget=target;if(target===undefined||body===undefined){throw new TypeError("Not enough arguments")}target=this.ua.normalizeTarget(target);if(!target){throw new TypeError("Invalid target: "+originalTarget)}this.initEvents(events);options=options||{};extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[];eventHandlers=options.eventHandlers||{};contentType=options.contentType||"text/plain";this.content_type=contentType;for(event in eventHandlers){this.on(event,eventHandlers[event])}this.closed=false;this.ua.applicants[this]=this;extraHeaders.push("Content-Type: "+contentType);this.request=new SIPMessage.OutgoingRequest(ExSIP_C.MESSAGE,target,this.ua,null,extraHeaders);if(body){this.request.body=body;this.content=body}else{this.content=null}request_sender=new RequestSender(this,this.ua);this.newMessage("local",this.request);request_sender.send()};Message.prototype.receiveResponse=function(response){var cause;if(this.closed){return}switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):delete this.ua.applicants[this];this.emit("succeeded",this,{originator:"remote",response:response});break;default:delete this.ua.applicants[this];cause=Utils.sipErrorCause(response.status_code);this.emit("failed",this,{originator:"remote",response:response,cause:cause});break}};Message.prototype.onRequestTimeout=function(){if(this.closed){return}this.emit("failed",this,{originator:"system",cause:ExSIP_C.causes.REQUEST_TIMEOUT})};Message.prototype.onTransportError=function(){if(this.closed){return}this.emit("failed",this,{originator:"system",cause:ExSIP_C.causes.CONNECTION_ERROR})};Message.prototype.close=function(){this.closed=true;delete this.ua.applicants[this]};Message.prototype.init_incoming=function(request){var transaction;this.request=request;this.content_type=request.getHeader("Content-Type");if(request.body){this.content=request.body}else{this.content=null}this.newMessage("remote",request);transaction=this.ua.transactions.nist[request.via_branch];if(transaction&&(transaction.state===Transactions.C.STATUS_TRYING||transaction.state===Transactions.C.STATUS_PROCEEDING)){request.reply(200)}};Message.prototype.accept=function(options){options=options||{};var extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],body=options.body;if(this.direction!=="incoming"){throw new Exceptions.NotSupportedError('"accept" not supported for outgoing Message')}this.request.reply(200,null,extraHeaders,body)};Message.prototype.reject=function(options){options=options||{};var status_code=options.status_code||480,reason_phrase=options.reason_phrase,extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],body=options.body;if(this.direction!=="incoming"){throw new Exceptions.NotSupportedError('"reject" not supported for outgoing Message')}if(status_code<300||status_code>=700){throw new TypeError("Invalid status_code: "+status_code)}this.request.reply(status_code,reason_phrase,extraHeaders,body)};Message.prototype.newMessage=function(originator,request){var message=this,event_name="newMessage";if(originator==="remote"){message.direction="incoming";message.local_identity=request.to;message.remote_identity=request.from}else if(originator==="local"){message.direction="outgoing";message.local_identity=request.from;message.remote_identity=request.to}message.ua.emit(event_name,message.ua,{originator:originator,message:message,request:request})}},{"./Constants":22,"./EventEmitter":26,"./Exceptions":28,"./RequestSender":40,"./SIPMessage":41,"./Transactions":43,"./Utils":47}],33:[function(require,module,exports){module.exports=NameAddrHeader;var URI=require("./URI");var Grammar=require("./Grammar");function NameAddrHeader(uri,display_name,parameters){var param;if(!uri||!(uri instanceof URI)){throw new TypeError('missing or invalid "uri" parameter')}this.uri=uri;this.parameters={};for(param in parameters){this.setParam(param,parameters[param])}Object.defineProperties(this,{display_name:{get:function(){return display_name},set:function(value){display_name=value===0?"0":value}}})}NameAddrHeader.prototype={setParam:function(key,value){if(key){this.parameters[key.toLowerCase()]=typeof value==="undefined"||value===null?null:value.toString()}},getParam:function(key){if(key){return this.parameters[key.toLowerCase()]}},hasParam:function(key){if(key){return this.parameters.hasOwnProperty(key.toLowerCase())&&true||false}},deleteParam:function(parameter){var value;parameter=parameter.toLowerCase();if(this.parameters.hasOwnProperty(parameter)){value=this.parameters[parameter];delete this.parameters[parameter];return value}},clearParams:function(){this.parameters={}},clone:function(){return new NameAddrHeader(this.uri.clone(),this.display_name,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var body,parameter;body=this.display_name||this.display_name===0?'"'+this.display_name+'" ':"";body+="<"+this.uri.toString()+">";for(parameter in this.parameters){body+=";"+parameter;if(this.parameters[parameter]!==null){body+="="+this.parameters[parameter]}}return body}};NameAddrHeader.parse=function(name_addr_header){name_addr_header=Grammar.parse(name_addr_header,"Name_Addr_Header");if(name_addr_header!==-1){return name_addr_header}else{return undefined}}},{"./Grammar":29,"./URI":46}],34:[function(require,module,exports){var Parser={};module.exports=Parser;var sdp_transform=require("sdp-transform");var Grammar=require("./Grammar");var SIPMessage=require("./SIPMessage");function getHeader(data,headerStart){var start=headerStart,end=0,partialEnd=0;if(data.substring(start,start+2).match(/(^\r\n)/)){return-2}while(end===0){partialEnd=data.indexOf("\r\n",start);if(partialEnd===-1){return partialEnd}if(!data.substring(partialEnd+2,partialEnd+4).match(/(^\r\n)/)&&data.charAt(partialEnd+2).match(/(^\s+)/)){start=partialEnd+2}else{end=partialEnd}}return end}function parseHeader(message,data,headerStart,headerEnd){var header,idx,length,parsed,hcolonIndex=data.indexOf(":",headerStart),headerName=data.substring(headerStart,hcolonIndex).trim(),headerValue=data.substring(hcolonIndex+1,headerEnd).trim();switch(headerName.toLowerCase()){case"via":case"v":message.addHeader("via",headerValue);if(message.getHeaders("via").length===1){parsed=message.parseHeader("Via");if(parsed){message.via=parsed;message.via_branch=parsed.branch}}else{parsed=0}break;case"from":case"f":message.setHeader("from",headerValue);parsed=message.parseHeader("from");if(parsed){message.from=parsed;message.from_tag=parsed.getParam("tag")}break;case"to":case"t":message.setHeader("to",headerValue);parsed=message.parseHeader("to");if(parsed){message.to=parsed;message.to_tag=parsed.getParam("tag")}break;case"record-route":parsed=Grammar.parse(headerValue,"Record_Route");if(parsed===-1){parsed=undefined}length=parsed.length;for(idx=0;idx<length;idx++){header=parsed[idx];message.addHeader("record-route",headerValue.substring(header.possition,header.offset));message.headers["Record-Route"][message.getHeaders("record-route").length-1].parsed=header.parsed}break;case"call-id":case"i":message.setHeader("call-id",headerValue);parsed=message.parseHeader("call-id");if(parsed){message.call_id=headerValue}break;case"contact":case"m":parsed=Grammar.parse(headerValue,"Contact");if(parsed===-1){parsed=undefined}length=parsed.length;for(idx=0;idx<length;idx++){header=parsed[idx];message.addHeader("contact",headerValue.substring(header.possition,header.offset));message.headers.Contact[message.getHeaders("contact").length-1].parsed=header.parsed}break;case"content-length":case"l":message.setHeader("content-length",headerValue);parsed=message.parseHeader("content-length");break;case"content-type":case"c":message.setHeader("content-type",headerValue);parsed=message.parseHeader("content-type");break;case"cseq":message.setHeader("cseq",headerValue);parsed=message.parseHeader("cseq");if(parsed){message.cseq=parsed.value}if(message instanceof SIPMessage.IncomingResponse){message.method=parsed.method}break;case"max-forwards":message.setHeader("max-forwards",headerValue);parsed=message.parseHeader("max-forwards");break;case"www-authenticate":message.setHeader("www-authenticate",headerValue);parsed=message.parseHeader("www-authenticate");break;case"proxy-authenticate":message.setHeader("proxy-authenticate",headerValue);parsed=message.parseHeader("proxy-authenticate");break;default:message.setHeader(headerName,headerValue);parsed=0}if(parsed===undefined){return{error:'error parsing header "'+headerName+'"'}}else{return true}}Parser.parseMessage=function(data,ua){var message,firstLine,contentLength,bodyStart,parsed,headerStart=0,headerEnd=data.indexOf("\r\n"),logger=ua.getLogger("ExSIP.parser");if(headerEnd===-1){logger.warn("no CRLF found, not a SIP message, discarded");return}firstLine=data.substring(0,headerEnd);parsed=Grammar.parse(firstLine,"Request_Response");if(parsed===-1){logger.warn('error parsing first line of SIP message: "'+firstLine+'"');return}else if(!parsed.status_code){message=new SIPMessage.IncomingRequest(ua);message.method=parsed.method;message.ruri=parsed.uri}else{message=new SIPMessage.IncomingResponse(ua);message.status_code=parsed.status_code;message.reason_phrase=parsed.reason_phrase}message.data=data;headerStart=headerEnd+2;while(true){headerEnd=getHeader(data,headerStart);if(headerEnd===-2){bodyStart=headerStart+2;break}else if(headerEnd===-1){parsed.error("malformed message");return}parsed=parseHeader(message,data,headerStart,headerEnd);if(parsed!==true){logger.error(parsed.error);return}headerStart=headerEnd+2}if(message.hasHeader("content-length")){contentLength=message.getHeader("content-length");message.body=data.substr(bodyStart,contentLength)}else{message.body=data.substring(bodyStart)}return message};Parser.parseSDP=sdp_transform.parse;Parser.writeSDP=sdp_transform.write;Parser.parseFmtpConfig=sdp_transform.parseFmtpConfig;Parser.parsePayloads=sdp_transform.parsePayloads;Parser.parseRemoteCandidates=sdp_transform.parseRemoteCandidates},{"./Grammar":29,"./SIPMessage":41,"sdp-transform":17}],35:[function(require,module,exports){module.exports=RTCSession;var C={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9,STATUS_REFER_SENT:10,STATUS_BYE_SENT:11};RTCSession.C=C;var ExSIP_C=require("./Constants");var EventEmitter=require("./EventEmitter");var Exceptions=require("./Exceptions");var Parser=require("./Parser");var Utils=require("./Utils");var Timers=require("./Timers");var UA=require("./UA");var WebRTC=require("./WebRTC");var SIPMessage=require("./SIPMessage");var Dialog=require("./Dialog");var RequestSender=require("./RequestSender");var RTCSession_RTCMediaHandler=require("./RTCSession/RTCMediaHandler");var RTCSession_DTMF=require("./RTCSession/DTMF");function RTCSession(ua){var events=["connecting","progress","failed","accepted","confirmed","ended","newDTMF","hold","held","resumed","unhold","muted","unmuted","started","onReInvite"];this.ua=ua;this.setStatus(C.STATUS_NULL);this.dialog=null;this.earlyDialogs={};this.rtcMediaHandler=null;this.receiveResponse=this.receiveInviteResponse;this.is_confirmed=false;this.late_sdp=false;this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null};this.data={};this.dtmf=new RTCSession_DTMF(this);this.isOnHold=false;this.audioMuted=false;this.videoMuted=false;this.local_hold=false;this.remote_hold=false;this.start_time=null;this.pending_actions={actions:[],length:function(){return this.actions.length},isPending:function(name){var idx=0,length=this.actions.length;for(idx;idx<length;idx++){if(this.actions[idx].name===name){return true}}return false},shift:function(){return this.actions.shift()},push:function(name){this.actions.push({name:name})},pop:function(name){var idx=0,length=this.actions.length;for(idx;idx<length;idx++){if(this.actions[idx].name===name){this.actions.splice(idx,1)}}}};this.data={};this.initEvents(events)}RTCSession.prototype=new EventEmitter;RTCSession.prototype.terminate=function(options){options=options||{};var cancel_reason,status_code=options.status_code,reason_phrase=options.reason_phrase,extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],body=options.body;if(this.status===C.STATUS_TERMINATED){throw new Exceptions.InvalidStateError(this.status)}this.logger.log("terminate with status : "+this.status);switch(this.status){case C.STATUS_NULL:case C.STATUS_INVITE_SENT:case C.STATUS_1XX_RECEIVED:this.logger.debug("canceling RTCSession");if(status_code&&(status_code<200||status_code>=700)){throw new TypeError("Invalid status_code: "+status_code)}else if(status_code){reason_phrase=reason_phrase||ExSIP_C.REASON_PHRASE[status_code]||"";cancel_reason="SIP ;cause="+status_code+' ;text="'+reason_phrase+'"'}if(this.status===C.STATUS_NULL){this.isCanceled=true;this.cancelReason=cancel_reason}else if(this.status===C.STATUS_INVITE_SENT){if(this.received_100){this.logger.debug("canceling after received 100 response");if(typeof this.request.cancel==="undefined"){this.sendBye(options);this.ended("local",null,ExSIP_C.causes.BYE)}else{this.isCanceled=true;this.logger.log("terminate on 100 - setting isCanceled = true",this.ua);this.request.cancel(cancel_reason)}}else{this.isCanceled=true;this.cancelReason=cancel_reason}}else if(this.status===C.STATUS_1XX_RECEIVED){this.isCanceled=true;this.logger.log("terminate on 1xx - setting isCanceled = true");this.request.cancel(cancel_reason)}this.setStatus(C.STATUS_CANCELED);this.failed("local",null,ExSIP_C.causes.CANCELED);break;case C.STATUS_WAITING_FOR_ANSWER:this.logger.log("rejecting RTCSession with 486 Busy Here",this.ua);this.request.reply(486);this.failed("local",null,ExSIP_C.causes.REJECTED);break;case C.STATUS_ANSWERED:this.logger.debug("rejecting RTCSession");status_code=status_code||480;if(status_code<300||status_code>=700){throw new TypeError("Invalid status_code: "+status_code)}this.request.reply(status_code,reason_phrase,extraHeaders,body);this.failed("local",null,ExSIP_C.causes.REJECTED);break;case C.STATUS_WAITING_FOR_ACK:case C.STATUS_REFER_SENT:case C.STATUS_CONFIRMED:this.logger.debug("terminating RTCSession");this.sendBye(options);return}this.close()};RTCSession.prototype.answer=function(options){options=options||{};var idx,length,sdp,remoteDescription,hasAudio=false,hasVideo=false,self=this,request=this.request,extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],mediaConstraints=options.mediaConstraints||{},mediaStream=options.mediaStream||null,sdpCreationSucceeded=function(body){var replySucceeded=function(){self.setStatus(C.STATUS_WAITING_FOR_ACK);self.setInvite2xxTimer(request,body);self.setACKTimer();self.accepted("local")},replyFailed=function(){self.failed("system",null,ExSIP_C.causes.CONNECTION_ERROR)};request.reply(200,null,extraHeaders,body,replySucceeded,replyFailed)},sdpCreationFailed=function(){if(self.status===C.STATUS_TERMINATED){return}self.failed("system",null,ExSIP_C.causes.WEBRTC_ERROR)};this.data=options.data||{};if(this.direction!=="incoming"){throw new Exceptions.NotSupportedError('"answer" not supported for outgoing RTCSession')}else if(this.status!==C.STATUS_WAITING_FOR_ANSWER){throw new Exceptions.InvalidStateError(this.status)}this.setStatus(C.STATUS_ANSWERED);if(!this.createDialog(request,"UAS")){request.reply(500,"Missing Contact header field");return}clearTimeout(this.timers.userNoAnswerTimer);extraHeaders.unshift("Contact: "+self.contact);remoteDescription=this.rtcMediaHandler.peerConnection.remoteDescription||{};sdp=Parser.parseSDP(remoteDescription.sdp||"");if(!(sdp.media instanceof Array)){sdp.media=[sdp.media||[]]}idx=sdp.media.length;while(idx--){if(sdp.media[idx].type==="audio"&&(sdp.media[idx].direction==="sendrecv"||sdp.media[idx].direction==="recvonly")){hasAudio=true}if(sdp.media[idx].type==="video"&&(sdp.media[idx].direction==="sendrecv"||sdp.media[idx].direction==="recvonly")){hasVideo=true}}if(mediaStream&&mediaConstraints.audio===false){length=mediaStream.getAudioTracks().length;for(idx=0;idx<length;idx++){mediaStream.removeTrack(mediaStream.getAudioTracks()[idx])}}if(mediaStream&&mediaConstraints.video===false){length=mediaStream.getVideoTracks().length;for(idx=0;idx<length;idx++){mediaStream.removeTrack(mediaStream.getVideoTracks()[idx])}}if(mediaConstraints.audio===undefined){mediaConstraints.audio=hasAudio}if(mediaConstraints.video===undefined){mediaConstraints.video=hasVideo}this.getUserMedia(mediaConstraints,sdpCreationSucceeded,sdpCreationFailed,{isAnswer:true,remoteSdp:request.body})};RTCSession.prototype.sendDTMF=function(tones,options){var duration,interToneGap;options=options||{};duration=options.duration||null;interToneGap=options.interToneGap||null;if(tones===undefined){throw new TypeError("Not enough arguments")}if(this.status!==C.STATUS_CONFIRMED&&this.status!==C.STATUS_WAITING_FOR_ACK){throw new Exceptions.InvalidStateError(this.status)}if(typeof tones==="number"){tones=tones.toString()}if(!tones||typeof tones!=="string"||!tones.match(/^[0-9A-D#*,]+$/i)){throw new TypeError("Invalid tones: "+tones)}if(duration&&!Utils.isDecimal(duration)){throw new TypeError("Invalid tone duration: "+duration)}else if(!duration){duration=RTCSession_DTMF.C.DEFAULT_DURATION}else if(duration<RTCSession_DTMF.C.MIN_DURATION){this.logger.warn('"duration" value is lower than the minimum allowed, setting it to '+RTCSession_DTMF.C.MIN_DURATION+" milliseconds");duration=RTCSession_DTMF.C.MIN_DURATION}else if(duration>RTCSession_DTMF.C.MAX_DURATION){this.logger.warn('"duration" value is greater than the maximum allowed, setting it to '+RTCSession_DTMF.C.MAX_DURATION+" milliseconds");duration=RTCSession_DTMF.C.MAX_DURATION}else{duration=Math.abs(duration)}options.duration=duration;if(interToneGap&&!Utils.isDecimal(interToneGap)){throw new TypeError("Invalid interToneGap: "+interToneGap)}else if(!interToneGap){interToneGap=RTCSession_DTMF.C.DEFAULT_INTER_TONE_GAP}else if(interToneGap<RTCSession_DTMF.C.MIN_INTER_TONE_GAP){this.logger.warn('"interToneGap" value is lower than the minimum allowed, setting it to '+RTCSession_DTMF.C.MIN_INTER_TONE_GAP+" milliseconds");interToneGap=RTCSession_DTMF.C.MIN_INTER_TONE_GAP}else{interToneGap=Math.abs(interToneGap)}this.dtmf.send(tones,options)};RTCSession.prototype.rejectReInvite=function(options){options=options||{};this.logger.log("rejecting re-INVITE");this.request.reply(488)};RTCSession.prototype.acceptReInvite=function(options){options=options||{};var self=this,extraHeaders=options.extraHeaders||[];this.logger.log("accepting re-INVITE");var replySucceeded=function(){var timeout=Timers.T1;self.setStatus(C.STATUS_WAITING_FOR_ACK);self.timers.invite2xxTimer=setTimeout(function invite2xxRetransmission(){if(self.status!==C.STATUS_WAITING_FOR_ACK){return}self.request.reply(200,null,extraHeaders,self.rtcMediaHandler.peerConnection.localDescription.sdp);if(timeout<Timers.T2){timeout=timeout*2;if(timeout>Timers.T2){timeout=Timers.T2}}self.timers.invite2xxTimer=setTimeout(invite2xxRetransmission,timeout)},timeout);self.timers.ackTimer=setTimeout(function(){if(self.status===C.STATUS_WAITING_FOR_ACK){self.logger.log("no ACK received")}},Timers.TIMER_H);self.started("local",undefined,true)};var replyFailed=function(){self.failed("system",null,ExSIP_C.causes.CONNECTION_ERROR)};var connectSuccess=function(){self.logger.debug("onMessage success");self.request.reply(200,null,extraHeaders,self.rtcMediaHandler.peerConnection.localDescription.getSdp({additionalSdp:self.rtcMediaHandler.peerConnection.remoteUnsupportedMedia}),replySucceeded,replyFailed)};var connectFailed=function(e){self.logger.warn("invalid SDP");self.logger.warn(e);self.request.reply(488)};this.initialRemoteSdp=this.initialRemoteSdp||self.rtcMediaHandler.peerConnection.remoteDescription.sdp;var sdp=this.request.body;if(sdp.length===0){this.logger.debug("empty sdp")}this.reconnectRtcMediaHandler(connectSuccess,connectFailed,{isAnswer:true,remoteSdp:sdp,isReconnect:true})};RTCSession.prototype.reconnectRtcMediaHandler=function(connectSuccess,connectFailed,options){var self=this;options=options||{};var localMedia=options.localMedia||this.rtcMediaHandler.localMedia;options.createOfferConstraints=options.createOfferConstraints||this.rtcMediaHandler.createOfferConstraints;this.rtcMediaHandler.close(!!options.localMedia);this.initRtcMediaHandler(options);this.rtcMediaHandler.localMedia=localMedia;this.rtcMediaHandler.createOfferConstraints=options.createOfferConstraints;this.connectRtcMediaHandler(localMedia,function(){self.started("local",undefined,true);connectSuccess()},connectFailed,options)};RTCSession.prototype.isReadyToReinvite=function(){if(!this.rtcMediaHandler.isReady()){return}if(this.dialog.uac_pending_reply===true||this.dialog.uas_pending_reply===true){return false}else{return true}};RTCSession.prototype.mute=function(options){options=options||{audio:true,video:false};var audioMuted=false,videoMuted=false;if(this.audioMuted===false&&options.audio){audioMuted=true;this.audioMuted=true;this.toogleMuteAudio(true)}if(this.videoMuted===false&&options.video){videoMuted=true;this.videoMuted=true;this.toogleMuteVideo(true)}if(audioMuted===true||videoMuted===true){this.onmute({audio:audioMuted,video:videoMuted})}};RTCSession.prototype.unmute=function(options){options=options||{audio:true,video:true};var audioUnMuted=false,videoUnMuted=false;if(this.audioMuted===true&&options.audio){audioUnMuted=true;this.audioMuted=false;if(this.local_hold===false){this.toogleMuteAudio(false)}}if(this.videoMuted===true&&options.video){videoUnMuted=true;this.videoMuted=false;if(this.local_hold===false){this.toogleMuteVideo(false)}}if(audioUnMuted===true||videoUnMuted===true){this.onunmute({audio:audioUnMuted,video:videoUnMuted})}};RTCSession.prototype.isMuted=function(){return{audio:this.audioMuted,video:this.videoMuted}};RTCSession.prototype.setInvite2xxTimer=function(request,body){var self=this,timeout=Timers.T1;this.timers.invite2xxTimer=setTimeout(function invite2xxRetransmission(){if(self.status!==C.STATUS_WAITING_FOR_ACK){return}request.reply(200,null,["Contact: "+self.contact],body);if(timeout<Timers.T2){timeout=timeout*2;if(timeout>Timers.T2){timeout=Timers.T2}}self.timers.invite2xxTimer=setTimeout(invite2xxRetransmission,timeout)},timeout)};RTCSession.prototype.setACKTimer=function(){var self=this;this.timers.ackTimer=setTimeout(function(){if(self.status===C.STATUS_WAITING_FOR_ACK){self.logger.debug("no ACK received, terminating the call");clearTimeout(self.timers.invite2xxTimer);self.sendBye();self.ended("remote",null,ExSIP_C.causes.NO_ACK)}},Timers.TIMER_H)};RTCSession.prototype.getLocalStreams=function(){try{if(this.rtcMediaHandler.peerConnection.localStreams){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.localStreams||[]}else{return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getLocalStreams()||[]}}catch(ex){return[]}};RTCSession.prototype.getRemoteStreams=function(){try{if(this.rtcMediaHandler.peerConnection.remoteStreams){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.remoteStreams||[]}else{return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getRemoteStreams()||[]}}catch(ex){return[]}};RTCSession.prototype.initRtcMediaHandler=function(options){options=options||{};var constraints=options.RTCConstraints||this.ua.rtcConstraints()||{optional:[{DtlsSrtpKeyAgreement:"true"}]};this.rtcMediaHandler=new RTCSession_RTCMediaHandler(this,{constraints:constraints,stun_servers:options.stun_servers,turn_servers:options.turn_servers})};RTCSession.prototype.init_incoming=function(request){var expires,self=this,contentType=request.getHeader("Content-Type"),waitForAnswer=function(){self.setStatus(C.STATUS_WAITING_FOR_ANSWER);self.timers.userNoAnswerTimer=setTimeout(function(){request.reply(408);self.failed("local",null,ExSIP_C.causes.NO_ANSWER)},self.ua.configuration.no_answer_timeout);if(expires){self.timers.expiresTimer=setTimeout(function(){if(self.status===C.STATUS_WAITING_FOR_ANSWER){request.reply(487);self.failed("system",null,ExSIP_C.causes.EXPIRES)}},expires)}self.newRTCSession("remote",request);request.reply(180,null,["Contact: "+self.contact]);self.progress("local",null)};if(request.body&&contentType!=="application/sdp"){request.reply(415);return}this.setStatus(C.STATUS_INVITE_RECEIVED);this.from_tag=request.from_tag;this.id=request.call_id+this.from_tag;this.request=request;this.contact=this.ua.contact.toString();this.logger=this.ua.getLogger("rtcsession",this.id);this.ua.sessions[this.id]=this;if(request.hasHeader("expires")){expires=request.getHeader("expires")*1e3}request.to_tag=Utils.newTag();if(!this.createDialog(request,"UAS",true)){request.reply(500,"Missing Contact header field");return}this.initRtcMediaHandler();if(request.body){this.rtcMediaHandler.onMessage("offer",request.body,waitForAnswer,function(e){self.logger.warn("invalid SDP");self.logger.warn(e);request.reply(488)})}else{this.late_sdp=true;waitForAnswer()}};RTCSession.prototype.connect=function(target,options){var self=this;options=options||{};this.data=options.data||{};this.initRtcMediaHandler(options);this.connectLocalMedia(target,options,function(){self.sendInviteRequest(target,options)},function(){})};RTCSession.prototype.close=function(){var idx;if(this.status===C.STATUS_TERMINATED){return}this.logger.debug("closing INVITE session "+this.id);if(this.rtcMediaHandler){this.rtcMediaHandler.close()}for(idx in this.timers){clearTimeout(this.timers[idx])}if(this.dialog){this.dialog.terminate();delete this.dialog}for(idx in this.earlyDialogs){this.earlyDialogs[idx].terminate();delete this.earlyDialogs[idx]}this.setStatus(C.STATUS_TERMINATED);delete this.ua.sessions[this.id]};RTCSession.prototype.createDialog=function(message,type,early){var dialog,early_dialog,local_tag=type==="UAS"?message.to_tag:message.from_tag,remote_tag=type==="UAS"?message.from_tag:message.to_tag,id=message.call_id+local_tag+remote_tag;early_dialog=this.earlyDialogs[id];if(early){if(early_dialog){return true}else{early_dialog=new Dialog(this,message,type,Dialog.C.STATUS_EARLY);if(early_dialog.id){this.earlyDialogs[id]=early_dialog;return true}else{this.failed("remote",message,ExSIP_C.causes.INTERNAL_ERROR);return false}}}else{if(early_dialog){early_dialog.update(message,type);this.dialog=early_dialog;delete this.earlyDialogs[id];return true}dialog=new Dialog(this,message,type);if(dialog.id){this.to_tag=message.to_tag;this.dialog=dialog;return true}else{this.failed("remote",message,ExSIP_C.causes.INTERNAL_ERROR);return false}}};RTCSession.prototype.connectRtcMediaHandler=function(stream,creationSucceeded,creationFailed,options){this.rtcMediaHandler.connect(stream,creationSucceeded,creationFailed,options);this.dtmf.enableDtmfSender(stream,this.rtcMediaHandler.peerConnection)};RTCSession.prototype.sendData=function(data){this.rtcMediaHandler.sendData(data)};RTCSession.prototype.getUserMedia=function(constraints,creationSucceeded,creationFailed,options){var self=this;var userMediaSucceeded=function(stream){self.ua.localMedia=stream;self.connectRtcMediaHandler(stream,creationSucceeded,creationFailed,options)};var userMediaFailed=function(){if(self.status===C.STATUS_TERMINATED){return}self.failed("local",null,ExSIP_C.causes.USER_DENIED_MEDIA_ACCESS)};if(this.ua.reuseLocalMedia()&&this.ua.localMedia){this.rtcMediaHandler.localMedia=this.ua.localMedia;userMediaSucceeded(this.ua.localMedia)}else{this.rtcMediaHandler.getUserMedia(userMediaSucceeded,userMediaFailed,constraints)}};RTCSession.prototype.sendInviteRequest=function(target,options,inviteSuccessCallback,inviteFailureCallback){options=options||{};options.status=C.STATUS_INVITE_SENT;options.sdp=this.rtcMediaHandler.peerConnection.localDescription.sdp;options.target=target;this.sendRequest(ExSIP_C.INVITE,options,{success:inviteSuccessCallback,failure:inviteFailureCallback})};RTCSession.prototype.createOutgoingRequestSender=function(target,method,options){options=options||{};var event,requestParams,iceServers,originalTarget=target,eventHandlers=options.eventHandlers||{},extraHeaders=options.extraHeaders&&options.extraHeaders.slice()||[],stun_servers=options.stun_servers||null,turn_servers=options.turn_servers||null;if(stun_servers){iceServers=UA.configuration_check.optional.stun_servers(stun_servers);if(!iceServers){throw new TypeError("Invalid stun_servers: "+stun_servers)}else{stun_servers=iceServers}}if(turn_servers){iceServers=UA.configuration_check.optional.turn_servers(turn_servers);if(!iceServers){throw new TypeError("Invalid turn_servers: "+turn_servers)}else{turn_servers=iceServers}}if(target===undefined){throw new TypeError("Not enough arguments")}if(!WebRTC.isSupported){throw new Exceptions.NotSupportedError("WebRTC not supported")}target=this.ua.normalizeTarget(target);if(!target){throw new TypeError("Invalid target: "+originalTarget)}if(this.status!==C.STATUS_NULL){throw new Exceptions.InvalidStateError(this.status)
}for(event in eventHandlers){this.on(event,eventHandlers[event])}this.from_tag=Utils.newTag();this.anonymous=options.anonymous||false;this.isCanceled=false;requestParams={from_tag:this.from_tag};this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:true});if(this.anonymous){requestParams.from_display_name="Anonymous";requestParams.from_uri="sip:anonymous@anonymous.invalid";extraHeaders.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString());extraHeaders.push("Privacy: id")}extraHeaders.push("Contact: "+this.contact);extraHeaders.push("Allow: "+Utils.getAllowedMethods(this.ua));this.request=new SIPMessage.OutgoingRequest(method,target,this.ua,requestParams,extraHeaders);this.id=this.request.call_id+this.from_tag;this.logger=this.ua.getLogger("rtcsession",this.id);this.ua.sessions[this.id]=this;this.newRTCSession("local",this.request);return new RequestSender(this,this.ua)};RTCSession.prototype.sendReferRequest=function(sessionToTransfer,options){this.sessionToTransfer=sessionToTransfer;options=options||{};options.status=C.STATUS_REFER_SENT;options.target=sessionToTransfer.dialog.remote_target;this.sendRequest(ExSIP_C.REFER,options)};RTCSession.prototype.sendNotifyRequest=function(options,successCallback,failureCallback){options=options||{};var extraHeaders=["Content-Type: message/sipfrag","Subscription-State: "+(options.subscriptionState||"active;expires=60"),"Event: refer"];options=Utils.merge_options({extraHeaders:extraHeaders},options);this.sendRequest(ExSIP_C.NOTIFY,options,{success:successCallback,failure:failureCallback})};RTCSession.prototype.isStarted=function(){return this.start_time!==null};RTCSession.prototype.isHeld=function(){return this.isOnHold};RTCSession.prototype.held=function(){this.isOnHold=true;this.emit("held",this)};RTCSession.prototype.resumed=function(){this.isOnHold=false;this.emit("resumed",this)};RTCSession.prototype.hold=function(inviteSuccessCallback,inviteFailureCallback){var self=this;this.changeSession({audioMode:ExSIP_C.INACTIVE,audioPort:"0",videoMode:ExSIP_C.INACTIVE,videoPort:"0"},function(){self.held();if(inviteSuccessCallback){inviteSuccessCallback()}},inviteFailureCallback)};RTCSession.prototype.unhold=function(inviteSuccessCallback,inviteFailureCallback){var self=this;this.changeSession({audioMode:ExSIP_C.SENDRECV,videoMode:ExSIP_C.SENDRECV},function(){self.resumed();if(inviteSuccessCallback){inviteSuccessCallback()}},inviteFailureCallback)};RTCSession.prototype.changeSession=function(sdpOptions,inviteSuccessCallback,inviteFailureCallback){var self=this;this.logger.debug("changeSession : "+JSON.stringify(sdpOptions));this.reconnectRtcMediaHandler(function(){self.logger.debug("changeSession : reconnectRtcMediaHandler : success");self.receiveResponse=self.receiveReinviteResponse;self.reinviteSucceeded=inviteSuccessCallback;self.reinviteFailed=inviteFailureCallback;self.sendInviteRequest(undefined,undefined)},function(){self.logger.error("Could not change local mode")},sdpOptions)};RTCSession.prototype.receiveInviteResponse=function(response){var cause,dialog,session=this;if(this.dialog&&(response.status_code>=200&&response.status_code<=299)){if(this.dialog.id.call_id===response.call_id&&this.dialog.id.local_tag===response.from_tag&&this.dialog.id.remote_tag===response.to_tag){this.sendRequest(ExSIP_C.ACK);return}else{dialog=new Dialog(this,response,"UAC");if(dialog.error!==undefined){this.logger.error(dialog.error);return}dialog.sendRequest({owner:{status:C.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},ExSIP_C.ACK);dialog.sendRequest({owner:{status:C.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},ExSIP_C.BYE);return}}if(this.isCanceled){this.isCanceled=false;if(response.status_code>=100&&response.status_code<200){this.request.cancel(this.cancelReason)}else if(response.status_code>=200&&response.status_code<299){this.acceptAndTerminate(response)}return}if(this.status!==C.STATUS_INVITE_SENT&&this.status!==C.STATUS_1XX_RECEIVED){return}switch(true){case/^100$/.test(response.status_code):this.received_100=true;break;case/^1[0-9]{2}$/.test(response.status_code):this.received_100=true;if(this.status!==C.STATUS_INVITE_SENT&&this.status!==C.STATUS_1XX_RECEIVED){break}if(!response.to_tag){this.logger.warn("1xx response received without to tag");break}if(response.hasHeader("contact")){if(!this.createDialog(response,"UAC",true)){break}}this.setStatus(C.STATUS_1XX_RECEIVED);this.progress("remote",response);if(!response.body){break}this.rtcMediaHandler.onMessage("pranswer",response.body,function(){},function(e){session.logger.warn(e);session.earlyDialogs[response.call_id+response.from_tag+response.to_tag].terminate()});break;case/^2[0-9]{2}$/.test(response.status_code):this.setStatus(C.STATUS_CONFIRMED);if(!response.body){this.acceptAndTerminate(response,400,ExSIP_C.causes.MISSING_SDP);this.failed("remote",response,ExSIP_C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(response,"UAC")){break}this.rtcMediaHandler.onMessage("answer",response.body,function(){session.accepted("remote",response);session.sendRequest(ExSIP_C.ACK);session.confirmed("local",null)},function(e){session.logger.warn(e);session.acceptAndTerminate(response,488,"Not Acceptable Here");session.failed("remote",response,ExSIP_C.causes.BAD_MEDIA_DESCRIPTION)});break;default:cause=Utils.sipErrorCause(response.status_code);this.failed("remote",response,cause)}};RTCSession.prototype.createDialog=function(message,type,early){var dialog,early_dialog,local_tag=type==="UAS"?message.to_tag:message.from_tag,remote_tag=type==="UAS"?message.from_tag:message.to_tag,id=message.call_id+local_tag+remote_tag;early_dialog=this.earlyDialogs[id];if(early){if(early_dialog){return true}else{early_dialog=new Dialog(this,message,type,Dialog.C.STATUS_EARLY);if(early_dialog.error){this.logger.error(dialog.error);this.failed("remote",message,ExSIP_C.causes.INTERNAL_ERROR);return false}else{this.earlyDialogs[id]=early_dialog;return true}}}else{if(early_dialog){early_dialog.update(message,type);this.dialog=early_dialog;delete this.earlyDialogs[id];return true}dialog=new Dialog(this,message,type);if(dialog.error){this.logger.error(dialog.error);this.failed("remote",message,ExSIP_C.causes.INTERNAL_ERROR);return false}else{this.to_tag=message.to_tag;this.dialog=dialog;return true}}};RTCSession.prototype.receiveReinvite=function(request){var sdp,idx,direction,self=this,contentType=request.getHeader("Content-Type"),hold=false,createSdp=function(onSuccess,onFailure){if(self.late_sdp){self.rtcMediaHandler.createOffer(onSuccess,onFailure)}else{self.rtcMediaHandler.createAnswer(onSuccess,onFailure)}},answer=function(){createSdp(function(body){request.reply(200,null,["Contact: "+self.contact],body,function(){self.setStatus(C.STATUS_WAITING_FOR_ACK);self.setInvite2xxTimer(request,body);self.setACKTimer();if(self.remote_hold===true&&hold===false){self.onunhold("remote")}else if(self.remote_hold===false&&hold===true){self.onhold("remote")}})},function(){request.reply(500)})};if(request.body){if(contentType!=="application/sdp"){this.logger.warn("invalid Content-Type");request.reply(415);return}sdp=Parser.parseSDP(request.body);for(idx=0;idx<sdp.media.length;idx++){direction=sdp.direction||sdp.media[idx].direction||"sendrecv";if(direction==="sendonly"||direction==="inactive"){hold=true}}this.rtcMediaHandler.onMessage("offer",request.body,answer,function(e){self.logger.error(e);request.reply(488)})}else{this.late_sdp=true;answer()}};RTCSession.prototype.receiveUpdate=function(request){var sdp,idx,direction,self=this,contentType=request.getHeader("Content-Type"),hold=true;if(!request.body){request.reply(200);return}if(contentType!=="application/sdp"){this.logger.warn("invalid Content-Type");request.reply(415);return}sdp=Parser.parseSDP(request.body);for(idx=0;idx<sdp.media.length;idx++){direction=sdp.direction||sdp.media[idx].direction||"sendrecv";if(direction!=="sendonly"&&direction!=="inactive"){hold=false}}this.rtcMediaHandler.onMessage("offer",request.body,function(){self.rtcMediaHandler.createAnswer(function(body){request.reply(200,null,["Contact: "+self.contact],body,function(){if(self.remote_hold===true&&hold===false){self.onunhold("remote")}else if(self.remote_hold===false&&hold===true){self.onhold("remote")}})},function(){request.reply(500)})},function(e){self.logger.error(e);request.reply(488)})};RTCSession.prototype.receiveRequest=function(request){var contentType,self=this;if(request.method===ExSIP_C.CANCEL){if(this.status===C.STATUS_WAITING_FOR_ANSWER||this.status===C.STATUS_ANSWERED){this.setStatus(C.STATUS_CANCELED);this.request.reply(487);this.failed("remote",request,ExSIP_C.causes.CANCELED)}}else{switch(request.method){case ExSIP_C.ACK:if(this.status===C.STATUS_WAITING_FOR_ACK){clearTimeout(this.timers.ackTimer);clearTimeout(this.timers.invite2xxTimer);this.setStatus(C.STATUS_CONFIRMED);if(request.body.length>0){this.logger.log("set remoteDescription for late offer ACK");this.rtcMediaHandler.onMessage(self.rtcMediaHandler.getSetRemoteLocationType(),request.body,function(){self.logger.log("late offer remoteDescription success");self.started("local",undefined,true)},function(){self.logger.log("late offer remoteDescription failure")})}}break;case ExSIP_C.BYE:if(this.status===C.STATUS_CONFIRMED){request.reply(200);this.ended("remote",request,ExSIP_C.causes.BYE)}else if(this.status===C.STATUS_INVITE_RECEIVED){request.reply(200);this.request.reply(487,"BYE Received");this.ended("remote",request,ExSIP_C.causes.BYE)}else{request.reply(403,"Wrong Status")}break;case ExSIP_C.INVITE:if(this.status===C.STATUS_CONFIRMED){this.logger.debug("re-INVITE received");this.request=request;if(!request.body||request.body.length===0){this.acceptReInvite();return}var description=new WebRTC.RTCSessionDescription({type:"offer",sdp:request.body});var oldDescription=this.rtcMediaHandler.peerConnection.remoteDescription;var audioAdd=description.hasActiveAudio()&&(!oldDescription||!oldDescription.hasActiveAudio());var videoAdd=description.hasActiveVideo()&&(!oldDescription||!oldDescription.hasActiveVideo());if(audioAdd||videoAdd){this.ua.emit("onReInvite",this.ua,{session:this,request:request,audioAdd:audioAdd,videoAdd:videoAdd})}else{this.acceptReInvite()}}else{request.reply(403,"Wrong Status")}break;case ExSIP_C.INFO:if(this.status===C.STATUS_CONFIRMED||this.status===C.STATUS_WAITING_FOR_ACK||this.status===C.STATUS_INVITE_RECEIVED||this.status===C.STATUS_ANSWERED){contentType=request.getHeader("content-type");if(contentType&&contentType.match(/^application\/dtmf-relay/i)){new RTCSession_DTMF(this).init_incoming(request)}else if(contentType&&contentType.match(/^application\/media_control\+xml/i)){request.reply(200);this.started("local",undefined,true)}else{request.reply(415)}}else{this.logger.debug("Wrong Status : "+this.status);request.reply(403,"Wrong Status")}break;case ExSIP_C.UPDATE:if(this.status===C.STATUS_CONFIRMED){this.logger.debug("UPDATE received");this.receiveUpdate(request)}else{request.reply(403,"Wrong Status")}break;case ExSIP_C.REFER:if(this.status===C.STATUS_CONFIRMED){this.ua.processRefer(this,request)}break;case ExSIP_C.NOTIFY:if(this.status===C.STATUS_REFER_SENT){request.reply(200);this.logger.log("received NOTIFY with body : "+request.body);var status=parseInt(request.body.match(/SIP\/2.0\s(.*)\s/)[1],10);this.logger.log("NOTIFY status : "+status);if(!this.sessionToTransfer){this.logger.warn("no transferred session for REFER session : "+this.id);return}if(status>=200&&status<=299){this.logger.log("terminate transferred session : "+this.sessionToTransfer.id);this.sessionToTransfer.terminate()}else if(status>=400&&status<=699){this.logger.warn("resuming session : "+this.sessionToTransfer.id);this.sessionToTransfer.unhold(function(){self.logger.log("resumed session : "+self.sessionToTransfer.id)})}}break;default:request.reply(501)}}};RTCSession.prototype.setStatus=function(status){if(this.logger){this.logger.debug("setStatus : "+Object.keys(C)[status])}else{console.log("setStatus : "+Object.keys(C)[status])}this.status=status};RTCSession.prototype.supports=function(name){var supported=this.request.getHeader("Supported");return supported!==undefined&&supported.indexOf(name)!==-1};RTCSession.prototype.sendACK=function(){this.sendRequest(ExSIP_C.ACK)};RTCSession.prototype.sendBye=function(options){var self=this;options=options||{};options.extraHeaders=options.extraHeaders||[];var reason,status_code=options.status_code,reason_phrase=options.reason_phrase||ExSIP_C.REASON_PHRASE[status_code]||"",body=options.body;if(status_code&&(status_code<200||status_code>=700)){throw new TypeError("Invalid status_code: "+status_code)}else if(status_code){reason="SIP ;cause="+status_code+'; text="'+reason_phrase+'"';options.extraHeaders.push("Reason: "+reason)}options.sdp=body;options.status=C.STATUS_BYE_SENT;var callbacks={success:function(){self.sendACK();self.ended("local",null,ExSIP_C.causes.BYE)}};this.logger.log("sendBye : "+callbacks);this.sendRequest(ExSIP_C.BYE,options,callbacks)};RTCSession.prototype.sendRequest=function(method,options,requestCallbacks){var request_sender;options=options||{};if(this.dialog){this.logger.debug("sendRequest : dialog : "+method);request_sender=this.dialog.createRequestSender(this,method,options)}else{this.logger.debug("sendRequest : createOutgoingRequestSender : "+method+", "+JSON.stringify(options));request_sender=this.createOutgoingRequestSender(options.target,method,options)}if(!request_sender){return}if(options.status){this.setStatus(options.status)}request_sender.request.body=options.sdp;var hasSdp=request_sender.request.body&&request_sender.request.body.length>0;if(!Utils.containsHeader(request_sender.request.extraHeaders,"Content-Type")&&hasSdp){request_sender.request.extraHeaders.push("Content-Type: application/sdp")}this.logger.debug("request_sender.request.extraHeaders : "+Utils.toString(request_sender.request.extraHeaders));request_sender.send(requestCallbacks)};RTCSession.prototype.onTransportError=function(){if(this.status!==C.STATUS_TERMINATED){if(this.status===C.STATUS_CONFIRMED){this.ended("system",null,ExSIP_C.causes.CONNECTION_ERROR)}else{this.failed("system",null,ExSIP_C.causes.CONNECTION_ERROR)}}};RTCSession.prototype.connectLocalMedia=function(target,options,success,failure){var self=this;this.receiveResponse=this.receiveInviteResponse;var mediaConstraints=options.mediaConstraints||{audio:true,video:true};this.getUserMedia(mediaConstraints,function(){self.logger.log("getUserMedia succeeded");success()},function(){self.logger.log("getUserMedia failed");self.failed("local",null,ExSIP_C.causes.WEBRTC_ERROR);failure()},options)};RTCSession.prototype.sendReinvite=function(options){options=options||{};var self=this,extraHeaders=options.extraHeaders||[],eventHandlers=options.eventHandlers||{},mangle=options.mangle||null;if(eventHandlers.succeeded){this.reinviteSucceeded=eventHandlers.succeeded}else{this.reinviteSucceeded=function(){}}if(eventHandlers.failed){this.reinviteFailed=eventHandlers.failed}else{this.reinviteFailed=function(){}}extraHeaders.push("Contact: "+this.contact);extraHeaders.push("Content-Type: application/sdp");this.receiveResponse=this.receiveReinviteResponse;this.rtcMediaHandler.createOffer(function(body){if(mangle){body=mangle(body)}self.dialog.sendRequest(self,ExSIP_C.INVITE,{extraHeaders:extraHeaders,body:body})},function(){if(self.isReadyToReinvite()){self.onReadyToReinvite()}self.reinviteFailed()})};RTCSession.prototype.receiveReinviteResponse=function(response){var self=this,contentType=response.getHeader("Content-Type");if(this.status===C.STATUS_TERMINATED){return}switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):this.setStatus(C.STATUS_CONFIRMED);this.sendRequest(ExSIP_C.ACK);if(!response.body){this.reinviteFailed();break}else if(contentType!=="application/sdp"){this.reinviteFailed();break}this.rtcMediaHandler.onMessage("answer",response.body,function(){if(self.reinviteSucceeded){self.reinviteSucceeded()}},function(){if(self.reinviteFailed){self.reinviteFailed()}});break;default:if(this.reinviteFailed){this.reinviteFailed()}}};RTCSession.prototype.acceptAndTerminate=function(response,status_code,reason_phrase){var extraHeaders=[];if(status_code){reason_phrase=reason_phrase||ExSIP_C.REASON_PHRASE[status_code]||"";extraHeaders.push("Reason: SIP ;cause="+status_code+'; text="'+reason_phrase+'"')}if(this.dialog||this.createDialog(response,"UAC")){this.sendRequest(ExSIP_C.ACK);this.sendBye()}this.setStatus(C.STATUS_TERMINATED)};RTCSession.prototype.toogleMuteAudio=function(mute){var streamIdx,trackIdx,tracks,localStreams=this.getLocalStreams();for(streamIdx in localStreams){tracks=localStreams[streamIdx].getAudioTracks();for(trackIdx in tracks){tracks[trackIdx].enabled=!mute}}};RTCSession.prototype.toogleMuteVideo=function(mute){var streamIdx,trackIdx,tracks,localStreams=this.getLocalStreams();for(streamIdx in localStreams){tracks=localStreams[streamIdx].getVideoTracks();for(trackIdx in tracks){tracks[trackIdx].enabled=!mute}}};RTCSession.prototype.onTransportError=function(){if(this.status!==C.STATUS_TERMINATED){if(this.status===C.STATUS_CONFIRMED){this.ended("system",null,ExSIP_C.causes.CONNECTION_ERROR)}else{this.failed("system",null,ExSIP_C.causes.CONNECTION_ERROR)}}};RTCSession.prototype.onRequestTimeout=function(){if(this.status!==C.STATUS_TERMINATED){if(this.status===C.STATUS_CONFIRMED){this.ended("system",null,ExSIP_C.causes.REQUEST_TIMEOUT)}else{this.ua.reconnect();this.failed("system",null,ExSIP_C.causes.CONNECTION_ERROR)}}};RTCSession.prototype.onDialogError=function(response){if(this.status!==C.STATUS_TERMINATED){if(this.status===C.STATUS_CONFIRMED){this.ended("remote",response,ExSIP_C.causes.DIALOG_ERROR)}else{this.failed("remote",response,ExSIP_C.causes.DIALOG_ERROR)}}};RTCSession.prototype.newRTCSession=function(originator,request){var session=this,event_name="newRTCSession";if(originator==="remote"){session.direction="incoming";session.local_identity=request.to;session.remote_identity=request.from}else if(originator==="local"){session.direction="outgoing";session.local_identity=request.from;session.remote_identity=request.to}session.ua.emit(event_name,session.ua,{originator:originator,session:session,request:request})};RTCSession.prototype.connecting=function(request){var session=this,event_name="connecting";session.emit(event_name,session,{request:request})};RTCSession.prototype.progress=function(originator,response){var session=this,event_name="progress";session.emit(event_name,session,{originator:originator,response:response||null})};RTCSession.prototype.accepted=function(originator,message){var session=this,event_name="accepted";session.start_time=new Date;session.emit(event_name,session,{originator:originator,response:message||null})};RTCSession.prototype.started=function(originator,message){var session=this,event_name="started";session.start_time=new Date;session.emit(event_name,session,{originator:originator,response:message||null})};RTCSession.prototype.confirmed=function(originator,ack){var session=this,event_name="confirmed";this.is_confirmed=true;session.emit(event_name,session,{originator:originator,ack:ack||null})};RTCSession.prototype.ended=function(originator,message,cause){var session=this,event_name="ended";session.end_time=new Date;session.close();session.emit(event_name,session,{originator:originator,message:message||null,cause:cause})};RTCSession.prototype.failed=function(originator,message,cause){var session=this,event_name="failed";session.close();session.emit(event_name,session,{originator:originator,message:message||null,cause:cause})};RTCSession.prototype.onhold=function(originator){if(originator==="local"){this.local_hold=true}else{this.remote_hold=true}this.emit("hold",this,{originator:originator})};RTCSession.prototype.onunhold=function(originator){if(originator==="local"){this.local_hold=false}else{this.remote_hold=false}this.emit("unhold",this,{originator:originator})};RTCSession.prototype.onmute=function(options){this.emit("muted",this,{audio:options.audio,video:options.video})};RTCSession.prototype.onunmute=function(options){this.emit("unmuted",this,{audio:options.audio,video:options.video})};RTCSession.prototype.onReadyToReinvite=function(){var action=this.pending_actions.length()>0?this.pending_actions.shift():null;if(!action){return}if(action.name==="hold"){this.hold()}else if(action.name==="unhold"){this.unhold()}}},{"./Constants":22,"./Dialog":23,"./EventEmitter":26,"./Exceptions":28,"./Parser":34,"./RTCSession/DTMF":36,"./RTCSession/RTCMediaHandler":38,"./RequestSender":40,"./SIPMessage":41,"./Timers":42,"./UA":45,"./Utils":47,"./WebRTC":48}],36:[function(require,module,exports){module.exports=DTMF;var C={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};DTMF.C=C;var EventEmitter=require("../EventEmitter");var Exceptions=require("../Exceptions");var RTCSession=require("../RTCSession");var Utils=require("../Utils");function DTMF(session){var events=["succeeded","failed"];this.sendTimeoutId=null;this.queuedDTMFs=[];this.session=session;this.direction=null;this.tone=null;this.duration=null;this.interToneGap=null;this.dtmfSender=null;this.logger=this.session.ua.getLogger("rtcsession.dtmf",session.id);this.initEvents(events)}DTMF.prototype=new EventEmitter;DTMF.prototype.send=function(tone,options){var event,eventHandlers,extraHeaders;if(tone===undefined){throw new TypeError("Not enough arguments")}this.direction="outgoing";if(this.session.status!==RTCSession.C.STATUS_CONFIRMED&&this.session.status!==RTCSession.C.STATUS_WAITING_FOR_ACK){throw new Exceptions.InvalidStateError(this.session.status)}options=options||{};extraHeaders=options.extraHeaders?options.extraHeaders.slice():[];eventHandlers=options.eventHandlers||{};if(typeof tone==="string"){tone=tone.toUpperCase()}else if(typeof tone==="number"){tone=tone.toString()}else{throw new TypeError("Invalid tone: "+tone)}if(!tone.match(/^[0-9A-D#*,]+$/i)){throw new TypeError("Invalid tone: "+tone)}else{this.tone=tone}for(event in eventHandlers){this.on(event,eventHandlers[event])}this.queueTone(this.tone,options.duration,options.interToneGap)};DTMF.prototype.processQueuedDTMFs=function(){var self=this;if(this.queuedDTMFs.length===0){return}if(!this.dtmfSender.canInsertDTMF){this.logger.log("DTMF Sender cannot insert DTMF - trying again after timeout",this.session.ua);this.sendTimeoutId=setTimeout(function(){self.processQueuedDTMFs()},1e3);return}var tones="";var durationSum=0;var interToneGapSum=0;for(var i=0;i<this.queuedDTMFs.length;i++){var dtmf=this.queuedDTMFs[i];tones+=dtmf.tone;durationSum+=dtmf.duration;interToneGapSum+=dtmf.interToneGap}var duration=durationSum/this.queuedDTMFs.length;var interToneGap=interToneGapSum/this.queuedDTMFs.length;this.logger.log("sending DTMF with tones "+tones+", duration "+duration+", gap "+interToneGap);this.dtmfSender.insertDTMF(tones,duration,interToneGap)};DTMF.prototype.queueTone=function(tone,duration,interToneGap){this.logger.log("Queue tone : "+tone);clearTimeout(this.sendTimeoutId);this.queuedDTMFs.push({tone:tone,duration:duration,interToneGap:interToneGap});var self=this;this.sendTimeoutId=setTimeout(function(){self.processQueuedDTMFs()},2*duration)};DTMF.prototype.onDTMFSent=function(tone){if(!tone){return}this.logger.log("Sent Dtmf tone: "+tone.tone);for(var i=0;i<this.queuedDTMFs.length;i++){var dtmf=this.queuedDTMFs[i];if(tone.tone===dtmf.tone){this.queuedDTMFs.splice(i,1);this.logger.log("removing from queued tones - remaining queue: 	"+Utils.toString(this.queuedDTMFs));break}else if(dtmf.tone.indexOf(tone.tone)!==-1){dtmf.tone=dtmf.tone.replace(tone.tone,"");this.queuedDTMFs[i]=dtmf;this.logger.log("removing from queued tones as contained - remaining queue: 	"+Utils.toString(this.queuedDTMFs));break}}this.session.emit("newDTMF",this.session,{originator:"local",dtmf:this,tone:tone.tone})};DTMF.prototype.enableDtmfSender=function(localstream,peerConnection){var self=this;this.logger.debug("enableDtmfSender : "+localstream);if(localstream!==null){var local_audio_track=localstream.getAudioTracks()[0];this.dtmfSender=peerConnection.createDTMFSender(local_audio_track);this.logger.log("Created DTMF Sender with canInsertDTMF : "+this.dtmfSender.canInsertDTMF);this.dtmfSender.ontonechange=function(tone){self.onDTMFSent(tone)};this.processQueuedDTMFs()}else{this.logger.error("No Local Stream to create DTMF Sender")}};DTMF.prototype.receiveResponse=function(response){var cause;switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):this.emit("succeeded",this,{originator:"remote",response:response});break;default:cause=Utils.sipErrorCause(response.status_code);this.emit("failed",this,{originator:"remote",response:response,cause:cause});break}};DTMF.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:C.causes.REQUEST_TIMEOUT})};DTMF.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:C.causes.CONNECTION_ERROR})};DTMF.prototype.init_incoming=function(request){var body,reg_tone=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,reg_duration=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming";this.request=request;request.reply(200);if(request.body){body=request.body.split("\r\n");if(body.length===2){if(reg_tone.test(body[0])){this.tone=body[0].replace(reg_tone,"$2")}if(reg_duration.test(body[1])){this.duration=parseInt(body[1].replace(reg_duration,"$2"),10)}}}if(!this.tone||!this.duration){this.logger.warn("invalid INFO DTMF received, discarded")}else{this.session.emit("newDTMF",this.session,{originator:"remote",dtmf:this,request:request})}}},{"../EventEmitter":26,"../Exceptions":28,"../RTCSession":35,"../Utils":47}],37:[function(require,module,exports){module.exports=DataChannel;var EventEmitter=require("../EventEmitter");function DataChannel(session,peerConnection){this.session=session;this.peerConnection=peerConnection;this.sendChannel=null;this.receiveChannel=null;this.chunkLength=6e4;this.dataReceived=[];this.logger=session.ua.getLogger("ExSIP.rtcsession.datachannel",session.id);this.initSendChannel()}DataChannel.prototype=new EventEmitter;DataChannel.prototype.isDebug=function(){return this.session.ua.isDebug()};DataChannel.prototype.close=function(){if(this.sendChannel){this.sendChannel.close()}if(this.receiveChannel){this.receiveChannel.close()}};DataChannel.prototype.send=function(data){this.sendInChunks(data);this.logger.log("Sent Data: "+data,this.session.ua);this.session.emit("dataSent",this,{data:data})};DataChannel.prototype.sendInChunks=function(data){var text=null,last=false,self=this;if(data.length>this.chunkLength){text=data.slice(0,this.chunkLength)}else{text=data;last=true}this.sendChannel.send(text+(last?"\n":""));if(!last){var remainingDataURL=data.slice(text.length);window.setTimeout(function(){self.sendInChunks(remainingDataURL)},50)}};DataChannel.prototype.initSendChannel=function(){var self=this;try{this.sendChannel=this.peerConnection.createDataChannel("sendDataChannel",null);this.logger.log("Created send data channel",this.session.ua);var onSendChannelStateChange=function(){var readyState=self.sendChannel.readyState;this.logger.log("Send channel state is: "+readyState,self.session.ua)};this.sendChannel.onopen=onSendChannelStateChange;this.sendChannel.onclose=onSendChannelStateChange;var receiveChannelCallback=function(event){this.logger.log("Receive Channel Callback",self.session.ua);self.receiveChannel=event.channel;var onReceiveChannelStateChange=function(){var readyState=self.receiveChannel.readyState;this.logger.log("Receive channel state is: "+readyState,self.session.ua)};var onReceiveMessageCallback=function(event){this.logger.log("Received Message : "+event.data,self.session.ua);if(event.data.indexOf("\n")!==-1){self.dataReceived.push(event.data.replace("\n",""));var data=self.dataReceived.join("");self.dataReceived=[];self.session.emit("dataReceived",self,{data:data})}else{self.dataReceived.push(event.data)}};self.receiveChannel.onmessage=onReceiveMessageCallback;self.receiveChannel.onopen=onReceiveChannelStateChange;self.receiveChannel.onclose=onReceiveChannelStateChange};this.peerConnection.ondatachannel=receiveChannelCallback}catch(e){this.emit("failed",this,{cause:"Failed to create data channel"});self.logger.error("Create Data channel failed with exception: "+e.message)}}},{"../EventEmitter":26}],38:[function(require,module,exports){module.exports=RTCMediaHandler;var ExSIP_C=require("../Constants");var WebRTC=require("../WebRTC");var Utils=require("../Utils");var DataChannel=require("./DataChannel");function RTCMediaHandler(session,constraints){constraints=constraints||{};this.logger=session.ua.getLogger("ExSIP.rtcsession.rtcmediahandler",session.id);this.logger.log("constraints : "+Utils.toString(constraints),session.ua);this.session=session;this.localMedia=null;this.peerConnection=null;this.createOfferConstraints=null;this.dataChannel=null;this.ready=true;this.init(constraints)}RTCMediaHandler.prototype={isReady:function(){return this.ready},copy:function(rtcMediaHandler){var self=this;var streamAdditionSucceeded=function(){};var streamAdditionFailed=function(){if(self.session.status===ExSIP_C.STATUS_TERMINATED){return}self.session.failed("local",null,ExSIP_C.causes.WEBRTC_ERROR)};var description=new WebRTC.RTCSessionDescription({type:this.getSetLocalDescriptionType(),sdp:rtcMediaHandler.peerConnection.localDescription.sdp});this.setLocalDescription(description);this.addStream(rtcMediaHandler.localMedia,streamAdditionSucceeded,streamAdditionFailed)},connect:function(stream,connectSucceeded,connectFailed,options){var self=this;options=options||{};this.logger.log("connect with isAnswer : "+options.isAnswer+" and remoteSdp : "+options.remoteSdp,self.session.ua);var setLocalDescription=function(callback){self.setLocalDescription(options.localDescription,callback||connectSucceeded,connectFailed)};var setRemoteDescription=function(successCallback){self.onMessage(self.getSetRemoteLocationType(),options.remoteSdp,successCallback||connectSucceeded,function(e){self.logger.error("setRemoteDescription failed");self.logger.error(Utils.toString(e));connectFailed()})};var createAnswer=function(){self.createAnswer(connectSucceeded,connectFailed,options.mediaConstraints)};var createOffer=function(){self.createOffer(function(sdp){if(options.remoteSdp&&options.remoteSdp!==""){setRemoteDescription(connectSucceeded)}else{connectSucceeded(sdp)}},connectFailed,options.createOfferConstraints,options)};var streamAdditionSucceeded=function(){var hasRemoteSdp=options.remoteSdp&&options.remoteSdp.length>0;var isRemote=options.isAnswer&&hasRemoteSdp;self.logger.log("isRemote : "+isRemote+", isAnswer : "+options.isAnswer+", hasRemoteSdp :"+hasRemoteSdp,self.session.ua);if(isRemote){if(options.localDescription){setRemoteDescription(setLocalDescription)}else{setRemoteDescription(createAnswer)}}else{if(options.remoteSdp){setLocalDescription(setRemoteDescription)}else{createOffer()}}};var streamAdditionFailed=function(){if(self.session.status===ExSIP_C.STATUS_TERMINATED){return}self.session.failed("local",null,ExSIP_C.causes.WEBRTC_ERROR);connectFailed()};this.addStream(stream,streamAdditionSucceeded,streamAdditionFailed)},createOffer:function(onSuccess,onFailure,constraints,options){var self=this;options=options||{};function onSetLocalDescriptionSuccess(){if(self.peerConnection.iceGatheringState==="complete"&&(self.peerConnection.iceConnectionState==="connected"||self.peerConnection.iceConnectionState==="completed")){self.ready=true;onSuccess(self.peerConnection.localDescription.sdp)}else{self.onIceCompleted=function(){self.onIceCompleted=undefined;self.ready=true;onSuccess(self.peerConnection.localDescription.sdp)
}}}this.ready=false;this.createOfferConstraints=constraints;this.logger.log("createOffer with createOfferConstraints : "+Utils.toString(this.createOfferConstraints),this.session.ua);this.peerConnection.createOffer(function(sessionDescription){if(options.videoMode){sessionDescription.setVideoMode(options.videoMode)}if(options.videoPort){sessionDescription.setVideoPort(options.videoPort)}if(options.audioMode){sessionDescription.setAudioMode(options.audioMode)}if(options.audioPort){sessionDescription.setAudioPort(options.audioPort)}self.setLocalDescription(sessionDescription,onSetLocalDescriptionSuccess,function(e){self.ready=true;onFailure(e)})},function(e){self.ready=true;self.logger.error("unable to create offer");self.logger.error(e);onFailure(e)},constraints)},getRemoteDescriptionSdp:function(){return this.peerConnection.remoteDescription?this.peerConnection.remoteDescription.sdp:undefined},createAnswer:function(onSuccess,onFailure,constraints){var self=this;function onSetLocalDescriptionSuccess(){if(self.peerConnection.iceGatheringState==="complete"&&(self.peerConnection.iceConnectionState==="connected"||self.peerConnection.iceConnectionState==="completed")){self.ready=true;onSuccess(self.peerConnection.localDescription.sdp)}else{self.onIceCompleted=function(){self.onIceCompleted=undefined;self.ready=true;onSuccess(self.peerConnection.localDescription.sdp)}}}this.ready=false;constraints=constraints||this.createOfferConstraints;this.logger.log("createAnswer with constraints : "+constraints,this.session.ua);this.peerConnection.createAnswer(function(sessionDescription){self.setLocalDescription(sessionDescription,onSetLocalDescriptionSuccess,function(e){self.ready=true;onFailure(e)})},function(e){self.ready=true;self.logger.error("unable to create answer");self.logger.error(e);onFailure(e)},constraints)},setLocalDescription:function(sessionDescription,onSuccess,onFailure){var self=this;this.peerConnection.setLocalDescription(sessionDescription,onSuccess,function(e){self.logger.error("unable to set local description");self.logger.error(e);onFailure(e)})},addStream:function(stream,onSuccess,onFailure,constraints){try{this.logger.log("add stream : "+Utils.toString(stream),this.session.ua);this.peerConnection.addStream(stream,constraints)}catch(e){this.logger.error("error adding stream");this.logger.error(e);onFailure();return}onSuccess()},clearStreams:function(){if(!this.localMedia){return}if(this.removeStream(this.localMedia)){this.localMedia=null}return},removeStream:function(stream){try{this.logger.log("remove stream : "+Utils.toString(stream),this.session.ua);this.peerConnection.removeStream(stream)}catch(e){this.logger.error("error removing stream");this.logger.error(e);return false}return true},getSetLocalDescriptionType:function(){var state=this.peerConnection.signalingState;if(state==="stable"||state==="have-local-offer"){return"offer"}else if(state==="have-remote-offer"||state==="have-local-pr-answer"){return"answer"}else{this.logger.error("state "+state+" not implemented - returning offer");return"offer"}},getSetRemoteLocationType:function(){var state=this.peerConnection.signalingState;if(state==="stable"||state==="have-remote-offer"){return"offer"}else if(state==="have-local-offer"||state==="have-remote-pr-answer"){return"answer"}else{this.logger.error("state "+state+" not implemented - returning offer");return"offer"}},sendData:function(data){if(this.dataChannel){this.dataChannel.send(data)}else{this.logger.error("datachannel is not enabled - see UA.configuration.enable_datachannel")}},init:function(options){options=options||{};var idx,length,server,self=this,servers=[],constraints=options.constraints||{},stun_servers=options.stun_servers||null,turn_servers=options.turn_servers||null,config=this.session.ua.configuration;if(!stun_servers){stun_servers=config.stun_servers}if(!turn_servers){turn_servers=config.turn_servers}if(stun_servers.length>0){servers.push({url:stun_servers})}length=turn_servers.length;for(idx=0;idx<length;idx++){server=turn_servers[idx];servers.push({url:server.urls,username:server.username,credential:server.credential})}this.peerConnection=new WebRTC.RTCPeerConnection({iceServers:servers},constraints);this.peerConnection.onaddstream=function(e){self.logger.debug("stream added: "+e.stream.id)};this.peerConnection.onremovestream=function(e){self.logger.debug("stream removed: "+e.stream.id)};this.peerConnection.onicecandidate=function(e){if(e.candidate&&self.session.ua.rtcMediaHandlerOptions.enableICE){self.logger.debug("ICE candidate received: "+e.candidate.candidate)}else if(self.onIceCompleted!==undefined){self.logger.log("onIceCompleted with ready : "+self.ready+" and candidate : "+Utils.toString(e.candidate),self.session.ua);if(!self.ready&&e.candidate){self.onIceCompleted()}}};this.peerConnection.oniceconnectionstatechange=function(){self.logger.debug('ICE connection state changed to "'+this.iceConnectionState+'"');if(this.iceConnectionState==="failed"){self.session.terminate({cause:ExSIP_C.causes.RTP_TIMEOUT,status_code:200,reason_phrase:ExSIP_C.causes.RTP_TIMEOUT})}};this.peerConnection.onstatechange=function(){self.logger.debug('PeerConnection state changed to "'+this.readyState+'"')};if(self.session.ua.configuration.enable_datachannel){this.dataChannel=new DataChannel(this.session,this.peerConnection)}},close:function(stopLocalMedia){this.logger.debug("closing PeerConnection");if(this.peerConnection){if(this.peerConnection.signalingState!=="closed"){this.logger.log("closing PeerConnection",this.session.ua);this.peerConnection.close()}if(stopLocalMedia){if(this.localMedia){this.logger.log("stopping local media "+Utils.toString(this.localMedia),this.session.ua);this.localMedia.stop()}}}},getUserMedia:function(onSuccess,onFailure,constraints){var self=this;this.logger.debug("requesting access to local media");WebRTC.getUserMedia(constraints,function(stream){self.logger.debug("got local media stream");self.localMedia=stream;onSuccess(stream)},function(e){self.logger.error("unable to get user media");self.logger.error(e);onFailure()})},onMessage:function(type,body,onSuccess,onFailure){var self=this;var description=new WebRTC.RTCSessionDescription({type:type,sdp:body});if(this.session.ua.rtcMediaHandlerOptions.videoBandwidth){description.setVideoBandwidth(this.session.ua.rtcMediaHandlerOptions.videoBandwidth);this.logger.log("Modifying SDP with videoBandwidth : "+this.session.ua.rtcMediaHandlerOptions.videoBandwidth)}if(this.peerConnection){if(!description.sdp){this.logger.log("empty sdp on setRemoteDescription - calling success");onSuccess();return}var unsupportedMedia=description.removeUnsupportedMedia();if(unsupportedMedia){this.logger.log("removed unsupported media : "+unsupportedMedia);this.peerConnection.remoteUnsupportedMedia=unsupportedMedia}this.logger.log("peerConnection.setRemoteDescription : description : "+Utils.toString(description));this.logger.log("peerConnection.setRemoteDescription for type "+description.type+" : "+description.sdp);this.peerConnection.setRemoteDescription(description,onSuccess,function(e){self.logger.log("----------setRemoteDescription with error : "+JSON.stringify(e));onFailure(e)})}}}},{"../Constants":22,"../Utils":47,"../WebRTC":48,"./DataChannel":37}],39:[function(require,module,exports){module.exports=Registrator;var Utils=require("./Utils");var ExSIP_C=require("./Constants");var SIPMessage=require("./SIPMessage");var RequestSender=require("./RequestSender");function Registrator(ua,transport){var reg_id=1;this.logger=ua.getLogger("ExSIP.registrator");this.ua=ua;this.transport=transport;this.registrar=ua.configuration.registrar_server;this.expires=ua.configuration.register_expires;this.call_id=Utils.createRandomToken(22);this.cseq=0;this.to_uri=ua.configuration.uri;this.registrationTimer=null;this.registered=false;this.contact=this.ua.contact.toString();this.contact+=";+sip.ice";this.extraHeaders=[];this.extraContactParams="";if(reg_id){this.contact+=";reg-id="+reg_id;this.contact+=';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"'}}Registrator.prototype={setExtraHeaders:function(extraHeaders){if(!extraHeaders instanceof Array){extraHeaders=[]}this.extraHeaders=extraHeaders.slice()},setExtraContactParams:function(extraContactParams){if(!extraContactParams instanceof Object){extraContactParams={}}this.extraContactParams="";for(var param_key in extraContactParams){var param_value=extraContactParams[param_key];this.extraContactParams+=";"+param_key;if(param_value){this.extraContactParams+="="+param_value}}},register:function(){var request_sender,cause,extraHeaders,self=this;extraHeaders=this.extraHeaders.slice();extraHeaders.push("Contact: "+this.contact+";expires="+this.expires+this.extraContactParams);extraHeaders.push("Expires: "+this.expires);this.request=new SIPMessage.OutgoingRequest(ExSIP_C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},extraHeaders);request_sender=new RequestSender(this,this.ua);this.receiveResponse=function(response){var contact,expires,contacts=response.getHeaders("contact").length;if(response.cseq!==this.cseq){return}if(this.registrationTimer!==null){clearTimeout(this.registrationTimer);this.registrationTimer=null}switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):if(response.hasHeader("expires")){expires=response.getHeader("expires")}if(!contacts){this.logger.warn("no Contact header in response to REGISTER, response ignored");break}while(contacts--){contact=response.parseHeader("contact",contacts);if(contact.uri.user===this.ua.contact.uri.user){expires=contact.getParam("expires");break}else{contact=null}}if(!contact){this.logger.warn("no Contact header pointing to us, response ignored");break}if(!expires){expires=this.expires}this.registrationTimer=setTimeout(function(){self.registrationTimer=null;self.register()},expires*1e3-3e3);if(contact.hasParam("temp-gruu")){this.ua.contact.temp_gruu=contact.getParam("temp-gruu").replace(/"/g,"")}if(contact.hasParam("pub-gruu")){this.ua.contact.pub_gruu=contact.getParam("pub-gruu").replace(/"/g,"")}if(!this.registered){this.registered=true;this.ua.emit("registered",this.ua,{response:response})}break;case/^423$/.test(response.status_code):if(response.hasHeader("min-expires")){this.expires=response.getHeader("min-expires");this.register()}else{this.logger.warn("423 response received for REGISTER without Min-Expires");this.registrationFailure(response,ExSIP_C.causes.SIP_FAILURE_CODE)}break;default:cause=Utils.sipErrorCause(response.status_code);this.registrationFailure(response,cause)}};this.onRequestTimeout=function(){this.registrationFailure(null,ExSIP_C.causes.REQUEST_TIMEOUT)};this.onTransportError=function(){this.registrationFailure(null,ExSIP_C.causes.CONNECTION_ERROR)};request_sender.send()},unregister:function(options){var extraHeaders;if(!this.registered){this.logger.debug("already unregistered");return}options=options||{};this.registered=false;if(this.registrationTimer!==null){clearTimeout(this.registrationTimer);this.registrationTimer=null}extraHeaders=this.extraHeaders.slice();if(options.all){extraHeaders.push("Contact: *"+this.extraContactParams);extraHeaders.push("Expires: 0");this.request=new SIPMessage.OutgoingRequest(ExSIP_C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},extraHeaders)}else{extraHeaders.push("Contact: "+this.contact+";expires=0"+this.extraContactParams);extraHeaders.push("Expires: 0");this.request=new SIPMessage.OutgoingRequest(ExSIP_C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},extraHeaders)}var request_sender=new RequestSender(this,this.ua);this.receiveResponse=function(response){var cause;switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):this.unregistered(response);break;default:cause=Utils.sipErrorCause(response.status_code);this.unregistered(response,cause)}};this.onRequestTimeout=function(){this.unregistered(null,ExSIP_C.causes.REQUEST_TIMEOUT)};this.onTransportError=function(){this.unregistered(null,ExSIP_C.causes.CONNECTION_ERROR)};request_sender.send()},registrationFailure:function(response,cause){this.ua.emit("registrationFailed",this.ua,{response:response||null,cause:cause});if(this.registered){this.registered=false;this.ua.emit("unregistered",this.ua,{response:response||null,cause:cause})}},unregistered:function(response,cause){this.registered=false;this.ua.emit("unregistered",this.ua,{response:response||null,cause:cause||null})},onTransportConnected:function(){this.register()},onTransportClosed:function(){if(this.registrationTimer!==null){clearTimeout(this.registrationTimer);this.registrationTimer=null}if(this.registered){this.registered=false;this.ua.emit("unregistered",this.ua)}},close:function(){if(this.registered){this.unregister()}}}},{"./Constants":22,"./RequestSender":40,"./SIPMessage":41,"./Utils":47}],40:[function(require,module,exports){module.exports=RequestSender;var ExSIP_C=require("./Constants");var UA=require("./UA");var DigestAuthentication=require("./DigestAuthentication");var Transactions=require("./Transactions");function RequestSender(applicant,ua){this.logger=ua.getLogger("ExSIP.requestsender");this.ua=ua;this.applicant=applicant;this.method=applicant.request.method;this.request=applicant.request;this.credentials=null;this.challenged=false;this.staled=false;if(ua.status===UA.C.STATUS_USER_CLOSED&&(this.method!==ExSIP_C.BYE||this.method!==ExSIP_C.ACK)){this.onTransportError()}}RequestSender.prototype={send:function(callbacks){this.callbacks=callbacks||{};this.logger.log("callbacks : "+this.callbacks);switch(this.method){case"INVITE":this.clientTransaction=new Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.logger.log("******************** onRequestTimeout : "+this.applicant);this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(response){var cseq,challenge,authorization_header_name,status_code=response.status_code;this.logger.log("receiveResponse: callbacks : "+this.callbacks);if(status_code===401||status_code===407){if(response.status_code===401){challenge=response.parseHeader("www-authenticate");authorization_header_name="authorization"}else{challenge=response.parseHeader("proxy-authenticate");authorization_header_name="proxy-authorization"}if(!challenge){this.logger.warn(response.status_code+" with wrong or missing challenge, cannot authenticate");this.applicant.receiveResponse(response);return}if(!this.challenged||!this.staled&&challenge.stale===true){if(!this.credentials){this.credentials=new DigestAuthentication(this.ua)}if(!this.credentials.authenticate(this.request,challenge)){this.applicant.receiveResponse(response);return}this.challenged=true;if(challenge.stale){this.staled=true}if(response.method===ExSIP_C.REGISTER){cseq=this.applicant.cseq+=1}else if(this.request.dialog){cseq=this.request.dialog.local_seqnum+=1}else{cseq=this.request.cseq+1;this.request.cseq=cseq}this.request.setHeader("cseq",cseq+" "+this.method);this.request.setHeader(authorization_header_name,this.credentials.toString());this.send()}else{this.applicant.receiveResponse(response)}}else{this.applicant.receiveResponse(response)}switch(true){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):if(this.callbacks.success){this.callbacks.success()}break;default:if(this.callbacks.failure){this.callbacks.failure(response)}break}}}},{"./Constants":22,"./DigestAuthentication":25,"./Transactions":43,"./UA":45}],41:[function(require,module,exports){module.exports={OutgoingRequest:OutgoingRequest,IncomingRequest:IncomingRequest,IncomingResponse:IncomingResponse};var ExSIP_C=require("./Constants");var Utils=require("./Utils");var NameAddrHeader=require("./NameAddrHeader");var Grammar=require("./Grammar");function OutgoingRequest(method,ruri,ua,params,extraHeaders,body){var to,from,call_id,cseq;params=params||{};this.logger=ua.getLogger("ExSIP.sipmessage");this.logger.debug("OutgoingRequest.extraHeaders : "+method+", "+ruri+", "+extraHeaders);if(!method||!ruri||!ua){return null}this.ua=ua;this.headers={};this.method=method;this.ruri=ruri;this.body=body;this.extraHeaders=extraHeaders&&extraHeaders.slice()||[];this.logger.debug("OutgoingRequest.extraHeaders 2 : "+this.extraHeaders);if(params.route_set){this.setHeader("route",params.route_set)}else if(ua.configuration.use_preloaded_route){this.setHeader("route",ua.transport.server.sip_uri)}this.setHeader("via","");this.setHeader("max-forwards",ExSIP_C.MAX_FORWARDS);to=params.to_display_name||params.to_display_name===0?'"'+params.to_display_name+'" ':"";var toUri=params.to_uri||ruri;to+="<"+(ua.configuration.enable_ims&&toUri.isPhoneNumber()&&toUri.toString().indexOf(";user=phone")===-1?toUri+";user=phone":toUri)+">";to+=params.to_tag?";tag="+params.to_tag:"";this.to=new NameAddrHeader.parse(to);this.setHeader("to",to);var fromName;if(params.from_display_name||params.from_display_name===0){fromName='"'+params.from_display_name+'" '}else if(ua.configuration.display_name){fromName='"'+ua.configuration.display_name+'" '}else{fromName=""}var fromUri=params.from_uri||ua.configuration.uri;fromName+="<"+(ua.configuration.enable_ims&&fromUri.isPhoneNumber()&&fromUri.toString().indexOf(";user=phone")===-1?fromUri+";user=phone":fromUri)+">";var fromTag=";tag="+(params.from_tag||Utils.newTag());from=fromName+fromTag;this.from=new NameAddrHeader.parse(from);this.setHeader("from",from);call_id=params.call_id||ua.configuration.exsip_id+Utils.createRandomToken(15);this.call_id=call_id;this.setHeader("call-id",call_id);cseq=params.cseq||Math.floor(Math.random()*1e4);this.cseq=cseq;this.setHeader("cseq",cseq+" "+method);if(ua.configuration.enable_ims){this.setHeader("P-Asserted-Identity",fromName)}else if(ua.configuration.p_asserted_identity){this.setHeader("P-Asserted-Identity",ua.configuration.p_asserted_identity)}}OutgoingRequest.prototype={setHeader:function(name,value){this.headers[Utils.headerize(name)]=value instanceof Array?value:[value]},getHeader:function(name){var regexp,idx,length=this.extraHeaders.length,header=this.headers[Utils.headerize(name)];if(header){if(header[0]){return header[0]}}else{regexp=new RegExp("^\\s*"+name+"\\s*:","i");for(idx=0;idx<length;idx++){header=this.extraHeaders[idx];if(regexp.test(header)){return header.substring(header.indexOf(":")+1).trim()}}}return},getHeaders:function(name){var idx,length,regexp,header=this.headers[Utils.headerize(name)],result=[];if(header){length=header.length;for(idx=0;idx<length;idx++){result.push(header[idx])}return result}else{length=this.extraHeaders.length;regexp=new RegExp("^\\s*"+name+"\\s*:","i");for(idx=0;idx<length;idx++){header=this.extraHeaders[idx];if(regexp.test(header)){result.push(header.substring(header.indexOf(":")+1).trim())}}return result}},hasHeader:function(name){var regexp,idx,length=this.extraHeaders.length;if(this.headers[Utils.headerize(name)]){return true}else{regexp=new RegExp("^\\s*"+name+"\\s*:","i");for(idx=0;idx<length;idx++){if(regexp.test(this.extraHeaders[idx])){return true}}}return false},toString:function(){var msg="",header,length,idx,supported=[];msg+=this.method+" "+(this.ua.configuration.enable_ims&&this.ruri.isPhoneNumber()?this.ruri+";user=phone":this.ruri)+" SIP/2.0\r\n";for(header in this.headers){length=this.headers[header].length;for(idx=0;idx<length;idx++){msg+=header+": "+this.headers[header][idx]+"\r\n"}}length=this.extraHeaders.length;for(idx=0;idx<length;idx++){msg+=this.extraHeaders[idx].trim()+"\r\n"}switch(this.method){case ExSIP_C.REGISTER:supported.push("path","gruu");break;case ExSIP_C.INVITE:if(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu){supported.push("gruu")}break}supported.push("outbound");if(!this.hasHeader("Allow")){msg+="Allow: "+ExSIP_C.ALLOWED_METHODS+"\r\n"}if(!this.hasHeader("Supported")){msg+="Supported: "+supported+"\r\n"}msg+="User-Agent: "+ExSIP_C.USER_AGENT+"\r\n";if(this.body){length=Utils.str_utf8_length(this.body);msg+="Content-Length: "+length+"\r\n\r\n";msg+=this.body}else{msg+="Content-Length: 0\r\n\r\n"}return msg}};function IncomingMessage(){this.data=null;this.headers=null;this.method=null;this.via=null;this.via_branch=null;this.call_id=null;this.cseq=null;this.from=null;this.from_tag=null;this.to=null;this.to_tag=null;this.body=null}IncomingMessage.prototype={addHeader:function(name,value){var header={raw:value};name=Utils.headerize(name);if(this.headers[name]){this.headers[name].push(header)}else{this.headers[name]=[header]}},getHeader:function(name){var header=this.headers[Utils.headerize(name)];if(header){if(header[0]){return header[0].raw}}else{return}},getHeaders:function(name){var idx,length,header=this.headers[Utils.headerize(name)],result=[];if(!header){return[]}length=header.length;for(idx=0;idx<length;idx++){result.push(header[idx].raw)}return result},hasHeader:function(name){return this.headers[Utils.headerize(name)]?true:false},parseHeader:function(name,idx){var header,value,parsed;name=Utils.headerize(name);idx=idx||0;if(!this.headers[name]){this.logger.log('header "'+name+'" not present');return}else if(idx>=this.headers[name].length){this.logger.log('not so many "'+name+'" headers present');return}header=this.headers[name][idx];value=header.raw;if(header.parsed){return header.parsed}parsed=Grammar.parse(value,name.replace(/-/g,"_"));if(parsed===-1){this.headers[name].splice(idx,1);this.logger.warn('error parsing "'+name+'" header field with value "'+value+'"');return}else{header.parsed=parsed;return parsed}},s:function(name,idx){return this.parseHeader(name,idx)},setHeader:function(name,value){var header={raw:value};this.headers[Utils.headerize(name)]=[header]}};function IncomingRequest(ua){this.logger=ua.getLogger("ExSIP.sipmessage");this.ua=ua;this.headers={};this.ruri=null;this.transport=null;this.server_transaction=null}IncomingRequest.prototype=new IncomingMessage;IncomingRequest.prototype.reply=function(code,reason,extraHeaders,body,onSuccess,onFailure){var rr,vias,length,idx,response,supported=[],to=this.getHeader("To"),r=0,v=0;code=code||null;reason=reason||null;if(!code||(code<100||code>699)){throw new TypeError("Invalid status_code: "+code)}else if(reason&&typeof reason!=="string"&&!(reason instanceof String)){throw new TypeError("Invalid reason_phrase: "+reason)}reason=reason||ExSIP_C.REASON_PHRASE[code]||"";extraHeaders=extraHeaders&&extraHeaders.slice()||[];response="SIP/2.0 "+code+" "+reason+"\r\n";if(this.method===ExSIP_C.INVITE&&code>100&&code<=200){rr=this.getHeaders("record-route");length=rr.length;for(r;r<length;r++){response+="Record-Route: "+rr[r]+"\r\n"}}vias=this.getHeaders("via");length=vias.length;for(v;v<length;v++){response+="Via: "+vias[v]+"\r\n"}if(!this.to_tag&&code>100){to+=";tag="+Utils.newTag()}else if(this.to_tag&&!this.s("to").hasParam("tag")){to+=";tag="+this.to_tag}response+="To: "+to+"\r\n";response+="From: "+this.getHeader("From")+"\r\n";response+="Call-ID: "+this.call_id+"\r\n";response+="CSeq: "+this.cseq+" "+this.method+"\r\n";length=extraHeaders.length;for(idx=0;idx<length;idx++){response+=extraHeaders[idx].trim()+"\r\n"}switch(this.method){case ExSIP_C.INVITE:if(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu){supported.push("gruu")}break}supported.push("outbound");if(this.method===ExSIP_C.OPTIONS){response+="Allow: "+ExSIP_C.ALLOWED_METHODS+"\r\n";response+="Accept: "+ExSIP_C.ACCEPTED_BODY_TYPES+"\r\n"}else if(code===405){response+="Allow: "+ExSIP_C.ALLOWED_METHODS+"\r\n"}else if(code===415){response+="Accept: "+ExSIP_C.ACCEPTED_BODY_TYPES+"\r\n"}response+="Supported: "+supported+"\r\n";if(body){length=Utils.str_utf8_length(body);if(!this.hasHeader("Content-Type")){response+="Content-Type: application/sdp\r\n"}response+="Content-Length: "+length+"\r\n\r\n";response+=body}else{response+="Content-Length: "+0+"\r\n\r\n"}this.server_transaction.receiveResponse(code,response,onSuccess,onFailure)};IncomingRequest.prototype.reply_sl=function(code,reason){var to,response,v=0,vias=this.getHeaders("via"),length=vias.length;code=code||null;reason=reason||null;if(!code||(code<100||code>699)){throw new TypeError("Invalid status_code: "+code)}else if(reason&&typeof reason!=="string"&&!(reason instanceof String)){throw new TypeError("Invalid reason_phrase: "+reason)}reason=reason||ExSIP_C.REASON_PHRASE[code]||"";response="SIP/2.0 "+code+" "+reason+"\r\n";for(v;v<length;v++){response+="Via: "+vias[v]+"\r\n"}to=this.getHeader("To");if(!this.to_tag&&code>100){to+=";tag="+Utils.newTag()}else if(this.to_tag&&!this.s("to").hasParam("tag")){to+=";tag="+this.to_tag}response+="To: "+to+"\r\n";response+="From: "+this.getHeader("From")+"\r\n";response+="Call-ID: "+this.call_id+"\r\n";response+="CSeq: "+this.cseq+" "+this.method+"\r\n";response+="Content-Length: "+0+"\r\n\r\n";this.transport.send(response)};function IncomingResponse(ua){this.logger=ua.getLogger("ExSIP.sipmessage");this.headers={};this.status_code=null;this.reason_phrase=null}IncomingResponse.prototype=new IncomingMessage},{"./Constants":22,"./Grammar":29,"./NameAddrHeader":33,"./Utils":47}],42:[function(require,module,exports){var T1=500,T2=4e3,T4=5e3;var Timers={T1:T1,T2:T2,T4:T4,TIMER_B:64*T1,TIMER_D:0*T1,TIMER_F:64*T1,TIMER_H:64*T1,TIMER_I:0*T1,TIMER_J:0*T1,TIMER_K:0*T4,TIMER_L:64*T1,TIMER_M:64*T1,PROVISIONAL_RESPONSE_INTERVAL:6e4};module.exports=Timers},{}],43:[function(require,module,exports){module.exports={C:null,NonInviteClientTransaction:NonInviteClientTransaction,InviteClientTransaction:InviteClientTransaction,AckClientTransaction:AckClientTransaction,NonInviteServerTransaction:NonInviteServerTransaction,InviteServerTransaction:InviteServerTransaction,checkTransaction:checkTransaction};var C={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};module.exports.C=C;var ExSIP_C=require("./Constants");var EventEmitter=require("./EventEmitter");var Timers=require("./Timers");function NonInviteClientTransaction(request_sender,request,transport){var via,via_transport,events=["stateChanged"];this.type=C.NON_INVITE_CLIENT;this.transport=transport;this.id="z9hG4bK"+Math.floor(Math.random()*1e7);this.request_sender=request_sender;this.request=request;this.logger=request_sender.ua.getLogger("ExSIP.transaction.nict",this.id);if(request_sender.ua.configuration.hack_via_tcp){via_transport="TCP"}else if(request_sender.ua.configuration.hack_via_ws){via_transport="WS"}else{via_transport=transport.server.scheme}via="SIP/2.0/"+via_transport;via+=" "+request_sender.ua.configuration.via_host+";branch="+this.id;this.request.setHeader("via",via);this.request_sender.ua.newTransaction(this);this.initEvents(events)}NonInviteClientTransaction.prototype=new EventEmitter;NonInviteClientTransaction.prototype.stateChanged=function(state){this.state=state;this.emit("stateChanged",this)};NonInviteClientTransaction.prototype.send=function(){var tr=this;this.stateChanged(C.STATUS_TRYING);this.F=setTimeout(function(){tr.timer_F()},Timers.TIMER_F);if(!this.transport.send(this.request)){this.onTransportError()}};NonInviteClientTransaction.prototype.onTransportError=function(){this.logger.debug("transport error occurred, deleting non-INVITE client transaction "+this.id);clearTimeout(this.F);clearTimeout(this.K);this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);this.request_sender.onTransportError()};NonInviteClientTransaction.prototype.timer_F=function(){this.logger.debug("Timer F expired for non-INVITE client transaction "+this.id);this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);this.request_sender.onRequestTimeout()};NonInviteClientTransaction.prototype.timer_K=function(){this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this)};NonInviteClientTransaction.prototype.receiveResponse=function(response){var tr=this,status_code=response.status_code;if(status_code<200){switch(this.state){case C.STATUS_TRYING:case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_PROCEEDING);this.request_sender.receiveResponse(response);break}}else{switch(this.state){case C.STATUS_TRYING:case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_COMPLETED);clearTimeout(this.F);if(status_code===408){this.request_sender.onRequestTimeout()}else{this.request_sender.receiveResponse(response)}this.K=setTimeout(function(){tr.timer_K()},Timers.TIMER_K);break;case C.STATUS_COMPLETED:break}}};function InviteClientTransaction(request_sender,request,transport){var via,tr=this,via_transport,events=["stateChanged"];this.type=C.INVITE_CLIENT;this.transport=transport;this.id="z9hG4bK"+Math.floor(Math.random()*1e7);this.request_sender=request_sender;this.request=request;this.logger=request_sender.ua.getLogger("ExSIP.transaction.ict",this.id);this.logger.log("******************** request_sender : "+request_sender);if(request_sender.ua.configuration.hack_via_tcp){via_transport="TCP"}else if(request_sender.ua.configuration.hack_via_ws){via_transport="WS"}else{via_transport=transport.server.scheme}via="SIP/2.0/"+via_transport;via+=" "+request_sender.ua.configuration.via_host+";branch="+this.id;this.request.setHeader("via",via);this.request_sender.ua.newTransaction(this);this.request.cancel=function(reason){tr.cancel_request(tr,reason)};this.initEvents(events)}InviteClientTransaction.prototype=new EventEmitter;InviteClientTransaction.prototype.stateChanged=function(state){this.state=state;this.emit("stateChanged",this)};InviteClientTransaction.prototype.send=function(){var tr=this;this.stateChanged(C.STATUS_CALLING);this.B=setTimeout(function(){tr.timer_B()},Timers.TIMER_B);if(!this.transport.send(this.request)){this.onTransportError()}};InviteClientTransaction.prototype.onTransportError=function(){this.logger.debug("transport error occurred, deleting INVITE client transaction "+this.id);clearTimeout(this.B);clearTimeout(this.D);clearTimeout(this.M);this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);if(this.state!==C.STATUS_ACCEPTED){this.request_sender.onTransportError()}};InviteClientTransaction.prototype.timer_M=function(){this.logger.debug("Timer M expired for INVITE client transaction "+this.id);if(this.state===C.STATUS_ACCEPTED){clearTimeout(this.B);this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this)}};InviteClientTransaction.prototype.timer_B=function(){this.logger.debug("Timer B expired for INVITE client transaction "+this.id);if(this.state===C.STATUS_CALLING){this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this);this.logger.debug("InviteClientTransaction.timer_B : "+this.request_sender);this.request_sender.onRequestTimeout()}};InviteClientTransaction.prototype.timer_D=function(){this.logger.debug("Timer D expired for INVITE client transaction "+this.id);clearTimeout(this.B);this.stateChanged(C.STATUS_TERMINATED);this.request_sender.ua.destroyTransaction(this)};InviteClientTransaction.prototype.sendACK=function(response){var tr=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n";this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n";if(this.request.headers.Route){this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"}this.ack+="To: "+response.getHeader("to")+"\r\n";this.ack+="From: "+this.request.headers.From.toString()+"\r\n";this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n";this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0];
this.ack+=" ACK\r\n";this.ack+="Content-Length: 0\r\n\r\n";this.D=setTimeout(function(){tr.timer_D()},Timers.TIMER_D);this.transport.send(this.ack)};InviteClientTransaction.prototype.cancel_request=function(tr,reason){var request=tr.request;this.cancel=ExSIP_C.CANCEL+" "+request.ruri+" SIP/2.0\r\n";this.cancel+="Via: "+request.headers.Via.toString()+"\r\n";if(this.request.headers.Route){this.cancel+="Route: "+request.headers.Route.toString()+"\r\n"}this.cancel+="To: "+request.headers.To.toString()+"\r\n";this.cancel+="From: "+request.headers.From.toString()+"\r\n";this.cancel+="Call-ID: "+request.headers["Call-ID"].toString()+"\r\n";this.cancel+="CSeq: "+request.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n";if(reason){this.cancel+="Reason: "+reason+"\r\n"}this.cancel+="Content-Length: 0\r\n\r\n";if(this.state===C.STATUS_PROCEEDING){this.transport.send(this.cancel)}};InviteClientTransaction.prototype.receiveResponse=function(response){var tr=this,status_code=response.status_code;if(status_code>=100&&status_code<=199){this.logger.debug("received 1xx : "+this.state);switch(this.state){case C.STATUS_CALLING:this.stateChanged(C.STATUS_PROCEEDING);this.request_sender.receiveResponse(response);break;case C.STATUS_PROCEEDING:this.request_sender.receiveResponse(response);break}}else if(status_code>=200&&status_code<=299){switch(this.state){case C.STATUS_CALLING:case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_ACCEPTED);this.M=setTimeout(function(){tr.timer_M()},Timers.TIMER_M);this.request_sender.receiveResponse(response);break;case C.STATUS_ACCEPTED:this.request_sender.receiveResponse(response);break}}else if(status_code>=300&&status_code<=699){switch(this.state){case C.STATUS_CALLING:case C.STATUS_PROCEEDING:this.state=C.STATUS_COMPLETED;this.sendACK(response);if(status_code===503){var options={code:503,reason:"Service Unavailable",retryCallback:function(transport){transport.ua.once("connected",function(e){if(transport===e.data.transport){tr.send()}})}};this.request_sender.ua.onTransportError(this.request_sender.ua.transport,options)}else{this.request_sender.receiveResponse(response)}break;case C.STATUS_COMPLETED:this.sendACK(response);break}}};function AckClientTransaction(request_sender,request,transport){var via,via_transport;this.transport=transport;this.id="z9hG4bK"+Math.floor(Math.random()*1e7);this.request_sender=request_sender;this.request=request;this.logger=request_sender.ua.getLogger("ExSIP.transaction.nict",this.id);if(request_sender.ua.configuration.hack_via_tcp){via_transport="TCP"}else if(request_sender.ua.configuration.hack_via_ws){via_transport="WS"}else{via_transport=transport.server.scheme}via="SIP/2.0/"+via_transport;via+=" "+request_sender.ua.configuration.via_host+";branch="+this.id;this.request.setHeader("via",via)}AckClientTransaction.prototype=new EventEmitter;AckClientTransaction.prototype.send=function(){if(!this.transport.send(this.request)){this.onTransportError()}};AckClientTransaction.prototype.onTransportError=function(){this.logger.debug("transport error occurred, for an ACK client transaction "+this.id);this.request_sender.onTransportError()};function NonInviteServerTransaction(request,ua){var events=["stateChanged"];this.type=C.NON_INVITE_SERVER;this.id=request.via_branch;this.request=request;this.transport=request.transport;this.ua=ua;this.last_response="";request.server_transaction=this;this.logger=ua.getLogger("ExSIP.transaction.nist",this.id);this.state=C.STATUS_TRYING;ua.newTransaction(this);this.initEvents(events)}NonInviteServerTransaction.prototype=new EventEmitter;NonInviteServerTransaction.prototype.stateChanged=function(state){this.state=state;this.emit("stateChanged",this)};NonInviteServerTransaction.prototype.timer_J=function(){this.logger.debug("Timer J expired for non-INVITE server transaction "+this.id);this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)};NonInviteServerTransaction.prototype.onTransportError=function(){if(!this.transportError){this.transportError=true;this.logger.debug("transport error occurred, deleting non-INVITE server transaction "+this.id);clearTimeout(this.J);this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)}};NonInviteServerTransaction.prototype.receiveResponse=function(status_code,response,onSuccess,onFailure){var tr=this;if(status_code===100){switch(this.state){case C.STATUS_TRYING:this.stateChanged(C.STATUS_PROCEEDING);if(!this.transport.send(response)){this.onTransportError()}break;case C.STATUS_PROCEEDING:this.last_response=response;if(!this.transport.send(response)){this.onTransportError();if(onFailure){onFailure()}}else if(onSuccess){onSuccess()}break}}else if(status_code>=200&&status_code<=699){switch(this.state){case C.STATUS_TRYING:case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_COMPLETED);this.last_response=response;if(Timers.TIMER_J===0){tr.timer_J()}else{this.J=setTimeout(function(){tr.timer_J()},Timers.TIMER_J)}if(!this.transport.send(response)){this.onTransportError();if(onFailure){onFailure()}}else if(onSuccess){onSuccess()}break;case C.STATUS_COMPLETED:break}}};function InviteServerTransaction(request,ua){var events=["stateChanged"];this.type=C.INVITE_SERVER;this.id=request.via_branch;this.request=request;this.transport=request.transport;this.ua=ua;this.last_response="";request.server_transaction=this;this.logger=ua.getLogger("ExSIP.transaction.ist",this.id);this.state=C.STATUS_PROCEEDING;ua.newTransaction(this);this.resendProvisionalTimer=null;request.reply(100);this.initEvents(events)}InviteServerTransaction.prototype=new EventEmitter;InviteServerTransaction.prototype.stateChanged=function(state){this.state=state;this.emit("stateChanged",this)};InviteServerTransaction.prototype.timer_H=function(){this.logger.debug("Timer H expired for INVITE server transaction "+this.id);if(this.state===C.STATUS_COMPLETED){this.logger.log("transactions","ACK for INVITE server transaction was never received, call will be terminated")}this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)};InviteServerTransaction.prototype.timer_I=function(){this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)};InviteServerTransaction.prototype.timer_L=function(){this.logger.debug("Timer L expired for INVITE server transaction "+this.id);if(this.state===C.STATUS_ACCEPTED){this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)}};InviteServerTransaction.prototype.onTransportError=function(){if(!this.transportError){this.transportError=true;this.logger.debug("transport error occurred, deleting INVITE server transaction "+this.id);if(this.resendProvisionalTimer!==null){clearInterval(this.resendProvisionalTimer);this.resendProvisionalTimer=null}clearTimeout(this.L);clearTimeout(this.H);clearTimeout(this.I);this.stateChanged(C.STATUS_TERMINATED);this.ua.destroyTransaction(this)}};InviteServerTransaction.prototype.resend_provisional=function(){if(!this.transport.send(this.last_response)){this.onTransportError()}};InviteServerTransaction.prototype.receiveResponse=function(status_code,response,onSuccess,onFailure){var tr=this;if(status_code>=100&&status_code<=199){switch(this.state){case C.STATUS_PROCEEDING:if(!this.transport.send(response)){this.onTransportError()}this.last_response=response;break}}if(status_code>100&&status_code<=199&&this.state===C.STATUS_PROCEEDING){if(this.resendProvisionalTimer===null){this.resendProvisionalTimer=setInterval(function(){tr.resend_provisional()},Timers.PROVISIONAL_RESPONSE_INTERVAL)}}else if(status_code>=200&&status_code<=299){switch(this.state){case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_ACCEPTED);this.last_response=response;this.L=setTimeout(function(){tr.timer_L()},Timers.TIMER_L);if(this.resendProvisionalTimer!==null){clearInterval(this.resendProvisionalTimer);this.resendProvisionalTimer=null}case C.STATUS_ACCEPTED:if(!this.transport.send(response)){this.onTransportError();if(onFailure){onFailure()}}else if(onSuccess){onSuccess()}break}}else if(status_code>=300&&status_code<=699){switch(this.state){case C.STATUS_PROCEEDING:if(this.resendProvisionalTimer!==null){clearInterval(this.resendProvisionalTimer);this.resendProvisionalTimer=null}if(!this.transport.send(response)){this.onTransportError();if(onFailure){onFailure()}}else{this.stateChanged(C.STATUS_COMPLETED);this.H=setTimeout(function(){tr.timer_H()},Timers.TIMER_H);if(onSuccess){onSuccess()}}break}}};function checkTransaction(ua,request){var tr;switch(request.method){case ExSIP_C.INVITE:tr=ua.transactions.ist[request.via_branch];if(tr){switch(tr.state){case C.STATUS_PROCEEDING:tr.transport.send(tr.last_response);break;case C.STATUS_ACCEPTED:break}console.log("checkTransaction failed for INVITE request and server transaction in state : "+tr.state);return true}break;case ExSIP_C.ACK:tr=ua.transactions.ist[request.via_branch];if(tr){if(tr.state===C.STATUS_ACCEPTED){return false}else if(tr.state===C.STATUS_COMPLETED){tr.state=C.STATUS_CONFIRMED;tr.I=setTimeout(function(){tr.timer_I()},Timers.TIMER_I);return true}}else{return false}break;case ExSIP_C.CANCEL:tr=ua.transactions.ist[request.via_branch];if(tr){request.reply_sl(200);if(tr.state===C.STATUS_PROCEEDING){return false}else{console.log("checkTransaction failed for CANCEL request and server transaction in state : "+tr.state);return true}}else{request.reply_sl(481);console.log("checkTransaction failed for CANCEL request and no server transaction");return true}break;default:console.log("***************** nist : ",Object.keys(ua.transactions.nist));tr=ua.transactions.nist[request.via_branch];if(tr){switch(tr.state){case C.STATUS_TRYING:break;case C.STATUS_PROCEEDING:case C.STATUS_COMPLETED:tr.transport.send(tr.last_response);break}console.log("checkTransaction failed for non invite server transaction in state : "+tr.state);return true}break}}},{"./Constants":22,"./EventEmitter":26,"./Timers":42}],44:[function(require,module,exports){(function(global){module.exports=Transport;var C={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};Transport.C=C;var ExSIP_C=require("./Constants");var Parser=require("./Parser");var UA=require("./UA");var SIPMessage=require("./SIPMessage");var sanityCheck=require("./sanityCheck");var WebSocket;var isNode=false;if(global.WebSocket){WebSocket=global.WebSocket}else{WebSocket=require("ws");isNode=true}function Transport(ua,server){this.logger=ua.getLogger("ExSIP.transport");this.ua=ua;this.ws=null;this.server=server;this.reconnection_attempts=0;this.closed=false;this.connected=false;this.reconnectTimer=null;this.lastTransportError={};if(isNode){this.ws_options=this.ua.configuration.node_ws_options;this.ws_options.protocol="sip";this.ws_options.headers={"User-Agent":ExSIP_C.USER_AGENT}}}Transport.prototype={send:function(msg){var message=msg.toString();if(this.ws&&this.readyState()===WebSocket.OPEN){if(this.ua.configuration.trace_sip===true){this.logger.debug("sending WebSocket message:\n\n"+message+"\n")}this.ws.send(message);return true}else{this.logger.warn("unable to send message, WebSocket is not open");return false}},readyState:function(){return this.ws.readyState},disconnect:function(){if(this.ws){clearTimeout(this.reconnectTimer);this.closed=true;this.logger.debug("closing WebSocket "+this.server.ws_uri);this.ws.close()}if(this.reconnectTimer!==null){clearTimeout(this.reconnectTimer);this.reconnectTimer=null;this.ua.emit("disconnected",this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason})}},connect:function(){var transport=this;if(this.ws&&(this.readyState()===WebSocket.OPEN||this.readyState()===WebSocket.CONNECTING)){this.logger.log("WebSocket "+this.server.ws_uri+" is already connected");return false}if(this.ws){this.ws.close()}this.logger.log("connecting to WebSocket "+this.server.ws_uri);this.ua.onTransportConnecting(this,this.reconnection_attempts===0?1:this.reconnection_attempts);try{if(!isNode){this.ws=new WebSocket(this.server.ws_uri,"sip");this.ws.binaryType="arraybuffer"}else{this.ws=new WebSocket(this.server.ws_uri,this.ws_options)}this.ua.usedServers.push(this.server);this.ws.onopen=function(){transport.onOpen()};this.ws.onclose=function(e){transport.onClose(e)};this.ws.onmessage=function(e){transport.onMessage(e)};this.ws.onerror=function(e){transport.onError(e)}}catch(e){this.logger.warn("error connecting to WebSocket "+this.server.ws_uri+": "+e);this.lastTransportError.code=null;this.lastTransportError.reason=e.message;this.ua.onTransportError(this)}},onOpen:function(){this.connected=true;this.logger.debug("WebSocket "+this.server.ws_uri+" connected");if(this.reconnectTimer!==null){clearTimeout(this.reconnectTimer);this.reconnectTimer=null}this.reconnection_attempts=0;this.closed=false;this.ua.onTransportConnected(this)},onClose:function(e){var connected_before=this.connected;this.connected=false;this.lastTransportError.code=e.code;this.lastTransportError.reason=e.reason;this.logger.debug("WebSocket disconnected (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")");if(e.wasClean===false){this.logger.warn("WebSocket abrupt disconnection")}if(connected_before===true){this.ua.onTransportClosed(this);if(!this.closed){this.reConnect()}else{this.ua.emit("disconnected",this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason})}}else{this.ua.onTransportError(this)}},onMessage:function(e){var message,transaction,data=e.data;if(data==="\r\n"){if(this.ua.configuration.trace_sip===true){this.logger.debug("received WebSocket message with CRLF Keep Alive response")}return}else if(typeof data!=="string"){try{data=String.fromCharCode.apply(null,new Uint8Array(data))}catch(evt){this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded");return}if(this.ua.configuration.trace_sip===true){this.logger.debug("received WebSocket binary message:\n\n"+data+"\n")}}else{this.logger.log("onMessage : "+this.ua.configuration.trace_sip);if(this.ua.configuration.trace_sip===true){this.logger.debug("received WebSocket text message:\n\n"+data+"\n")}}message=Parser.parseMessage(data,this.ua);if(!message){return}if(this.ua.status===UA.C.STATUS_USER_CLOSED&&message instanceof SIPMessage.IncomingRequest){return}if(!sanityCheck(message,this.ua,this)){return}if(message instanceof SIPMessage.IncomingRequest){message.transport=this;this.ua.receiveRequest(message)}else if(message instanceof SIPMessage.IncomingResponse){switch(message.method){case ExSIP_C.INVITE:transaction=this.ua.transactions.ict[message.via_branch];if(transaction){transaction.receiveResponse(message)}break;case ExSIP_C.ACK:break;default:transaction=this.ua.transactions.nict[message.via_branch];if(transaction){transaction.receiveResponse(message)}break}}},onError:function(e){this.logger.warn("WebSocket connection error: "+e)},reConnect:function(){var transport=this;this.reconnection_attempts+=1;if(this.reconnection_attempts>this.ua.configuration.ws_server_max_reconnection){this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.ws_uri);this.ua.onTransportError(this)}else{this.logger.log("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"+" (reconnection timeout "+this.ua.configuration.ws_server_reconnection_timeout+")");if(this.ua.configuration.ws_server_reconnection_timeout===0){transport.connect()}else{this.reconnectTimer=setTimeout(function(){transport.connect();transport.reconnectTimer=null},this.ua.configuration.ws_server_reconnection_timeout*1e3)}}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./Constants":22,"./Parser":34,"./SIPMessage":41,"./UA":45,"./sanityCheck":49,ws:20}],45:[function(require,module,exports){module.exports=UA;var C={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};UA.C=C;var ExSIP_C=require("./Constants");var LoggerFactory=require("./LoggerFactory");var EventEmitter=require("./EventEmitter");var Registrator=require("./Registrator");var RTCSession=require("./RTCSession");var Message=require("./Message");var Transport=require("./Transport");var Transactions=require("./Transactions");var Transactions=require("./Transactions");var Utils=require("./Utils");var WebRTC=require("./WebRTC");var Exceptions=require("./Exceptions");var URI=require("./URI");var Grammar=require("./Grammar");var Utils=require("./Utils");function UA(configuration){var events=["connecting","connected","disconnected","newTransaction","transactionDestroyed","registered","unregistered","registrationFailed","newRTCSession","newMessage","onReInvite"];this.log=new LoggerFactory;this.logger=this.getLogger("ua");this.usedServers=[];this.rtcMediaHandlerOptions={};this.cache={credentials:{}};this.configuration={};this.dynConfiguration={};this.dialogs={};this.applicants={};this.sessions={};this.transport=null;this.contact=null;this.status=C.STATUS_INIT;this.error=null;this.transactions={nist:{},nict:{},ist:{},ict:{}};this.data={};this.transportRecoverAttempts=0;this.transportRecoveryTimer=null;Object.defineProperties(this,{transactionsCount:{get:function(){var type,transactions=["nist","nict","ist","ict"],count=0;for(type in transactions){count+=Object.keys(this.transactions[transactions[type]]).length}return count}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}});if(configuration===undefined){throw new TypeError("Not enough arguments")}if(configuration.log){if(configuration.log.hasOwnProperty("builtinEnabled")){this.log.builtinEnabled=configuration.log.builtinEnabled}if(configuration.log.hasOwnProperty("level")){this.log.level=configuration.log.level}if(configuration.log.hasOwnProperty("connector")){this.log.connector=configuration.log.connector}}try{this.loadConfig(configuration);this.initEvents(events)}catch(e){this.status=C.STATUS_NOT_READY;this.error=C.CONFIGURATION_ERROR;throw e}this._registrator=new Registrator(this)}UA.prototype=new EventEmitter;UA.prototype.isDebug=function(){return this.configuration.trace_sip===true};UA.prototype.isRegistered=function(){if(this._registrator&&this._registrator.registered){return true}else{return false}};UA.prototype.isConnected=function(){if(this.transport){return this.transport.connected}else{return false}};UA.prototype.transfer=function(transferTarget,sessionToTransfer,options){var self=this;this.logger.log("transfer : "+transferTarget+" : options : "+Utils.toString(options));transferTarget=Utils.normalizeTarget(transferTarget,this.configuration.hostport_params);if(!transferTarget){sessionToTransfer.failed("local",null,ExSIP_C.causes.INVALID_TARGET);this.logger.warn("invalid transfer target");return}var holdFailed=function(){self.logger.log("transfer : hold failed")};var holdSuccess=function(){self.logger.log("transfer : hold success - sending refer to transferee");self.sendReferBasic(sessionToTransfer,transferTarget,options)};self.logger.log("transfer : holding session to transfer");sessionToTransfer.hold(holdSuccess,holdFailed)};UA.prototype.attendedTransfer=function(transferTarget,sessionToTransfer,options){var self=this;this.logger.log("attended transfer : "+transferTarget+" : options : "+Utils.toString(options));transferTarget=Utils.normalizeTarget(transferTarget,this.configuration.hostport_params);if(!transferTarget){this.logger.warn("invalid transfer target");sessionToTransfer.failed("local",null,ExSIP_C.causes.INVALID_TARGET);return}var targetSession=self.newSession(options);targetSession.rtcMediaHandler.copy(sessionToTransfer.rtcMediaHandler);var holdTargetSuccess=function(){self.logger.log("transfer : hold target success - sending attended refer");self.sendReferAttended(sessionToTransfer,targetSession,transferTarget,options)};var holdTargetFailed=function(){self.logger.log("transfer : hold target failed")};var sendTargetInviteSuccess=function(){self.logger.log("transfer : send invite to target success - putting target on hold");targetSession.hold(holdTargetSuccess,holdTargetFailed)};var sendTargetInviteFailed=function(response){self.logger.log("transfer : send invite to target failed - sending basic refer");if(response.status_code===420){self.sendReferBasic(sessionToTransfer,transferTarget,options)}};var holdFailed=function(){self.logger.log("transfer : hold failed")};var holdSuccess=function(){self.logger.log("transfer : hold success - sending invite to target");targetSession.sendInviteRequest(transferTarget,{extraHeaders:["Require: replaces"]},sendTargetInviteSuccess,sendTargetInviteFailed)};self.logger.log("transfer : holding session to transfer");sessionToTransfer.hold(holdSuccess,holdFailed)};UA.prototype.sendReferAttended=function(sessionToTransfer,targetSession,transferTarget,options){var referSession=this.getReferSession(sessionToTransfer,options);options=this.getReferOptions(sessionToTransfer,targetSession,options);var referTo="<"+transferTarget.toString()+"?Replaces="+targetSession.dialog.id.call_id+"%3Bto-tag%3D"+targetSession.dialog.id.remote_tag+"%3Bfrom-tag%3D"+targetSession.dialog.id.local_tag+">";options.extraHeaders.push("Refer-To: "+referTo);referSession.sendReferRequest(sessionToTransfer,options)};UA.prototype.processRefer=function(sessionToTransfer,referRequest){var self=this;referRequest.reply(202);var notifySuccess=function(){self.logger.log("Notify successful")};var notifyFailure=function(){self.logger.log("Notify failed")};sessionToTransfer.sendNotifyRequest({sdp:"SIP/2.0 100 Trying"},notifySuccess,notifyFailure)};UA.prototype.sendReferBasic=function(sessionToTransfer,transferTarget,options){var referSession=this.getReferSession(sessionToTransfer,options);options=this.getReferOptions(sessionToTransfer,sessionToTransfer,options);options.extraHeaders.push("Refer-To: <"+transferTarget+">");this.logger.debug("refer options : "+JSON.stringify(options));referSession.sendReferRequest(sessionToTransfer,options)};UA.prototype.getReferOptions=function(sessionToTransfer,targetDialogSession,options){options=options||{};options.extraHeaders=options.extraHeaders||[];if(sessionToTransfer.supports("tdialog")){options.extraHeaders.push("Require: tdialog");var localTag=targetDialogSession.dialog.isUAS()?targetDialogSession.dialog.id.remote_tag:targetDialogSession.dialog.id.local_tag;var remoteTag=targetDialogSession.dialog.isUAS()?targetDialogSession.dialog.id.local_tag:targetDialogSession.dialog.id.remote_tag;var targetDialog=targetDialogSession.dialog.id.call_id+";local-tag="+localTag+";remote-tag="+remoteTag;options.extraHeaders.push("Target-Dialog: "+targetDialog)}return options};UA.prototype.getReferSession=function(sessionToTransfer,options){if(sessionToTransfer.supports("tdialog")){return this.newSession(options)}else{this.logger.warn("tdialog not supported - sending refer in same session : "+sessionToTransfer.id,this);return sessionToTransfer}};UA.prototype.newSession=function(options){var session=new RTCSession(this);session.initRtcMediaHandler(options);return session};UA.prototype.getUserMedia=function(options,success,failure,force){if(!force&&this.localMedia){return this.localMedia}if(this.localMedia){this.logger.log("stopping existing local media stream",this);this.localMedia.stop()}this.logger.log("options : "+Utils.toString(options),this);var self=this;var constraints=options.mediaConstraints||{audio:true,video:true};WebRTC.getUserMedia(constraints,function(stream){self.logger.log("got local media stream",self);self.localMedia=stream;success(stream)},function(e){self.logger.error("unable to get user media");self.logger.error(e);failure(e)})};UA.prototype.stop=function(){var session,applicant,ua=this;this.logger.log("user requested closure...");this.dynConfiguration={};if(this.status===C.STATUS_USER_CLOSED){this.logger.warn("UA already closed");return}clearTimeout(this.transportRecoveryTimer);if(this._registrator){this.logger.debug("closing registrator");this._registrator.close()}var num_sessions=Object.keys(this.sessions).length;for(session in this.sessions){this.logger.log("closing session "+session,this);this.sessions[session].terminate()}for(applicant in this.applicants){this.applicants[applicant].close()}this.status=C.STATUS_USER_CLOSED;if(this.nistTransactionsCount===0&&this.nictTransactionsCount===0&&num_sessions===0){ua.transport.disconnect()}else{setTimeout(function(){ua.transport.disconnect()},2e3)}};UA.prototype.reconnect=function(){this.logger.debug("************** reconnect");this.stop();this.status=C.STATUS_INIT;this.start()};UA.prototype.start=function(){var server;this.logger.debug("user requested startup... : ",this.status);if(this.status===C.STATUS_INIT){server=this.getNextWsServer({force:true});this.transport=new Transport(this,server);this.transport.connect()}else if(this.status===C.STATUS_USER_CLOSED){this.logger.log("resuming");this.status=C.STATUS_READY;this.transport.connect()}else if(this.status===C.STATUS_READY){this.logger.log("UA is in READY status, not resuming")}else{this.logger.error("Connection is down. Auto-Recovery system is trying to connect")}this.dynConfiguration.register=this.configuration.register};UA.prototype.register=function(){this.dynConfiguration.register=true;this._registrator.register()};UA.prototype.unregister=function(options){this.dynConfiguration.register=false;this._registrator.unregister(options)};UA.prototype.registrator=function(){return this._registrator};UA.prototype.isRegistered=function(){if(this._registrator.registered){return true}else{return false}};UA.prototype.isConnected=function(){if(this.transport){return this.transport.connected}else{return false}};UA.prototype.call=function(target,options){var session;session=new RTCSession(this);session.connect(target,options);return session};UA.prototype.sendMessage=function(target,body,options){var message;message=new Message(this);message.send(target,body,options)};UA.prototype.normalizeTarget=function(target){return Utils.normalizeTarget(target,this.configuration.hostport_params)};UA.prototype.setRtcMediaHandlerOptions=function(rtcMediaHandlerOptions){this.rtcMediaHandlerOptions=rtcMediaHandlerOptions};UA.prototype.rtcConstraints=function(){return this.rtcMediaHandlerOptions?this.rtcMediaHandlerOptions.RTCConstraints:false};UA.prototype.reuseLocalMedia=function(){return this.rtcMediaHandlerOptions?this.rtcMediaHandlerOptions.reuseLocalMedia:false};UA.prototype.saveCredentials=function(credentials){this.cache.credentials[credentials.realm]=this.cache.credentials[credentials.realm]||{};this.cache.credentials[credentials.realm][credentials.uri]=credentials};UA.prototype.getCredentials=function(request){var realm,credentials;realm=request.ruri.host;if(this.cache.credentials[realm]&&this.cache.credentials[realm][request.ruri]){credentials=this.cache.credentials[realm][request.ruri];credentials.method=request.method}return credentials};UA.prototype.getLogger=function(category,label){return this.log.getLogger(category,label)};UA.prototype.onTransportClosed=function(transport){var type,idx,length,client_transactions=["nict","ict","nist","ist"];transport.server.status=Transport.C.STATUS_DISCONNECTED;this.logger.log("connection state set to "+Transport.C.STATUS_DISCONNECTED,this);length=client_transactions.length;for(type=0;type<length;type++){for(idx in this.transactions[client_transactions[type]]){this.transactions[client_transactions[type]][idx].onTransportError()}}if(!this.contact.pub_gruu){this.closeSessionsOnTransportError()}};UA.prototype.onTransportError=function(transport,options){options=options||{};if(this.status===C.STATUS_USER_CLOSED){return}this.logger.log("transport "+transport.server.ws_uri+" failed | connection state set to "+Transport.C.STATUS_ERROR,this);transport.server.status=Transport.C.STATUS_ERROR;this.closeSessionsOnTransportError();if(!this.error||this.error!==C.NETWORK_ERROR){this.status=C.STATUS_NOT_READY;this.error=C.NETWORK_ERROR}this.recoverTransport(options);var data=Utils.merge_options({transport:transport,code:transport.lastTransportError.code,reason:transport.lastTransportError.reason},options);this.emit("disconnected",this,data)};UA.prototype.onTransportConnected=function(transport){this.transport=transport;this.transportRecoverAttempts=0;transport.server.status=Transport.C.STATUS_READY;this.logger.log("connection state set to "+Transport.C.STATUS_READY,this);if(this.status===C.STATUS_USER_CLOSED){return}this.status=C.STATUS_READY;this.error=null;this.emit("connected",this,{transport:transport});if(this.dynConfiguration.register){if(this._registrator){this._registrator.onTransportConnected()}else{this._registrator=new Registrator(this,transport);this.register()}}else if(!this._registrator){this._registrator=new Registrator(this,transport)}};UA.prototype.onTransportConnecting=function(transport,attempts){this.emit("connecting",this,{transport:transport,attempts:attempts})};UA.prototype.newTransaction=function(transaction){this.transactions[transaction.type][transaction.id]=transaction;this.emit("newTransaction",this,{transaction:transaction})};UA.prototype.destroyTransaction=function(transaction){delete this.transactions[transaction.type][transaction.id];this.emit("transactionDestroyed",this,{transaction:transaction})};UA.prototype.receiveRequest=function(request){var dialog,session,message,method=request.method;if(request.ruri.user!==this.configuration.uri.user&&request.ruri.user!==this.contact.uri.user){this.logger.warn("Request-URI ("+request.ruri.user+") does not point to us ("+this.configuration.uri.user+")",this);if(request.method!==ExSIP_C.ACK){request.reply_sl(404)}return}if(request.ruri.scheme===ExSIP_C.SIPS){request.reply_sl(416);return}if(Transactions.checkTransaction(this,request)){this.logger.warn("Check Transaction failed",this);return}if(method===ExSIP_C.INVITE){new Transactions.InviteServerTransaction(request,this)}else if(method!==ExSIP_C.ACK&&method!==ExSIP_C.CANCEL){new Transactions.NonInviteServerTransaction(request,this)}if(method===ExSIP_C.OPTIONS){request.reply(200)}else if(method===ExSIP_C.MESSAGE){if(!this.checkEvent("newMessage")||this.listeners("newMessage").length===0){request.reply(405);return}message=new Message(this);message.init_incoming(request)}else if(method===ExSIP_C.INVITE){if(!this.checkEvent("newRTCSession")||this.listeners("newRTCSession").length===0){request.reply(405);return}}if(!request.to_tag){switch(method){case ExSIP_C.INVITE:if(WebRTC.isSupported){this.logger.debug("INVITE received",this);session=new RTCSession(this);session.init_incoming(request)}else{this.logger.warn("INVITE received but WebRTC is not supported",this);request.reply(488)}break;case ExSIP_C.BYE:request.reply(481);break;case ExSIP_C.CANCEL:session=this.findSession(request);if(session){session.receiveRequest(request)}else{this.logger.warn("received CANCEL request for a non existent session",this)}break;case ExSIP_C.ACK:break;default:request.reply(405);break}}else{dialog=this.findDialog(request);if(dialog){dialog.receiveRequest(request)}else if(method===ExSIP_C.NOTIFY){session=this.findSession(request);if(session){this.logger.log("received NOTIFY request for session : "+session.id,this);session.receiveRequest(request)}else{this.logger.warn("received NOTIFY request for a non existent session",this);this.logger.log("request : "+(request.call_id+"-"+request.from_tag+"-"+request.to_tag),this);this.logger.log("sessions : "+Object.keys(this.sessions),this);request.reply(481,"Subscription does not exist")}}else{if(method!==ExSIP_C.ACK){request.reply(481)}}}};UA.prototype.findSession=function(request){var sessionIDa=request.call_id+request.from_tag,sessionA=this.sessions[sessionIDa],sessionIDb=request.call_id+request.to_tag,sessionB=this.sessions[sessionIDb];if(sessionA){return sessionA
}else if(sessionB){return sessionB}else{return null}};UA.prototype.findDialog=function(request){var id=request.call_id+request.from_tag+request.to_tag,dialog=this.dialogs[id];if(dialog){return dialog}else{id=request.call_id+request.to_tag+request.from_tag;dialog=this.dialogs[id];if(dialog){return dialog}else{return null}}};UA.prototype.getNextWsServer=function(options){options=options||{};if(options.force&&this.usedServers.length>=this.configuration.ws_servers.length){this.usedServers=[]}var candidates=[];var totalWeight=0;for(var i=0;i<this.configuration.ws_servers.length;i++){var server=this.configuration.ws_servers[i];if(server.status===Transport.C.STATUS_READY&&this.usedServers.indexOf(server)===-1){candidates.push(server);totalWeight+=server.weight||1}}var weightedServers=[];for(var j=0;j<candidates.length;j++){var candidate=candidates[j];for(var k=0;k<(candidate.weight||1);k++){weightedServers.push(candidate)}}var randomNumber=Math.floor(Math.random()*totalWeight);var index=Math.min(randomNumber,weightedServers.length-1);return weightedServers[index]};UA.prototype.closeSessionsOnTransportError=function(){var idx;for(idx in this.sessions){this.sessions[idx].onTransportError()}this._registrator.onTransportClosed()};UA.prototype.loadConfig=function(configuration){var parameter,value,checked_value,hostport_params,registrar_server,settings={via_host:Utils.createRandomToken(12)+".invalid",password:null,register_expires:600,register:true,registrar_server:null,ws_server_max_reconnection:3,ws_server_reconnection_timeout:4,connection_recovery_min_interval:2,connection_recovery_max_interval:30,use_preloaded_route:false,no_answer_timeout:60,stun_servers:["stun:stun.l.google.com:19302"],turn_servers:[],trace_sip:false,hack_via_tcp:false,hack_via_ws:false,hack_ip_in_contact:false,enable_datachannel:false,enable_ims:false,p_asserted_identity:null,node_ws_options:{}};for(parameter in UA.configuration_check.mandatory){if(!configuration.hasOwnProperty(parameter)){throw new Exceptions.ConfigurationError(parameter)}else{value=configuration[parameter];checked_value=UA.configuration_check.mandatory[parameter].call(this,value);if(checked_value!==undefined){settings[parameter]=checked_value}else{throw new Exceptions.ConfigurationError(parameter,value)}}}for(parameter in UA.configuration_check.optional){if(configuration.hasOwnProperty(parameter)){value=configuration[parameter];if(Utils.isEmpty(value)){continue}checked_value=UA.configuration_check.optional[parameter].call(this,value);if(checked_value!==undefined){settings[parameter]=checked_value}else{throw new Exceptions.ConfigurationError(parameter,value)}}}if(settings.connection_recovery_max_interval<settings.connection_recovery_min_interval){throw new Exceptions.ConfigurationError("connection_recovery_max_interval",settings.connection_recovery_max_interval)}if(settings.display_name===0){settings.display_name="0"}if(!settings.instance_id){settings.instance_id=Utils.newUUID()}settings.exsip_id=Utils.createRandomToken(5);hostport_params=settings.uri.clone();hostport_params.user=null;settings.hostport_params=hostport_params.toString().replace(/^sip:/i,"");if(!settings.authorization_user){settings.authorization_user=settings.uri.user}if(!settings.registrar_server){registrar_server=settings.uri.clone();registrar_server.user=null;settings.registrar_server=registrar_server}settings.no_answer_timeout=settings.no_answer_timeout*1e3;if(settings.hack_ip_in_contact){settings.via_host=Utils.getRandomTestNetIP()}value=configuration.stun_servers;if(value instanceof Array&&value.length===0){settings.stun_servers=[]}this.contact={pub_gruu:null,temp_gruu:null,uri:new URI("sip",Utils.createRandomToken(8),settings.via_host,null,{transport:"ws"}),toString:function(options){options=options||{};var anonymous=options.anonymous||null,outbound=options.outbound||null,contact="<";if(anonymous){contact+=this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws"}else{contact+=this.pub_gruu||this.uri.toString()}if(outbound&&(anonymous?!this.temp_gruu:!this.pub_gruu)){contact+=";ob"}contact+=">";return contact}};for(parameter in settings){UA.configuration_skeleton[parameter].value=settings[parameter]}Object.defineProperties(this.configuration,UA.configuration_skeleton);for(parameter in settings){UA.configuration_skeleton[parameter].value=""}this.logger.debug("configuration parameters after validation:");for(parameter in settings){switch(parameter){case"uri":case"registrar_server":this.logger.debug("Â· "+parameter+": "+settings[parameter]);break;case"password":this.logger.debug("Â· "+parameter+": "+"NOT SHOWN");break;default:this.logger.debug("Â· "+parameter+": "+JSON.stringify(settings[parameter]))}}return};UA.prototype.retry=function(nextRetry,server,callback){var self=this;var retryCallback=function(){var transport=new Transport(self,server);if(callback){callback(transport)}};if(nextRetry===0){retryCallback()}else{setTimeout(retryCallback,nextRetry*1e3)}};UA.prototype.recoverTransport=function(options){var idx,length,k,nextRetry,count,server;options=options||{};count=this.transportRecoverAttempts;length=this.configuration.ws_servers.length;for(idx=0;idx<length;idx++){this.configuration.ws_servers[idx].status=Transport.C.STATUS_READY}server=this.getNextWsServer();if(options.code===503&&!server){delete options.retryAfter;this.logger.log("non-failover on 503 error - skipping recoverTransport",this);return}var maxTransportRecoveryAttempts=this.configuration.max_transport_recovery_attempts;if(typeof maxTransportRecoveryAttempts!=="undefined"&&count>=parseInt(maxTransportRecoveryAttempts,10)){delete options.retryAfter;this.logger.log("recover attempts "+count+" exceed max transport recovery attempts "+maxTransportRecoveryAttempts+" - skipping recoverTransport");return}if(server){this.logger.log("failover - new connection attempt with "+server.ws_uri);this.retry(0,server,options.retryCallback);return}if(options.retryAfter){nextRetry=options.retryAfter}else{k=Math.floor(Math.random()*Math.pow(2,count)+1);nextRetry=k*this.configuration.connection_recovery_min_interval;if(nextRetry>this.configuration.connection_recovery_max_interval){this.logger.log("time for next connection attempt exceeds connection_recovery_max_interval, resetting counter",this);nextRetry=this.configuration.connection_recovery_min_interval;count=0}}server=this.getNextWsServer({force:true});this.transportRecoverAttempts=count+1;this.logger.log("resetting ws server list - next connection attempt in "+nextRetry+" seconds to "+server.ws_uri+" : "+this.transportRecoverAttempts);this.retry(nextRetry,server,options.retryCallback)};UA.configuration_skeleton=function(){var idx,parameter,skeleton={},parameters=["exsip_id","ws_server_max_reconnection","ws_server_reconnection_timeout","hostport_params","uri","ws_servers","authorization_user","connection_recovery_max_interval","connection_recovery_min_interval","max_transport_recovery_attempts","display_name","hack_via_tcp","hack_via_ws","hack_ip_in_contact","instance_id","no_answer_timeout","node_ws_options","password","register_expires","registrar_server","stun_servers","trace_sip","turn_servers","use_preloaded_route","enable_datachannel","enable_ims","p_asserted_identity","via_core_value","via_host"];for(idx in parameters){parameter=parameters[idx];skeleton[parameter]={value:"",writable:false,configurable:false}}skeleton.register={value:"",writable:true,configurable:false};return skeleton}();UA.configuration_check={mandatory:{uri:function(uri){var parsed;if(!/^sip:/i.test(uri)){uri=ExSIP_C.SIP+":"+uri}parsed=URI.parse(uri);if(!parsed){return}else if(!parsed.user){return}else{return parsed}},ws_servers:function(ws_servers){var idx,length,url;if(typeof ws_servers==="string"){ws_servers=[{ws_uri:ws_servers}]}else if(ws_servers instanceof Array){length=ws_servers.length;for(idx=0;idx<length;idx++){if(typeof ws_servers[idx]==="string"){ws_servers[idx]={ws_uri:ws_servers[idx]}}}}else{return}if(ws_servers.length===0){return false}length=ws_servers.length;for(idx=0;idx<length;idx++){if(!ws_servers[idx].ws_uri){this.logger.error('missing "ws_uri" attribute in ws_servers parameter');return}if(ws_servers[idx].weight&&!Number(ws_servers[idx].weight)){this.logger.error('"weight" attribute in ws_servers parameter must be a Number');return}url=Grammar.parse(ws_servers[idx].ws_uri,"absoluteURI");if(url===-1){this.logger.error('invalid "ws_uri" attribute in ws_servers parameter: '+ws_servers[idx].ws_uri);return}else if(url.scheme!=="wss"&&url.scheme!=="ws"){this.logger.error("invalid URI scheme in ws_servers parameter: "+url.scheme);return}else{ws_servers[idx].sip_uri="<sip:"+url.host+(url.port?":"+url.port:"")+";transport=ws;lr>";if(!ws_servers[idx].weight){ws_servers[idx].weight=0}ws_servers[idx].status=0;ws_servers[idx].scheme=url.scheme.toUpperCase()}}return ws_servers}},optional:{authorization_user:function(authorization_user){if(Grammar.parse('"'+authorization_user+'"',"quoted_string")===-1){return}else{return authorization_user}},connection_recovery_max_interval:function(connection_recovery_max_interval){var value;if(Utils.isDecimal(connection_recovery_max_interval)){value=Number(connection_recovery_max_interval);if(value>0){return value}}},connection_recovery_min_interval:function(connection_recovery_min_interval){var value;if(Utils.isDecimal(connection_recovery_min_interval)){value=Number(connection_recovery_min_interval);if(value>=0){return value}}},display_name:function(display_name){if(Grammar.parse('"'+display_name+'"',"display_name")===-1){return}else{return display_name}},hack_via_tcp:function(hack_via_tcp){if(typeof hack_via_tcp==="boolean"){return hack_via_tcp}},hack_via_ws:function(hack_via_ws){if(typeof hack_via_ws==="boolean"){return hack_via_ws}},hack_ip_in_contact:function(hack_ip_in_contact){if(typeof hack_ip_in_contact==="boolean"){return hack_ip_in_contact}},enable_ims:function(enable_ims){if(typeof enable_ims==="boolean"){return enable_ims}},ws_server_reconnection_timeout:function(ws_server_reconnection_timeout){var value;if(Utils.isDecimal(ws_server_reconnection_timeout)){value=Number(ws_server_reconnection_timeout);if(value>=0){return value}}},max_transport_recovery_attempts:function(max_transport_recovery_attempts){var value;if(Utils.isDecimal(max_transport_recovery_attempts)){value=Number(max_transport_recovery_attempts);if(value>=0){return value}}},p_asserted_identity:function(p_asserted_identity){return String(p_asserted_identity)},enable_datachannel:function(enable_datachannel){if(typeof enable_datachannel==="boolean"){return enable_datachannel}},instance_id:function(instance_id){if(/^uuid:/i.test(instance_id)){instance_id=instance_id.substr(5)}if(Grammar.parse(instance_id,"uuid")===-1){return}else{return instance_id}},no_answer_timeout:function(no_answer_timeout){var value;if(Utils.isDecimal(no_answer_timeout)){value=Number(no_answer_timeout);if(value>0){return value}}},node_ws_options:function(node_ws_options){return typeof node_ws_options==="object"?node_ws_options:{}},password:function(password){return String(password)},register:function(register){if(typeof register==="boolean"){return register}},register_expires:function(register_expires){var value;if(Utils.isDecimal(register_expires)){value=Number(register_expires);if(value>0){return value}}},registrar_server:function(registrar_server){var parsed;if(!/^sip:/i.test(registrar_server)){registrar_server=ExSIP_C.SIP+":"+registrar_server}parsed=URI.parse(registrar_server);if(!parsed){return}else if(parsed.user){return}else{return parsed}},stun_servers:function(stun_servers){var idx,length,stun_server;if(typeof stun_servers==="string"){stun_servers=[stun_servers]}else if(!(stun_servers instanceof Array)){return}length=stun_servers.length;for(idx=0;idx<length;idx++){stun_server=stun_servers[idx];if(!/^stuns?:/.test(stun_server)){stun_server="stun:"+stun_server}if(Grammar.parse(stun_server,"stun_URI")===-1){return}else{stun_servers[idx]=stun_server}}return stun_servers},trace_sip:function(trace_sip){if(typeof trace_sip==="boolean"){return trace_sip}},turn_servers:function(turn_servers){var idx,idx2,length,length2,turn_server,url;if(!turn_servers instanceof Array){turn_servers=[turn_servers]}length=turn_servers.length;for(idx=0;idx<length;idx++){turn_server=turn_servers[idx];if(turn_server.server){turn_server.urls=[turn_server.server]}if(turn_server.password){turn_server.credential=[turn_server.password]}if(!turn_server.urls||!turn_server.username||!turn_server.credential){return}if(!(turn_server.urls instanceof Array)){turn_server.urls=[turn_server.urls]}length2=turn_server.urls.length;for(idx2=0;idx2<length2;idx2++){url=turn_server.urls[idx2];if(!/^turns?:/.test(url)){url="turn:"+url}if(Grammar.parse(url,"turn_URI")===-1){return}}}return turn_servers},use_preloaded_route:function(use_preloaded_route){if(typeof use_preloaded_route==="boolean"){return use_preloaded_route}}}}},{"./Constants":22,"./EventEmitter":26,"./Exceptions":28,"./Grammar":29,"./LoggerFactory":31,"./Message":32,"./RTCSession":35,"./Registrator":39,"./Transactions":43,"./Transport":44,"./URI":46,"./Utils":47,"./WebRTC":48}],46:[function(require,module,exports){module.exports=URI;var ExSIP_C=require("./Constants");var Utils=require("./Utils");var Grammar=require("./Grammar");function URI(scheme,user,host,port,parameters,headers){var param,header;if(!host){throw new TypeError('missing or invalid "host" parameter')}scheme=scheme||ExSIP_C.SIP;this.parameters={};this.headers={};for(param in parameters){this.setParam(param,parameters[param])}for(header in headers){this.setHeader(header,headers[header])}Object.defineProperties(this,{scheme:{get:function(){return scheme},set:function(value){scheme=value.toLowerCase()}},user:{get:function(){return user},set:function(value){user=value}},host:{get:function(){return host},set:function(value){host=value.toLowerCase()}},port:{get:function(){return port},set:function(value){port=value===0?value:parseInt(value,10)||null}}})}URI.prototype={setParam:function(key,value){if(key){this.parameters[key.toLowerCase()]=typeof value==="undefined"||value===null?null:value.toString().toLowerCase()}},getParam:function(key){if(key){return this.parameters[key.toLowerCase()]}},hasParam:function(key){if(key){return this.parameters.hasOwnProperty(key.toLowerCase())&&true||false}},deleteParam:function(parameter){var value;parameter=parameter.toLowerCase();if(this.parameters.hasOwnProperty(parameter)){value=this.parameters[parameter];delete this.parameters[parameter];return value}},clearParams:function(){this.parameters={}},setHeader:function(name,value){this.headers[Utils.headerize(name)]=value instanceof Array?value:[value]},getHeader:function(name){if(name){return this.headers[Utils.headerize(name)]}},hasHeader:function(name){if(name){return this.headers.hasOwnProperty(Utils.headerize(name))&&true||false}},deleteHeader:function(header){var value;header=Utils.headerize(header);if(this.headers.hasOwnProperty(header)){value=this.headers[header];delete this.headers[header];return value}},clearHeaders:function(){this.headers={}},isPhoneNumber:function(){return this.user&&this.user.match(/^\+?\d+$/)!==null},clone:function(){return new URI(this.scheme,this.user,this.host,this.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toString:function(){var header,parameter,idx,uri,headers=[];uri=this.scheme+":";if(this.user){uri+=Utils.escapeUser(this.user)+"@"}uri+=this.host;if(this.port||this.port===0){uri+=":"+this.port}for(parameter in this.parameters){uri+=";"+parameter;if(this.parameters[parameter]!==null){uri+="="+this.parameters[parameter]}}for(header in this.headers){for(idx in this.headers[header]){headers.push(header+"="+this.headers[header][idx])}}if(headers.length>0){uri+="?"+headers.join("&")}return uri},toAor:function(show_port){var aor;aor=this.scheme+":";if(this.user){aor+=Utils.escapeUser(this.user)+"@"}aor+=this.host;if(show_port&&(this.port||this.port===0)){aor+=":"+this.port}return aor}};URI.parse=function(uri){uri=Grammar.parse(uri,"SIP_URI");if(uri!==-1){return uri}else{return undefined}}},{"./Constants":22,"./Grammar":29,"./Utils":47}],47:[function(require,module,exports){var Utils={};module.exports=Utils;var ExSIP_C=require("./Constants");var URI=require("./URI");var Grammar=require("./Grammar");Utils.inArray=function(array,el){for(var i=array.length;i--;){if(array[i]===el){return true}}return false};Utils.isEqArrays=function(arr1,arr2){if(arr1===null&&arr2!==null){return false}if(arr1!==null&&arr2===null){return false}if(arr1===null&&arr2===null){return true}if(arr1.length!==arr2.length){return false}for(var i=arr1.length;i--;){if(!this.inArray(arr2,arr1[i])){return false}}return true};Utils.merge_options=function(obj1,obj2){var obj3={};for(var attrname1 in obj1){obj3[attrname1]=obj1[attrname1]}for(var attrname2 in obj2){obj3[attrname2]=obj2[attrname2]}return obj3};Utils.containsHeader=function(headers,name){for(var i=0;i<headers.length;i++){if(headers[i].indexOf(name)!==-1){return true}}return false};Utils.str_utf8_length=function(string){return unescape(encodeURIComponent(string)).length};Utils.toString=function(object){var seen=[];return JSON.stringify(object,function(key,val){if(typeof val==="object"){if(seen.indexOf(val)>=0){return}seen.push(val)}return val})};Utils.isFunction=function(fn){if(fn!==undefined){return Object.prototype.toString.call(fn)==="[object Function]"?true:false}else{return false}};Utils.isDecimal=function(num){return!isNaN(num)&&parseFloat(num)===parseInt(num,10)};Utils.getHeadersFromQuery=function(query){var headers=[];var queryParts=query.split("&");for(var i=0;i<queryParts.length;i++){var parameters=queryParts[i].split("=");headers.push(parameters[0]+": "+decodeURIComponent(parameters[1]))}return headers};Utils.stripSip=function(address){var match=address.match(/<sip\:(.*)\>/);return match?match[1]:address};Utils.isEmpty=function(value){if(value===null||value===""||value===undefined||value instanceof Array&&value.length===0||typeof value==="number"&&isNaN(value)){return true}};Utils.getAllowedMethods=function(ua){var event,allowed=ExSIP_C.ALLOWED_METHODS.toString();for(event in ExSIP_C.EVENT_METHODS){if(ua.checkEvent(event)&&ua.listeners(event).length>0){allowed+=","+ExSIP_C.EVENT_METHODS[event]}}return allowed};Utils.createRandomToken=function(size,base){var i,r,token="";base=base||32;for(i=0;i<size;i++){r=Math.random()*base|0;token+=r.toString(base)}return token};Utils.newTag=function(){return Utils.createRandomToken(10)};Utils.newUUID=function(){var UUID="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c==="x"?r:r&3|8;return v.toString(16)});return UUID};Utils.hostType=function(host){if(!host){return}else{host=Grammar.parse(host,"host");if(host!==-1){return host.host_type}}};Utils.normalizeTarget=function(target,domain){var uri,target_array,target_user,target_domain;if(!target){return}else if(target instanceof URI){return target}else if(typeof target==="string"){target_array=target.split("@");switch(target_array.length){case 1:if(!domain){return}target_user=target;target_domain=domain;break;case 2:target_user=target_array[0];target_domain=target_array[1];break;default:target_user=target_array.slice(0,target_array.length-1).join("@");target_domain=target_array[target_array.length-1]}target_user=target_user.replace(/^(sips?|tel):/i,"");if(/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(target_user)){target_user=target_user.replace(/[\-\.\(\)]/g,"")}target=ExSIP_C.SIP+":"+Utils.escapeUser(target_user)+"@"+target_domain;if(uri=URI.parse(target)){return uri}else{return}}else{return}};Utils.escapeUser=function(user){return encodeURIComponent(decodeURIComponent(user)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")};Utils.headerize=function(string){var exceptions={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},name=string.toLowerCase().replace(/_/g,"-").split("-"),hname="",parts=name.length,part;for(part=0;part<parts;part++){if(part!==0){hname+="-"}hname+=name[part].charAt(0).toUpperCase()+name[part].substring(1)}if(exceptions[hname]){hname=exceptions[hname]}return hname};Utils.sipErrorCause=function(status_code){var cause;for(cause in ExSIP_C.SIP_ERROR_CAUSES){if(ExSIP_C.SIP_ERROR_CAUSES[cause].indexOf(status_code)!==-1){return ExSIP_C.causes[cause]}}return ExSIP_C.causes.SIP_FAILURE_CODE};Utils.getRandomTestNetIP=function(){function getOctet(from,to){return Math.floor(Math.random()*(to-from+1)+from)}return"192.0.2."+getOctet(1,254)};Utils.calculateMD5=function(string){function rotateLeft(lValue,iShiftBits){return lValue<<iShiftBits|lValue>>>32-iShiftBits}function addUnsigned(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=lX&2147483648;lY8=lY&2147483648;lX4=lX&1073741824;lY4=lY&1073741824;lResult=(lX&1073741823)+(lY&1073741823);if(lX4&lY4){return lResult^2147483648^lX8^lY8}if(lX4|lY4){if(lResult&1073741824){return lResult^3221225472^lX8^lY8}else{return lResult^1073741824^lX8^lY8}}else{return lResult^lX8^lY8}}function doF(x,y,z){return x&y|~x&z}function doG(x,y,z){return x&z|y&~z}function doH(x,y,z){return x^y^z}function doI(x,y,z){return y^(x|~z)}function doFF(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(doF(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)}function doGG(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(doG(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)}function doHH(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(doH(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)}function doII(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(doI(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)}function convertToWordArray(string){var lWordCount;var lMessageLength=string.length;var lNumberOfWords_temp1=lMessageLength+8;var lNumberOfWords_temp2=(lNumberOfWords_temp1-lNumberOfWords_temp1%64)/64;var lNumberOfWords=(lNumberOfWords_temp2+1)*16;var lWordArray=new Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-lByteCount%4)/4;lBytePosition=lByteCount%4*8;lWordArray[lWordCount]=lWordArray[lWordCount]|string.charCodeAt(lByteCount)<<lBytePosition;lByteCount++}lWordCount=(lByteCount-lByteCount%4)/4;lBytePosition=lByteCount%4*8;lWordArray[lWordCount]=lWordArray[lWordCount]|128<<lBytePosition;lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray}function wordToHex(lValue){var wordToHexValue="",wordToHexValue_temp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=lValue>>>lCount*8&255;wordToHexValue_temp="0"+lByte.toString(16);wordToHexValue=wordToHexValue+wordToHexValue_temp.substr(wordToHexValue_temp.length-2,2)}return wordToHexValue}function utf8Encode(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128)}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128)}}return utftext}var x=[];var k,AA,BB,CC,DD,a,b,c,d;var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;string=utf8Encode(string);x=convertToWordArray(string);a=1732584193;b=4023233417;c=2562383102;d=271733878;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=doFF(a,b,c,d,x[k+0],S11,3614090360);d=doFF(d,a,b,c,x[k+1],S12,3905402710);c=doFF(c,d,a,b,x[k+2],S13,606105819);b=doFF(b,c,d,a,x[k+3],S14,3250441966);a=doFF(a,b,c,d,x[k+4],S11,4118548399);d=doFF(d,a,b,c,x[k+5],S12,1200080426);c=doFF(c,d,a,b,x[k+6],S13,2821735955);b=doFF(b,c,d,a,x[k+7],S14,4249261313);a=doFF(a,b,c,d,x[k+8],S11,1770035416);d=doFF(d,a,b,c,x[k+9],S12,2336552879);c=doFF(c,d,a,b,x[k+10],S13,4294925233);b=doFF(b,c,d,a,x[k+11],S14,2304563134);a=doFF(a,b,c,d,x[k+12],S11,1804603682);d=doFF(d,a,b,c,x[k+13],S12,4254626195);c=doFF(c,d,a,b,x[k+14],S13,2792965006);b=doFF(b,c,d,a,x[k+15],S14,1236535329);a=doGG(a,b,c,d,x[k+1],S21,4129170786);d=doGG(d,a,b,c,x[k+6],S22,3225465664);c=doGG(c,d,a,b,x[k+11],S23,643717713);b=doGG(b,c,d,a,x[k+0],S24,3921069994);a=doGG(a,b,c,d,x[k+5],S21,3593408605);d=doGG(d,a,b,c,x[k+10],S22,38016083);c=doGG(c,d,a,b,x[k+15],S23,3634488961);b=doGG(b,c,d,a,x[k+4],S24,3889429448);a=doGG(a,b,c,d,x[k+9],S21,568446438);d=doGG(d,a,b,c,x[k+14],S22,3275163606);c=doGG(c,d,a,b,x[k+3],S23,4107603335);b=doGG(b,c,d,a,x[k+8],S24,1163531501);a=doGG(a,b,c,d,x[k+13],S21,2850285829);d=doGG(d,a,b,c,x[k+2],S22,4243563512);c=doGG(c,d,a,b,x[k+7],S23,1735328473);b=doGG(b,c,d,a,x[k+12],S24,2368359562);a=doHH(a,b,c,d,x[k+5],S31,4294588738);d=doHH(d,a,b,c,x[k+8],S32,2272392833);c=doHH(c,d,a,b,x[k+11],S33,1839030562);b=doHH(b,c,d,a,x[k+14],S34,4259657740);a=doHH(a,b,c,d,x[k+1],S31,2763975236);d=doHH(d,a,b,c,x[k+4],S32,1272893353);c=doHH(c,d,a,b,x[k+7],S33,4139469664);b=doHH(b,c,d,a,x[k+10],S34,3200236656);a=doHH(a,b,c,d,x[k+13],S31,681279174);d=doHH(d,a,b,c,x[k+0],S32,3936430074);c=doHH(c,d,a,b,x[k+3],S33,3572445317);b=doHH(b,c,d,a,x[k+6],S34,76029189);a=doHH(a,b,c,d,x[k+9],S31,3654602809);d=doHH(d,a,b,c,x[k+12],S32,3873151461);c=doHH(c,d,a,b,x[k+15],S33,530742520);b=doHH(b,c,d,a,x[k+2],S34,3299628645);a=doII(a,b,c,d,x[k+0],S41,4096336452);d=doII(d,a,b,c,x[k+7],S42,1126891415);c=doII(c,d,a,b,x[k+14],S43,2878612391);b=doII(b,c,d,a,x[k+5],S44,4237533241);a=doII(a,b,c,d,x[k+12],S41,1700485571);d=doII(d,a,b,c,x[k+3],S42,2399980690);c=doII(c,d,a,b,x[k+10],S43,4293915773);b=doII(b,c,d,a,x[k+1],S44,2240044497);a=doII(a,b,c,d,x[k+8],S41,1873313359);d=doII(d,a,b,c,x[k+15],S42,4264355552);c=doII(c,d,a,b,x[k+6],S43,2734768916);b=doII(b,c,d,a,x[k+13],S44,1309151649);a=doII(a,b,c,d,x[k+4],S41,4149444226);d=doII(d,a,b,c,x[k+11],S42,3174756917);c=doII(c,d,a,b,x[k+2],S43,718787259);b=doII(b,c,d,a,x[k+9],S44,3951481745);a=addUnsigned(a,AA);b=addUnsigned(b,BB);c=addUnsigned(c,CC);d=addUnsigned(d,DD)}var temp=wordToHex(a)+wordToHex(b)+wordToHex(c)+wordToHex(d);return temp.toLowerCase()}},{"./Constants":22,"./Grammar":29,"./URI":46}],48:[function(require,module,exports){var WebRTC={};module.exports=WebRTC;var ExSIP_C=require("./Constants");var Utils=require("./Utils");if(typeof navigator!=="undefined"&&navigator.webkitGetUserMedia){WebRTC.getUserMedia=navigator.webkitGetUserMedia.bind(navigator)}else if(typeof navigator!=="undefined"&&navigator.mozGetUserMedia){WebRTC.getUserMedia=navigator.mozGetUserMedia.bind(navigator)}else if(typeof navigator!=="undefined"&&navigator.getUserMedia){WebRTC.getUserMedia=navigator.getUserMedia.bind(navigator)}if(typeof webkitRTCPeerConnection!=="undefined"){WebRTC.RTCPeerConnection=webkitRTCPeerConnection}else if(typeof mozRTCPeerConnection!=="undefined"){WebRTC.RTCPeerConnection=mozRTCPeerConnection}else if(typeof RTCPeerConnection!=="undefined"){WebRTC.RTCPeerConnection=RTCPeerConnection}else{console.log("WebRTC.RTCPeerConnection undefined");WebRTC.RTCPeerConnection=function(options,constraints){this.options=options;this.constraints=constraints}}if(typeof RTCIceCandidate!=="undefined"){WebRTC.RTCIceCandidate=RTCIceCandidate}else{console.log("WebRTC.RTCIceCandidate undefined");WebRTC.RTCIceCandidate=function(){}}if(typeof webkitRTCSessionDescription!=="undefined"){WebRTC.RTCSessionDescription=webkitRTCSessionDescription}else if(typeof mozRTCSessionDescription!=="undefined"){WebRTC.RTCSessionDescription=mozRTCSessionDescription}else if(typeof RTCSessionDescription!=="undefined"){WebRTC.RTCSessionDescription=RTCSessionDescription}else{console.log("WebRTC.RTCSessionDescription undefined");WebRTC.RTCSessionDescription=function(options){options=options||{};this.sdp=options.sdp;this.type=options.type}}WebRTC.RTCSessionDescription.prototype.getSdp=function(options){options=options||{};var sdp=this.sdp;if(options.additionalSdp){sdp+=options.additionalSdp}return sdp};WebRTC.RTCSessionDescription.prototype.getUnsupportedMedias=function(){var slideMedias=this.getSlidesMedias();var inactiveApplicationMedias=this.getApplicationMedias("0 RTP/SAVPF");var unsupportedMedias=slideMedias.concat(inactiveApplicationMedias);return unsupportedMedias};WebRTC.RTCSessionDescription.prototype.removeUnsupportedMedia=function(){var unsupportedMedias=this.getUnsupportedMedias();for(var i=0;i<unsupportedMedias.length;i++){this.sdp=this.sdp.replace(unsupportedMedias[i],"");console.warn("removing unsupported media from sdp : "+unsupportedMedias[i])}return unsupportedMedias.join("")};WebRTC.RTCSessionDescription.prototype.getSlidesMedias=function(){var slideMedia=this.getVideoMedias("a=content:slides");return slideMedia};WebRTC.RTCSessionDescription.prototype.getVideoMedias=function(filter){return this.getMedias("video",filter)};WebRTC.RTCSessionDescription.prototype.getApplicationMedias=function(filter){return this.getMedias("application",filter)};WebRTC.RTCSessionDescription.prototype.getMedias=function(type,filter){var regex=new RegExp("(m="+type+"(?:(?!m=)[\\s\\S])*)","mig");var match;var results=[];while((match=regex.exec(this.sdp))!==null){var media=match.pop();if(!filter||media.indexOf(filter)!==-1){results.push(media)}}return results};WebRTC.RTCSessionDescription.prototype.getAudioIcePwd=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*a=ice-pwd:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getVideoIcePwd=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*a=ice-pwd:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudioIceUfrag=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*a=ice-ufrag:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getVideoIceUfrag=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*a=ice-ufrag:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getCandidates=function(media){var regex=new RegExp("a=candidate:(.*)","ig");var matches;var result=[];while((matches=regex.exec(media))!==null){result.push(matches[matches.length-1])}return result};WebRTC.RTCSessionDescription.prototype.getAudioCandidates=function(){var audio=this.getAudio();return audio?this.getCandidates(audio):null};WebRTC.RTCSessionDescription.prototype.getVideoCandidates=function(){var video=this.getVideo();return video?this.getCandidates(video):null};WebRTC.RTCSessionDescription.prototype.getConnection=function(){var match=this.sdp.match(/v=(?:(?!m=)[\s\S])*c=(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudio=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getVideo=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudioConnection=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*c=(.*)/im);return match!==null?match[match.length-1]:this.getConnection()};WebRTC.RTCSessionDescription.prototype.getVideoConnection=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*c=(.*)/im);return match!==null?match[match.length-1]:this.getConnection()};WebRTC.RTCSessionDescription.prototype.hasVideo=function(){return this.sdp.match(/m=video/)!==null};WebRTC.RTCSessionDescription.prototype.hasAudio=function(){return this.sdp.match(/m=audio/)!==null};WebRTC.RTCSessionDescription.prototype.videoPort=function(){var match=this.sdp.match(/m=video\s(\d*)\s/);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.audioPort=function(){var match=this.sdp.match(/m=audio\s(\d*)\s/);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudioMedia=function(){var match=this.sdp.match(/m=audio\s(.*)/);return match!==null?match[match.length-1]:null
};WebRTC.RTCSessionDescription.prototype.getVideoMedia=function(){var match=this.sdp.match(/m=video\s(.*)/);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudioCodecs=function(){var audioMedia=this.getAudioMedia();return this.getCodecs(audioMedia)};WebRTC.RTCSessionDescription.prototype.getVideoCodecs=function(){var videoMedia=this.getVideoMedia();return this.getCodecs(videoMedia)};WebRTC.RTCSessionDescription.prototype.getCodecs=function(media){if(!media){return null}var mediaParts=media.split(" ");return mediaParts.splice(2)};WebRTC.RTCSessionDescription.prototype.getAudioCodecRtpmap=function(codec){var regex=new RegExp("m=audio(?:(?!m=)[\\s\\S])*a=rtpmap:"+codec+"(.*)","mi");var match=this.sdp.match(regex);return match!==null?match[match.length-1].trim():null};WebRTC.RTCSessionDescription.prototype.getVideoCodecRtpmap=function(codec){var regex=new RegExp("m=video(?:(?!m=)[\\s\\S])*a=rtpmap:"+codec+"(.*)","mi");var match=this.sdp.match(regex);return match!==null?match[match.length-1].trim():null};WebRTC.RTCSessionDescription.prototype.getAudioCodecFmtp=function(codec){var regex=new RegExp("m=audio(?:(?!m=)[\\s\\S])*a=fmtp:"+codec+"(.*)","mi");var match=this.sdp.match(regex);return match!==null?match[match.length-1].trim():null};WebRTC.RTCSessionDescription.prototype.getVideoCodecFmtp=function(codec){var regex=new RegExp("m=video(?:(?!m=)[\\s\\S])*a=fmtp:"+codec+"(.*)","mi");var match=this.sdp.match(regex);return match!==null?match[match.length-1].trim():null};WebRTC.RTCSessionDescription.prototype.getAudioFingerprint=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*a=fingerprint:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getVideoFingerprint=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*a=fingerprint:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getAudioRtcp=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*a=rtcp:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.getVideoRtcp=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*a=rtcp:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.removeVideoFingerprint=function(){if(this.getVideoFingerprint()){this.sdp=this.sdp.replace(/(m=video(?:(?!m=)[\s\S])*)(a=fingerprint:.*\r\n)/im,"$1")}};WebRTC.RTCSessionDescription.prototype.removeAudioFingerprint=function(){if(this.getAudioFingerprint()){this.sdp=this.sdp.replace(/(m=audio(?:(?!m=)[\s\S])*)(a=fingerprint:.*\r\n)/im,"$1")}};WebRTC.RTCSessionDescription.prototype.hasActiveVideo=function(){var videoPort=this.videoPort()||0;var videoConnection=this.getVideoConnection()||"";return this.hasVideo()&&videoPort>0&&videoConnection.indexOf("0.0.0.0")===-1};WebRTC.RTCSessionDescription.prototype.hasActiveAudio=function(){var audioPort=this.audioPort()||0;var audioConnection=this.getAudioConnection()||"";return this.hasAudio()&&audioPort>0&&audioConnection.indexOf("0.0.0.0")===-1};WebRTC.RTCSessionDescription.prototype.getVideoBandwidth=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*b=.*:(.*)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.setVideoBandwidth=function(videoBandwidth){if(this.getVideoBandwidth()){this.sdp=this.sdp.replace(/(m=video(?:(?!m=)[\s\S])*)(b=.*)/im,"$1b=AS:"+videoBandwidth)}else{this.sdp=this.sdp.replace(/(m=video.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\nb=AS:"+videoBandwidth)}};WebRTC.RTCSessionDescription.prototype.setVideoMode=function(mode){if(this.getVideoMode()){this.sdp=this.sdp.replace(/(m=video(?:(?!m=)[\s\S])*)(a=(sendrecv|sendonly|recvonly|inactive))/im,"$1a="+mode)}else{this.sdp=this.sdp.replace(/(m=video.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\na="+mode)}};WebRTC.RTCSessionDescription.prototype.setVideoPort=function(port){this.sdp=this.sdp.replace(/(m=video\s)(\d*)(\s)/i,"$1"+port+"$3")};WebRTC.RTCSessionDescription.prototype.getVideoMode=function(){var match=this.sdp.match(/m=video(?:(?!m=)[\s\S])*a=(sendrecv|sendonly|recvonly|inactive)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.setAudioMode=function(mode){if(this.getAudioMode()){this.sdp=this.sdp.replace(/(m=audio(?:(?!m=)[\s\S])*)(a=(sendrecv|sendonly|recvonly|inactive))/im,"$1a="+mode)}else{this.sdp=this.sdp.replace(/(m=audio.*(:?(?!m=)[\s\S])*(c=IN\s+IP4.*)?)/,"$1\r\na="+mode)}};WebRTC.RTCSessionDescription.prototype.setAudioPort=function(port){this.sdp=this.sdp.replace(/(m=audio\s)(\d*)(\s)/i,"$1"+port+"$3")};WebRTC.RTCSessionDescription.prototype.setAudioConnection=function(audioConnection){if(this.getAudioConnection()){this.sdp=this.sdp.replace(/(m=audio(?:(?!m=)[\s\S])*)(c=.*)/im,"$1c="+audioConnection)}else{this.sdp=this.sdp.replace(/(m=audio.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\nc="+audioConnection)}};WebRTC.RTCSessionDescription.prototype.setVideoConnection=function(videoConnection){if(this.getVideoConnection()){this.sdp=this.sdp.replace(/(m=video(?:(?!m=)[\s\S])*)(c=.*)/im,"$1c="+videoConnection)}else{this.sdp=this.sdp.replace(/(m=video.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\nc="+videoConnection)}};WebRTC.RTCSessionDescription.prototype.setAudioRtcp=function(audioRtcp){if(this.getAudioRtcp()){this.sdp=this.sdp.replace(/(m=audio(?:(?!m=)[\s\S])*)(a=rtcp:.*)/im,"$1a=rtcp:"+audioRtcp)}else{this.sdp=this.sdp.replace(/(m=audio.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\na=rtcp:"+audioRtcp)}};WebRTC.RTCSessionDescription.prototype.setVideoRtcp=function(videoRtcp){if(this.getVideoRtcp()){this.sdp=this.sdp.replace(/(m=video(?:(?!m=)[\s\S])*)(a=rtcp:.*)/im,"$1a=rtcp:"+videoRtcp)}else{this.sdp=this.sdp.replace(/(m=video.*((?!m=)[\s\S]*c=IN\s+IP4.*)?)/,"$1\r\na=rtcp:"+videoRtcp)}};WebRTC.RTCSessionDescription.prototype.getAudioMode=function(){var match=this.sdp.match(/m=audio(?:(?!m=)[\s\S])*a=(sendrecv|sendonly|recvonly|inactive)/im);return match!==null?match[match.length-1]:null};WebRTC.RTCSessionDescription.prototype.isActive=function(){if(this.hasAudio()&&this.audioPort()!=="0"&&this.getAudioMode()!==ExSIP_C.INACTIVE){return true}if(this.hasVideo()&&this.videoPort()!=="0"&&this.getVideoMode()!==ExSIP_C.INACTIVE){return true}return false};WebRTC.RTCSessionDescription.prototype.mediaChanges=function(otherSdp){var mediaChanges=[];if(this.hasAudio()!==otherSdp.hasAudio()){mediaChanges.push("audio has changed")}if(this.hasVideo()!==otherSdp.hasVideo()){mediaChanges.push("video has changed")}if(this.audioPort()!==otherSdp.audioPort()){mediaChanges.push("audio port has changed : "+this.audioPort()+" - "+otherSdp.audioPort())}if(this.videoPort()!==otherSdp.videoPort()){mediaChanges.push("video port has changed : "+this.videoPort()+" - "+otherSdp.videoPort())}if(this.getAudioConnection()!==otherSdp.getAudioConnection()){mediaChanges.push("audio connection has changed : "+this.getAudioConnection()+" - "+otherSdp.getAudioConnection())}if(this.getVideoConnection()!==otherSdp.getVideoConnection()){mediaChanges.push("video connection has changed : "+this.getVideoConnection()+" - "+otherSdp.getVideoConnection())}var audioCodecs=this.getAudioCodecs();if(!Utils.isEqArrays(audioCodecs,otherSdp.getAudioCodecs())){mediaChanges.push("audio codecs has changed : "+audioCodecs+" - "+otherSdp.getAudioCodecs())}var videoCodecs=this.getVideoCodecs();if(!Utils.isEqArrays(videoCodecs,otherSdp.getVideoCodecs())){mediaChanges.push("video codecs has changed : "+videoCodecs+" - "+otherSdp.getVideoCodecs())}if(audioCodecs){for(var i=0;i<audioCodecs.length;i++){if(this.getAudioCodecRtpmap(audioCodecs[i])!==otherSdp.getAudioCodecRtpmap(audioCodecs[i])){mediaChanges.push("audio codec rtpmap for "+audioCodecs[i]+" has changed : "+this.getAudioCodecRtpmap(audioCodecs[i])+" - "+otherSdp.getAudioCodecRtpmap(audioCodecs[i]))}}}if(videoCodecs){for(var j=0;j<videoCodecs.length;j++){if(this.getVideoCodecRtpmap(videoCodecs[j])!==otherSdp.getVideoCodecRtpmap(videoCodecs[j])){mediaChanges.push("video codec rtpmap for "+videoCodecs[j]+" has changed : "+this.getVideoCodecRtpmap(videoCodecs[j])+" - "+otherSdp.getVideoCodecRtpmap(videoCodecs[j]))}}}return mediaChanges};if(WebRTC.RTCPeerConnection&&WebRTC.RTCPeerConnection.prototype){if(!WebRTC.RTCPeerConnection.prototype.getLocalStreams){WebRTC.RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams};WebRTC.RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams}}WebRTC.RTCPeerConnection.prototype.isIceCandidateReady=function(candidate){return candidate}}if(WebRTC.getUserMedia&&WebRTC.RTCPeerConnection&&WebRTC.RTCSessionDescription){WebRTC.isSupported=true}else{WebRTC.isSupported=false}},{"./Constants":22,"./Utils":47}],49:[function(require,module,exports){module.exports=sanityCheck;var ExSIP_C=require("./Constants");var SIPMessage=require("./SIPMessage");var Utils=require("./Utils");var logger,message,ua,transport,requests=[],responses=[],all=[];requests.push(rfc3261_8_2_2_1);requests.push(rfc3261_16_3_4);requests.push(rfc3261_18_3_request);requests.push(rfc3261_8_2_2_2);responses.push(rfc3261_8_1_3_3);responses.push(rfc3261_18_3_response);all.push(minimumHeaders);function sanityCheck(m,u,t){var len,pass;message=m;ua=u;transport=t;logger=ua.getLogger("ExSIP.sanitycheck");len=all.length;while(len--){pass=all[len](message);if(pass===false){return false}}if(message instanceof SIPMessage.IncomingRequest){len=requests.length;while(len--){pass=requests[len](message);if(pass===false){return false}}}else if(message instanceof SIPMessage.IncomingResponse){len=responses.length;while(len--){pass=responses[len](message);if(pass===false){return false}}}return true}function rfc3261_8_2_2_1(){if(message.s("to").uri.scheme!=="sip"){logger.warn("Scheme ("+message.s("to").uri.scheme+") is not sip. Dropping the request",ua);reply(416);return false}}function rfc3261_16_3_4(){if(!message.to_tag){if(message.call_id.substr(0,5)===ua.configuration.exsip_id){logger.warn("Call_id ("+message.call_id+") is same as exsip ("+ua.configuration.exsip_id+"). Dropping the request",ua);reply(482);return false}}}function rfc3261_18_3_request(){var len=Utils.str_utf8_length(message.body),contentLength=message.getHeader("content-length");if(len<contentLength){logger.warn("Message body length ("+len+") is lower than the value in Content-Length header field ("+contentLength+"). Dropping the request",ua);reply(400);return false}}function rfc3261_8_2_2_2(){var tr,idx,fromTag=message.from_tag,call_id=message.call_id,cseq=message.cseq;if(message.to_tag){return}if(message.method===ExSIP_C.INVITE){if(ua.transactions.ist[message.via_branch]){return false}else{for(idx in ua.transactions.ist){tr=ua.transactions.ist[idx];if(tr.request.from_tag===fromTag&&tr.request.call_id===call_id&&tr.request.cseq===cseq){reply(482);return false}}}}else{if(ua.transactions.nist[message.via_branch]){return false}else{for(idx in ua.transactions.nist){tr=ua.transactions.nist[idx];if(tr.request.from_tag===fromTag&&tr.request.call_id===call_id&&tr.request.cseq===cseq){reply(482);return false}}}}}function rfc3261_8_1_3_3(){if(message.getHeaders("via").length>1){logger.warn("More than one Via header field present in the response. Dropping the response");return false}}function rfc3261_18_3_response(){var len=Utils.str_utf8_length(message.body),contentLength=message.getHeader("content-length");if(len<contentLength){logger.warn("Message body length is lower than the value in Content-Length header field. Dropping the response");return false}}function minimumHeaders(){var mandatoryHeaders=["from","to","call_id","cseq","via"],idx=mandatoryHeaders.length;while(idx--){if(!message.hasHeader(mandatoryHeaders[idx])){logger.warn("Missing mandatory header field : "+mandatoryHeaders[idx]+". Dropping the response");return false}}}function reply(status_code){var to,response="SIP/2.0 "+status_code+" "+ExSIP_C.REASON_PHRASE[status_code]+"\r\n",vias=message.getHeaders("via"),length=vias.length,idx=0;for(idx;idx<length;idx++){response+="Via: "+vias[idx]+"\r\n"}to=message.getHeader("To");if(!message.to_tag){to+=";tag="+Utils.newTag()}response+="To: "+to+"\r\n";response+="From: "+message.getHeader("From")+"\r\n";response+="Call-ID: "+message.call_id+"\r\n";response+="CSeq: "+message.cseq+" "+message.method+"\r\n";response+="\r\n";transport.send(response)}},{"./Constants":22,"./SIPMessage":41,"./Utils":47}],50:[function(require,module,exports){module.exports=Authentication;var events=require("./EventBus");function Authentication(element,options){this.popup=element;this.okButton=this.popup.find(".authPopupButton");this.userIdInput=this.popup.find("input.userid");this.authUserIdInput=this.popup.find("input.authUserid");this.passwordInput=this.popup.find("input.password");this.alert=this.popup.find(".alert");this.visible=false;this.options=options||{};this.registerListeners()}Authentication.prototype={registerListeners:function(){var self=this;events.on("registrationFailed",function(e){var statusCode=e.data.response.status_code;if(statusCode===403&&self.options.settingsUserId()&&!self.options.settingsPassword()||self.options.configurationRegister){self.setVisible(true)}});this.okButton.bind("click",function(){var userId=self.userIdInput.val();if(!userId){self.alert.text("Invalid User ID").fadeIn(10).fadeOut(4e3);return}var authUserId=self.authUserIdInput.val();var password=self.passwordInput.val();self.setVisible(false);self.options.onAuthenticate({userId:userId,authenticationUserId:authUserId,password:password});events.once("registered",function(){if(authUserId&&self.options.settingsUserId()!==authUserId){self.options.settingsAuthenticationUserId(authUserId)}self.options.settingsUserId(userId);self.options.settingsPassword(password)})});this.popup.bind("keypress",function(e){if(e.which===13){self.okButton.click()}})},show:function(){this.setVisible(true)},setVisible:function(visible){this.visible=visible;this.authUserIdInput.val(this.options.settingsAuthenticationUserId());this.userIdInput.val(this.options.settingsUserId());events.emit("viewChanged")}}},{"./EventBus":55}],51:[function(require,module,exports){module.exports=Client;var styles='.bdsft-reset{font-size:14px;font:normal normal 14px Open Sans,Arial,sans-serif}.bdsft-reset div,.bdsft-reset span,.bdsft-reset applet,.bdsft-reset object,.bdsft-reset iframe,.bdsft-reset h1,.bdsft-reset h2,.bdsft-reset h3,.bdsft-reset h4,.bdsft-reset h5,.bdsft-reset h6,.bdsft-reset p,.bdsft-reset blockquote,.bdsft-reset pre,.bdsft-reset a,.bdsft-reset abbr,.bdsft-reset acronym,.bdsft-reset address,.bdsft-reset big,.bdsft-reset cite,.bdsft-reset code,.bdsft-reset del,.bdsft-reset dfn,.bdsft-reset em,.bdsft-reset img,.bdsft-reset ins,.bdsft-reset kbd,.bdsft-reset q,.bdsft-reset s,.bdsft-reset samp,.bdsft-reset small,.bdsft-reset strike,.bdsft-reset strong,.bdsft-reset sub,.bdsft-reset sup,.bdsft-reset tt,.bdsft-reset var,.bdsft-reset b,.bdsft-reset u,.bdsft-reset i,.bdsft-reset center,.bdsft-reset dl,.bdsft-reset dt,.bdsft-reset dd,.bdsft-reset ol,.bdsft-reset ul,.bdsft-reset li,.bdsft-reset fieldset,.bdsft-reset form,.bdsft-reset div.form,.bdsft-reset label,.bdsft-reset legend,.bdsft-reset table,.bdsft-reset caption,.bdsft-reset tbody,.bdsft-reset tfoot,.bdsft-reset thead,.bdsft-reset tr,.bdsft-reset th,.bdsft-reset td,.bdsft-reset article,.bdsft-reset aside,.bdsft-reset canvas,.bdsft-reset details,.bdsft-reset figcaption,.bdsft-reset figure,.bdsft-reset footer,.bdsft-reset header,.bdsft-reset hgroup,.bdsft-reset menu,.bdsft-reset nav,.bdsft-reset section,.bdsft-reset summary,.bdsft-reset time,.bdsft-reset mark,.bdsft-reset audio,.bdsft-reset video,.bdsft-reset button,.bdsft-reset textarea,.bdsft-reset input{font-size:100%;font:normal normal 100% Open Sans,Arial,sans-serif}.bdsft-reset,.bdsft-reset div,.bdsft-reset span,.bdsft-reset applet,.bdsft-reset object,.bdsft-reset iframe,.bdsft-reset h1,.bdsft-reset h2,.bdsft-reset h3,.bdsft-reset h4,.bdsft-reset h5,.bdsft-reset h6,.bdsft-reset p,.bdsft-reset blockquote,.bdsft-reset pre,.bdsft-reset a,.bdsft-reset abbr,.bdsft-reset acronym,.bdsft-reset address,.bdsft-reset big,.bdsft-reset cite,.bdsft-reset code,.bdsft-reset del,.bdsft-reset dfn,.bdsft-reset em,.bdsft-reset img,.bdsft-reset ins,.bdsft-reset kbd,.bdsft-reset q,.bdsft-reset s,.bdsft-reset samp,.bdsft-reset small,.bdsft-reset strike,.bdsft-reset strong,.bdsft-reset sub,.bdsft-reset sup,.bdsft-reset tt,.bdsft-reset var,.bdsft-reset b,.bdsft-reset u,.bdsft-reset i,.bdsft-reset center,.bdsft-reset dl,.bdsft-reset dt,.bdsft-reset dd,.bdsft-reset ol,.bdsft-reset ul,.bdsft-reset li,.bdsft-reset fieldset,.bdsft-reset form,.bdsft-reset div.form,.bdsft-reset label,.bdsft-reset legend,.bdsft-reset table,.bdsft-reset caption,.bdsft-reset tbody,.bdsft-reset tfoot,.bdsft-reset thead,.bdsft-reset tr,.bdsft-reset th,.bdsft-reset td,.bdsft-reset article,.bdsft-reset aside,.bdsft-reset canvas,.bdsft-reset details,.bdsft-reset figcaption,.bdsft-reset figure,.bdsft-reset footer,.bdsft-reset header,.bdsft-reset hgroup,.bdsft-reset menu,.bdsft-reset nav,.bdsft-reset section,.bdsft-reset summary,.bdsft-reset time,.bdsft-reset mark,.bdsft-reset audio,.bdsft-reset video,.bdsft-reset button,.bdsft-reset textarea,.bdsft-reset input{font-family:Open Sans,Arial,sans-serif;font-size-adjust:none;font-style:normal;letter-spacing:normal;font-stretch:normal;font-variant:normal;font-weight:normal;text-align:left;text-align-last:start;text-decoration:none;text-emphasis:none;text-height:auto;text-indent:0;text-justify:auto;text-outline:0;text-shadow:none;text-transform:none;text-wrap:normal;alignment-adjust:auto;alignment-baseline:baseline;-webkit-animation:none 0 ease 0 1 normal;-moz-animation:none 0 ease 0 1 normal;-ms-animation:none 0 ease 0 1 normal;animation:none 0 ease 0 1 normal;-webkit-animation-play-state:running;-moz-play-state:running;-ms-animation-play-state:running;animation-play-state:running;appearance:normal;azimuth:center;backface-visibility:visible;background:none 0 0 auto repeat scroll padding-box transparent;background-color:transparent;background-image:none;baseline-shift:baseline;binding:none;bleed:6pt;bookmark-label:content();bookmark-level:none;bookmark-state:open;bookmark-target:none;border:0 none transparent;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0;bottom:auto;box-align:stretch;box-decoration-break:slice;box-direction:normal;box-flex:0;box-flex-group:1;box-lines:single;box-ordinal-group:1;box-orient:inline-axis;box-pack:start;-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;break-after:auto;break-before:auto;break-inside:auto;caption-side:top;clear:none;clip:auto;color:inherit;color-profile:auto;-webkit-column-count:auto;-webkit-column-fill:balance;-webkit-column-gap:normal;-webkit-column-rule:medium medium #1f1f1f;-webkit-column-span:1;-webkit-column-width:auto;-webkit-columns:auto auto;-moz-column-count:auto;-moz-column-fill:balance;-moz-column-gap:normal;-moz-column-rule:medium medium #1f1f1f;-moz-column-span:1;-moz-column-width:auto;-moz-columns:auto auto;column-count:auto;column-fill:balance;column-gap:normal;column-rule:medium medium #1f1f1f;column-span:1;column-width:auto;columns:auto auto;content:normal;counter-increment:none;counter-reset:none;crop:auto;cursor:auto;direction:ltr;display:inline;dominant-baseline:auto;drop-initial-after-adjust:text-after-edge;drop-initial-after-align:baseline;drop-initial-before-adjust:text-before-edge;drop-initial-before-align:caps-height;drop-initial-size:auto;drop-initial-value:initial;elevation:level;empty-cells:show;fit:fill;fit-position:0;float:none;float-offset:0;grid-columns:none;grid-rows:none;hanging-punctuation:none;height:auto;hyphenate-after:auto;hyphenate-before:auto;hyphenate-character:auto;hyphenate-lines:no-limit;hyphenate-resource:none;hyphens:manual;icon:auto;image-orientation:auto;image-rendering:auto;image-resolution:normal;inline-box-align:last;left:auto;line-height:inherit;line-stacking:inline-line-height exclude-ruby consider-shifts;list-style:disc outside none;margin:0;marks:none;marquee-direction:forward;marquee-loop:1;marquee-play-count:1;marquee-speed:normal;marquee-style:scroll;max-height:none;max-width:none;min-height:0;min-width:0;move-to:normal;nav-down:auto;nav-index:auto;nav-left:auto;nav-right:auto;nav-up:auto;opacity:1;orphans:2;outline:invert none medium;outline-offset:0;overflow:visible;overflow-style:auto;padding:0;page:auto;page-break-after:auto;page-break-before:auto;page-break-inside:auto;page-policy:start;perspective:none;perspective-origin:50% 50%;position:static;presentation-level:0;punctuation-trim:none;quotes:none;rendering-intent:auto;resize:none;right:auto;rotation:0;rotation-point:50% 50%;ruby-align:auto;ruby-overhang:none;ruby-position:before;ruby-span:none;size:auto;string-set:none;table-layout:auto;top:auto;-webkit-transform:none;-moz-transform:none;transform:none;-webkit-transform-origin:50% 50%;-moz-transform-origin:50% 50%;-o-transform-origin:50% 50%;transform-origin:50% 50% 0;transform-style:flat;-webkit-transition:all 0 ease 0;-moz-transition:all 0 ease 0;-o-transition:all 0 ease 0;transition:all 0 ease 0;unicode-bidi:normal;vertical-align:baseline;white-space:normal;white-space-collapse:collapse;widows:2;width:auto;word-break:normal;word-spacing:normal;word-wrap:normal;z-index:auto;text-align:start}.bdsft-reset address,.bdsft-reset blockquote,.bdsft-reset dd,.bdsft-reset div,.bdsft-reset dl,.bdsft-reset dt,.bdsft-reset fieldset,.bdsft-reset form,.bdsft-reset div.form,.bdsft-reset frame,.bdsft-reset frameset,.bdsft-reset h1,.bdsft-reset h2,.bdsft-reset h3,.bdsft-reset h4,.bdsft-reset h5,.bdsft-reset h6,.bdsft-reset noframes,.bdsft-reset ol,.bdsft-reset p,.bdsft-reset ul,.bdsft-reset center,.bdsft-reset dir,.bdsft-reset hr,.bdsft-reset menu,.bdsft-reset pre,.bdsft-reset article,.bdsft-reset aside,.bdsft-reset canvas,.bdsft-reset details,.bdsft-reset figcaption,.bdsft-reset figure,.bdsft-reset footer,.bdsft-reset header,.bdsft-reset hgroup,.bdsft-reset nav,.bdsft-reset section,.bdsft-reset summary{display:block}.bdsft-reset li{display:list-item}.bdsft-reset table{display:table}.bdsft-reset tr{display:table-row}.bdsft-reset thead{display:table-header-group}.bdsft-reset tbody{display:table-row-group}.bdsft-reset tfoot{display:table-footer-group}.bdsft-reset col{display:table-column}.bdsft-reset colgroup{display:table-column-group}.bdsft-reset td,.bdsft-reset th{display:table-cell}.bdsft-reset caption{display:table-caption}.bdsft-reset input,.bdsft-reset select{display:inline-block}.bdsft-reset b,.bdsft-reset strong,.bdsft-reset strong>*{font-weight:bold}.bdsft-reset textarea,.bdsft-reset input{cursor:text}.bdsft-reset textarea .bdsft-reset textarea::-webkit-input-placeholder,.bdsft-reset input .bdsft-reset textarea::-webkit-input-placeholder,.bdsft-reset textarea .bdsft-reset input::-webkit-input-placeholder,.bdsft-reset input .bdsft-reset input::-webkit-input-placeholder{background-color:inherit;color:inherit;font-family:Open Sans,Arial,sans-serif;font-size-adjust:none;font-size:100%;font-style:normal;letter-spacing:normal;font-stretch:normal;font-variant:normal;font-weight:normal;font:normal normal 100% Open Sans,Arial,sans-serif;text-align:left;text-align-last:start;text-decoration:none;text-emphasis:none;text-height:auto;text-indent:0;text-justify:auto;text-outline:0;text-shadow:none;text-transform:none;text-wrap:normal}.bdsft-reset textarea .bdsft-reset textarea:-moz-placeholder,.bdsft-reset input .bdsft-reset textarea:-moz-placeholder,.bdsft-reset textarea .bdsft-reset input:-moz-placeholder,.bdsft-reset input .bdsft-reset input:-moz-placeholder{background-color:inherit;color:inherit;font-family:Open Sans,Arial,sans-serif;font-size-adjust:none;font-size:100%;font-style:normal;letter-spacing:normal;font-stretch:normal;font-variant:normal;font-weight:normal;font:normal normal 100% Open Sans,Arial,sans-serif;text-align:left;text-align-last:start;text-decoration:none;text-emphasis:none;text-height:auto;text-indent:0;text-justify:auto;text-outline:0;text-shadow:none;text-transform:none;text-wrap:normal}.bdsft-reset textarea .bdsft-reset textarea::-moz-placeholder,.bdsft-reset input .bdsft-reset textarea::-moz-placeholder,.bdsft-reset textarea .bdsft-reset input::-moz-placeholder,.bdsft-reset input .bdsft-reset input::-moz-placeholder{background-color:inherit;color:inherit;font-family:Open Sans,Arial,sans-serif;font-size-adjust:none;font-size:100%;font-style:normal;letter-spacing:normal;font-stretch:normal;font-variant:normal;font-weight:normal;font:normal normal 100% Open Sans,Arial,sans-serif;text-align:left;text-align-last:start;text-decoration:none;text-emphasis:none;text-height:auto;text-indent:0;text-justify:auto;text-outline:0;text-shadow:none;text-transform:none;text-wrap:normal}.bdsft-reset textarea .bdsft-reset textarea:-ms-input-placeholder,.bdsft-reset input .bdsft-reset textarea:-ms-input-placeholder,.bdsft-reset textarea .bdsft-reset input:-ms-input-placeholder,.bdsft-reset input .bdsft-reset input:-ms-input-placeholder{background-color:inherit;color:inherit;font-family:Open Sans,Arial,sans-serif;font-size-adjust:none;font-size:100%;font-style:normal;letter-spacing:normal;font-stretch:normal;font-variant:normal;font-weight:normal;font:normal normal 100% Open Sans,Arial,sans-serif;text-align:left;text-align-last:start;text-decoration:none;text-emphasis:none;text-height:auto;text-indent:0;text-justify:auto;text-outline:0;text-shadow:none;text-transform:none;text-wrap:normal}.bdsft-reset input[type=checkbox],.bdsft-reset input[type=radio]{cursor:default}.bdsft-reset a,.bdsft-reset a *,.bdsft-reset a span,.bdsft-reset button,.bdsft-reset button *,.bdsft-reset button span,.bdsft-reset input[type=submit],.bdsft-reset input[type=reset]{cursor:pointer}.bdsft-reset a:link,.bdsft-reset a:visited,.bdsft-reset a:hover,.bdsft-reset a:active{color:inherit;background:transparent;text-shadow:none}.bdsft-reset button::-moz-focus-inner{border:0;padding:0}.bdsft-reset *[class^=\'bdsft-icon\']{font-family:FontAwesome!important}body{background-color:#fff;margin:0;font-family:\'Open Sans\',Arial,sans-serif;-webkit-font-smoothing:antialiased!important}.main{position:relative;top:0;left:0;width:100%}.main:-webkit-full-screen-ancestor:not(iframe){position:absolute!important;top:0;left:0;right:0;bottom:0;width:100%;height:100%}.client{position:relative;top:0;left:0}.client.r1280x720{width:1280px}.client.r960x720{width:960px}.client .table{display:table;width:100%}.client .fixed{table-layout:fixed}.client .collapse{border-collapse:collapse}.client .cell{display:table-cell}.client .heading{display:table-row;font-weight:bold}.client .row{display:table-row;margin:0}.client .group{display:table-row-group}.client .fadeable{opacity:0;display:block;z-index:-1;backface-visibility:hidden}.client::-webkit-scrollbar{width:8px}.client::-webkit-scrollbar-track,.client::-webkit-scrollbar-thumb{background:#272727}.client::-webkit-scrollbar-track:window-inactive,.client::-webkit-scrollbar-thumb:window-inactive{background:#272727}.client.view-centered{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);backface-visibility:hidden}.client.r640x360,.client.r640x480{width:640px}.client.r320x180,.client.r320x240{width:320px}.full-screen-expanded.client{width:100%!important;height:100%!important}.full-screen-expanded .main{height:100%}.button:active{color:#04aff0;background:-webkit-gradient(linear,left top,right bottom,from(#7cdd07),to(#faa51a));background:linear-gradient(to bottom left,#7cdd07,#faa51a)}.button:hover{box-shadow:0 0 10px #999}.popup{display:none;background:#333;padding:10px;border:2px solid #ddd;float:left;position:absolute;top:0;bottom:0;left:0;right:0;margin:auto;box-shadow:0 0 10px #999;border-radius:3px;font-size:14px;line-height:18px;z-index:100}.popup .actions{text-align:right}.popup .title{font-weight:bold;font-size:16px;color:#fff}.ui-widget-content.ui-dialog{display:none;color:#999;font-size:22px;background:#333;padding:10px;border:2px solid #ddd;box-shadow:0 0 10px #999;border-radius:3px;z-index:99}.no-close .ui-dialog-titlebar-close{display:none}.unsupported{position:absolute;top:240px;left:30px;width:600px;background-color:#191414;text-align:center;display:none;color:#fff;z-index:10}#screen_sharing_unsupported{position:relative;top:0;left:0;margin:10px;background:#f00}#screen_sharing_unsupported{display:none}#screen_sharing_unsupported span{text-decoration:underline}.client .row:before,.client .row:after{display:none}.historyRowSample{display:none}.client.view-audioOnly{display:inline-block;width:auto}.default-color{color:#2ba6cb}[id$="sample"]{display:none!important}#javascript_disabled{display:block;background-color:#fff;color:#000}a.disabled{pointer-events:none;cursor:default;background-color:#999;opacity:.5}.callHistory{display:none;position:absolute;width:200px;height:258px;right:auto;left:200px;bottom:40px;top:auto;background:#292929;overflow:hidden;background-color:#292929;border-radius:0;border:1px solid #3c3c3c;box-shadow:none;color:#999;z-index:200;padding:0}.callHistory .rowSpace{padding:.5em}.callHistory .actions{margin-top:12px}.callHistory .content{padding:16px 0 10px 0;height:68%;width:200px;overflow:auto;margin-bottom:10px}.history-row:hover,.history-row.active{background:#353535}.history-row{cursor:pointer;position:relative}.row{display:block;margin:0;position:relative;height:46px}.row .hist-direction{position:absolute;color:#3da005;left:3px;font-family:arial;font-size:18px;top:6px}.row .hist-direction .icon-arrow-down-thick{color:#e9651d}.row .hist-destination{position:absolute;color:#b3b3b3;left:25px;font-family:arial;font-size:18px;text-decoration:none;top:6px}.row .hist-date{position:absolute;color:#0082ff;left:20px;font-family:arial;font-size:10px;position:absolute;color:#b3b3b3;left:26px;font-family:arial;font-size:10px;top:29px}.row .hist-length{position:absolute;color:#0082ff;left:205px;font-family:arial;font-size:10px;position:absolute;color:#b3b3b3;left:104px;font-family:arial;font-size:10px;top:29px}.hist-details-arrow{position:absolute;right:8px;font-size:16px;top:14px}.classHistoryActions{padding-top:2px}.historyClear a{text-decoration:none;color:#fff;font-size:14px;font-weight:700;background:#6f6f6f;border-radius:20px;padding:5px 10px;margin-left:15px}.historyClear a:hover{background:#4e4e4e}.historyClose a{color:#04aff0;font-size:14px;font-weight:700;text-decoration:none;margin-left:8px}.historyClose a:hover{color:#017ead}.callHistoryDetails{background:#fff;width:194px;height:auto;border:0;clear:both;top:0;bottom:-1;left:201px;right:auto;box-shadow:none;border-radius:0;background:#292929;border:1px solid #3c3c3c;border-top:0;overflow:auto}.callHistoryDetails .callLink{text-align:left;background:#6f6f6f;float:left;padding:6px 10px 6px 10px;text-decoration:none;font-weight:bold;color:#fff!important;border-radius:50px;font-size:14px!important}.callHistoryDetails .historyDetailsClose{text-align:right;margin-top:10px;text-align:right;margin-top:10px;display:inline-block!important;height:26px;margin-top:0}.callHistoryDetails .historyDetailsClose .icon-ok{margin:0}.callHistoryDetails .historyDetailsClose a{text-decoration:none;outline-color:rgba(0,0,0,0);color:#aaa;font-size:18px}.callHistoryDetails .table{font-size:13px;padding-left:8px}.callHistoryDetails .table #history-dt-close-container{text-align:right}.callStats{display:none;position:absolute;top:10px;left:660px;width:400px;top:auto;bottom:40px;right:0;left:auto;background-color:#292929;border-radius:0;border:1px solid #3c3c3c;box-shadow:none;color:#999;z-index:200;padding:10px}.callStats .statsVideo{position:absolute;white-space:pre-wrap;color:#0082ff;left:10px;font-family:arial;font-size:18px;text-decoration:none}.callStats .statsAudio{position:absolute;white-space:pre-wrap;color:#0082ff;left:260px;float:left;font-family:arial;font-size:18px;text-decoration:none}.callStats a{color:#2ba6cb}.callStats .spacer{height:15px}.callStats .statsDelay{display:none}.stats-table-container,.stats-graph-sub-container{display:none}.stats0-selected .kiloBitsSentPerSecond-video,.stats1-selected .kiloBitsSentPerSecond-audio,.stats2-selected .kiloBitsReceivedPerSecond-video,.stats3-selected .kiloBitsReceivedPerSecond-audio,.stats4-selected .packetsLost-video,.stats5-selected .packetsLostPer-video,.stats6-selected .packetsLost-audio,.stats7-selected .packetsLostPer-audio,.stats8-selected .googFrameRateSent-video,.stats9-selected .googFrameRateReceived-video,.stats10-selected .audioOutputLevel-audio,.stats11-selected .audioInputLevel-audio,.stats12-selected .googFrameWidthReceived-video,.stats13-selected .googFrameHeightReceived-video,.stats14-selected .googFrameWidthSent-video,.stats15-selected .googFrameHeightSent-video,.stats16-selected .googRtt-audio,.stats17-selected .googJitterReceived-audio{display:block}.callStats{color:<%= statsColor %>}.stats-graph-sub-container canvas{width:100%}.stats-container{margin-bottom:18px}.dialpad{padding:15px;background:#292929;border:1px solid #3c3c3c;display:none;position:absolute;bottom:40px;right:auto;width:170px;top:auto;left:0;letter-spacing:5px;z-index:100;box-sizing:content-box;height:228px;padding-left:14px}.dialpad button{color:#333;opacity:.8;font-family:arial;font-size:20px;width:30px;border-color:#000;border-width:1px;border-radius:4px;border-spacing:5em;font-weight:bold;line-height:33px;margin:.1em;border-top-style:outset;cursor:pointer;color:#b3b3b3;background:0;border-radius:0;font-weight:normal;padding:0;margin:0;border:0;width:50px}.dialpad button:active{color:#04aff0;background:-webkit-gradient(linear,left top,left bottom,from(#f47a20),to(#faa51a));background:linear-gradient(to left bottom,#f47a20,#faa51a)}.dialpad button:hover{box-shadow:1px 1px 20px #999;background:#3a3a3a;box-shadow:none}.dialpad button:focus{outline:0}.dialpad button span{display:block;font-size:8px;text-align:center;font-weight:bold;margin-top:-13px;color:#2d7b99}.dialpad .btn-star{font-size:30px;vertical-align:middle}.dialpad .history-button{font-size:16px!important;padding-top:5px;padding-bottom:5px;outline:0;position:absolute;right:4px;top:5px;width:25px}.dialpad .history-button.active{color:#04aff0}.dialpad-control-bar{margin-top:6px}.dialpad-control-bar .main-button{background:#3da005;border-radius:14px;width:70px;padding:5px;margin:0 auto}.dialpad-control-bar a{color:#fff;text-decoration:none;text-align:center;width:100%;display:inline-block;font-size:14px;font-weight:700;letter-spacing:1}.dialpad-control-bar a span{margin-right:5px}.view-audioOnly .dialpad{top:45px}.callControl{display:none;position:relative;left:0;top:0;height:75px;color:#666;font-family:arial;font-size:18px;font-weight:bold;height:auto;display:block}.callControl .destination::-webkit-input-placeholder{color:#04aff0;font-style:italic;padding-left:5px;font-weight:400}.callControl hr{border:0;border-bottom:1px solid #3c3c3c}.callControl input{background:#333;border:1px solid #3c3c3c;color:#d3d3d3;font-family:arial;font-size:18px;padding:0;border-radius:0;width:171px;line-height:30px;padding-left:8px;padding-right:35px}.callControl input:focus{outline:0}.callPopup{padding:0;background:#292929;border:1px solid #3c3c3c;box-shadow:none;width:220px;border-radius:0;height:168px}.callPopup span{color:#999;font-size:22px}.callPopup .incomingCallTitle{display:block;padding:8px;font-size:18px;font-weight:bold;background:#3c3c3c;margin-bottom:18px;color:#e4e4e4}.callPopup .acceptIncomingCall{background:#3da005;border:0;border-radius:20px;padding:5px 10px;font-size:14px;color:#fff;margin-left:12px}.callPopup #rejectIncomingCallContainer{text-align:right}.callPopup #rejectIncomingCallContainer button{background:#f00;border:0;border-radius:20px;padding:5px 10px;font-size:14px;color:#fff;margin-right:12px}.started .holdAndAnswerButton,.started .dropAndAnswerButton,.client:not(.started) .acceptIncomingCall{display:inline-block}.holdAndAnswerButton,.dropAndAnswerButton,.acceptIncomingCall{display:none}.callPopup,.reInvitePopup{width:170px;height:137px}.transferPopup{color:#fff;width:280px;height:60px}.transferTarget{width:200px}.call{display:none;position:absolute;z-index:10;top:25px;left:265px;display:block;position:static;top:auto;left:auto}.incomingCallName,.incomingCallUser{display:block;margin-left:10px;margin-bottom:18px}.reInvite .reInvitePopup,.incomingCall .callPopup{transition:all 1s linear;opacity:1;z-index:100}.reInvite-done .reInvitePopup{transition:all 1s linear;opacity:0;z-index:-1}.client:not(.connected) .call{transition:all 1s linear;opacity:0;z-index:-1}.video{position:relative;top:0;left:0;width:100%;height:auto}.video:-webkit-full-screen{position:absolute;height:100%;border:0;z-index:1}.remoteVideo{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background-color:#191414;border-radius:4px;border:2px solid #ddd;box-shadow:0 0 10px #000;border-radius:0;border:0;box-shadow:0 0 1px rgba(0,0,0,0.05);background:#000;background:-moz-linear-gradient(top,#181818 0,#494949 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,#181818),color-stop(100%,#494949));background:-webkit-linear-gradient(top,#181818 0,#494949 100%);background:-o-linear-gradient(top,#181818 0,#494949 100%);background:-ms-linear-gradient(top,#181818 0,#494949 100%);background:linear-gradient(to bottom,#181818 0,#494949 100%);overflow:hidden}.localVideo{display:none;position:absolute;top:auto;left:0;bottom:0;right:auto;width:25%;height:25%;background-color:transparent;z-index:99}.localVideo video{border-radius:0;box-shadow:none;background:#292929;border:1px solid #3c3c3c;cursor:move;width:100%;height:100%;position:absolute}.localVideo .inner{margin:5px;position:absolute;top:0;bottom:0;right:0;left:0}.full-screen-expanded .video{padding-bottom:0;bottom:40px;position:absolute;height:auto!important}.widescreen .video{padding-bottom:56.25%}.standard .video{padding-bottom:75%}:-webkit-full-screen .remoteVideo{z-index:1}:-webkit-full-screen .localVideo{z-index:2}:-webkit-full-screen .remoteVideo,:-webkit-full-screen .localVideo{border:0;border-radius:0}.started .watermark-icon{display:none;transform:none;box-shadow:0 0 1px rgba(0,0,0,0.05)}.started .remoteVideo{box-shadow:0 0 1px rgba(0,0,0,0.1)}.connected .watermark-icon{box-shadow:0 0 1px rgba(0,0,0,0.05)}.selfView-bl .localVideo{top:auto;bottom:0;left:0;right:auto}.selfView-tl .localVideo{top:0;bottom:auto;left:0;right:auto}.selfView-tr .localVideo{top:0;bottom:auto;left:auto!important;right:0}.selfView-br .localVideo{top:auto;bottom:0;left:auto!important;right:0}.selfView-1x .localVideo{width:25%;height:25%}.selfView-2x .localVideo{width:50%;height:50%}.view-audioOnly .video{display:none!important}.videoBar{display:none;position:relative;top:0;left:0;width:100%;height:40px;background:#000;background-image:-ms-linear-gradient(center top,#404040,#000);background-image:linear-gradient(to bottom,#404040,#000);background-image:-webkit-linear-gradient(#404040,#000);background-image:-moz-linear-gradient(top,#404040,#000);border-radius:4px;border:2px solid #ddd;box-shadow:0 0 10px #000;margin-top:5px;background-image:none;border-radius:0;border:0;box-shadow:none;margin-top:0;background:#292929;border-top:1px solid #3c3c3c}.videoBar .icon{z-index:10;margin:0 2.5px;position:absolute}.videoBar .table{height:100%;margin:6px;margin:0}.videoBar .cell{position:relative;top:0;left:0;width:35px;width:36px}.videoBar .cell .icon{width:100%;text-align:center;margin-top:10px;margin-right:0;margin-left:0}.videoBar .cell .icon a{margin:0}.videoBar .cell:first-child{padding:0}.videoBar span{color:#808080}.videoBar .unmuteAudio{margin-top:-1px}.videoBar .leftSpacer{width:8px}.videoBar .cell-hangup{width:42px}.videoBar .subtitle{display:none}.videoBar .cell-timer{position:relative;top:0;left:0;width:auto}.videoBar .rightSpacer{width:8px}.full-screen-expanded .videoBar{top:auto!important;bottom:0;position:absolute}.hangup,.fullScreen,.selfView,.muteAudioIcon,.dialpadIcon,.messages{top:0;left:0}#videoBar #settings{width:auto;background-color:transparent}.view-audioOnly .videoBar{display:inline-block;width:auto}.view-audioOnly .videoBar .table{table-layout:auto;width:auto}.view-audioOnly .cell-hangup{width:35px!important}.view-conference .cell-hangup{width:30px!important;top:2px}.view-conference .videoBar .cell .hangup{margin-top:0;width:140px;background-color:#f00;border-radius:5px;margin-left:10px;height:36px;line-height:14px}.view-conference .hangup .subtitle{display:block!important;font-size:14px;color:#fff}.videoBar .icon,.videoBar a{font-size:20px;color:#808080;text-decoration:none}.videoBar .hold,.videoBar .resume{margin-top:-1px}.settingsPopup{display:none;background:#333;padding:2px;border:2px solid #ddd;position:absolute;top:5px;left:5px;overflow-x:hidden;overflow-y:scroll;width:435;height:180;box-shadow:0 0 10px #999;border-radius:3px;font-size:20px;line-height:28px;z-index:99;border:1px solid #3c3c3c;background:#292929;border-radius:0;box-shadow:none;bottom:40px;right:0;top:auto;left:auto;width:304px!important;font-size:14px;height:276px;overflow:hidden}.settingsPopup span{color:#999;font-size:20px;font-size:14px}.settingsPopup [type="checkbox"]{width:18;height:18;vertical-align:middle}.settingsPopup .short{width:36px}.settingsPopup input{background:#333;border:1px solid #414141;color:#eee;padding-left:5px;line-height:22px;font-size:13px;margin-left:14px}.settingsPopup select{margin-left:14px}.settingsPopup .tabs span{margin-right:5px;color:#fff}.settingsPopup .btn{background:#04aff0;color:#fff;padding:5px 10px;text-decoration:none;border-radius:20px;margin-left:9px;margin-top:15px;font-weight:700;text-align:center}.settingsPopup .btn:hover{background:#017ead}.settingsPopup .clear{display:inline-block;color:#04aff0;margin-left:10px;text-decoration:none;font-weight:700}.settingsPopup .clear:hover{color:#017ead}.settingsPopup .saveSettings{display:inline-block}.resolutionSubType{display:none}.tabs{width:250px;padding-left:0}li{list-style:none;display:inline}a{padding:5px 10px;display:inline-block;background:#494949;color:#fff;text-decoration:none}a.active{background:#04aff0;color:#fff}.tabs ~div p,.tabs ~div h3{margin-bottom:15px;color:#999;font-size:14px}.tabs ~ div{padding:10px;margin-bottom:10px}.enable-mute.unmuted.started .muteAudioIcon,.enable-mute.muted.started .unmuteAudioIcon,.enable-full-screen.full-screen-contracted .fullScreenExpand,.enable-full-screen.full-screen-expanded .fullScreenContract,.enable-self-view.self-view-enabled .selfViewDisable,.enable-self-view.self-view-disabled .selfViewEnable,.enable-self-view.self-view-enabled .localVideo,.enable-dialpad.dialpad-shown .dialpadIconHide,.enable-dialpad.dialpad-hidden .dialpadIconShow,.enable-call-control.connected .call,.enable-transfer.started .transfer,.enable-timer.started .timer,.client:not(.held).enable-hold.started .hold,.enable-hold.started.held .resume,.enable-screen-sharing.screen-sharing-off .shareScreen,.enable-screen-sharing.screen-sharing .stopShareScreen,.enable-file-share.started .file_share,.enable-settings .settings{transition:all 1s linear;opacity:1;z-index:20}.enable-transfer.started.transfer-visible .transferPopup,.enable-dialpad.dialpad-shown .dialpad,.enable-settings.settings-shown .settingsPopup{transition:all 1s linear;opacity:1;z-index:100}.enable-screen-sharing.screen-sharing .shareScreen,.enable-screen-sharing.screen-sharing-off .stopShareScreen,.enable-mute.connected .muteAudioIcon,.enable-mute.disconnected .muteAudioIcon,.enable-mute.connected .unmuteAudioIcon,.enable-mute.disconnected .unmuteAudioIcon,.enable-mute.muted .muteAudioIcon,.enable-mute.unmuted .unmuteAudioIcon,.enable-full-screen.full-screen-expanded .fullScreenExpand,.enable-full-screen.full-screen-contracted .fullScreenContract,.enable-self-view.self-view-disabled .selfViewDisable,.enable-self-view.self-view-enabled .selfViewEnable,.enable-self-view.self-view-disabled .localVideo,.enable-dialpad.dialpad-hidden .dialpadIconHide,.enable-dialpad.dialpad-shown .dialpadIconShow,.enable-dialpad.dialpad-hidden .dialpad,.enable-transfer.connected .transfer,.enable-transfer.disconnected .transfer,.enable-transfer.transfer-hidden .transferPopup,.enable-settings.settings-hidden .settingsPopup{transition:all 1s linear;opacity:0;z-index:-1}.enable-file-share .fileshare-container{display:table}.settings{margin-top:12px!important}.settings .icon-settings{margin:0;font-size:18px;color:#fff}.client:not(.enable-mute) .cell-muteAudio,.client:not(.enable-transfer) .cell-transfer,.client:not(.enable-hold) .cell-hold,.client:not(.enable-timer) .cell-timer,.client:not(.enable-full-screen) .cell-fullScreen,.client:not(.enable-self-view) .cell-selfView,.client:not(.enable-settings) .cell-settings,.client:not(.enable-dialpad) .cell-dialpad,.client:not(.enable-shareScreen) .cell-shareScreen,.client:not(.enable-call-control) .callControl{display:none!important}.whiteboard{display:none;position:absolute;top:40px;left:378px}.simple_sketch{border-radius:4px;border:2px solid #ddd;box-shadow:0 0 10px #999}background-color white .tools{padding-bottom:10px}background-color white .tools a{border:1px solid #000;height:30px;line-height:30px;padding:0 10px;vertical-align:middle;text-align:center;text-decoration:none;display:inline-block;color:#000;font-weight:bold}background-color white .tools a.selected{border-color:#f00;border-width:3px}#whiteboard_unsupported{position:relative;top:0;left:0;margin:10px;background:#f00}@font-face{font-family:\'Exario-Icon-Fonts\';src:url("../fonts/Exario-Icon-Fonts.eot?") format("embedded-opentype")}@font-face{font-family:\'Exario-Icon-Fonts\';src:url("data:application/font-woff;base64,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") format("woff"),url("data:application/x-font-ttf;base64,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") format("truetype"),url("../fonts/Exario-Icon-Fonts.svg#Exario-Icon-Fonts") format("svg");font-weight:normal;font-style:normal}@font-face{font-family:\'bsl_icons\';src:url("../fonts/bsl_icons.eot?") format("embedded-opentype")}@font-face{font-family:\'bsl_icons\';src:url("data:application/font-woff;base64,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N3JgWV1XfTGc+xSMgoiFgoeIiomKiYuFi4aOh5CHkIeRh5KHkYOYgZ+AnoGeg54Ig52EoYSkhaSHoougi56MnIybjZuNnY+dj52RnJGakpqUm5ablpuYmZqXmpedl6CWCKCWo5Slk6aSqZGuj62PsI60iwjmi4v3AQWLm5OXmpGQjY+MkIuVi5OHk4QI92/7bwWSg4+Di4GLgYeChIQIDvtv+bn3hhWLgYl+h3qHeod+h4KDeHR3ZHVneGiBaIuBi4GMgYyBjICOf45/j4KNhY6FjYCPfJAIfJGCjoeNZphpm26dWqlZtFe/V79ivm27eal7rH2wio+IlIWahZuIlYiRiZGJlIeXCIiXiJaKlYqVipWLlYuula6er6CyoKKek5SPmI+cj5uPmY2Vi5CLj4qOipKJlXyYcQiQg5CBk36SfZF/koCRgZGAkIKMiY+HkIORg4+EjoWNho2Fi4aLg4WCgH+AgICBfoEIfoF/gYCBgYCFgouEi4iMh42GjYWNiIyIjIiOh4+Ej4WNh4uKqFetXrBmsGa4ar9uCIyKj4mRh5GHkIiOio2Kj4mQiZGJj4qOi5KLlJGWlpWVlZeVmJSYlpeWlZeWlJGTiwiQi5GJkImRiJGHk4WThpCIjYmUhpWFloWWhZeEmYSYg5WGkoemfZqBjYSMiYyHi4UIDv0m9+j4JhWLhomHh4cI+577ngWHh4eJhouGi4eNh48IbqcFh4+JkIuQi5CNj4+PCPd193T7dfd1BYePiY+LkIuQjY+PjwioqAWPj4+MkIuQi4+Kj4cI9577nwWPiI2Gi4YIDviU+fQV+3qL+077Tov7eov7evdO+073eov3eov3TvdOi/d6i/d6+073Tvt6iwj3fPu+FfvD+8MFg4N/i4OTCIWRi4v7O/c8BYOTi5eTkwi0tAWTk5eLk4MI9wr7C/eM94wFk5OXi5ODCLRiBZODi3+DgwgO+JSrFft6i/tO906L93qL93r3TvdO93qL93qL9077Tov7eov7evtO+077eosI91P4rRWTk4uYg5MIYLUFg5N/i4ODCPsM+wz7DfcMBYOTf4uDgwhgYQWEg4t+koMI9w37DPsN+wwFhIOLfpKDCLZhBZODl4uTkwj3DfcM9wz7DAWTg5eLk5MItrUFk5OLmIOTCPsN9wz3DfcMBQ74hPnkFft6i/tO+06L+3qL+3r3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") format("woff"),url("data:application/x-font-ttf;base64,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") format("truetype"),url("../fonts/bsl_icons.svg#bsl_icons") format("svg");font-weight:normal;font-style:normal}.client [class^="icon-"],.client [class*=" icon-"]{font-family:\'bsl_icons\';speak:none;font-style:normal;font-weight:normal;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.quality{display:none;position:absolute;z-index:10;top:13px;left:15px}.icon-quality:before{color:#0f0;opacity:.4}.connection-status{display:none;position:absolute;top:13px}.connected-icon{right:5px}.registered-icon{right:40px}.icon{cursor:pointer}.icon a{speak:none;text-decoration:none;margin:0 .35em 0 0;font-size:25px}.icon a:before{color:#fff}.icon-trash:before{content:"\\e013";color:#f00}.icon-screen-sharing:before{content:"\\e604"}.icon-screen-sharing-off:before{content:"\\e605"}.icon-quality1:before{content:"\\e007"}.icon-quality2:before{content:"\\e006"}.icon-quality3:before{content:"\\e005"}.icon-quality4:before{content:"\\e004"}.icon-link:before{content:"\\e00b"}.icon-dialpadShow:before,.icon-dialpadShow:hover:before,.icon-dialpadHide:before,.icon-dialpadHide:hover:before{content:"\\ed3b"}.icon-hangup:before,.icon-hangup:hover:before{content:"\\e600"}.icon-clock:before{content:"\\e634"}.client .icon-cog:before,.icon-settings:before,.icon-settings:hover:before{content:"\\e601"}.icon-resume:before,.icon-resume:hover:before,.icon-hold:before,.icon-hold:hover:before{content:"\\e6bb"}.icon-unmuteAudio:before,.icon-unmuteAudio:hover:before{content:"\\e6c1"}.icon-muteAudio:before,.icon-muteAudio:hover:before{content:"\\e6c3"}.icon-arrow-up-thick:before{content:"\\f5a4"}.icon-arrow-down-thick:before{content:"\\f5a5"}.icon-cancel3:before{content:"\\f2c9"}.icon-fullScreenContract:before,.icon-fullScreenContract:hover:before,.icon-fullScreenExpand:before,.icon-fullScreenExpand:hover:before{content:"\\f371"}.icon-th:before{content:"\\e602"}.icon-selfViewEnable:before,.icon-selfViewEnable:hover:before,.icon-selfViewDisable:before,.icon-selfViewDisable:hover:before{content:"\\f17f"}.icon-transfer:before,.icon-transfer:hover:before{content:"\\f186"}.icon-angle-right:before{content:"\\f1fe"}.icon-link.exario,.icon-quality1.exario,.icon-quality2.exario,.icon-quality3.exario,.icon-quality4.exario{font-family:\'Exario-Icon-Fonts\'!important;font-size:20px!important}.icon-call:before{content:"\\e00e";color:#3b9e3b}.icon-hangup:before{content:"\\e00f";color:#f00}.view-conference .icon-hangup:before,.view-conference .icon-hangup:hover:before{color:#fff!important}.view-conference .selfViewDisable,.view-conference .selfViewEnable{text-align:right!important}.view-conference .fullScreenExpand,.view-conference .fullScreenContract{text-align:left!important}.view-audioOnly .fullScreenExpand,.view-audioOnly .fullScreenContract,.view-audioOnly .selfViewDisable,.view-audioOnly .selfViewEnable,.view-audioOnly .quality1,.view-audioOnly .quality2,.view-audioOnly .quality3,.view-audioOnly .quality4,.view-audioOnly .cell-fullScreen,.view-audioOnly .cell-selfView{display:none!important}.selfViewEnable a,.dialpadIconHide a,.unmuteAudio a,.fullScreenContract a{color:#04aff0!important}.watermark-icon{position:absolute;top:50%;left:50%;backface-visibility:hidden;transform:translate(-50%,-50%);color:rgba(255,255,255,0.08);z-index:1;font-size:265px;text-align:center;width:100%}.started .hangup,.calling .hangup{transition:all 1s linear;opacity:1;z-index:20}.connected .hangup,.disconnected .hangup,.client.held .hold,.client:not(.started) .hold,.client:not(.held) .resume,.client:not(.started) .resume{transition:all 1s linear;opacity:0;z-index:-1}.icon-highlightable:hover{color:<%= iconHightlightColor %>}.icon a:hover,.icon span:hover,.videoBar a:hover{color:<%= iconHightlightColor %>}.sms{display:none;position:absolute;top:10px;right:10px}.sms .smsView{padding:10px;border-radius:4px;border:2px solid #ddd;box-shadow:0 0 10px #999}.sms .smsLoginForm{width:250px}.sms .smsSendForm{width:600px;display:none}.sms .smsSendBody{width:339px}.sms .smsInbox{width:600px;display:none}.sms .smsInbox .inner{max-height:250px;overflow:auto}.sms .smsInbox .cell{padding:5px}.sms .smsInbox .from{width:100px}.sms .smsInbox .status{width:50px}.sms .smsInbox .time{width:135px}.sms .smsInbox .body{word-wrap:break-word}.sms .smsInbox .body>div{display:none}.sms .smsInbox .sms-inbox-item.image .body .image span{margin-right:5px}.sms .smsInbox .actions{width:15px}.sms .smsInbox .icon-trash{font-size:15px}.sms .smsStatus{display:none;text-align:right}.sms .smsStatus .content{text-align:right;border:1px solid #c3c3c3;background-color:#e3e2e2;font-size:70%;padding:1px 3px;border-top:0;margin-right:15px;border-bottom-right-radius:4px;border-bottom-left-radius:4px}.sms .smsStatus.error{color:#f00}.sms .smsInbox .sms-inbox-item.text .body .text,.sms .smsInbox .sms-inbox-item.image .body .image,.sms .smsInbox .sms-inbox-item.video .body .video,.sms .smsInbox .sms-inbox-item.audio .body .audio{display:block}.sms .smsInbox .sms-inbox-item.audio .body .audio audio,.sms .smsInbox .sms-inbox-item.video .body .video video{width:100%}.smsInbox .content{display:table-row-group}authPopup{width:210px;height:200px}authPopup span{color:#999;font-size:14px;line-height:18px}authPopup input{background:#666;border-bottom:1px solid #333;border-left:1px solid #000;border-right:1px solid #333;border-top:1px solid #000;color:#fff;border-radius:3px;font-family:arial;font-size:16px;padding:6px 6px 4px;width:200px}authPopup button{border-color:#999;border-width:1px;border-radius:4px;color:#333;cursor:pointer;padding:6px 6px 4px;margin-top:10px;font-size:12px;width:200px}authPopup #alert{font-size:20px;text-align:center;color:#f00}.sign-in,.sign-out{display:none}.client:not(.registered) .sign-in,.client.registered .sign-out{display:block}.client:not(.disconnected).auth-visible .authPopup{transition:all 1s linear;opacity:1;z-index:100}.client.disconnected .authPopup,.client.auth-hidden .authPopup{transition:all 1s linear;opacity:0;z-index:-1}.timer{display:none;position:absolute;top:3px;left:0;width:100%;text-align:center;font-family:arial;font-size:16px;top:11px}.timer{color:<%= timerColor %>}.view-audioOnly .timer{position:relative;margin-right:10px}.client:not(.started) .timer{transition:all 1s linear;opacity:0;z-index:-1}.messages{position:absolute;font-family:arial;text-align:left;width:auto;font-size:12px;bottom:auto;top:10px;left:10px}.view-audioOnly .messages{left:10px!important;top:48px!important;font-weight:bold;font-size:14px}.normal{color:<%= infoMessageColor %>}.success{color:<%= successMessageColor %>}.warning{color:<%= successMessageColor %>}.alert{color:<%= alertMessageColor %>}.fileshare-container{display:none}.client:not(.started) .file_share{transition:all 1s linear;opacity:0;z-index:-1}';
var templates=require("../js/templates");var ejs=require("ejs");var events=require("./EventBus");var debug=require("debug")("client");var debugerror=require("debug")("client:ERROR");debugerror.log=console.warn.bind(console);var Configuration=require("./Configuration");var SIPStack=require("./SIPStack");var Video=require("./Video");var Sound=require("./Sound");var XMPP=require("./XMPP");var SMS=require("./SMS");var Settings=require("./Settings");var Stats=require("./Stats");var Timer=require("./Timer");var History=require("./History");var Transfer=require("./Transfer");var Whiteboard=require("./Whiteboard");var FileShare=require("./FileShare");var Authentication=require("./Authentication");var Icon=require("./Icon");var WebRTC_C=require("./Constants");var Utils=require("./Utils");var ExSIP=require("exsip");var ClientConfig=require("../js/client-config.js.default");function Client(config,element){this.config=config;if(element){this.appendTo($(element))}}Client.prototype={setup:function(){var self=this;this.main=this.client.find(".main");this.muteAudioIcon=this.client.find(".muteAudioIcon");this.unmuteAudioIcon=this.client.find(".unmuteAudioIcon");this.hangup=this.client.find(".hangup");this.callControl=this.client.find(".callControl");this.destination=this.callControl.find("input.destination");this.callButton=this.client.find(".call");this.reInvitePopup=this.client.find(".reInvitePopup");this.acceptReInviteCall=this.client.find(".acceptReInviteCall");this.rejectReInviteCall=this.client.find(".rejectReInviteCall");this.messages=this.client.find(".messages");this.callPopup=this.client.find(".callPopup");this.incomingCallName=this.callPopup.find(".incomingCallName");this.incomingCallUser=this.callPopup.find(".incomingCallUser");this.acceptIncomingCall=this.callPopup.find(".acceptIncomingCall");this.rejectIncomingCall=this.callPopup.find(".rejectIncomingCall");this.holdAndAnswerButton=this.callPopup.find(".holdAndAnswerButton");this.dropAndAnswerButton=this.callPopup.find(".dropAndAnswerButton");this.errorPopup=this.client.find(".errorPopup");this.fullScreenExpandIcon=this.client.find(".fullScreenExpand");this.fullScreenContractIcon=this.client.find(".fullScreenContract");this.dialpadShowIcon=this.client.find(".dialpadIconShow");this.dialpadHideIcon=this.client.find(".dialpadIconHide");this.dialpad=this.client.find(".dialpad");this.dialpadButtons=this.client.find(".dialpad button");this.selfViewEnableIcon=this.client.find(".selfViewEnable");this.selfViewDisableIcon=this.client.find(".selfViewDisable");this.connected=this.client.find(".connected-icon");this.registered=this.client.find(".registered-icon");this.historyClose=this.client.find(".historyClose");this.callHistory=this.client.find(".callHistory");this.callStats=this.client.find(".callStats");this.shareScreen=this.client.find(".shareScreen");this.stopShareScreen=this.client.find(".stopShareScreen");this.screenSharingUnsupported=this.client.find(".screen_sharing_unsupported");this.config=this.config||Utils.clone(ClientConfig);this.configuration=new Configuration(this.config);this.sipStack=new SIPStack(this.configuration);this.sound=new Sound(this.sipStack,this.configuration);this.video=new Video(this.client.find(".video"),this.sipStack,{onPlaying:function(){self.validateUserMediaResolution()}});this.xmpp=new XMPP(this);this.sms=new SMS(this,this.client.find(".sms"),this.sound);this.settings=new Settings(this,this.configuration,this.sound,this.sipStack);this.stats=new Stats(this,this.sipStack,this.configuration);this.timer=new Timer(this,this.stats,this.configuration);this.history=new History(this,this.sound,this.stats,this.sipStack,this.configuration);this.transfer=new Transfer(this,this.sound,this.sipStack,this.configuration);this.whiteboard=new Whiteboard(this,this.client.find(".whiteboard"),this.sipStack);this.fileShare=new FileShare(this,this.client.find(".file_share"),this.sipStack);this.authentication=new Authentication(this.client.find(".authPopup"),{onAuthenticate:function(data){self.sipStack.init(data)},configurationRegister:self.configuration.register,settingsUserId:self.settings.userId,settingsAuthenticationUserId:self.settings.authenticationUserId,settingsPassword:self.settings.password});this.hold=new Icon(this.client.find(".hold"),this.sound);this.resume=new Icon(this.client.find(".resume"),this.sound);this.fullScreen=false;this.selfViewEnabled=true;this.dialpadShown=false;this.isScreenSharing=false;this.configuration.setSettings(this.settings);this.registerListeners();this.init()},appendTo:function(parent){this.updateCss();this.wrapper=$("<div/>",{"class":"webrtc-wrapper"});parent.append(this.wrapper);var renderData={};var html=ejs.render(templates.webrtc(),renderData);this.wrapper.html(html);this.client=this.wrapper.find(".client");this.setup()},updateCss:function(styleData){this.styleData=styleData||{};var cssData=$.extend({},WebRTC_C.STYLES,WebRTC_C.FONTS,this.styleData);var cssStr=ejs.render(styles,cssData);if($("#webrtc_css").length===0){$("<style type='text/css' id='webrtc_css'>"+cssStr+"</style>").appendTo("head")}else{$("#webrtc_css").text(cssStr)}},init:function(){var self=this;var unsupported=Utils.compatibilityCheck(this);if(unsupported){$("#unsupported").html(unsupported).show()}var whiteboardUnsupported=Utils.whiteboardCompabilityCheck();if(whiteboardUnsupported){$("#whiteboard_unsupported").html(whiteboardUnsupported).show()}if(this.configuration.enableWindowDrag){$(function(){self.video.localHolder.draggable({snap:".remoteVideo,.videoBar",containment:".main",snapTolerance:200,stop:function(event,ui){self.settings.updateViewPositions()}})})}this.updateClientClass();$.cookie.raw=true;window.onbeforeunload=function(e){self.endCall({rtcSession:"all"});return null};this.onLoad()},showErrorPopup:function(error){window.alert(error)},guiStart:function(){this.main.css("zoom",this.configuration.size);this.main.css("-moz-transform","scale("+this.configuration.size+")");if($.cookie("settingWindowPosition")){var windowPositions=$.cookie("settingWindowPosition").split("|");for(var i=0;i<windowPositions.length;++i){var elementPosition=windowPositions[i].split("-");this.client.find(elementPosition[0]).css("top",elementPosition[1]);this.client.find(elementPosition[0]).css("left",elementPosition[2])}}this.client.find(".remoteVideo, .videoBar").fadeIn(1e3);if(this.configuration.enableCallControl){this.callControl.fadeIn(1e3)}else{this.callControl.fadeOut(1e3)}},find:function(selector){return this.client.find(selector)},message:function(text,level){if(!this.configuration.enableMessages){return}var messageEl=this.messages.find("."+level);messageEl.stop(true,true).fadeOut();messageEl.text(text).fadeIn(10).fadeOut(1e4)},validateDestination:function(destination){if(destination.indexOf("sip:")===-1){destination="sip:"+destination}if(!this.configuration.allowOutside&&!new RegExp("[.||@]"+this.configuration.domainTo).test(destination)){this.message(this.configuration.messageOutsideDomain,"alert");return false}if(destination.indexOf("@")===-1){destination=destination+"@"+this.configuration.domainTo}var domain=destination.substring(destination.indexOf("@"));if(domain.indexOf(".")===-1){destination=destination+"."+this.configuration.domainTo}return destination.replace(/,[0-9A-D#*,]+/,"")},callUri:function(destinationToValidate){if(this.sipStack.getCallState()!==SIPStack.C.STATE_CONNECTED){debug("Already in call with state : "+this.sipStack.getCallState());return}if(destinationToValidate===""){this.message(this.configuration.messageEmptyDestination,"alert");return}var destination=this.validateDestination(destinationToValidate);if(destination===false){debug("destination is not valid : "+destinationToValidate);return}debug("calling destination : "+destination);this.message(this.configuration.messageCall,"success");this.sipStack.call(destination)},setClientConfig:function(clientConfig){var connectionChanged=this.configuration.websocketsServers[0].ws_uri!==clientConfig.websocketsServers[0].ws_uri;jQuery.extend(this.config,clientConfig);jQuery.extend(this.configuration,this.config);this.guiStart();this.updateClientClass();if(connectionChanged){this.sipStack.init()}},endCall:function(options){options=options||{};var rtcSession=options.rtcSession;if(rtcSession==="all"){this.sipStack.terminateSessions()}else if(rtcSession){this.sipStack.terminateSession(rtcSession)}else{this.sipStack.terminateSession()}this.setEvent(null);this.sound.pause();this.video.updateSessionStreams();this.guiStart();this.timer.stop();this.checkEndCallURL()},checkEndCallURL:function(){if(this.configuration.endCallURL&&!this.configuration.disabled){window.location=this.configuration.endCallURL}},onLoad:function(){var self=this;debug("onLoad");this.sipStack.init();if(!this.configuration.enableConnectLocalMedia&&this.configuration.destination){events.once("connected",function(e){self.callUri(self.configuration.destination)})}this.guiStart()},pressDTMF:function(digit){if(digit.length!==1){return}if(this.sipStack.isStarted()){this.destination.val(this.destination.val()+digit);this.sound.playClick();this.sipStack.sendDTMF(digit)}},resumeCall:function(){var self=this;this.resume.disable();var enable=function(){self.resume.enable()};this.sipStack.unhold(enable,enable)},hideSelfView:function(){this.selfViewEnabled=false;this.updateClientClass()},stopFullScreen:function(){if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}this.fullScreen=false;this.updateClientClass()},showSelfView:function(){this.selfViewEnabled=true;this.updateClientClass()},showFullScreen:function(){if(this.client[0].webkitRequestFullScreen){this.client[0].webkitRequestFullScreen()}this.fullScreen=true;this.updateClientClass()},muteAudio:function(){this.sound.setMuted(true)},unmuteAudio:function(){this.sound.setMuted(false)},showDialpad:function(){this.dialpadShown=true;this.updateClientClass()},hideDialpad:function(){this.dialpadShown=false;this.updateClientClass()},toggleDialpad:function(flag){this.dialpadShown=flag;this.updateClientClass()},updateFullScreen:function(){this.fullScreen=document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen;this.updateClientClass()},holdCall:function(){var self=this;this.hold.disable();var enable=function(){self.hold.enable()};this.sipStack.hold(enable,enable)},getRemoteUser:function(rtcSession){return rtcSession.remote_identity.uri.user||rtcSession.remote_identity.uri.host},enableScreenSharing:function(enabled){var self=this;this.isScreenSharing=enabled;this.updateClientClass();if(enabled){var onShareScreenSuccess=function(localMedia){localMedia.onended=function(){self.enableScreenSharing(false)}};var onShareScreenFailure=function(e){if(e){self.screenSharingUnsupported.show()}self.enableScreenSharing(false)};self.sipStack.reconnectUserMedia(onShareScreenSuccess,onShareScreenFailure)}else{self.sipStack.reconnectUserMedia()}},registerListeners:function(){var self=this;events.on("viewChanged",function(e){self.updateClientClass()});events.on("ended",function(e){self.message(self.configuration.messageEnded.replace("{0}",self.getRemoteUser(e.sender)),"normal");self.history.persistCall(e.sender);self.endCall({rtcSession:e.sender})});events.on("resumed",function(e){self.onSessionStarted(e.sender);self.message(self.configuration.messageResume.replace("{0}",self.getRemoteUser(e.sender)),"success")});events.on("started",function(e){self.onSessionStarted(e.sender);var dtmfTones=Utils.parseDTMFTones(self.configuration.destination);if(dtmfTones&&e.data&&!e.data.isReconnect){debug("DTMF tones found in destination - sending DTMF tones : "+dtmfTones);self.sipStack.sendDTMF(dtmfTones)}delete self.configuration.destination;if(e.data&&!e.data.isReconnect){self.message(self.configuration.messageStarted.replace("{0}",self.getRemoteUser(e.sender)),"success");self.timer.start()}});events.on("held",function(e){self.message(self.configuration.messageHold.replace("{0}",self.getRemoteUser(e.sender)),"success")});events.on("disconnected",function(e){if(self.configuration.enableConnectionIcon){self.connected.removeClass("success");self.connected.addClass("alert").fadeIn(100)}var msg=self.configuration.messageConnectionFailed;if(e.data&&e.data.reason){msg=e.data.reason}if(e.data&&e.data.retryAfter){msg+=" - Retrying in "+e.data.retryAfter+" seconds"}self.message(msg,"alert");self.endCall()});events.on("failed",function(e){var error=e.data.cause;self.message(error,"alert");if(error==="User Denied Media Access"){self.showErrorPopup("WebRTC was not able to access your microphone/camera!")}else if(error===ExSIP.C.causes.CANCELED){self.setEvent("incomingCall-done")}self.sound.pause();self.endCall({rtcSession:e.sender})});events.on("progress",function(e){self.message(self.configuration.messageProgress,"normal");self.sound.playDtmfRingback()});events.on("message",function(e){self.message(e.text,e.level)});events.on("registrationFailed",function(e){self.updateClientClass();if(self.configuration.enableRegistrationIcon){self.registered.addClass("alert").fadeIn(100)}var statusCode=e.data.response.status_code;var msg=statusCode;if(statusCode===403){msg="403 Authentication Failure"}self.message(self.configuration.messageRegistrationFailed.replace("{0}",msg),"alert")});events.on("registered",function(e){self.updateClientClass();if(self.configuration.enableRegistrationIcon){self.registered.removeClass("alert");self.registered.addClass("success").fadeIn(10).fadeOut(3e3)}self.message(self.configuration.messageRegistered,"success")});events.on("unregistered",function(e){self.updateClientClass();self.message(self.configuration.messageUnregistered||"Unregistered","success")});events.on("connected",function(e){if(self.configuration.enableConnectionIcon){self.connected.removeClass("alert");self.connected.addClass("success").fadeIn(10).fadeOut(3e3)}self.message(self.configuration.messageConnected,"success");self.sipStack.updateUserMedia(function(){if(self.configuration.destination){self.callUri(self.configuration.destination)}})});events.on("incomingCall",function(evt){var incomingCallName=evt.data.request.from.display_name;var incomingCallUser=evt.data.request.from.uri.user;self.message("Incoming Call","success");self.setEvent("incomingCall");self.incomingCallName.text(incomingCallName);self.incomingCallUser.text(incomingCallUser);Utils.rebindListeners("click",[self.rejectIncomingCall,self.acceptIncomingCall,self.holdAndAnswerButton,self.dropAndAnswerButton],function(e){e.preventDefault();self.incomingCallHandler($(this),evt.data.session)});self.sound.playRingtone()});events.on("reInvite",function(e){self.setEvent("reInvite");var incomingCallName=e.data.request.from.display_name;var incomingCallUser=e.data.request.from.uri.user;var title=e.data.audioAdd?"Adding Audio":"Adding Video";self.message(title,"success");self.reInvitePopup.find(".incomingCallName").text(incomingCallName);self.reInvitePopup.find(".incomingCallUser").text(incomingCallUser);self.reInvitePopup.find(".title").text(title);self.acceptReInviteCall.off("click");self.acceptReInviteCall.on("click",function(){self.setEvent("reInvite-done");e.data.session.acceptReInvite()});self.rejectReInviteCall.off("click");self.rejectReInviteCall.on("click",function(){self.setEvent("reInvite-done");e.data.session.rejectReInvite()})});events.on("newDTMF",function(e){var digit=e.data.tone;debug("DTMF sent : "+digit);if(!digit){return}var file=null;if(digit==="*"){file="star"}else if(digit==="#"){file="pound"}else{file=digit}self.sound.playDtmfTone(file)});this.shareScreen.bind("click",function(e){e.preventDefault();self.sound.playClick();self.enableScreenSharing(true)});this.stopShareScreen.bind("click",function(e){e.preventDefault();self.sound.playClick();self.enableScreenSharing(false)});this.callButton.bind("click",function(e){e.preventDefault();self.sound.playClick();self.callUri(self.destination.val())});this.hangup.bind("click",function(e){e.preventDefault();self.sound.playClick();self.endCall();if(self.fullScreen){self.fullScreenContractIcon.click()}});this.fullScreenExpandIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.showFullScreen()});this.fullScreenContractIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.stopFullScreen()});$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(e){self.updateFullScreen()});this.selfViewDisableIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.hideSelfView()});this.selfViewEnableIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.showSelfView()});$(".history-button").bind("click",function(e){e.preventDefault();self.history.toggle()});$(".button-row button").bind("click",function(e){e.preventDefault();var destinationStr=$("#destination").val();$("#destination").val(destinationStr+this.firstChild.nodeValue)});this.hold.onClick(function(e){self.holdCall()});this.resume.onClick(function(e){self.resumeCall()});this.muteAudioIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.muteAudio()});this.unmuteAudioIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.unmuteAudio()});this.dialpadShowIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.showDialpad();self.destination.focus();self.settings.toggleSettings(false)});this.dialpadHideIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.hideDialpad();self.history.historyToggled=true;self.history.toggle()});this.historyClose.bind("click",function(e){e.preventDefault();self.sound.playClick();self.history.toggle()});this.dialpadButtons.bind("click",function(e){self.processDigitInput(e.target.textContent)});this.destination.keypress(function(e){if(e.keyCode===13){e.preventDefault();self.callUri(self.destination.val())}});$(".video").bind("click",function(e){var $target=$(e.target);var dialpad=$target.closest(".dialpad").length;var history=$target.closest(".callHistory").length;var details=$target.closest(".callHistoryDetails").length;if(dialpad===0||history===0||details===0){self.history.historyToggled=true;self.history.toggle()}});$(document).unbind("keypress").bind("keypress",function(e){});$(document).unbind("keydown").bind("keydown",function(event){var isModifier=event.altKey;if(isModifier){if(self.transfer.targetInput.is(event.target)){return}if(event.which===83){self.stats.toggle()}else if(event.which===84){self.sms.toggle()}else if(event.which===87){self.whiteboard.toggle()}else if(event.which===72){self.history.toggle()}return}if(self.dialpadShown){var doPrevent=false;if(event.keyCode===8){var d=event.srcElement||event.target;if(d.tagName.toUpperCase()==="INPUT"&&(d.type.toUpperCase()==="TEXT"||d.type.toUpperCase()==="PASSWORD"||d.type.toUpperCase()==="FILE"||d.type.toUpperCase()==="EMAIL")||d.tagName.toUpperCase()==="TEXTAREA"){doPrevent=d.readOnly||d.disabled}else{doPrevent=true;self.destination.trigger("keydown",event);self.destination.putCursorAtEnd()}}if(doPrevent){event.preventDefault();return}}var digit=String.fromCharCode(event.which);self.processDigitInput(digit,event)})},processDigitInput:function(digit,event){if(!this.sipStack.isStarted()&&this.dialpadShown){if(event&&this.destination.is(event.target)){return}this.destination.val(this.destination.val()+digit);this.destination.putCursorAtEnd()}else if(digit.match(/^[0-9A-D#*,]+$/i)){this.pressDTMF(digit)}},onSessionStarted:function(sender){debug("setting active session to "+sender.id);this.sipStack.activeSession=sender;this.video.updateSessionStreams(sender);this.client.find(".stats-container").attr("id",this.sipStack.getSessionId()+"-1");this.sound.pause()},incomingCallHandler:function(source,session){this.setEvent("incomingCall-done");this.sound.pause();if(source.is(this.acceptIncomingCall)){this.sipStack.answer(session)}else if(source.is(this.dropAndAnswerButton)){this.sipStack.terminateSession();this.sipStack.answer(session)}else if(source.is(this.holdAndAnswerButton)){this.sipStack.holdAndAnswer(session)}else if(source.is(this.rejectIncomingCall)){this.sipStack.terminateSession(session)}},setEvent:function(event){this.event=event;this.updateClientClass()},validateUserMediaResolution:function(){var encodingWidth=this.settings.getResolutionEncodingWidth();var encodingHeight=this.settings.getResolutionEncodingHeight();var videoWidth=this.video.localWidth();var videoHeight=this.video.localHeight();debug("validating video resolution "+videoWidth+","+videoHeight+" to match selected encoding "+encodingWidth+","+encodingHeight);if(!videoWidth&&!videoHeight){return}if(encodingWidth!==videoWidth||encodingHeight!==videoHeight){var msg="Video resolution "+videoWidth+","+videoHeight+" does not match selected encoding "+encodingWidth+","+encodingHeight;debugerror(msg)}},setAudioOnlyOfferAndRec:function(audioOnly){this.configuration.audioOnly=audioOnly;this.configuration.offerToReceiveVideo=!audioOnly;this.sipStack.updateUserMedia()},setAudioOnly:function(audioOnly){this.configuration.audioOnly=audioOnly;this.configuration.offerToReceiveVideo=true;this.sipStack.updateUserMedia()},asScript:function(){var self=this;var script='<script src="'+self.src+'" ';var dataStrs=Object.keys(self.styleData).filter(function(key){var value=self.styleData[key];var defaultValue=WebRTC_C.STYLES[key];return!!value&&value!==defaultValue}).map(function(key){var value=self.styleData[key];return"data-"+key.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+"='"+value+"'"});script+=dataStrs.join(" ");var config=$.extend({},this.config);Object.keys(config).forEach(function(key){var value=config[key];var defaultValue=ClientConfig[key];if(!value&&!defaultValue){delete config[key];return}if(Array.isArray(value)){value=JSON.stringify(value);defaultValue=JSON.stringify(defaultValue)}else{value=value+"";defaultValue=defaultValue+""}if(value===defaultValue){delete config[key]}});script+=">\n"+JSON.stringify(config,undefined,2)+"\n</script>";return script},updateClientClass:function(){var classes=["client"];classes.push("r"+this.configuration.getResolutionDisplay());classes.push(this.configuration.isWidescreen()?"widescreen":"standard");var callState=this.sipStack.getCallState();if(callState){classes.push(callState)}if(this.sipStack.isRegistered()){classes.push("registered")}if(this.event){classes.push(this.event)}if(this.configuration.enableMute){classes.push("enable-mute")}if(this.configuration.enableShareScreen){classes.push("enable-shareScreen")}if(this.configuration.enableCallControl){classes.push("enable-call-control")}if(this.configuration.enableTransfer){classes.push("enable-transfer")}if(this.configuration.enableHold){classes.push("enable-hold")}if(this.configuration.enableCallTimer){classes.push("enable-timer")}if(this.configuration.enableSettings){classes.push("enable-settings")}if(this.configuration.enableFullScreen){classes.push("enable-full-screen")}if(this.configuration.enableSelfView){classes.push("enable-self-view")}if(this.configuration.enableDialpad){classes.push("enable-dialpad")}var views=this.configuration.getViews();if(views&&views.length>0){views.map(function(view){classes.push("view-"+view)})}if(this.configuration.enableScreenSharing){classes.push("enable-screen-sharing")}if(this.configuration.enableFileShare){classes.push("enable-file-share")}if(this.configuration.selfViewSize){classes.push("selfView-"+this.configuration.selfViewSize)}if(this.configuration.selfViewLocation){classes.push("selfView-"+this.configuration.selfViewLocation)}if(this.sound.muted){classes.push("muted")}else{classes.push("unmuted")}if(this.settings.toggled){classes.push("settings-shown")}else{classes.push("settings-hidden")}if(this.selfViewEnabled){classes.push("self-view-enabled")}else{classes.push("self-view-disabled")}if(this.dialpadShown){classes.push("dialpad-shown")}else{classes.push("dialpad-hidden")}if(this.fullScreen){classes.push("full-screen-expanded")}else{classes.push("full-screen-contracted")}if(this.isScreenSharing){classes.push("screen-sharing")}else{classes.push("screen-sharing-off")}if(this.transfer.visible){classes.push("transfer-visible")}else{classes.push("transfer-hidden")}if(this.authentication.visible){classes.push("auth-visible")}else{classes.push("auth-hidden")}this.client.attr("class",classes.join(" "))}}},{"../js/client-config.js.default":1,"../js/templates":2,"./Authentication":50,"./Configuration":52,"./Constants":53,"./EventBus":55,"./FileShare":56,"./History":57,"./Icon":58,"./SIPStack":59,"./SMS":60,"./Settings":62,"./Sound":63,"./Stats":64,"./Timer":65,"./Transfer":66,"./Utils":67,"./Video":68,"./Whiteboard":70,"./XMPP":71,debug:10,ejs:13,exsip:27}],52:[function(require,module,exports){module.exports=Configuration;var Flags={enableHD:1,enableCallControl:2,enableCallTimer:4,enableCallHistory:8,enableFullScreen:16,enableSelfView:32,enableCallStats:64,enableDialpad:128,enableMute:256,enableMessages:512,enableRegistrationIcon:1024,enableConnectionIcon:2048,enableWindowDrag:4096,enableSettings:8192,enableAutoAnswer:16384,enableAutoAcceptReInvite:32768,enableConnectLocalMedia:65536,enableTransfer:131072,enableHold:262144,enableIms:524288};Configuration.Flags=Flags;var events=require("./EventBus");var debug=require("debug")("configuration");var Utils=require("./Utils");var WebRTC_C=require("./Constants");var ExSIP=require("exsip");function Configuration(configObj){debug("window.location.search : "+window.location.search);debug("configuration options : "+ExSIP.Utils.toString(configObj));jQuery.extend(this,configObj);if(Utils.getSearchVariable("disableMessages")){this.enableMessages=false}this.destination=this.destination||Utils.getSearchVariable("destination");this.networkUserId=this.networkUserId||Utils.getSearchVariable("networkUserId");this.hd=Utils.getSearchVariable("hd")==="true"||$.cookie("settingHD");this.audioOnly=Utils.getSearchVariable("audioOnly")==="true";this.sipDisplayName=this.displayName||Utils.getSearchVariable("name")||$.cookie("settingDisplayName");if(this.sipDisplayName){this.sipDisplayName=this.sipDisplayName.replace(/%20/g," ")}this.maxCallLength=Utils.getSearchVariable("maxCallLength");this.size=Utils.getSearchVariable("size")||$.cookie("settingSize")||1;this.color=Utils.colorNameToHex(Utils.getSearchVariable("color"))||$.cookie("settingColor");this.offerToReceiveVideo=true;var features=Utils.getSearchVariable("features");if(features){this.setClientConfigFlags(parseInt(features,10))}this.bodyBackgroundColor=$("body").css("backgroundColor")}Configuration.prototype={getClientConfigFlags:function(){var flags=0;for(var flag in Flags){var value=Flags[flag];if(this[flag]){flags|=value}}return flags},setClientConfigFlags:function(flags){for(var flag in Flags){var value=Flags[flag];if(flags&value){this[flag]=true}else{this[flag]=false}}},isAudioOnlyView:function(){var views=this.getViews();return views.indexOf("audioOnly")!==-1},getViews:function(){var view=Utils.getSearchVariable("view");var views=[];if(this.view){$.merge(views,this.view.split(" "))}if(view){$.merge(views,view.split(" "))}return $.unique(views)},getBackgroundColor:function(){return this.color||this.bodyBackgroundColor},getPassword:function(){return $.cookie("settingPassword")},isAutoAnswer:function(){return this.settings.settingAutoAnswer.is(":checked")},getDTMFOptions:function(){return{duration:WebRTC_C.DEFAULT_DURATION,interToneGap:WebRTC_C.DEFAULT_INTER_TONE_GAP}},getExSIPOptions:function(){var options={mediaConstraints:{audio:true,video:this.getVideoConstraints()},createOfferConstraints:{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:!this.isAudioOnlyView()&&this.offerToReceiveVideo}}};return options},getMediaConstraints:function(){if(this.client.isScreenSharing){return{video:{mandatory:{chromeMediaSource:"screen"}}}}else{return{audio:true,video:this.getVideoConstraints()}}},getVideoConstraints:function(){if(this.isAudioOnlyView()||this.audioOnly){return false}else{var constraints=this.getResolutionConstraints();return constraints?constraints:true}},getResolutionConstraints:function(){if(this.hd===true){return{mandatory:{minWidth:1280,minHeight:720}}}else{var width=this.settings.getResolutionEncodingWidth();var height=this.settings.getResolutionEncodingHeight();if(width&&height){if(height<=480){return{mandatory:{maxWidth:width,maxHeight:height}}}else{return{mandatory:{minWidth:width,minHeight:height}}}}else{return false}}},getExSIPConfig:function(data){data=data||{};var userid=data.userId||$.cookie("settingUserId")||this.networkUserId||Utils.randomUserid();var sip_uri=encodeURI(userid);if(sip_uri.indexOf("@")===-1){sip_uri=sip_uri+"@"+this.domainFrom}var config={uri:sip_uri,authorization_user:data.authenticationUserId||$.cookie("settingAuthenticationUserId")||userid,ws_servers:this.websocketsServers,stun_servers:"stun:"+this.stunServer+":"+this.stunPort,trace_sip:this.debug,enable_ims:this.enableIms,p_asserted_identity:this.pAssertedIdentity,enable_datachannel:this.enableWhiteboard||this.enableFileShare};if(this.sipDisplayName){config.display_name=this.sipDisplayName}if($.cookie("settingUserId")||this.register){config.register=true;config.password=data.password||$.cookie("settingPassword")}else{config.register=false}return config},getRtcMediaHandlerOptions:function(){var options={reuseLocalMedia:this.enableConnectLocalMedia,videoBandwidth:this.settings.getBandwidth(),disableICE:this.disableICE,RTCConstraints:{optional:[],mandatory:{}}};return options},setSettings:function(settings){this.settings=settings},isDebug:function(){return this.debug===true},isHD:function(){return this.enableHD===true&&this.hd===true},isWidescreen:function(){return this.isHD()||this.settings.resolutionType.val()===WebRTC_C.WIDESCREEN},setResolutionDisplay:function(resolutionDisplay){this.hd=false;this.settings.setResolutionDisplay(resolutionDisplay);events.emit("viewChanged")},getResolutionDisplay:function(){return this.isHD()?WebRTC_C.R_1280x720:this.settings.getResolutionDisplay()}}},{"./Constants":53,"./EventBus":55,"./Utils":67,debug:10,exsip:27}],53:[function(require,module,exports){var C={WIDESCREEN:"widescreen",STANDARD:"standard",R_1280x720:"1280x720",R_640x360:"640x360",R_320x180:"320x180",R_960x720:"960x720",R_640x480:"640x480",R_320x240:"320x240",DEFAULT_DURATION:500,DEFAULT_INTER_TONE_GAP:200,TEMPLATES:"$TEMPLATES$",CSS:"$CSS$",MEDIA:"$MEDIA$",FONTS:"$FONTS$",STYLES:{iconHightlightColor:"#00adef",infoMessageColor:"#999999",successMessageColor:"#00FF00",warningMessageColor:"#FFFF00",alertMessageColor:"#FF0000",statsColor:"#999999",timerColor:"#FFFFFF"}};C.DEFAULT_RESOLUTION_ENCODING=C.R_640x480;C.DEFAULT_RESOLUTION_DISPLAY=C.R_640x480;C.RESOLUTION_TYPES={standard:C.STANDARD,widescreen:C.WIDESCREEN};C.STANDARD_RESOLUTIONS={"960 x 720":C.R_960x720,"640 x 480":C.R_640x480,"320 x 240":C.R_320x240};C.WIDESCREEN_RESOLUTIONS={"1280 x 720":C.R_1280x720,"640 x 360":C.R_640x360,"320 x 180":C.R_320x180};module.exports=C},{}],54:[function(require,module,exports){module.exports=DateFormat;var C={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],mthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};C.zeroPad=function(number){return("0"+number).substr(-2,2)};C.dateMarkers={d:["getDate",function(v){return C.zeroPad(v)}],m:["getMonth",function(v){return C.zeroPad(v+1)}],n:["getMonth",function(v){return C.mthNames[v]}],w:["getDay",function(v){return C.dayNames[v]}],y:["getFullYear"],H:["getHours",function(v){return C.zeroPad(v)}],M:["getMinutes",function(v){return C.zeroPad(v)}],S:["getSeconds",function(v){return C.zeroPad(v)}],i:["toISOString"]};DateFormat.C=C;function DateFormat(fstr){this.formatString=fstr}DateFormat.prototype={format:function(date){var dateTxt=this.formatString.replace(/%(.)/g,function(m,p){var dateMarker=C.dateMarkers[p];var method=dateMarker[0];var rv=date[method]();if(dateMarker[1]!==null){rv=dateMarker[1](rv)}return rv});return dateTxt}}},{}],55:[function(require,module,exports){(function(global){var util=require("util");var events=require("events");function EventBus(){events.EventEmitter.call(this)
}util.inherits(EventBus,events.EventEmitter);global.WEBRTC_EVENTBUS=global.WEBRTC_EVENTBUS||new EventBus;module.exports=global.WEBRTC_EVENTBUS}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{events:4,util:9}],56:[function(require,module,exports){module.exports=FileShare;var C={ACTION_REQUEST:"request",ACTION_REPLY:"reply",ACTION_SEND:"send",ACTION_RECEIVED:"received"};FileShare.C=C;var events=require("./EventBus");var debug=require("debug")("fileshare");var Utils=require("./Utils");function FileShare(element,sipStack){this.ui=element;this.fileInput=this.ui.find('input[type="file"]');this.status=this.ui.find(".status");this.requests={};this.toggled=false;this.sipStack=sipStack;this.registerListeners()}FileShare.prototype={registerListeners:function(){var self=this;this.fileInput.on("change",$.proxy(this.handleFileSelect,this));events.on("dataReceived",function(e){var data=e.data,match;var regex=/^fileshare:([^:]*):([^:]*):?/;if(!!(match=data.match(regex))){var fileName=match.pop();var action=match.pop();data=data.replace(regex,"");self.process(action,fileName,data)}})},process:function(action,fileName,data){if(action===C.ACTION_REQUEST){var accept=window.confirm("User wants to share the file "+fileName+" with you. Do you want to receive it?");this.replyRequest(accept,fileName)}else if(action===C.ACTION_REPLY){if(data==="true"){var fileData=this.requests[fileName];this.sendFile(fileData,fileName)}else{this.updateStatus("rejected request for "+fileName);delete this.requests[fileName]}}else if(action===C.ACTION_SEND){this.receivedFile(data,fileName)}else if(action===C.ACTION_RECEIVED){this.updateStatus(fileName+" transferred successfully");delete this.requests[fileName]}},handleFileSelect:function(evt){var file=evt.target.files[0];if(file){var reader=new FileReader;reader.onload=$.proxy(this.requestSend,this);reader.readAsDataURL(file)}else{alert("Failed to load file")}},requestSend:function(e){var data=e.target.result;var file=this.fileInput.val();var fileName=this.fileName(file);this.requests[fileName]=data;this.updateStatus("requesting sending file "+fileName+" ...");this.send(C.ACTION_REQUEST,fileName)},replyRequest:function(accept,fileName){if(accept){this.updateStatus("receiving file "+fileName+" ...")}this.send(C.ACTION_REPLY,fileName,accept)},receivedFile:function(data,fileName){this.updateStatus("received file "+fileName);var blob=Utils.dataURItoBlob(data);window.saveAs(blob,fileName);this.send(C.ACTION_RECEIVED,fileName)},sendFile:function(data,fileName){this.updateStatus("sending file "+fileName+" ...");this.send(C.ACTION_SEND,fileName,data)},send:function(action,fileName,data){var dataString="fileshare:"+action+":"+fileName;if(data){dataString+=":"+data}this.sipStack.sendData(dataString)},updateStatus:function(status){debug(status,this.client.configuration);this.status.text(status)},fileName:function(file){return file.split("\\").pop()}}},{"./EventBus":55,"./Utils":67,debug:10}],57:[function(require,module,exports){module.exports=History;var Utils=require("./Utils");var SIPStack=require("./SIPStack");function History(client,sound,stats,sipStack,configuration){this.callHistory=client.find(".callHistory");this.content=this.callHistory.find(".content");this.historyForward=this.callHistory.find(".historyForward");this.historyBack=this.callHistory.find(".historyBack");this.callHistoryDetails=this.callHistory.find(".callHistoryDetails");this.historyDetailsClose=this.callHistory.find(".historyDetailsClose");this.resolutionIn=this.callHistory.find(".resolutionIn");this.resolutionOut=this.callHistory.find(".resolutionOut");this.bitrateIn=this.callHistory.find(".bitrateIn");this.bitrateOut=this.callHistory.find(".bitrateOut");this.frameRateIn=this.callHistory.find(".frameRateIn");this.frameRateOut=this.callHistory.find(".frameRateOut");this.audioLostPer=this.callHistory.find(".audioLostPer");this.videoLostPer=this.callHistory.find(".videoLostPer");this.jitter=this.callHistory.find(".jitter");this.historyClear=this.callHistory.find(".historyClear");this.historyCallLink=this.callHistory.find(".callLink");this.historyButton=$(".history-button");this.pageNumber=0;this.historyToggled=false;this.configuration=configuration;this.client=client;this.sound=sound;this.stats=stats;this.sipStack=sipStack;this.callsPerPage=10;this.maxPages=25;this.rows=[];this.registerListeners();this.updateContent()}History.Page=function(number,callsValue){this.number=number;this.calls=this.parseCalls(callsValue)};History.Page.prototype={callsAsString:function(){return this.calls.map(function(call){return call.toString()}).join("~")},parseCalls:function(callsValue){var calls=[];if(callsValue.trim().length>0){var callsArray=callsValue.split("~");for(var i=0;i<callsArray.length;i++){calls.push(new History.Call(callsArray[i]))}}return calls}};History.Call=function(value){var values=value?value.split("|"):[];this.startTime=values[0];this.destination=values[1];this.direction=values[2];this.resolutionIn=values[3];this.resolutionOut=values[4];this.bitrateIn=values[5];this.bitrateOut=values[6];this.frameRateIn=values[7];this.frameRateOut=values[8];this.audioLostPer=values[9];this.videoLostPer=values[10];this.jitter=values[11];this.length=values[12]};History.Call.prototype={startDate:function(){var date=new Date;date.setTime(this.startTime);return date.toLocaleString()},destinationWithoutSip:function(){return this.destination.replace(/sip:([^@]+)@.+/,"$1")},toString:function(){var values=[this.startTime,this.destination,this.direction,this.resolutionIn,this.resolutionOut,this.bitrateIn,this.bitrateOut,this.frameRateIn,this.frameRateOut,this.audioLostPer,this.videoLostPer,this.jitter,this.length];return values.join("|")}};History.prototype={pages:function(){var pages=[];for(var i=0;i<localStorage.length;i++){var key=localStorage.key(i);var regex=new RegExp(/page_(.*)/g);var match=regex.exec(key);if(match!==null&&match.length>1){var value=localStorage.getItem(key);var page=new History.Page(parseInt(match[1],10),value);pages.push(page)}}pages.sort(function(page1,page2){return page2.number-page1.number});return pages},updateButtonsVisibility:function(){var pages=this.pages();var pagesCount=pages?pages.length-1:0;if(this.pageNumber<pagesCount){this.historyForward.show()}else{this.historyForward.hide()}if(this.pageNumber>0){this.historyBack.show()}else{this.historyBack.hide()}},updateContent:function(){this.content.html("");this.rows=[];this.updateButtonsVisibility();var calls=this.getAllCalls();var startPos=this.callsPerPage*this.pageNumber;for(var i=startPos;i<startPos+this.callsPerPage&&i<calls.length;i++){var row=this.client.find(".historyRowSample").clone();row.attr("id","");row.attr("class","history-row");var call=calls[i];row.bind("click",this.callDetailsHandler(call));row.find(".historyCall").text(this.pageNumber*10+i+1);row.find(".hist-destination").text(call.destinationWithoutSip());row.find(".hist-direction").append("<i class='icon-arrow-"+call.direction+"-thick'></i>");row.find(".hist-date").text(Utils.formatDateTime(call.startDate()));row.find(".hist-length").text(call.length);this.rows.push(row);row.appendTo(this.content)}},getAllCalls:function(){var pages=this.pages();var calls=[];for(var i=0;i<pages.length;i++){calls=calls.concat(pages[i].calls)}return calls},callDetailsHandler:function(call){var self=this;return function(e){e.preventDefault();self.resolutionIn.text(call.resolutionIn);self.resolutionOut.text(call.resolutionOut);self.bitrateIn.text(call.bitrateIn);self.bitrateOut.text(call.bitrateOut);self.frameRateIn.text(call.frameRateIn);self.frameRateOut.text(call.frameRateOut);self.audioLostPer.text(call.audioLostPer);self.videoLostPer.text(call.videoLostPer);self.jitter.text(call.jitter);self.historyCallLink.attr("data-destination",call.destinationWithoutSip());self.historyCallLink.text("Call "+call.destinationWithoutSip());self.callHistoryDetails.fadeIn(100);self.callHistory.css({width:"416px"});$(".history-row").removeClass("active");$(this).addClass("active")}},setPageNumber:function(pageNumber){this.pageNumber=pageNumber;this.updateContent()},registerListeners:function(){var self=this;this.historyForward.bind("click",function(e){e.preventDefault();self.sound.playClick();self.setPageNumber(self.pageNumber+1)});this.historyBack.bind("click",function(e){e.preventDefault();self.sound.playClick();self.setPageNumber(self.pageNumber-1)});this.historyDetailsClose.bind("click",function(e){e.preventDefault();self.callHistoryDetails.fadeOut(100);self.callHistory.css({width:"200px"})});this.historyCallLink.bind("click",function(e){e.preventDefault();if(self.sipStack.getCallState()===SIPStack.C.STATE_CONNECTED){self.sound.playClick();var destination=self.historyCallLink.attr("data-destination");self.client.destination.val(destination);self.client.callUri(destination);self.callHistory.css({width:"200px"});self.callHistory.fadeOut(100)}self.callHistoryDetails.hide()});this.historyClear.bind("click",function(e){e.preventDefault();self.sound.playClick();var pages=self.pages();for(var i=0;i<pages.length;i++){localStorage.removeItem("page_"+pages[i].number)}self.setPageNumber(0)})},persistPage:function(page){var key="page_"+page.number;var value=page.callsAsString();localStorage[key]=value},persistCall:function(rtcSession){if(!this.configuration.enableCallHistory){return}var pages=this.pages();var page=null;if(pages.length>0){page=pages[0]}else{page=new History.Page(0,"")}if(page.calls.length>=this.callsPerPage){if(page.number+1>=this.maxPages){for(var i=0;i<pages.length;i++){var lastPageCall=pages[i].calls.pop();if(i+1<pages.length){pages[i+1].calls.unshift(lastPageCall)}this.persistPage(pages[i])}}else{page=new History.Page(page.number+1,"")}}var call=this.createCall(rtcSession);page.calls.unshift(call);this.persistPage(page);this.updateContent()},createCall:function(rtcSession){var call=new History.Call;var start=rtcSession.start_time;call.startTime=new Date(start).getTime();call.destination=rtcSession.remote_identity.uri;if(rtcSession.direction==="outgoing"){call.direction="up"}else{call.direction="down"}call.resolutionIn=this.stats.getValue("video","googFrameWidthReceived")+"x"+this.stats.getValue("video","googFrameHeightReceived");call.resolutionOut=this.stats.getValue("video","googFrameWidthSent")+"x"+this.stats.getValue("video","googFrameHeightSent");call.bitrateIn=this.stats.getAvg("video","kiloBitsReceivedPerSecond");call.bitrateOut=this.stats.getAvg("video","kiloBitsSentPerSecond");call.frameRateIn=this.stats.getAvg("video","googFrameRateReceived");call.frameRateOut=this.stats.getAvg("video","googFrameRateSent");call.audioLostPer=this.stats.getAvg("audio","packetsLostPer");call.videoLostPer=this.stats.getAvg("video","packetsLostPer");call.jitter=this.stats.getAvg("audio","googJitterReceived");call.length=Utils.format(Math.round(Math.abs((rtcSession.end_time-start)/1e3)));return call},toggle:function(){if(this.configuration.enableCallHistory===true){if(this.historyToggled===false){this.callHistory.fadeIn(100);this.historyClear.fadeIn(100);this.historyButton.addClass("active")}else if(this.historyToggled===true){this.callHistory.fadeOut(100);this.historyClear.fadeOut(100);this.historyButton.removeClass("active")}}this.historyToggled=!this.historyToggled}}},{"./SIPStack":59,"./Utils":67}],58:[function(require,module,exports){module.exports=Icon;function Icon(element,sound){this.element=element;this.sound=sound;this.disabled=false}Icon.prototype={css:function(name){return this.element.css(name)},attr:function(name){return this.element.attr(name)},disable:function(){this.disabled=true},enable:function(){this.disabled=false},onClick:function(handler){var self=this;this.element.bind("click",function(e){e.preventDefault();if(self.disabled){return}self.sound.playClick();handler(e)})}}},{}],59:[function(require,module,exports){module.exports=SIPStack;var C={STATE_CONNECTED:"connected",STATE_DISCONNECTED:"disconnected",STATE_CALLING:"calling",STATE_STARTED:"started",STATE_HELD:"held"};SIPStack.C=C;var ExSIP=require("exsip");var events=require("./EventBus");var debug=require("debug")("sipstack");var debugerror=require("debug")("sipstack:ERROR");debugerror.log=console.warn.bind(console);function SIPStack(configuration){this.configuration=configuration;this.ua=null;this.activeSession=null;this.sessions=[]}SIPStack.prototype={getLocalStreams:function(){return this.activeSession?this.activeSession.getLocalStreams():null},getRemoteStreams:function(){return this.activeSession?this.activeSession.getRemoteStreams():null},getSessionId:function(){return this.activeSession.id.replace(/\./g,"")},terminateSession:function(session){session=session||this.activeSession;if(!session){return}var index=this.sessions.indexOf(session);if(index!==-1){this.sessions.splice(index,index+1)}if(session.status!==ExSIP.RTCSession.C.STATUS_TERMINATED){session.terminate()}if(session===this.activeSession){debug("clearing active session");this.activeSession=null}events.emit("viewChanged",this)},terminateSessions:function(){var allSessions=[];allSessions=allSessions.concat(this.sessions);for(var i=0;i<allSessions.length;i++){this.terminateSession(allSessions[i])}},holdAndAnswer:function(session){var self=this;var firstSession=this.activeSession;session.on("ended",function(){events.emit("message",{text:"Resuming with "+firstSession.remote_identity.uri.user,level:"normal"});debug("incoming call ended - unholding first call");firstSession.unhold(function(){debug("unhold first call successful")})});this.activeSession.hold(function(){debug("hold successful - answering incoming call");self.answer(session)})},answer:function(session){session.answer(this.configuration.getExSIPOptions())},hold:function(successCallback,failureCallback){if(this.activeSession){this.activeSession.hold(successCallback,failureCallback)}},unhold:function(successCallback,failureCallback){if(this.activeSession){this.activeSession.unhold(successCallback,failureCallback)}},reconnectUserMedia:function(successCallback,failureCallback){var self=this;var onUserMediaUpdateSuccess=function(localMedia){debug("reconnect user media successful");if(self.activeSession){self.activeSession.changeSession({localMedia:localMedia},function(){debug("session changed successfully");if(successCallback){successCallback(localMedia)}},failureCallback)}else if(successCallback){successCallback(localMedia)}};this.updateUserMedia(onUserMediaUpdateSuccess,failureCallback)},call:function(destination){var session=this.ua.call(destination,this.configuration.getExSIPOptions());session.on("failed",function(e){events.emit("failed",e.data)});events.emit("calling",session)},sendDTMF:function(digit){this.activeSession.sendDTMF(digit,this.configuration.getDTMFOptions())},isStarted:function(){return this.getCallState()===C.STATE_STARTED},unregister:function(){return this.ua&&this.ua.unregister()},register:function(){return this.ua&&this.ua.register()},isRegistered:function(){return this.ua&&this.ua.isRegistered()},sendData:function(data){if(this.activeSession){this.activeSession.sendData(data)}},transfer:function(transferTarget,isAttended){if(isAttended){this.ua.attendedTransfer(transferTarget,this.activeSession)}else{this.ua.transfer(transferTarget,this.activeSession)}},updateRtcMediaHandlerOptions:function(){if(typeof this.ua==="undefined"){return}this.ua.setRtcMediaHandlerOptions(this.configuration.getRtcMediaHandlerOptions())},getCallState:function(){if(this.sessions.length>0){if(this.sessions.length===1&&!this.sessions[0].isStarted()){return C.STATE_CALLING}else{if(this.activeSession&&this.activeSession.isHeld()){return C.STATE_STARTED+" "+C.STATE_HELD}else{return C.STATE_STARTED}}}else{if(this.ua&&this.ua.isConnected&&this.ua.isConnected()){return C.STATE_CONNECTED}else{return C.STATE_DISCONNECTED}}},updateUserMedia:function(userMediaCallback,failureCallback){var self=this;if(!this.configuration.disabled&&(this.configuration.enableConnectLocalMedia||this.activeSession)){var options=this.configuration.getExSIPOptions();debug("updating user media ...");this.ua.getUserMedia(options,function(localStream){events.emit("userMediaUpdated",localStream);if(self.activeSession){debug("changing active session ...");self.activeSession.changeSession({localMedia:localStream,createOfferConstraints:options.createOfferConstraints},function(){debug("change session succeeded")},function(){debug("change session failed")})}if(userMediaCallback){userMediaCallback(localStream)}},function(e){events.emit("message",{text:self.configuration.messageGetUserMedia||"Get User Media Failed",level:"alert"});if(failureCallback){failureCallback(e)}},true)}},incomingReInvite:function(e){if(this.configuration.enableAutoAcceptReInvite){debug("auto accepting reInvite");e.data.session.acceptReInvite()}else{events.emit("reInvite",e.data)}},incomingCall:function(evt){var session=evt.data.session;if(!this.activeSession&&this.configuration.isAutoAnswer()){session.answer(this.configuration.getExSIPOptions())}else{events.emit("incomingCall",evt)}},init:function(data){try{var self=this;if(this.ua){debug("stopping existing UA");this.ua.stop()}if(this.configuration.disabled){return}this.ua=new ExSIP.UA(this.configuration.getExSIPConfig(data));this.updateRtcMediaHandlerOptions();this.ua.start();this.ua.on("connected",function(e){events.emit("viewChanged");events.emit("connected",e)});this.ua.on("disconnected",function(e){events.emit("viewChanged");events.emit("disconnected",e)});this.ua.on("onReInvite",function(e){debug("incoming onReInvite event");self.incomingReInvite(e)});this.ua.on("newRTCSession",function(e){var session=e.data.session;self.sessions.push(session);events.emit("viewChanged");session.on("progress",function(e){events.emit("progress",e)});session.on("failed",function(e){events.emit("failed",e)});session.on("started",function(e){events.emit("viewChanged",self);events.emit("started",e)});session.on("resumed",function(e){events.emit("viewChanged",self);events.emit("resumed",e)});session.on("held",function(e){events.emit("viewChanged",self);events.emit("held",e)});session.on("ended",function(e){events.emit("ended",e)});session.on("newDTMF",function(e){events.emit("newDTMF",e)});session.on("dataSent",function(e){events.emit("dataSent",e)});session.on("dataReceived",function(e){events.emit("dataReceived",e)});if(e.data.session.direction==="incoming"){self.incomingCall(e)}else{if(!self.activeSession){debug("new active session : "+session.id);self.activeSession=session}}});this.ua.on("registered",function(){events.emit("registered")});this.ua.on("unregistered",function(){events.emit("unregistered")});this.ua.on("registrationFailed",function(e){events.emit("registrationFailed",e)})}catch(e){debugerror("could not init sip stack",e)}}}},{"./EventBus":55,debug:10,exsip:27}],60:[function(require,module,exports){module.exports=SMS;var events=require("./EventBus");var debug=require("debug")("sms");var SMSProvider=require("./SMSProvider");var DateFormat=require("./DateFormat");var Utils=require("./Utils");function SMS(element,sound){this.sound=sound;this.view=element;this.status=element.find(".smsStatus");this.statusContent=this.status.find(".content");this.inbox=element.find(".smsInbox");this.inboxContent=this.inbox.find(".content");this.loginForm=element.find(".smsLoginForm");this.loginLink=element.find(".smsLogin");this.nameInput=element.find(".smsName");this.passwordInput=element.find(".smsPassword");this.sendForm=element.find(".smsSendForm");this.sendTo=element.find(".smsSendTo");this.sendBody=element.find(".smsSendBody");this.sendButton=element.find(".smsSendButton");this.inboxItems=[];this.smsProvider=new SMSProvider;this.toggled=false;this.registerListeners()}SMS.InboxItem=function(sms,message){this.sms=sms;this.message=message;this.cloned=sms.view.find(".sms-inbox-item-sample").clone(false);this.cloned.removeClass("sms-inbox-item-sample");this.cloned.attr("id",message.mid);this.from=this.cloned.find(".from");this.status=this.cloned.find(".status");this.time=this.cloned.find(".time");this.bodyText=this.cloned.find(".body .text");this.bodyImageLink=this.cloned.find(".body .image a");this.bodyImageText=this.cloned.find(".body .image span");this.bodyImageThumbnail=this.cloned.find(".body .image img");this.bodyVideo=this.cloned.find(".body .video video");this.bodyAudio=this.cloned.find(".body .audio audio");this.removeLink=this.cloned.find(".icon-trash");this.dateFormat=new DateFormat("%m/%d/%y %H:%M:%S");this.registerListeners();this.updateContent(message);return this};SMS.InboxItem.prototype={registerListeners:function(){var self=this;this.removeLink.bind("click",function(){self.sms.remove(self.message,self)})},enableActions:function(enable){this.removeLink.attr("disabled",!enable)},updateContent:function(message){var messageType=this.getMessageType(message);this.cloned.addClass(messageType);this.from.text(message.tn);this.status.text(SMS.getStatusAsString(message.status));this.time.text(this.dateFormat.format(new Date(message.time)));var body=message.body.trim();if(messageType==="image"){this.bodyImageLink.attr("href",message.mmscontentlocation);this.bodyImageText.text(body);if(message.mmscontentthumbnail){this.bodyImageThumbnail.attr("src","data:"+message.mmscontentsubtype+";base64,"+message.mmscontentthumbnail)}}else if(messageType==="video"){this.bodyVideo.attr("src",message.mmscontentlocation);this.bodyVideo.text(body)}else if(messageType==="audio"){this.bodyAudio.attr("src",message.mmscontentlocation);this.bodyAudio.text(body)}else{this.bodyText.html(body)}},getMessageType:function(message){if(message.mmscontentsubtype&&message.mmscontentsubtype.indexOf("image/")!==-1){return"image"}else if(message.mmscontentsubtype&&message.mmscontentsubtype.indexOf("video/")!==-1){return"video"}else if(message.mmscontentsubtype&&message.mmscontentsubtype.indexOf("audio/")!==-1){return"audio"}else{return"text"}},remove:function(){this.cloned.remove()},appendTo:function(element){this.cloned.appendTo(element)}};SMS.getStatusAsString=function(status){if(status==="N"){return"New"}else if(status==="U"){return"Unread"}else if(status==="R"){return"Read"}else if(status==="L"){return"Locked"}else if(status==="D"){return"Deleted"}else{throw new Error("Unsupported status : "+status)}};SMS.prototype={registerListeners:function(){var self=this;events.on("smsLoggedIn",function(){self.onLoggedIn()});events.on("smsSent",function(){self.status.hide();self.sendBody.val("");self.sendTo.val("");self.sendButton.attr("disabled",false)});events.on("smsReadAll",function(e){self.status.hide();var messages=e.messages;messages=messages.sort(function(a,b){return b.time-a.time});var incomingMessages=$.grep(messages,function(n){return n.dir==="I"});self.updateInbox(incomingMessages)});this.loginLink.bind("click",function(e){e.preventDefault();self.login(self.nameInput.val(),self.passwordInput.val())});this.passwordInput.bind("keypress",function(e){if(e.keyCode===13){e.preventDefault();self.login(self.nameInput.val(),self.passwordInput.val())}});this.sendButton.bind("click",function(e){e.preventDefault();self.sendSMS()});this.sendBody.bind("keypress",function(e){if(e.keyCode===13){e.preventDefault();self.sendSMS()}})},remove:function(message,inboxItem){var self=this;this.sound.playClick();if(!window.confirm("Do you really want to delete SMS from "+message.tn+"?")){return}this.info("Deleting SMS...");if(inboxItem){inboxItem.enableActions(false)}this.smsProvider.remove([message.mid],function(){self.status.hide();inboxItem.remove()},function(msg){self.error("Deleting SMS failed : "+msg);inboxItem.enableActions(true)})},login:function(name,password){var self=this;this.sound.playClick();this.info("Logging in...");this.smsProvider.login(name,password,function(msg){self.error("Logging failed : "+msg)})},onNotification:function(notifications){var needsRead=false,self=this;if(!notifications){return}for(var i=0;i<notifications.length;i++){if(notifications[i].action==="new-rec"||notifications[i].action==="update"||notifications[i].action==="delete"){needsRead=true;break}}if(needsRead){this.smsProvider.readAll(function(msg){self.error("Fetching SMS failed : "+msg)})}},enableUpdate:function(enable){this.enableUpdate=enable;this.triggerUpdate()},triggerUpdate:function(){var self=this;if(this.enableUpdate&&!this.pendingUpdate){debug("triggering getUpdate");this.pendingUpdate=true;this.smsProvider.getUpdate(function(notifications){self.pendingUpdate=false;self.onNotification(notifications);self.triggerUpdate()},function(){self.pendingUpdate=false;self.error("Technical problems connecting to server - auto refresh disabled")})}},sendSMS:function(){var self=this;this.sound.playClick();var msg=this.validateSendForm();if(msg!==""){this.error(msg);return}this.info("Sending SMS...");this.sendButton.attr("disabled",true);this.smsProvider.sendSMS([this.sendTo.val()],this.sendBody.val(),function(msg){self.sendButton.attr("disabled",false);self.error("Sending SMS failed : "+msg)})},validateSendForm:function(){var to=this.sendTo.val();var msgs=[];if(to===""){msgs.push("Please enter a phone number to send to")}else if(!Utils.isValidUsPstn(to)){msgs.push(to+" not a valid US phone number")}var body=this.sendBody.val();if(body===""){msgs.push("Please enter a text to send")}return msgs.join("\n")},onLoggedIn:function(){var self=this;this.loginForm.hide();this.inbox.show();this.sendForm.show();this.enableUpdate(true);this.smsProvider.readAll(function(msg){self.error("Fetching SMS failed : "+msg)});this.info("Fetching SMS...")},updateInbox:function(messages){this.inboxContent.html("");this.inboxItems=[];for(var i=0;i<messages.length;i++){var inboxItem=new SMS.InboxItem(this,messages[i]);inboxItem.appendTo(this.inboxContent);this.inboxItems.push(inboxItem)}},setStatus:function(msg,type){this.status.show();this.status.attr("class",type);this.statusContent.text(msg)},error:function(msg){this.setStatus(msg,"error")},info:function(msg){this.setStatus(msg,"info")},toggle:function(){if(ClientConfig.enableSMS){if(this.toggled){this.view.fadeOut(100)}else{this.view.fadeIn(100)}this.toggled=!this.toggled}}}},{"./DateFormat":54,"./EventBus":55,"./SMSProvider":61,"./Utils":67,debug:10}],61:[function(require,module,exports){module.exports=SMSProvider;var ExSIP=require("exsip");var events=require("./EventBus");var debug=require("debug")("smsprovider");var debugerror=require("debug")("client:ERROR");debugerror.log=console.warn.bind(console);function SMSProvider(){this.init()}SMSProvider.prototype={send:function(type,restSuffix,jsonData,successCallback,failureCallback,isJsonp){var url="http://"+ClientConfig.smsHost+"/"+ClientConfig.smsUser+"/"+restSuffix;if(this.sessionid){url+=";jsessionid="+this.sessionid}debug("Request to "+url+" : "+ExSIP.Utils.toString(jsonData));$.ajax({crossDomain:true,contentType:type==="GET"?"text/plain":"text/plain",dataType:isJsonp?"jsonp":"json",type:type,url:url,data:type==="GET"?jsonData:JSON.stringify(jsonData)}).done(function(msg){if(msg.status==="empty"||msg.status==="success"||msg.status.code==="0000001"){debug("Response successful : "+ExSIP.Utils.toString(msg));if(successCallback){successCallback(msg)}}else{debugerror("Response failed : "+ExSIP.Utils.toString(msg));if(failureCallback){failureCallback(msg.status.message)}}}).fail(function(jqXHR,textStatus){debugerror("Response error : "+textStatus);if(failureCallback){failureCallback(textStatus)}})},getUpdate:function(onNotification,onFailure){var onSuccess=function(msg){debug("received notification : "+ExSIP.Utils.toString(msg));onNotification(msg.notifications)};var data={fid:this.name,platform:"fmc"};this.send("GET","getUpdate",data,onSuccess,onFailure,false)},sendSMS:function(desttnarray,body,onFailure){var onSuccess=function(msg){debug("sent msg "+msg+" to "+desttnarray);events.emit("smsSent",{desttnarray:desttnarray,body:body})};var data={desttnarray:desttnarray,body:body};this.send("POST","ua/msg/sms/send",data,onSuccess,onFailure)},remove:function(mids,onSuccess,onFailure){var data={mids:mids};this.send("POST","ua/msg/sms/delete",data,function(){debug("Deleted msgs : "+mids);if(onSuccess){onSuccess()}},onFailure)},readAll:function(onFailure){var onSuccess=function(msg){debug("Read all mgs : "+ExSIP.Utils.toString(msg.messages));events.emit("smsReadAll",{messages:msg.messages})};var data=null;this.send("GET","ua/msg/sms/all",data,onSuccess,onFailure)},login:function(name,password,onFailure){var self=this;var onSuccess=function(msg){self.sessionid=msg.sessionid;self.name=name;debug("Logged in "+name+" : "+msg.sessionid);events.emit("smsLoggedIn")};var data={spcode:ClientConfig.smsSpcode,password:password,name:name,platform:"fmc"};this.send("POST","ua/login",data,onSuccess,onFailure)},init:function(){this.registerListeners()},registerListeners:function(){}}},{"./EventBus":55,debug:10,exsip:27}],62:[function(require,module,exports){module.exports=Settings;var events=require("./EventBus");var debug=require("debug")("settings");var debugerror=require("debug")("settings:ERROR");debugerror.log=console.warn.bind(console);var WebRTC_C=require("./Constants");var Utils=require("./Utils");function Settings(client,configuration,sound,sipStack){this.settingsIcon=client.find(".settings");this.settingsUi=client.find(".settingsPopup");this.popup=this.settingsUi;this.localVideoTop=this.settingsUi.find(".settingLocalVideoTop");this.localVideoLeft=this.settingsUi.find(".settingLocalVideoLeft");this.userIdInput=this.settingsUi.find(".settingUserid");this.authenticationUserIdInput=this.settingsUi.find(".settingAuthenticationUserid");this.passwordInput=this.settingsUi.find(".settingPassword");this.saveBtn=this.settingsUi.find(".saveSettings");this.signInBtn=this.settingsUi.find(".sign-in");this.signOutBtn=this.settingsUi.find(".sign-out");this.displayNameInput=this.settingsUi.find(".settingDisplayName");this.resolutionType=this.settingsUi.find(".resolutionTypeSelect");this.resolutionDisplayWidescreen=this.settingsUi.find(".resolutionDisplayWidescreenSelect");this.resolutionDisplayStandard=this.settingsUi.find(".resolutionDisplayStandardSelect");this.resolutionEncodingWidescreen=this.settingsUi.find(".resolutionEncodingWidescreenSelect");this.resolutionEncodingStandard=this.settingsUi.find(".resolutionEncodingStandardSelect");this.bandwidthLowInput=this.settingsUi.find(".settingBandwidthLow");this.bandwidthMedInput=this.settingsUi.find(".settingBandwidthMed");this.bandwidthHighInput=this.settingsUi.find(".settingBandwidthHigh");this.settingDisplayNameRow=this.settingsUi.find(".settingDisplayNameRow");this.settingUseridRow=this.settingsUi.find(".settingUseridRow");this.settingSelfViewDisableRow=this.settingsUi.find(".settingSelfViewDisableRow");this.settingHDRow=this.settingsUi.find(".settingHDRow");this.settingAutoAnswerRow=this.settingsUi.find(".settingAutoAnswerRow");this.settingResolutionTypeRow=this.settingsUi.find(".settingResolutionTypeRow");this.settingResolutionDisplayRow=this.settingsUi.find(".settingResolutionDisplayRow");this.settingResolutionEncodingRow=this.settingsUi.find(".settingResolutionEncodingRow");this.settingResolutionRow=this.settingsUi.find(".settingResolutionRow");this.settingBandwidthRow=this.settingsUi.find(".settingBandwidthRow");this.settingCallHistoryTop=this.settingsUi.find(".settingCallHistoryTop");this.settingCallHistoryLeft=this.settingsUi.find(".settingCallHistoryLeft");this.settingCallStatsTop=this.settingsUi.find(".settingCallStatsTop");this.settingCallStatsLeft=this.settingsUi.find(".settingCallStatsLeft");this.resolutionTypeSelect=this.settingsUi.find(".resolutionTypeSelect");this.settingSelfViewDisable=this.settingsUi.find(".settingSelfViewDisable");this.settingHD=this.settingsUi.find(".settingHD");this.settingSize=this.settingsUi.find(".settingSize");this.settingAutoAnswer=this.settingsUi.find(".settingAutoAnswer");this.colorInput=this.settingsUi.find(".settingColor");this.tabConfigureLink=this.settingsUi.find("[href='#tab1']");this.tabLayoutLink=this.settingsUi.find("[href='#tab2']");
this.clearLink=this.settingsUi.find(".clear");this.configuration=configuration;this.sound=sound;this.client=client;this.sipStack=sipStack;this.toggled=false;this.settingsChanged=false;var self=this;this.cookiesMapper={settingDisplayName:{name:"displayName",initValue:function(){return self.configuration.sipDisplayName||$.cookie("settingDisplayName")},inputSetter:function(val){self.displayNameInput.val(val)},inputGetter:function(){return self.displayNameInput.val()}},settingUserId:{name:"userId",inputSetter:function(val){self.userIdInput.val(val)},inputGetter:function(){return self.userIdInput.val()}},settingPassword:{name:"password",inputSetter:function(val){self.passwordInput.val(val)},inputGetter:function(){return self.passwordInput.val()}},settingAuthenticationUserId:{name:"authenticationUserId",inputSetter:function(val){self.authenticationUserIdInput.val(val)},inputGetter:function(){return self.authenticationUserIdInput.val()}},settingSelfViewDisable:{name:"selfViewDisable",initValue:function(){return $.cookie("settingSelfViewDisable")==="true"},inputSetter:function(val){self.settingSelfViewDisable.prop("checked",val)},inputGetter:function(){return self.settingSelfViewDisable.prop("checked")}},settingHD:{name:"hd",initValue:function(){return $.cookie("settingHD")==="true"},inputSetter:function(val){self.settingHD.prop("checked",val)},inputGetter:function(){return self.settingHD.prop("checked")}},settingBandwidthLow:{name:"bandwidthLow",initValue:function(){return self.configuration.bandwidthLow||$.cookie("settingBandwidthLow")},inputSetter:function(val){self.bandwidthLowInput.val(val)},inputGetter:function(){return self.bandwidthLowInput.val()}},settingBandwidthMed:{name:"bandwidthMed",initValue:function(){return self.configuration.bandwidthMed||$.cookie("settingBandwidthMed")},inputSetter:function(val){self.bandwidthMedInput.val(val)},inputGetter:function(){return self.bandwidthMedInput.val()}},settingBandwidthHigh:{name:"bandwidthHigh",initValue:function(){return self.configuration.bandwidthHigh||$.cookie("settingBandwidthHigh")},inputSetter:function(val){self.bandwidthHighInput.val(val)},inputGetter:function(){return self.bandwidthHighInput.val()}},settingColor:{name:"color",initValue:function(){return self.configuration.getBackgroundColor()},inputSetter:function(val){self.colorInput.val(val||"#ffffff")},inputGetter:function(){return self.colorInput.val()}},settingResolutionDisplay:{name:"resolutionDisplay",initValue:function(){return self.configuration.displayResolution||$.cookie("settingResolutionDisplay")||WebRTC_C.DEFAULT_RESOLUTION_DISPLAY},inputSetter:function(val){self.setResolutionDisplay(val)},inputGetter:function(){return self.getResolutionDisplay()}},settingResolutionEncoding:{name:"resolutionEncoding",initValue:function(){return self.configuration.encodingResolution||$.cookie("settingResolutionEncoding")||WebRTC_C.DEFAULT_RESOLUTION_ENCODING},inputSetter:function(val){self.setResolutionEncoding(val)},inputGetter:function(){return self.getResolutionEncoding()}},settingSize:{name:"size",initValue:function(){return self.configuration.size||$.cookie("settingSize")},inputSetter:function(val){self.settingSize.val(val)},inputGetter:function(){return self.settingSize.val()}},settingAutoAnswer:{name:"autoAnswer",initValue:function(){return $.cookie("settingAutoAnswer")==="true"},inputSetter:function(val){self.settingAutoAnswer.prop("checked",val)},inputGetter:function(){return self.settingAutoAnswer.prop("checked")}},settingWindowPosition:{name:"windowPosition",inputSetter:function(){},inputGetter:function(){return".localVideo"+"-"+self.localVideoTop.val()+"-"+self.localVideoLeft.val()+"|"+".callHistory"+"-"+self.settingCallHistoryTop.val()+"-"+self.settingCallHistoryLeft.val()+"|"+".callStats"+"-"+self.settingCallStatsTop.val()+"-"+self.settingCallStatsLeft.val()}}};function makeAccessor(cookie){var mapping=self.cookiesMapper[cookie];self[mapping.name]=function(value){if(arguments.length===1){mapping.inputSetter(value);if(value){$.cookie(cookie,value,{expires:self.configuration.expires})}else{jQuery.removeCookie(cookie)}}else{return mapping.inputGetter()}}}for(var cookie in this.cookiesMapper){makeAccessor(cookie)}this.registerListeners();this.initUi();this.updateRowVisibility();this.updatePageColor();this.initializeTabs()}Settings.prototype={registerListeners:function(){var self=this;events.on("ended",function(){if(self.settingsChanged){self.reload()}});events.on("registered",function(){self.enableRegistration(true)});events.on("unregistered",function(){self.enableRegistration(true)});events.on("registrationFailed",function(){self.enableRegistration(true)});this.resolutionTypeSelect.bind("change",function(){self.updateResolutionSelectVisibility()});this.settingsIcon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.toggled=!self.toggled;self.client.updateClientClass();self.client.toggleDialpad(false);self.client.history.historyToggled=true;self.client.history.toggle()});this.colorInput.bind("change",function(){self.updatePageColor()});this.clearLink.on("click",function(e){e.preventDefault();self.resetLayout();events.emit("message",{text:"Settings reset"})});this.signOutBtn.on("click",function(e){e.preventDefault();self.signOut()});this.saveBtn.bind("click",function(e){e.preventDefault();self.save()});this.signInBtn.bind("click",function(e){e.preventDefault();self.signIn()});this.bandwidthLowInput.bind("blur",function(){self.client.sipStack.updateRtcMediaHandlerOptions()});this.bandwidthMedInput.bind("blur",function(){self.client.sipStack.updateRtcMediaHandlerOptions()});this.bandwidthHighInput.bind("blur",function(){self.client.sipStack.updateRtcMediaHandlerOptions()});this.resolutionType.bind("change",function(){self.client.updateClientClass();self.client.sipStack.updateRtcMediaHandlerOptions();self.client.sipStack.updateUserMedia()});this.resolutionDisplayWidescreen.bind("change",function(){self.client.updateClientClass()});this.resolutionDisplayStandard.bind("change",function(){self.client.updateClientClass()});this.resolutionEncodingWidescreen.bind("change",function(){self.client.sipStack.updateRtcMediaHandlerOptions();self.client.sipStack.updateUserMedia()});this.resolutionEncodingStandard.bind("change",function(){self.client.sipStack.updateRtcMediaHandlerOptions();self.client.sipStack.updateUserMedia()})},updateRowVisibility:function(){this.settingAutoAnswerRow.toggle(this.configuration.enableAutoAnswer);this.settingSelfViewDisableRow.toggle(!this.configuration.hasOwnProperty("enableSelfView"));this.settingHDRow.toggle(!this.configuration.hasOwnProperty("enableHD"));this.settingResolutionRow.toggle(!this.configuration.hasOwnProperty("displayResolution")||!this.configuration.hasOwnProperty("encodingResolution"));this.settingResolutionDisplayRow.toggle(!this.configuration.hasOwnProperty("displayResolution"));this.settingResolutionEncodingRow.toggle(!this.configuration.hasOwnProperty("encodingResolution"));this.settingResolutionTypeRow.toggle(!this.configuration.hasOwnProperty("displayResolution")&&!this.configuration.hasOwnProperty("encodingResolution"));this.bandwidthLowInput.toggle(!this.configuration.hasOwnProperty("bandwidthLow"));this.bandwidthMedInput.toggle(!this.configuration.hasOwnProperty("bandwidthMed"));this.bandwidthHighInput.toggle(!this.configuration.hasOwnProperty("bandwidthHigh"));this.settingBandwidthRow.toggle(!this.configuration.hasOwnProperty("bandwidthLow")||!this.configuration.hasOwnProperty("bandwidthMed")||!this.configuration.hasOwnProperty("bandwidthHigh"));this.settingDisplayNameRow.toggle(!this.configuration.hasOwnProperty("displayName"))},getBandwidth:function(){var height=this.getResolutionEncodingHeight();if(height<=240){return this.bandwidthLowInput.val()}else if(height<=480){return this.bandwidthMedInput.val()}else if(height<=720){return this.bandwidthHighInput.val()}},reload:function(){location.reload(0)},updatePageColor:function(){var color=this.configuration.getBackgroundColor();debug("updating page color : "+color);$("body").css("backgroundColor",color||"")},initUi:function(){Utils.addSelectOptions(WebRTC_C.RESOLUTION_TYPES,this.resolutionType);Utils.addSelectOptions(WebRTC_C.STANDARD_RESOLUTIONS,this.resolutionDisplayStandard);Utils.addSelectOptions(WebRTC_C.WIDESCREEN_RESOLUTIONS,this.resolutionDisplayWidescreen);Utils.addSelectOptions(WebRTC_C.STANDARD_RESOLUTIONS,this.resolutionEncodingStandard);Utils.addSelectOptions(WebRTC_C.WIDESCREEN_RESOLUTIONS,this.resolutionEncodingWidescreen);for(var cookie in this.cookiesMapper){var mapping=this.cookiesMapper[cookie];var value=mapping.initValue?mapping.initValue():$.cookie(cookie);mapping.inputSetter(value)}},updateViewPositions:function(){var localVideoPosition=this.client.video.local.position();if(localVideoPosition&&localVideoPosition.top!==0&&localVideoPosition.left!==0){this.localVideoTop.val(localVideoPosition.top);this.localVideoLeft.val(localVideoPosition.left)}var callHistoryPosition=this.client.callHistory.position();if(callHistoryPosition&&callHistoryPosition.top!==0&&callHistoryPosition.left!==0){this.settingCallHistoryTop.val(callHistoryPosition.top);this.settingCallHistoryLeft.val(callHistoryPosition.left)}var callStatsPosition=this.client.callStats.position();if(callStatsPosition&&callStatsPosition.top!==0&&callStatsPosition.left!==0){this.settingCallStatsTop.val(callStatsPosition.top);this.settingCallStatsLeft.val(callStatsPosition.left)}},updateResolutionSelectVisibility:function(){var resolutionType=this.resolutionType.val();this.resolutionDisplayStandard.toggle(resolutionType===WebRTC_C.STANDARD);this.resolutionEncodingStandard.toggle(resolutionType===WebRTC_C.STANDARD);this.resolutionDisplayWidescreen.toggle(resolutionType===WebRTC_C.WIDESCREEN);this.resolutionEncodingWidescreen.toggle(resolutionType===WebRTC_C.WIDESCREEN)},setResolutionDisplay:function(resolution){this.setResolution(resolution,this.resolutionDisplayStandard,this.resolutionDisplayWidescreen)},setResolutionEncoding:function(resolution){this.setResolution(resolution,this.resolutionEncodingStandard,this.resolutionEncodingWidescreen)},setResolution:function(resolution,resolutionStandard,resolutionWidescreen){if(Utils.containsKey(WebRTC_C.STANDARD_RESOLUTIONS,resolution)){this.resolutionType.val(WebRTC_C.STANDARD);resolutionStandard.val(resolution)}else if(Utils.containsKey(WebRTC_C.WIDESCREEN_RESOLUTIONS,resolution)){this.resolutionType.val(WebRTC_C.WIDESCREEN);resolutionWidescreen.val(resolution)}else{debugerror("no resolution type for "+resolution)}this.updateResolutionSelectVisibility()},getResolutionDisplay:function(){return this.getResolution(this.resolutionDisplayStandard,this.resolutionDisplayWidescreen)},getResolutionEncodingWidth:function(){var resolution=this.getResolutionEncoding();if(!$.isBlank(resolution)){var resolutions=resolution.split("x");return parseInt(resolutions[0],10)}},getResolutionEncodingHeight:function(){var resolution=this.getResolutionEncoding();if(!$.isBlank(resolution)){var resolutions=resolution.split("x");return parseInt(resolutions[1],10)}},getResolutionEncoding:function(){return this.getResolution(this.resolutionEncodingStandard,this.resolutionEncodingWidescreen)},getResolution:function(resolutionStandard,resolutionWidescreen){var resolutionType=this.resolutionType.val();if(resolutionType===WebRTC_C.STANDARD){return resolutionStandard.val()}else if(resolutionType===WebRTC_C.WIDESCREEN){return resolutionWidescreen.val()}else{return false}},changed:function(){if(!this.sipStack.activeSession){this.reload()}else{this.settingsChanged=true}},save:function(){this.sound.playClick();this.persist();this.toggled=false;this.client.updateClientClass();this.changed()},enableRegistration:function(enable){this.signInBtn.removeClass("disabled");this.signOutBtn.removeClass("disabled");if(!enable){this.signInBtn.addClass("disabled");this.signOutBtn.addClass("disabled")}},signIn:function(){this.sound.playClick();this.persist();this.sipStack.init();this.enableRegistration(false)},signOut:function(){this.sound.playClick();this.sipStack.unregister();this.clearConfigurationCookies();this.enableRegistration(false)},resetLayout:function(){this.resolutionEncoding(WebRTC_C.DEFAULT_RESOLUTION_ENCODING);this.resolutionDisplay(WebRTC_C.DEFAULT_RESOLUTION_DISPLAY);this.client.updateClientClass()},clearConfigurationCookies:function(){$.removeCookie("settingDisplayName");$.removeCookie("settingUserId");$.removeCookie("settingAuthenticationUserId");$.removeCookie("settingPassword")},clearConfiguration:function(){this.displayName(null);this.userId(null);this.authenticationUserId(null);this.password(null)},clear:function(){for(var cookie in this.cookiesMapper){var mapping=this.cookiesMapper[cookie];this[mapping.name](null)}},persist:function(){for(var cookie in this.cookiesMapper){var mapping=this.cookiesMapper[cookie];$.cookie(cookie,mapping.inputGetter(),{expires:this.configuration.expires})}},toggleSettings:function(flag){this.toggled=flag;this.client.updateClientClass()},initializeTabs:function(){$("ul.tabs").each(function(){var $active,$content,$links=$(this).find("a");$active=$($links.filter('[href="'+location.hash+'"]')[0]||$links[0]);$active.addClass("active");$content=$($active[0].hash);$links.not($active).each(function(){$(this.hash).hide()});$(this).on("click","a",function(e){$active.removeClass("active");$content.hide();$active=$(this);$content=$(this.hash);$active.addClass("active");$content.show();e.preventDefault()})})}}},{"./Constants":53,"./EventBus":55,"./Utils":67,debug:10}],63:[function(require,module,exports){module.exports=Sound;var events=require("./EventBus");var WebRTC_C=require("./Constants");function Sound(sipStack,configuration){this.sipStack=sipStack;this.soundOut=document.createElement("audio");this.soundOut.volume=configuration.volumeClick;this.soundOutDTMF=document.createElement("audio");this.soundOutDTMF.volume=configuration.volumeDTMF;this.muted=false;this.registerListeners()}Sound.prototype={registerListeners:function(){var self=this;events.on("resumed",function(){self.updateLocalAudio()});events.on("started",function(){self.updateLocalAudio()});events.on("userMediaUpdated",function(){self.updateLocalAudio()})},setMuted:function(muted){this.muted=muted;events.emit("viewChanged");this.updateLocalAudio()},updateLocalAudio:function(){this.enableLocalAudio(!this.muted)},enableLocalAudio:function(enabled){var localStreams=this.sipStack.getLocalStreams();if(!localStreams||localStreams.length===0){return}var localMedia=localStreams[0];var localAudio=localMedia.getAudioTracks()[0];localAudio.enabled=enabled},pause:function(){this.soundOut.pause();this.soundOutDTMF.pause()},playDtmfRingback:function(){this.playDtmf("dtmf-ringback",{loop:true})},playRingtone:function(){this.play("ringtone",{loop:true})},playDtmfTone:function(tone){this.playDtmf("dtmf-"+tone)},playClick:function(){this.play("click")},play:function(media,options){this.playTone(this.soundOut,media,options)},playTone:function(audioSource,media,options){if(audioSource.getAttribute("src")===media&&!audioSource.paused){return}options=options||{};audioSource.setAttribute("src",WebRTC_C.MEDIA[media]);if(options.loop){audioSource.setAttribute("loop","true")}else{audioSource.removeAttribute("loop")}audioSource.play()},playDtmf:function(media,options){this.playTone(this.soundOutDTMF,media,options)}}},{"./Constants":53,"./EventBus":55}],64:[function(require,module,exports){module.exports=Stats;function Stats(client,sipStack,configuration){this.ui=client.find(".callStats");this.statsToggled=false;this.sipStack=sipStack;this.configuration=configuration;this.initialize()}Stats.prototype={toggle:function(){if(this.configuration.enableCallStats){if(this.statsToggled===false){this.ui.fadeIn(100)}else if(this.statsToggled===true){this.ui.fadeOut(100)}}this.statsToggled=!this.statsToggled},getReportById:function(reports,id){for(var i=0;i<reports.length;i++){if(reports[i].id===id){return reports[i]}}return null},processStats:function(){var self=this;var peerConnection=this.sipStack.activeSession.rtcMediaHandler.peerConnection;peerConnection.getStats(function(stats){var results=stats.result();var reports=[];for(var i=0;i<results.length;++i){var res=results[i];var report=self.getReportById(reports,res.id);if(!report){report={};report.type=res.type;report.id=res.id}var names=res.names();var values=[];for(var j=0;j<names.length;j++){var name=names[j];if(!name){continue}var value=res.stat(name);values.push(name);values.push(value)}var valueObj={};valueObj.timestamp=res.timestamp;valueObj.values=values;report.stats=valueObj;reports.push(report)}var data={lid:1,pid:self.sipStack.getSessionId(),reports:reports};addStats(data)})},getDataSerie:function(type,label,sessionId){var dataSeries=getDataSeriesByLabel(sessionId||this.sipStack.getSessionId(),type,label);var result;for(var i=0;i<dataSeries.length;i++){var dataSerie=dataSeries[i];if(!result||dataSerie.getAvg()>result.getAvg()){result=dataSerie}}return result},getStatValues:function(type,label,sessionId){var dataSerie=this.getDataSerie(type,label,sessionId);return dataSerie?dataSerie.dataPoints_.map(function(e){return e.value}):null},getStatAvg:function(type,label,sessionId){var dataSerie=this.getDataSerie(type,label,sessionId);return dataSerie?dataSerie.getAvg():null},setSelected:function(id,parentSelector,selected){if(arguments.length===2){selected=true}var className=id.replace(/\d+/g,"");var classes=jQuery.grep($(parentSelector).attr("class").split(" "),function(n){return n.indexOf(className)===-1});if(selected){classes.push(id+"-selected");if(id!==className){classes.push(className+"-selected")}}var classNames=classes.join(" ");$(parentSelector).attr("class",classNames)},getValue:function(type,name){return $('[data-type="'+type+'"][data-var="'+name+'"]').text()},getAvg:function(type,name){return Math.round($('[data-type="'+type+'"][data-var="'+name+'"]').attr("data-avg")*100)/100},initialize:function(){var self=this;$("a.stats-var").click(function(){var index=$(".stats-var").index($(this)[0]);self.setSelected("stats"+index,this.callStats)})}}},{}],65:[function(require,module,exports){module.exports=Timer;var debug=require("debug")("timer");var Utils=require("./Utils");function Timer(client,stats,configuration){this.text=client.find(".timer");this.client=client;this.stats=stats;this.configuration=configuration;this.callTimer=null;this.startTime=null;this.updateText()}Timer.prototype={start:function(){if(this.callTimer){debug("timer "+this.callTimer+" already running");return}var timer=this.runningTimer();this.callTimer=setInterval(timer,1e3);debug("started timer interval : "+this.callTimer)},stop:function(){this.startTime=null;clearInterval(this.callTimer);debug("cleared timer interval : "+this.callTimer);this.callTimer=null;this.updateText()},getSeconds:function(){return Math.round(((new Date).getTime()-(this.startTime||(new Date).getTime()))/1e3)},updateText:function(){var secs=this.getSeconds();this.text.text(Utils.format(secs))},runningTimer:function(){var self=this;this.startTime=(new Date).getTime();return function(){var secs=self.getSeconds();if(self.configuration.maxCallLength&&secs>=self.configuration.maxCallLength){self.client.terminateSessions();self.client.endCall();return}self.updateText();if(self.configuration.enableCallStats&&Utils.isChrome()){self.stats.processStats()}}}}},{"./Utils":67,debug:10}],66:[function(require,module,exports){module.exports=Transfer;function Transfer(client,sound,sipStack,configuration){this.icon=client.find(".transfer");this.popup=client.find(".transferPopup");this.accept=this.popup.find(".acceptTransfer");this.reject=this.popup.find(".rejectTransfer");this.targetInput=this.popup.find(".transferTarget");this.typeAttended=this.popup.find(".transferTypeAttended");this.visible=false;this.client=client;this.sound=sound;this.sipStack=sipStack;this.configuration=configuration;this.registerListeners()}Transfer.prototype={registerListeners:function(){var self=this;this.icon.bind("click",function(e){e.preventDefault();self.sound.playClick();self.setVisible(!self.visible);if(self.visible){self.targetInput.focus()}});this.accept.bind("click",function(e){e.preventDefault();self.sound.playClick();var targetInput=self.targetInput.val();if($.isBlank(targetInput)){self.client.message(self.configuration.messageOutsideDomain,"alert");return}targetInput=self.client.validateDestination(targetInput);self.setVisible(false);self.sipStack.transfer(targetInput,self.typeAttended.is(":checked"))});this.reject.bind("click",function(e){e.preventDefault();self.sound.playClick();self.setVisible(false)})},setVisible:function(visible){this.visible=visible;this.client.updateClientClass()}}},{}],67:[function(require,module,exports){var Utils={clone:function(obj){return JSON.parse(JSON.stringify(obj))},dataURItoBlob:function(dataURI){var byteString=atob(dataURI.split(",")[1]);var mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0];var ab=new ArrayBuffer(byteString.length);var ia=new Uint8Array(ab);for(var i=0;i<byteString.length;i++){ia[i]=byteString.charCodeAt(i)}var blob=new Blob([ab],{type:mimeString});return blob},format:function(seconds){var hrs=Math.floor(seconds/3600);seconds%=3600;var mns=Math.floor(seconds/60);seconds%=60;var formatedDuration=(hrs<10?"0":"")+hrs+":"+(mns<10?"0":"")+mns+":"+(seconds<10?"0":"")+seconds;return formatedDuration},formatDateTime:function(dateStr){var date=new Date(dateStr);var strDate=date.getMonth()+1+"/"+date.getDate();var hours=date.getHours();var minutes=date.getMinutes();var ampm=hours>=12?"PM":"AM";hours=hours%12;hours=hours?hours:12;minutes=minutes<10?"0"+minutes:minutes;var strTime=hours+":"+minutes+" "+ampm;return strDate+" - "+strTime},getSearchVariable:function(variable){var search=decodeURIComponent(window.location.search.substring(1));var vars=search.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(pair[0]===variable){return pair[1]}}return false},containsKey:function(object,value){return $.inArray(value,$.map(object,function(key){return key}))!==-1},containsValue:function(object,value){return $.inArray(value,$.map(object,function(key,value){return value}))!==-1},addSelectOptions:function(options,selector){$.each(options,function(key,value){$(selector).append($("<option>",{value:value}).text(key))})},randomUserid:function(){var chars="0123456789abcdef";var string_length=10;var userid="";for(var i=0;i<string_length;i++){var rnum=Math.floor(Math.random()*chars.length);userid+=chars.substring(rnum,rnum+1)}return userid},whiteboardCompabilityCheck:function(){var isChrome=this.isChrome();if(!isChrome){return"Chrome is required for whiteboard feature, please go to:<br>"+"<a href='http://chrome.google.com'>http://chrome.google.com</a>"}var major=this.majorVersion();if(isChrome&&major<34){return"Your version of Chrome must be upgraded to at least version 34 in order to be able to use the whiteboard<br>"+"Please go to: <a href='http://chrome.google.com'>http://chrome.google.com</a> or <a href='https://www.google.com/intl/en/chrome/browser/canary.html'>https://www.google.com/intl/en/chrome/browser/canary.html</a>"}},compatibilityCheck:function(client){var isChrome=this.isChrome();var isFirefox=this.isFirefox();if(!isChrome&&!isFirefox){return"Chrome or Firefox is required, please go to:<br>"+"<a href='http://chrome.google.com'>http://chrome.google.com</a> or <a href='http:www.mozilla.org'>http://www.mozilla.org</a>"}var major=this.majorVersion();if(isChrome&&major<25){return"Your version of Chrome must be upgraded to at least version 25<br>"+"Please go to: <a href='http://chrome.google.com'>http://chrome.google.com</a>"}else{if(isFirefox&&major<22){return"Your version of Firefox must be upgraded to at least version 22y<br>"+"Please go to: <a href='http://www.mozilla.org'>http://www.mozilla.org</a>"}client.configuration.enableStats=false}},isValidUsPstn:function(pstn){pstn=pstn.replace(/-/g,"").replace(/\(/g,"").replace(/\)/g,"");return pstn.match(/^1?\d{10}$/)!==null},majorVersion:function(){return detect.parse(navigator.userAgent).browser.major},isChrome:function(){var ua=detect.parse(navigator.userAgent);return/chrom(e|ium)/.test(ua.browser.family.toLowerCase())},isFirefox:function(){var ua=detect.parse(navigator.userAgent);return/firefox/.test(ua.browser.family.toLowerCase())},rebindListeners:function(type,elements,listener){for(var i=0;i<elements.length;i++){this.rebindListener(type,elements[i],listener)}},rebindListener:function(type,element,listener){element.off(type);element.on(type,listener)},colorNameToHex:function(color){if(!color){return false}var colors={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:"transparent"};if(typeof colors[color.toLowerCase()]!=="undefined"){return colors[color.toLowerCase()]}return this.isHexColor(color)?color.indexOf("#")!==-1?color:"#"+color:false},isHexColor:function(color){return/(^#?[0-9A-F]{6}$)|(^#?[0-9A-F]{3}$)/i.test(color)},parseDTMFTones:function(destination){if(!destination){return null}var dtmfMatch=destination.match(/,[0-9A-D#*,]+/,"");return dtmfMatch?dtmfMatch[0]:null}};module.exports=Utils},{}],68:[function(require,module,exports){module.exports=Video;var events=require("./EventBus");var debug=require("debug")("video");function Video(element,sipStack,options){this.ui=element;this.local=this.ui.find(".localVideo video");this.localHolder=this.ui.find(".localVideo");this.remote=this.ui.find(".remoteVideo");this.options=options||{};this.sipStack=sipStack;this.registerListeners()}Video.prototype={registerListeners:function(){var self=this;this.local.bind("playing",function(){self.options.onPlaying()});events.on("userMediaUpdated",function(e){self.updateStreams([e&&e.localStream],[])})},updateSessionStreams:function(){this.updateStreams(this.sipStack.getLocalStreams(),this.sipStack.getRemoteStreams())},updateStreams:function(localStreams,remoteStreams){debug("updating video streams");this.setVideoStream(this.local[0],localStreams);this.setVideoStream(this.remote[0],remoteStreams)},localWidth:function(){return this.local[0].videoWidth},localHeight:function(){return this.local[0].videoHeight},setVideoStream:function(video,streams){var hasStream=streams&&streams.length>0&&typeof streams[0]!=="undefined"&&!streams[0].ended;if(video&&video.mozSrcObject!==undefined){if(hasStream){video.mozSrcObject=streams[0];video.play()}else{video.mozSrcObject=null}}else if(video){if(hasStream){video.src=window.URL&&window.URL.createObjectURL(streams[0])||streams[0]}else{video.src=""}}}}},{"./EventBus":55,debug:10}],69:[function(require,module,exports){var Client=require("./Client");var Utils=require("./Utils");var ClientConfig=require("../js/client-config.js.default");var WebRTC={Client:Client,Utils:Utils,Sound:require("./Sound")};module.exports=WebRTC;Object.defineProperties(WebRTC,{version:{get:function(){return"<%= pkg.version %>"}},name:{get:function(){return"<%= pkg.title %>"}}});jQuery.fn.putCursorAtEnd=function(){return this.each(function(){$(this).focus();if(this.setSelectionRange){var len=$(this).val().length*2;this.setSelectionRange(len,len)}else{$(this).val($(this).val())}this.scrollTop=999999})};$.cssHooks.backgroundColor={get:function(elem){var bg=null;if(elem.currentStyle){bg=elem.currentStyle.backgroundColor}else if(window.getComputedStyle){bg=document.defaultView.getComputedStyle(elem,null).getPropertyValue("background-color")}if(bg.search("rgb")===-1||bg==="transparent"){return bg}else{bg=bg.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+).*\)$/);var hex=function(x){return("0"+parseInt(x,10).toString(16)).slice(-2)};return"#"+hex(bg[1])+hex(bg[2])+hex(bg[3])}}};$(document).ready(function(){var nodes=$("script[src*='webrtc-bundle']");if(nodes.length===0){console.error("no <script> with webrtc-bundle.js found");return}window.BroadSoftWebRTC=window.BroadSoftWebRTC||{};window.BroadSoftWebRTC.clients=[];$.each(nodes,function(i,node){node=$(node);if(!node.text()){return}var configData=JSON.parse(node.text());console.log("script config : ",configData);var clientConfig=Utils.clone(ClientConfig);var config=$.extend({},clientConfig,configData);console.log("merged config : ",config);var client=new Client(config,node.parent());var styleData=node.data();if(styleData){client.updateCss(styleData)}client.src=node[0].src;node.remove();window.BroadSoftWebRTC.clients.push(client)})});(function($){$.isBlank=function(obj){return!obj||$.trim(obj)===""}})(jQuery);if(typeof String.prototype.endsWith!=="function"){String.prototype.endsWith=function(suffix){return this.indexOf(suffix,this.length-suffix.length)!==-1}}},{"../js/client-config.js.default":1,"./Client":51,"./Sound":63,"./Utils":67}],70:[function(require,module,exports){module.exports=Whiteboard;var events=require("./EventBus");function Whiteboard(client,element,sipStack){this.whiteboard=element;this.canvas=this.whiteboard.find(".simple_sketch");if(this.canvas[0]&&this.canvas[0].getContext){this.context=this.canvas[0].getContext("2d")}this.toggled=false;this.client=client;this.sipStack=sipStack;this.color="#000";this.size=5;this.tool="marker";this.action=[];this.initCanvas();this.registerListeners();this.updateToolsSelection()}Whiteboard.prototype={registerListeners:function(){var self=this;events.on("dataReceived",function(e){var data=e.data;
var regex=/^whiteboard:/;if(data.match(regex)){data=data.replace(regex,"");var img=new Image;img.onload=function(){self.clear();self.context.drawImage(img,0,0)};img.src=data}})},initCanvas:function(){var self=this;$.each(["#f00","#ff0","#0f0","#0ff","#00f","#f0f","#000","#fff"],function(){self.whiteboard.find(".tools").append("<a href='.simple_sketch' onclick='javascript:;' data-color='"+this+"' style='width: 10px; background: "+this+";'></a> ")});$.each([3,5,10,15],function(){self.whiteboard.find(".tools").append("<a href='.simple_sketch' onclick='javascript:;' data-size='"+this+"' style='background: #ccc'>"+this+"</a> ")});this.canvas.bind("click mousedown mouseup mousemove mouseleave mouseout touchstart touchmove touchend touchcancel",jQuery.proxy(this,"onEvent"));$("body").delegate('a[href=".'+this.canvas.attr("class")+'"]',"click",function(){var $canvas,$this,key,sketch,_i,_len,_ref;$this=$(this);$canvas=$($this.attr("href"));sketch=$canvas.data("sketch");_ref=["color","size","tool"];for(_i=0,_len=_ref.length;_i<_len;_i++){key=_ref[_i];var value=$this.attr("data-"+key);if(value){if(key==="size"){value=+value}self[key]=value}}self.updateToolsSelection();return false})},updateToolsSelection:function(){var self=this;$.each(this.whiteboard.find(".tools a"),function(){var selected=$(this).data("color")===self.color||$(this).data("tool")===self.tool||+$(this).data("size")===self.size;if(selected){$(this).attr("class","selected")}else{$(this).attr("class","")}})},sendData:function(){var data=this.canvas[0].toDataURL();this.sipStack.sendData("whiteboard:"+data)},clear:function(){this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.canvas[0].width,this.canvas[0].height);this.context.restore()},onEvent:function(e){if(e.originalEvent&&e.originalEvent.targetTouches){e.pageX=e.originalEvent.targetTouches[0].pageX;e.pageY=e.originalEvent.targetTouches[0].pageY}switch(e.type){case"mousedown":case"touchstart":this.painting=true;this.action={tool:this.tool,color:this.color,size:parseFloat(this.size),events:[]};break}if(this.painting){this.action.events.push({x:e.pageX-this.canvas.offset().left,y:e.pageY-this.canvas.offset().top,event:e.type});if(this.tool==="marker"){this.draw(this.action)}else if(this.tool==="eraser"){this.erase(this.action)}}switch(e.type){case"mouseup":case"mouseout":case"mouseleave":case"touchend":case"touchcancel":this.painting=false;this.action=null;this.sendData()}e.preventDefault();return false},erase:function(action){var oldcomposite;oldcomposite=this.context.globalCompositeOperation;this.context.globalCompositeOperation="copy";action.color="rgba(0,0,0,0)";this.draw(action);this.context.globalCompositeOperation=oldcomposite;return this.context.globalCompositeOperation},draw:function(action){var event,previous,_i,_len,_ref;this.context.lineJoin="round";this.context.lineCap="round";this.context.beginPath();this.context.moveTo(action.events[0].x,action.events[0].y);_ref=action.events;for(_i=0,_len=_ref.length;_i<_len;_i++){event=_ref[_i];this.context.lineTo(event.x,event.y);previous=event}this.context.strokeStyle=action.color;this.context.lineWidth=action.size;return this.context.stroke()},toggle:function(){if(this.toggled){this.whiteboard.fadeOut(100)}else{this.whiteboard.fadeIn(100)}this.toggled=!this.toggled}}},{"./EventBus":55}],71:[function(require,module,exports){module.exports=XMPP;var events=require("./EventBus");var debug=require("debug")("xmpp");var debugerror=require("debug")("xmpp:ERROR");debugerror.log=console.warn.bind(console);function XMPP(client){this.client=client;this.init()}XMPP.prototype={init:function(){if(ClientConfig.enableXMPP){try{converse.initialize({auto_list_rooms:false,auto_subscribe:false,bosh_service_url:"https://bind.opkode.im",hide_muc_server:false,i18n:locales.en,prebind:false,show_controlbox_by_default:true,xhr_user_search:false});this.registerListeners()}catch(e){debugerror("Could not init XMPP chat : "+e)}}},registerListeners:function(){var self=this;events.on("started",function(){self.statusBeforeCall=converse.getStatus();debug("status before call : "+self.statusBeforeCall);converse.setStatus("dnd")});events.on("ended",function(){debug("reset status to : "+self.statusBeforeCall);converse.setStatus(self.statusBeforeCall)})}}},{"./EventBus":55,debug:10}]},{},[69]);